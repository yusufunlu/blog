{"componentChunkName":"component---src-templates-blog-post-js","path":"/Spring Security Architecture/","result":{"data":{"site":{"siteMetadata":{"title":"yusufunlu","author":"Yusuf Unlu"}},"markdownRemark":{"id":"71f0c1ba-91c3-5d48-8cb3-39b259a62b8b","html":"<p>Bu yazı <a href=\"https://spring.io/guides/topicals/spring-security-architecture\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://spring.io/guides/topicals/spring-security-architecture</a> adresindeki referans dökümandan yararlanacarak oluşturulmuştur.\nUygulama güvenliği birkaç bağımsız problemle ilgilidir. Bunlar : Authentication(kim?) ve authorization (neye iznin var?). Bu iki kelime birbirine benzediği için authorization yerine access control da kullanılır bazen.</p>\n<h2 id=\"authentication\"><a href=\"#authentication\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authentication</h2>\n<p>Authentication için ana strateji arayüzü AuthenticationManager interface’idir.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">AuthenticationManager</span> <span class=\"token punctuation\">{</span>\n\n  Authentication <span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span>Authentication authentication<span class=\"token punctuation\">)</span>\n    throws AuthenticationException<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>AuthenticationManager</strong> <strong>authenticate</strong> ile 3 şey yapar</p>\n<ul>\n<li>Eğer inputlar valid ise bir <strong>Authentication</strong> nesnesi döner. <strong>authenticated=true</strong> olarak.</li>\n<li>Eğer inputlar invalid ise <strong>AuthenticationException</strong> fırlatır.</li>\n<li>Girdiler valid olduğuna emin olamazsa <strong>null</strong> döner.</li>\n</ul>\n<p><strong>AuthenticationException</strong> bir runtime exception’dır. Bu exception’ı siz handle etmeseniz bile HTTP 401 dönecektir, <strong>WWW-Authenticate</strong> ile veya değil.</p>\n<p>AuthenticationManager’ın en çok kullanılan implementation’u ProviderManager’dır. ProviderManager da sorumluluğu AuthenticationProvider instance’larına dağıtır. Her AuthenticationProvider biraz AuthenticationManager gibidir. </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">AuthenticationProvider</span> <span class=\"token punctuation\">{</span>\n\n\tAuthentication <span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span>Authentication authentication<span class=\"token punctuation\">)</span>\n\t\t\tthrows AuthenticationException<span class=\"token punctuation\">;</span>\n\n\tboolean <span class=\"token function\">supports</span><span class=\"token punctuation\">(</span>Class<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span><span class=\"token operator\">></span> authentication<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>supports()</strong> methodu <strong>authenticate()</strong> methoduna geçecek bir paremetreyi destekleyip desteklemediğini anlamak için kullanılır.\n<strong>ProviderManager</strong> AuthenticationProviders zincirini kullanarak farklı auth mekanizmalarını destekleyebilir.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/19992a59bb9ffbc0b14ed45613139986/393aa/ProviderManager.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEDUlEQVQ4yy2Se0xbdRTHz71lzjm3EExMyP6YxsT9M7OYEXxmGBelC1N8QOmDXlpoeUQKFvAxQJiRuWTRxfgAQRLnxvbHSJgKzMWMMcFlTnFMCtgX99Je2tvnbW+faEuPv879km8+v1/yO+f3Pef8AO6tqqoqqK6uhtvB+wFxD9Hj9I2obHCao+Yvr1OXiX6adNIz86JsajG6oxgR4PzEYzLEVirlZaiMUEdimgDMkgjNUoRuSafoxohId8du0fsQqSB2yn6LUb0zPmp0+KpsavQ6PXnJCl9f88MXE04oQmTyPijk84lMgNkuwH8MFHQmY9ASl6AVc9CSSoJpKwOd5Pn38hYAKYCOBwjp/PHYOMA2QsSL21HQ7/r02FPE6akdiOZdiFmS0EiuS+FCc8xf8i4mn+yI+w92SkJpVyr0TF/cvbdNQe0sPbSvuGegbCdiNyQDTOmmpA+EBa1HFLTekFfrJ9wQfdpg1M8sYKS+GN4Sw0qlICYqV9lApcUZemXR6n/d5vq3dhNPfC+OwV2faKaQWExzjQ8lwroJp73GxjqUf7FO5RK3plwitGy4NcuYNOwHw+ddjy6LJ790SAPDdunEkCM6MGSNfjzsi3Wfwoiu6c6csSif9PjsN/cBXKcx+DzcHJLB3Lk9cGWmAi6MH4aLl16C+ZuVgJlGgJZDBbtzUY3TzyvQw1Wj4PqfG64a3OA1mIloDWPB83BgUYLDxOVzS3541R0GFdkP/vAmPTT4NDUy+iw1feUIdXfKk+dKIBk2PeJx6Sv4df3LnKOu3OOuL/fwBnnA9oZ8PnH2oE4IvK/n2H7GZu3Xrzn6jDx3sj0W1GMIaG/KLJPiJlk2WS/LRvQ0jP8op3IJI/i8KsgFjgBKrwHGa0jf9sMqjkJNDvcawkGLem1tWW23rlTZ2N+PWvnbygR+xmZ6yWQZwBTRpoHENgDcwG/Blxmg8RpQT6xk4eGRWaA/+RngggBFp6egLEY6mCNqtcMM3oHk8tESTNeZUaptxrixDRNGE8YMrRg3dGCkoQzak3Gql/SjD7GwMeCbrrXbZtUWy4zasnRVY/37V2NUGiV2AYfbCN4B14qqKSbqkGNVpM9qdHEq5O8x5NOm4O1kHHpwC3oxt7tZDI3oePdZxuk8wzgdZ7QsO2aW/KcxfLwQt0z5v0jU82BK0FcEOW01b1O/uGZVyX1uRu5yqOXhDaYc2tLJvDvoJ2rweaFqYQFqWRZeyCL8gUuAvsrvEqIuF/EzYjTASIRRKVjHx0J1kbSoa3a7NeCwKmF1RQECXwvQnkpAvuQPiIwBf4HG4ShQ/LlQ8OH8V9sRD0Ai3Khzc+pbdqviF4etZs5mVcyR8ubI57aQEj/ypHXgDWq3rdtVdMijpf8DFKqQ6UD+49IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ProviderManager isteğe bağlı olarak başka bir ProviderManager parent'a sahip olabilir\"\n        title=\"\"\n        src=\"/blog/static/19992a59bb9ffbc0b14ed45613139986/fcda8/ProviderManager.png\"\n        srcset=\"/blog/static/19992a59bb9ffbc0b14ed45613139986/12f09/ProviderManager.png 148w,\n/blog/static/19992a59bb9ffbc0b14ed45613139986/e4a3f/ProviderManager.png 295w,\n/blog/static/19992a59bb9ffbc0b14ed45613139986/fcda8/ProviderManager.png 590w,\n/blog/static/19992a59bb9ffbc0b14ed45613139986/efc66/ProviderManager.png 885w,\n/blog/static/19992a59bb9ffbc0b14ed45613139986/c83ae/ProviderManager.png 1180w,\n/blog/static/19992a59bb9ffbc0b14ed45613139986/393aa/ProviderManager.png 1190w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>ProviderManager isteğe bağlı olarak başka bir ProviderManager parent’a sahip olabilir. Eğer <strong>AuthenticationProviders</strong> null parent’a düşer bu istek.\nUygulamamız <strong>/api/</strong> path’ine göre farklı logic resource gruplardan oluşabilir. Her grup kendi dedicated <strong>AuthenticationManager</strong> ‘ına yani <strong>ProviderManager</strong>‘a sahiptir. Bunlar da ortak bir parent’a sahiptir ve buna global denir. Tüm provider’lar buraya düşer.</p>\n<h2 id=\"customizing-authentication-managers\"><a href=\"#customizing-authentication-managers\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Customizing Authentication Managers</h2>\n<p>Spring Security, bize temel authentication manager özelliklerini ayarlamamız için bazı helper class’lar verir. Bunlardan en çok kullanılanı <strong>AuthenticationManagerBuilder</strong>. Bu class bize in-memory, JDBC ya da LDAP kullanıcı detayları ya da custom UserDetailsService için kolaylık sağlar.</p>\n<ul>\n<li>Aşağıda global <strong>AuthenticationManager</strong> ayarlamak için örnek kodlar vardır. Aşağıdaki <strong>initialize</strong> ve <strong>Autowired</strong> olduğundan global AuthenticationManager configure eder.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">@Configuration\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ApplicationSecurity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">{</span>\n\n   <span class=\"token operator\">...</span> <span class=\"token comment\">// web stuff here</span>\n\n  @Autowired\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">AuthenticationManagerBuilder builder<span class=\"token punctuation\">,</span> DataSource dataSource</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    builder<span class=\"token punctuation\">.</span><span class=\"token function\">jdbcAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">dataSource</span><span class=\"token punctuation\">(</span>dataSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dave\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"secret\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"USER\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Aşağıdaki kodlar da <strong>Override</strong> ile <strong>configure</strong> methodunu kullandığından yalnızca local <strong>AuthenticationManager</strong> build eder.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">@Configuration\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ApplicationSecurity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">{</span>\n\n  @Autowired\n  DataSource dataSource<span class=\"token punctuation\">;</span>\n\n   <span class=\"token operator\">...</span> <span class=\"token comment\">// web stuff here</span>\n\n  @Override\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">AuthenticationManagerBuilder builder</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    builder<span class=\"token punctuation\">.</span><span class=\"token function\">jdbcAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">dataSource</span><span class=\"token punctuation\">(</span>dataSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dave\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"secret\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"USER\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Spring boot bize tek kullanıcı için bir <strong>AuthenticationManager</strong> bizim için hazır getirir. Ta ki AuthenticationManager’ınızı implement edene kadar.  </p>\n<h2 id=\"authorization-or-access-control\"><a href=\"#authorization-or-access-control\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization or Access Control</h2>\n<ul>\n<li>authentication tamamlanınca authorization’a geçebiliriz. Buradaki temel strateji <strong>AccessDecisionManager</strong> dir. Aynen <strong>ProviderManager</strong>‘ın <strong>AuthenticationProviders</strong> zincirine(chain) sorumluluğu verilmesi gibi burada da sorumluluk <strong>AccessDecisionVoter</strong> zincirine verilir.  Burada 3 tip implementasyon vardır.\n<strong>AccessDecisionVoter</strong> principal’ı temsil eden <strong>Authentication</strong>‘a ve <strong>ConfigAttributes</strong> ile tanımlanan secure <strong>Object</strong>‘a ihtiyaç duyar. </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">boolean <span class=\"token function\">supports</span><span class=\"token punctuation\">(</span>ConfigAttribute attribute<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nboolean <span class=\"token function\">supports</span><span class=\"token punctuation\">(</span>Class<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span><span class=\"token operator\">></span> clazz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nint <span class=\"token function\">vote</span><span class=\"token punctuation\">(</span>Authentication authentication<span class=\"token punctuation\">,</span> <span class=\"token constant\">S</span> object<span class=\"token punctuation\">,</span>\n        Collection<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"> attributes);</span></code></pre></div>\n<p>//todo buraya ekleme yapılacak</p>\n<h2 id=\"web-security\"><a href=\"#web-security\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web Security</h2>\n<p>Spring security web’de Servlet Filter’lara göre çalışır.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/0c63cd2617c6907c1b30ef37802886cd/393aa/filters.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACYklEQVQ4y43Tb0gTcRgH8GfbOcuNSNBeFCGzN0Vvioyiwl6IUEJvWwlBWJs6bb0KpaCiCPvfm+Wb0PkiAlHKTQtsS2tntrkZ1k73prAM89SWt93dbrc/9+vZBCmIeT/4cHx5nvtyd3AA/zkBkqfJXSeQDz2dBfCkV/Pfc1UnKBdpEQQFfW0oS3nHRco1NEu56DjlwjwSkoobgrIe9/RaVYWMDBoEjADVTAZ6pyRw9gehzx8F53QW+pgEnM7PZVBXWB0jeTVRYjwiEtPh36SiqmvqYB0hFYc4YqrhSOlRnOeoOi2yqENgF1YabBmZNEqCUj/DEEt8JWvLpog9EX/QinOkU1XYtjQPbcvzcIWdK760/LO8XeTKajtu7W6LR8swb7m8+MOQ22lH6p4wKWkQ2PnYvuZM+q5VFG6enAg8tAr8DVsmff+CyB/PzVuTCXXfsDklaxHgjSealGzYIif9Zib8+bwofmhSlJlWKXHRhnO0/isfeBkGt8uJenKogQGnwT3cW1J3xrxjZNJT8rz/iWHQ3aMfxJ0hVzdUeucKF25/twRN6ZQOgU0UzloVhZyTJMEciUgNgsg3Ym6WpDstOEc63UR6ncK3i3CNW4DrsQVYIdPGTvKr6jHh91rcz445SHyPg0T3j5PZ8no2BqfYmIYKrFO4y/MNgJA86r1kh/HMI3gd7YAuvwNesbcx39OOSVcradZoolkopbnChTu939cKN/qTnUUh5aPex/mKXF9o/ZtlGnNgQyD5Ytsou2nrKAubx2KagoWaQGqtEGbQVzSGuj8BDPOrOYJCaBKF//1b/gAgCXbGm0Y9pAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Bir web client request attığında container hangi filter ve servlet çalışacağına request URI'ye göre karar verir.\"\n        title=\"\"\n        src=\"/blog/static/0c63cd2617c6907c1b30ef37802886cd/fcda8/filters.png\"\n        srcset=\"/blog/static/0c63cd2617c6907c1b30ef37802886cd/12f09/filters.png 148w,\n/blog/static/0c63cd2617c6907c1b30ef37802886cd/e4a3f/filters.png 295w,\n/blog/static/0c63cd2617c6907c1b30ef37802886cd/fcda8/filters.png 590w,\n/blog/static/0c63cd2617c6907c1b30ef37802886cd/efc66/filters.png 885w,\n/blog/static/0c63cd2617c6907c1b30ef37802886cd/c83ae/filters.png 1180w,\n/blog/static/0c63cd2617c6907c1b30ef37802886cd/393aa/filters.png 1190w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \nBir web client request attığında container hangi filter ve servlet çalışacağına request URI’ye göre karar verir. Çoğunlukla bir servlet request’i handle eder ama filter’lar sıralı bir zincir oluşturur. Bir filter kendisinden sonraki filteri devre dışı bırakabilir eğer requesti kendisi kullanmak isterse.  Ayrıca filtre request ve response objelerini değiştirebilir. Filtrelerin sırası önemlidir. Sıra 2 lekilde sağlanabilir. </p>\n<ul>\n<li>Filter’in <strong>@Beans</strong>‘i <strong>@Order</strong> alabilir veya <strong>Ordered</strong>‘ı implement eder.</li>\n<li><strong>FilterRegistrationBean **‘ın bir parçası olarak.\nBazı hazır filtreler hangi sırada olduğunu kendisi belirlemek ister. Mesela **SessionRepositoryFilter ** önlerde olmak ister ama kendinden öncekileri zorlamaz.\nSpring Security yalnız tek bir filtre olarak yüklenir ve bunun tipi de **FilterChainProxy</strong>‘dir .\nSpring Boot uygulamarında security filter <strong>ApplicationContext</strong> içinde bir <strong>@Bean</strong> olarak çalışır ve bu filter her requeste uygulanır. Bu filtrenin sırası <strong>SecurityProperties.DEFAULT<em>FILTER</em>ORDER</strong> ile belirlenir.\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/3f60f83afd640295241ce31d230f60e8/393aa/security-filters.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAD/ElEQVQ4yzWTf1DTZRjAn8UXnHYw3A8GBwJ5IpWEQYt+cKeGEWp3SdZFIIqRwjYI7MIE5a5bpnaK3mHd7NTyECtKIWAgFxd3iAxhQDOG/FgDkZNBsI3G5mBs+z49G/bH597n+37f9/N93vd5vtDvCoB6BGgheoheotkO8PMkgJpizZP5PwkAB6wT8iEiNAJCBUKICg2HMIEIwkPCoIgWbs0oBdCaedBEi1u9sqUARR/L/NE2y9S3TDIN3U5G1ecibKs2aB3+JETY+EKcIDbpdeH6zQnC515+RbjhRYkwJlEiqkCElI/KAYbNAB0ku0voFqFkGKGm/RFcr9dCjc4FVweXoUq3AM/0WxjIOFUtWMeJDRMATywEoTgE1obyIUgkgCDxttzvBTkXe/0g3UgmXGGrGcVbECMlt3BTcvO/iamIEckmjH5rHgOiBhB2FNQFHUFcfxhxcyHLxtEYV4wY/xni8xlXbot2vneZgTKzEQQkiyMKl+y/yz3LmDsz5cnWj6DM7US504HFVpOkht6LIUaUbzHpZCyLB4xT7uwxAyt1u1DmWnYWakdfuu5N7MTECOym4EPi6OwU7yKiILu1Jept5TcxPyCuLbOZRYjIoQtkUguu8UoejQeXu5eEuV13wtPOn439ApFfavuH/+7XTbzdxTcpQ9OM77gRhNxmzdk3NnYma+j+6cyBv87uGx//Ms9iPvl+U2MMCTkpaco1BYsOmZz1nMl5OHEqa1BXIfe4v5K7lxWH2u5Fe/sAjlpmfcJoQrbouLD34YQuc2SkN3N0VJs1Ntb9scWsydb0SChL2BJZzpU7l6qkiAM509OaLMPf9/JZViP1uNXSnuFNM94jq367Ct7gPlGrqubSRq5cURaSUXCIksZVjR2NT/u+DFwm9XANr/ZXJVfT3bT62LkT/PQDWZFDw2pu+y3l6j2lvwS+c6yJgU9NcxBMsnhC6nSq8siyf2bGnmkwOPJY1pHvci3KrFZJva8oG4V51nkNZejePz1t3fvggZ0yfCxlPZYCrT7hJ/R1PwJ3CkEwjvTHTEZdQlficb0m+ZN2VQoVJf47djoB8YZf80Q17DhYHVQ0b0kqtNnSZHNz2/ONxjcLFxZSixy2N7KvdYRue63SD4LuWDnBaiuEdJiiQO08B12e03BDfx6q+ivhtuMkqF2VazrtGRz1MmxXtAQzEMisXAF4K//Uk5GTcvBH3gcVrX4QrF4g4QIJzc8GaFxq/1632r/V2OmvGu8M6Hrc4d/n0QbedZQwvW5f8ZQEtQrnOFFKKAjv86vplyHzQhu5dbiClhgl9EQDtVLVIEA/xQZiaGX+2yQp7DpSS9TBThr/Z9fndZBWchP2lDfAf7nANGDjjVrGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"FilterChainProxy \"\n        title=\"\"\n        src=\"/blog/static/3f60f83afd640295241ce31d230f60e8/fcda8/security-filters.png\"\n        srcset=\"/blog/static/3f60f83afd640295241ce31d230f60e8/12f09/security-filters.png 148w,\n/blog/static/3f60f83afd640295241ce31d230f60e8/e4a3f/security-filters.png 295w,\n/blog/static/3f60f83afd640295241ce31d230f60e8/fcda8/security-filters.png 590w,\n/blog/static/3f60f83afd640295241ce31d230f60e8/efc66/security-filters.png 885w,\n/blog/static/3f60f83afd640295241ce31d230f60e8/c83ae/security-filters.png 1180w,\n/blog/static/3f60f83afd640295241ce31d230f60e8/393aa/security-filters.png 1190w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \nYukarıdaki şekle bakınca farklı dursa da aslında bir fiziksel filter vardır.  Bu filtre <strong>FilterChainProxy ** içerir. FilterChainProxy  bir bean’dir ve içerdiği tüm filtreler de Servlet’ten gelen **Filter ** interface’ini implement eder.  Her birinin de zincirin gerisini veto etme hakkı vardır.\nSpring Security filter birden fazla filter zinciri içerebilir ve gelen request’i eşleşen ilk zincire gönderir.\nAşağıda /foo/</strong> adresine gelen request’i /** zincirine dağıtması gösteriliyor. Ama en önemlisi bir request’i yalnızca bir chain yakalıyor.</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/95561c170de539398957b14db5d3318a/393aa/security-filters-dispatch.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADrklEQVQ4y41TbUxTZxQ+vcwZpQOCFrtkm382/5rgRjAZmR9UvubmCi3tvb2FdhsK9MtageGUgQYicfzhI0MxYhvEUVr5EDcygjodiRQZLS0ELMMtaWUsM5NK21vavnsvlP1btpM8Oc977nuec8593xcgZmVMEDQIcdSRNSheegZiux0kMzNQ6HAA6XbDcf8qGIIYjB80qyvwn6YK+AlNNAKaEEN9uvy7hV5wX5M/fXqd/mXhumLpmanUv9pu8P3FM/h9oHv5glNQUPDvYlwuF9RBP6FDEdAyAcVnfyx/T7mcPTLn9ABlt/fR83N9ZS99psqQP8Xw5zJolzwcoVAIqampMDg4CB6PB/h8/oZYRqkR8qqHYBIhUM4tcj5f9YHo+XNIx2MempqC93A8w+WCEuxfB+BI6xoJdf1R+CQzDTLTeJCWKYNjDTbIOmWGbIMFILdxCA7IuqECIaIfJ+UZO7bKrJZt717SEVvxWnRv5NV96tL4MoTilN8NbKHS+YRMKYyje29u+ajfHIfjhB7jsNYMGcougKzG2xxBeXdiACdvB9ixDSDlHubZht4kgdKYgDDfCfAGARDP8uyqvsTDso6E2N9iPcEiS29OEGh6NqLUzTG+KhRsKRwfH5DNzt5SRcJNZM23PPkPjrfLmWC7eOwnCz0/b1aH1776WNKcpLg7vUcVWWshndOdRb/9alIHmfOiOkuy4soIK/c+R9oxulMfCclpp0NL2h5V4BFIUVVXMnXr0Vu6aPiEdPKxgZp2VJ9EEemHdFuCfHB8tw5FS8QPH5yhZ10VulCIEp4zJ8lbh1nBV0DaeZ+nDTMayYStlvx5sl6LoqXiL7t3UP22N7XRsAonniXtU7UnUZQ6SrclFg3ZdrN7Cu6O1tJzs2ewoDyfFWwb3hiZND3AgqEqesbVJHM5m/FmQ2GlKZketr+DR/6Gdj+5XOz1dqoYpvYY2ZqoGHXsKQ8xrTh+pdjruaYKBC6I6qzJissjm4I/8rSRtUrJY1uTZHKiRYuQnm4dSknPbeeyB1GD8TUGy3Oq+187IL4avxm/hIGNk33KyhWoYodCGh/uwi/lbNHiYoPS672Iu6qSNd/Z9cXtUTiHrwTpWyAUaIXAnJNTcwf27b24fs3IFTehRC+ICzh+RG+FD5Q3AOgJNwiO39jOVjyP0Rnr5Iimd72L/flXIfe0BXIrrP/4HNafjq03wX7HgPyuMTgoN0I9rlKCfIQKV27A/NCJnnXhJrQCeZVW+L/2N2uC9lC2GqyKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"FilterChainProxy \"\n        title=\"\"\n        src=\"/blog/static/95561c170de539398957b14db5d3318a/fcda8/security-filters-dispatch.png\"\n        srcset=\"/blog/static/95561c170de539398957b14db5d3318a/12f09/security-filters-dispatch.png 148w,\n/blog/static/95561c170de539398957b14db5d3318a/e4a3f/security-filters-dispatch.png 295w,\n/blog/static/95561c170de539398957b14db5d3318a/fcda8/security-filters-dispatch.png 590w,\n/blog/static/95561c170de539398957b14db5d3318a/efc66/security-filters-dispatch.png 885w,\n/blog/static/95561c170de539398957b14db5d3318a/c83ae/security-filters-dispatch.png 1180w,\n/blog/static/95561c170de539398957b14db5d3318a/393aa/security-filters-dispatch.png 1190w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id=\"creating-and-customizing-filter-chains\"><a href=\"#creating-and-customizing-filter-chains\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating and Customizing Filter Chains</h2>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">@Configuration\n@<span class=\"token function\">Order</span><span class=\"token punctuation\">(</span>SecurityProperties<span class=\"token punctuation\">.</span><span class=\"token constant\">BASIC_AUTH_ORDER</span> <span class=\"token operator\">-</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ApplicationConfigurerAdapter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">{</span>\n  @Override\n  <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>HttpSecurity http<span class=\"token punctuation\">)</span> throws Exception <span class=\"token punctuation\">{</span>\n    http<span class=\"token punctuation\">.</span><span class=\"token function\">antMatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/foo/**\"</span><span class=\"token punctuation\">)</span>\n     <span class=\"token operator\">...</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Yukarıdaki örnekte gelen requesti basic auth filter’dan önce yakalamak için <strong>@Order</strong> kullanılarak ondan daha düşük bir sıra verilmiştir .\nDiğer bir yöntem olarak da <strong>security.basic.enabled=false</strong> yapılabilirdik. </p>\n<p>Many applications have completely different access rules for one set of resources compared to another. For example an application that hosts a UI and a backing API might support cookie-based authentication with a redirect to a login page for the UI parts, and token-based authentication with a 401 response to unauthenticated requests for the API parts. Each set of resources has its own WebSecurityConfigurerAdapter with a unique order and a its own request matcher. If the matching rules overlap the earliest ordered filter chain will win.\nÇoğu uygulama farklı kaynaklara erişim için farklı kurallara sahiptir. Mesela bir UI backend cookie tabanlı authentication destekleyip login sayfasına yönlendirme yapmak isterken , API kısımları token temelli authentication http 401 response verebilir.  </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">@Configuration\n@<span class=\"token function\">Order</span><span class=\"token punctuation\">(</span>SecurityProperties<span class=\"token punctuation\">.</span><span class=\"token constant\">BASIC_AUTH_ORDER</span> <span class=\"token operator\">-</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ApplicationConfigurerAdapter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">{</span>\n  @Override\n  <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>HttpSecurity http<span class=\"token punctuation\">)</span> throws Exception <span class=\"token punctuation\">{</span>\n    http<span class=\"token punctuation\">.</span><span class=\"token function\">antMatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/foo/**\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/foo/bar\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"BAR\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/foo/spam\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SPAM\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>request matcher vs filter chain ?\nOne of the easiest mistakes to make with configuring Spring Security is to forget that these matchers apply to different processes, one is a request matcher for the whole filter chain, and the other is only to choose the access rule to apply.</p>\n<ul>\n<li>Combining Application Security Rules with Actuator Rules\nEğer projenizde endpoint’leri yönetmek için Spring Boot Actuator kullanıyorsanız, onlar da secure de olur ve bunlar için yeni bir filter chain tanımlanır. Bu filter chain’in order’ı yani sırası **ManagementServerProperties.BASIC<em>AUTH</em>ORDER ** ile tanımlıdır ve sıra numarası **SecurityProperties **‘dan 5 düşüktür.\nEğer defalt security rullarının actuator için de geçerli olmasını isterseniz actuator’e daha yüksek bir order verin.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">@Configuration\n@<span class=\"token function\">Order</span><span class=\"token punctuation\">(</span>ManagementServerProperties<span class=\"token punctuation\">.</span><span class=\"token constant\">BASIC_AUTH_ORDER</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ApplicationConfigurerAdapter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">{</span>\n  @Override\n  <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>HttpSecurity http<span class=\"token punctuation\">)</span> throws Exception <span class=\"token punctuation\">{</span>\n    http<span class=\"token punctuation\">.</span><span class=\"token function\">antMatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/foo/**\"</span><span class=\"token punctuation\">)</span>\n     <span class=\"token operator\">...</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","timeToRead":6,"frontmatter":{"title":"Spring Security Architecture","date":"April 25, 2020","spoiler":"Authentication and Authorization(Access Control)"},"fields":{"slug":"/Spring Security Architecture/","langKey":"en"}}},"pageContext":{"slug":"/Spring Security Architecture/","previous":{"fields":{"slug":"/First post/","langKey":"en","directoryName":"First post","maybeAbsoluteLinks":["/test/"]},"frontmatter":{"title":"First post"}},"next":{"fields":{"slug":"/Neo4J Graph Db/","langKey":"en","directoryName":"Neo4J Graph Db","maybeAbsoluteLinks":[]},"frontmatter":{"title":"Neo4J Graph Db nedir ve Spring ile örnek"}},"translations":["tr"],"translatedLinks":[]}},"staticQueryHashes":["336482444"]}