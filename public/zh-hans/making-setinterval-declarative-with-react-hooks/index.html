<!DOCTYPE html><html lang="zh-hans"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/2.4ac699a3d6a5be115d81.css">@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:url(/static/merriweather-400-l-8796b7875d52e9cb9b280211e8d3f82d.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:url(/static/montserrat-900-l-5751237264c0468be0d48ad1cea75b90.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}body{--pink:#ffa7c4;background-color:var(--bg)}body.light{--bg:#fff;--header:var(--pink);--textNormal:#222;--textTitle:#222;--textLink:#d23669;--hr:rgba(0,0,0,0.2);--inlineCode-bg:rgba(255,229,100,0.2);--inlineCode-text:#1a1a1a}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--textLink:var(--pink);--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:#373c49;--inlineCode-text:#e6e6e6}body:lang(ar) article,body:lang(fa) article{direction:rtl}body:lang(ar) .language-text,body:lang(ar) article .translations,body:lang(ar) article pre,body:lang(fa) .language-text,body:lang(fa) article .translations,body:lang(fa) article pre{direction:ltr}body:lang(ar) .language-text,body:lang(fa) .language-text{display:inline-block}body:lang(ar) blockquote,body:lang(fa) blockquote{border-left:unset;border-right:.32813rem solid rgba(0,0,0,.9);padding-right:1.42188rem;padding-left:unset;margin-left:.75rem;margin-right:-1.75rem}body:lang(fa) article,body:lang(fa) header>h1{font-family:Vazir}body:lang(ar) article,body:lang(ar) header>h1{font-family:Cairo,sans-serif}body:lang(ko) article,body:lang(ko) header{word-break:keep-all}code[class*=language-],pre[class*=language-]{color:#fff;background:none;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;-webkit-font-feature-settings:normal;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:var(--inlineCode-bg);color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;padding-right:1em;padding-left:1.25em;border-left:.25em solid #ffa7c4}.gatsby-highlight,.gatsby-highlight-code-line{margin-right:-1.3125rem;margin-left:-1.3125rem}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#011627;-webkit-overflow-scrolling:touch;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}.react-toggle{touch-action:pan-x;display:inline-block;position:relative;cursor:pointer;background-color:transparent;border:0;padding:0;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.react-toggle-screenreader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle-track{width:50px;height:24px;padding:0;border-radius:30px;background-color:#0f1114;transition:all .2s ease}.react-toggle-track-check{position:absolute;width:17px;height:17px;left:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0;opacity:0;transition:opacity .25s ease}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{position:absolute;width:17px;height:17px;right:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{position:absolute;top:1px;left:1px;width:22px;height:22px;border-radius:50%;background-color:#fafafa;box-sizing:border-box;transition:all .5s cubic-bezier(.23,1,.32,1) 0ms;-webkit-transform:translateX(0);transform:translateX(0)}.react-toggle--checked .react-toggle-thumb{-webkit-transform:translateX(26px);transform:translateX(26px);border-color:#19ab27}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #ffa7c4}.react-toggle:active .react-toggle-thumb{box-shadow:0 0 5px 5px #ffa7c4}</style><style data-href="/component---src-templates-blog-post-js.f3aea2f29a9b96501823.css">@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:url(/static/merriweather-400-i-l-9a3ea56a5f449980432ace5972181ef6.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:url(/static/merriweather-700-l-e24e02bb044cb07539a3a6bd12348d14.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:url(/static/merriweather-700-i-l-ad085ede31afcc5585ff34869b1cd029.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}.formkit-form *{box-sizing:border-box}.formkit-form legend{border:none;font-size:inherit;margin-bottom:10px;padding:0;position:relative;display:table}.formkit-form fieldset{border:0;padding:.01em 0 0;margin:0;min-width:0}.formkit-form body:not(:-moz-handler-blocked) fieldset{display:table-cell}.formkit-form p{color:inherit;font-size:inherit;font-weight:inherit}.formkit-form[data-format="slide in"],.formkit-form[data-format=modal]{display:none}.formkit-form .formkit-checkboxes,.formkit-form .formkit-input,.formkit-form .formkit-select{width:100%}.formkit-form .formkit-button,.formkit-form .formkit-submit{border:0;border-radius:5px;color:#fff;cursor:pointer;display:inline-block;text-align:center;font-size:15px;font-weight:500;margin-bottom:15px;overflow:hidden;padding:0;position:relative;vertical-align:middle}.formkit-form .formkit-button:focus,.formkit-form .formkit-button:hover,.formkit-form .formkit-submit:focus,.formkit-form .formkit-submit:hover{outline:none}.formkit-form .formkit-button:focus>span,.formkit-form .formkit-button:hover>span,.formkit-form .formkit-submit:focus>span,.formkit-form .formkit-submit:hover>span{background-color:#dc658d}.formkit-form .formkit-button>span,.formkit-form .formkit-submit>span{display:block;transition:all .3s ease-in-out;padding:12px 24px}.formkit-form .formkit-input{background:#fff;font-size:15px;padding:12px;border:1px solid #e3e3e3;flex:1 0 auto;line-height:1.4;margin:0;transition:border-color .3s ease-out}.formkit-form .formkit-input:focus{outline:none;border-color:#1677be;transition:border-color .3s ease}.formkit-form .formkit-input::-webkit-input-placeholder{color:#848585}.formkit-form .formkit-input:-ms-input-placeholder{color:#848585}.formkit-form .formkit-input::-ms-input-placeholder{color:#848585}.formkit-form .formkit-input::placeholder{color:#848585}.formkit-form [data-group=dropdown]{position:relative;display:inline-block;width:100%}.formkit-form [data-group=dropdown]:before{content:"";top:calc(50% - 2.5px);right:10px;position:absolute;pointer-events:none;border-color:#4f4f4f transparent transparent;border-style:solid;border-width:6px 6px 0;height:0;width:0;z-index:999}.formkit-form [data-group=dropdown] select{height:auto;width:100%;cursor:pointer;color:#333;line-height:1.4;margin-bottom:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:15px;padding:12px 25px 12px 12px;border:1px solid #e3e3e3;background:#fff}.formkit-form [data-group=dropdown] select:focus{outline:none}.formkit-form [data-group=checkboxes]{text-align:left;margin:0}.formkit-form [data-group=checkboxes] [data-group=checkbox]{margin-bottom:10px}.formkit-form [data-group=checkboxes] [data-group=checkbox] *{cursor:pointer}.formkit-form [data-group=checkboxes] [data-group=checkbox]:last-of-type{margin-bottom:0}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]{display:none}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]+label:after{content:none}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label:after{border-color:#fff;content:""}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label:before{background:#10bf7a;border-color:#10bf7a}.formkit-form [data-group=checkboxes] [data-group=checkbox] label{position:relative;display:inline-block;padding-left:28px}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:after,.formkit-form [data-group=checkboxes] [data-group=checkbox] label:before{position:absolute;content:"";display:inline-block}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:before{height:16px;width:16px;border:1px solid #e3e3e3;background:#fff;left:0;top:3px}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:after{height:4px;width:8px;border-left:2px solid #4d4d4d;border-bottom:2px solid #4d4d4d;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);left:4px;top:8px}.formkit-form .formkit-alert{background:#f9fafb;border:1px solid #e3e3e3;border-radius:5px;flex:1 0 auto;list-style:none;margin:25px auto;padding:12px;text-align:center;width:100%}.formkit-form .formkit-alert:empty{display:none}.formkit-form .formkit-alert-success{background:#d3fbeb;border-color:#10bf7a;color:#0c905c}.formkit-form .formkit-alert-error{background:#fde8e2;border-color:#f2643b;color:#ea4110}.formkit-form .formkit-spinner{display:flex;height:0;width:0;margin:0 auto;position:absolute;top:0;left:0;right:0;overflow:hidden;text-align:center;transition:all .3s ease-in-out}.formkit-form .formkit-spinner>div{margin:auto;width:12px;height:12px;background-color:#fff;opacity:.3;border-radius:100%;display:inline-block;-webkit-animation:formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd- 1.4s ease-in-out infinite both;animation:formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd- 1.4s ease-in-out infinite both}.formkit-form .formkit-spinner>div:first-child{-webkit-animation-delay:-.32s;animation-delay:-.32s}.formkit-form .formkit-spinner>div:nth-child(2){-webkit-animation-delay:-.16s;animation-delay:-.16s}.formkit-form .formkit-submit[data-active] .formkit-spinner{opacity:1;height:100%;width:50px}.formkit-form .formkit-submit[data-active] .formkit-spinner~span{opacity:0}@-webkit-keyframes formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd-{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd-{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.formkit-form{box-shadow:0 2px 15px 0 rgba(210,214,220,.5);max-width:700px;overflow:hidden}.formkit-form [data-style=full]{width:100%;display:block}.formkit-form .formkit-header{margin-top:0;margin-bottom:20px;font-family:inherit}.formkit-form .formkit-subheader{margin:15px 0}.formkit-form .formkit-column{background-size:cover;background-repeat:no-repeat;background-position:50%;padding:20px}.formkit-form .formkit-column:nth-child(2){border-top:1px solid #e9ecef}.formkit-form .formkit-field{margin:0 0 15px}.formkit-form .formkit-input,.formkit-form .formkit-submit{width:100%}.formkit-form .formkit-guarantee{font-size:13px;margin:0 0 15px}.formkit-form .formkit-guarantee>p{margin:0}.formkit-form .formkit-powered-by{color:#7d7d7d;display:block;font-size:12px;margin-bottom:0;text-align:center}.formkit-form .formkit-powered-by[data-active=false]{opacity:.5}.formkit-form[min-width~="600"] [data-style=full],.formkit-form[min-width~="700"] [data-style=full],.formkit-form[min-width~="800"] [data-style=full]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.formkit-form[min-width~="600"] .formkit-submit,.formkit-form[min-width~="700"] .formkit-submit,.formkit-form[min-width~="800"] .formkit-submit{width:auto}.formkit-form[min-width~="600"] .formkit-column,.formkit-form[min-width~="700"] .formkit-column,.formkit-form[min-width~="800"] .formkit-column{padding:40px}.formkit-form[min-width~="600"] .formkit-column:nth-child(2),.formkit-form[min-width~="700"] .formkit-column:nth-child(2),.formkit-form[min-width~="800"] .formkit-column:nth-child(2){border-top:none}</style><meta name="generator" content="Gatsby 2.0.91"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="Dan Abramov&#x27;s Overreacted Blog RSS Feed" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><title data-react-helmet="true">ä½¿ç”¨ React Hooks å£°æ˜ setInterval â€” Overreacted</title><meta data-react-helmet="true" name="theme-color" content="#282c35"/><meta data-react-helmet="true" name="description" content="æˆ‘æ˜¯å¦‚ä½•å­¦ä¹ åœæ­¢æ‹…å¿ƒå’Œå–œçˆ± refs çš„ã€‚"/><meta data-react-helmet="true" property="og:url" content="https://overreacted.io/zh-hans/making-setinterval-declarative-with-react-hooks/"/><meta data-react-helmet="true" property="og:title" content="ä½¿ç”¨ React Hooks å£°æ˜ setInterval"/><meta data-react-helmet="true" property="og:description" content="æˆ‘æ˜¯å¦‚ä½•å­¦ä¹ åœæ­¢æ‹…å¿ƒå’Œå–œçˆ± refs çš„ã€‚"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@dan_abramov"/><meta data-react-helmet="true" name="twitter:title" content="ä½¿ç”¨ React Hooks å£°æ˜ setInterval"/><meta data-react-helmet="true" name="twitter:description" content="æˆ‘æ˜¯å¦‚ä½•å­¦ä¹ åœæ­¢æ‹…å¿ƒå’Œå–œçˆ± refs çš„ã€‚"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:inherit;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);border-left-color:inherit;opacity:0.8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:var(--hr);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"â€” ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:var(--textLink);text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}a.anchor{box-shadow:none;}a.anchor svg[aria-hidden="true"]{stroke:var(--textLink);}p code{font-size:1rem;}h1 code, h2 code, h3 code, h4 code, h5 code, h6 code{font-size:inherit;}li code{font-size:1rem;}blockquote.translation{font-size:1em;}</style><link as="script" rel="preload" href="/component---src-templates-blog-post-js-5ff9d93420b5b2cefece.js"/><link as="script" rel="preload" href="/app-83825dcbe188439d174e.js"/><link as="script" rel="preload" href="/0-b197e8c6c7ff26484233.js"/><link as="script" rel="preload" href="/2-31a6021f1637c5720eda.js"/><link as="script" rel="preload" href="/1-1b550cd61a5e170131aa.js"/><link as="script" rel="preload" href="/webpack-runtime-dea655677e505366ecd7.js"/><link as="fetch" rel="preload" href="/static/d/661/path---zh-hans-making-setinterval-declarative-with-react-hooks-a-62-bc3-3AQLyCZjbz2COfIef2q2sw3E.json" crossorigin="use-credentials"/></head><body class="light"><script>
              (function() {
                window.__onThemeChange = function() {};
                function setTheme(newTheme) {
                  window.__theme = newTheme;
                  preferredTheme = newTheme;
                  document.body.className = newTheme;
                  window.__onThemeChange(newTheme);
                }

                var preferredTheme;
                try {
                  preferredTheme = localStorage.getItem('theme');
                } catch (err) { }

                window.__setPreferredTheme = function(newTheme) {
                  setTheme(newTheme);
                  try {
                    localStorage.setItem('theme', newTheme);
                  } catch (err) {}
                }

                var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
                darkQuery.addListener(function(e) {
                  window.__setPreferredTheme(e.matches ? 'dark' : 'light')
                });

                setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
              })();
            </script><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="color:var(--textNormal);background:var(--bg);transition:color 0.2s ease-out, background 0.2s ease-out;min-height:100vh"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2.625rem"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:0;height:42px;line-height:2.625rem"><a style="box-shadow:none;text-decoration:none;color:rgb(255, 167, 196)" href="/">Overreacted</a></h3><div style="height:24px"></div></header><main><article><header><h1 style="color:var(--textTitle)">ä½¿ç”¨ React Hooks å£°æ˜ setInterval</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.4rem">2019 M02 4<!-- --> â€¢ â˜•ï¸â˜•ï¸ 11 min read</p><div class="translations"><p style="font-size:0.9em;border:1px solid var(--hr);border-radius:0.75em;padding:0.75em;background:var(--inlineCode-bg);word-break:keep-all;font-family:system-ui, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
    &quot;Roboto&quot;, &quot;Oxygen&quot;, &quot;Ubuntu&quot;, &quot;Cantarell&quot;, &quot;Fira Sans&quot;,
    &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif"><span><span>Translated by readers into: </span><a href="/fr/making-setinterval-declarative-with-react-hooks/">FranÃ§ais</a> â€¢ <b>ç®€ä½“ä¸­æ–‡</b></span><br/><br/><a href="/making-setinterval-declarative-with-react-hooks/">Read the original</a> â€¢ <a href="https://github.com/gaearon/overreacted.io/edit/master/src/pages/making-setinterval-declarative-with-react-hooks/index.zh-hans.md" target="_blank" rel="noopener noreferrer">Improve this translation</a> â€¢ <a href="/zh-hans">View all translated posts</a> </p></div></header><div><p>å¦‚æœä½ ç©äº†å‡ å°æ—¶çš„ <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="nofollow noopener noreferrer">React Hooks</a>ï¼Œä½ å¯èƒ½ä¼šé™·å…¥ä¸€ä¸ªçƒ¦äººçš„é—®é¢˜ï¼šåœ¨ç”¨ <code class="language-text">setInterval</code> æ—¶æ€»ä¼š<a href="https://stackoverflow.com/questions/53024496/state-not-updating-when-using-react-state-hook-within-setinterval" target="_blank" rel="nofollow noopener noreferrer">åç¦»</a>è‡ªå·±æƒ³è¦çš„æ•ˆæœã€‚</p>
<p>è¿™æ˜¯ Ryan Florence çš„<a href="https://mobile.twitter.com/ryanflorence/status/1088606583637061634" target="_blank" rel="nofollow noopener noreferrer">åŸè¯</a>ï¼š</p>
<blockquote>
<p>æˆ‘å·²ç»ç¢°åˆ°è®¸å¤šäººæåˆ°å¸¦æœ‰ setInterval çš„ hooks æ—¶å¸¸ä¼šæ‰“ React çš„è„¸ï¼Œä½†å› ä¸º stale state å¼•å‘çš„é—®é¢˜æˆ‘è¿˜æ˜¯å¤´ä¸€æ¬¡è§ã€‚ å¦‚æœåœ¨ hooks ä¸­è¿™ä¸ªé—®é¢˜æå…¶å›°éš¾ï¼Œé‚£ä¹ˆç›¸æ¯”äº class componentï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸åŒçº§åˆ«å¤æ‚åº¦çš„é—®é¢˜ã€‚</p>
</blockquote>
<p>è€å®è¯´ï¼Œæˆ‘è§‰å¾—è¿™äº›äººæ˜¯æœ‰ä¸€å¥—çš„ï¼Œè‡³å°‘ä¸ºæ­¤å›°æƒ‘äº†ã€‚</p>
<p>ç„¶è€Œæˆ‘å‘ç°è¿™ä¸æ˜¯ Hooks çš„é—®é¢˜ï¼Œè€Œæ˜¯ <a href="/zh-hans/react-as-a-ui-runtime/">Reactç¼–ç¨‹æ¨¡å‹</a> å’Œ <code class="language-text">setInterval</code> ä¸åŒ¹é…é€ æˆçš„ã€‚Hooks æ¯” class æ›´è´´è¿‘ React ç¼–ç¨‹æ¨¡å‹ï¼Œä½¿è¿™ç§ä¸åŒ¹é…æ›´æ˜æ˜¾ã€‚</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° intervals å’Œ Hooks æ˜¯å¦‚ä½•ç©åœ¨ä¸€èµ·çš„ã€ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæœ‰æ„ä¹‰å’Œå¯ä»¥æä¾›å“ªäº›æ–°çš„åŠŸèƒ½ã€‚</p>
<hr>
<p><strong>å…è´£å£°æ˜ï¼šè¿™ç¯‡æ–‡ç« çš„é‡ç‚¹æ˜¯ä¸€ä¸ª <em>é—®é¢˜æ ·ä¾‹</em>ã€‚å³ä½¿ API å¯ä»¥ç®€åŒ–ä¸Šç™¾ç§æƒ…å†µï¼Œè®®è®ºå§‹ç»ˆæŒ‡å‘æ›´éš¾çš„é—®é¢˜ä¸Š</strong>ã€‚</p>
<p>å¦‚æœä½ åˆšå…¥æ‰‹ Hooks ä¸”ä¸çŸ¥é“è¿™å„¿åœ¨è¯´ä»€ä¹ˆï¼Œå…ˆæŸ¥çœ‹ <a href="https://juejin.im/post/5be98a87f265da616e4bf8a4" target="_blank" rel="nofollow noopener noreferrer">è¿™ä¸ªä»‹ç»</a> å’Œ <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="nofollow noopener noreferrer">æ–‡æ¡£</a>ã€‚è¿™ç¯‡æ–‡ç« å‡è®¾ä½ å·²ç»ä½¿ç”¨ Hooks è¶…è¿‡ä¸€ä¸ªå°æ—¶ã€‚</p>
<hr>
<h2 id="ç›´æ¥ç»™æˆ‘çœ‹ä»£ç "><a href="#%E7%9B%B4%E6%8E%A5%E7%BB%99%E6%88%91%E7%9C%8B%E4%BB%A3%E7%A0%81" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç›´æ¥ç»™æˆ‘çœ‹ä»£ç </h2>
<p>ä¸ç”¨å¤šè¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯ç§’é€’å¢çš„è®¡æ•°å™¨ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// ä½ è‡ªå·±çš„ä»£ç </span></span><span class="gatsby-highlight-code-line">    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>ï¼ˆè¿™æ˜¯ <a href="https://codesandbox.io/s/105x531vkq" target="_blank" rel="nofollow noopener noreferrer">CodeSandbox demo</a>ï¼‰ã€‚</em></p>
<p>demoé‡Œé¢çš„ <code class="language-text">useInterval</code> ä¸æ˜¯ä¸€ä¸ªå†…ç½® React Hookï¼Œè€Œæ˜¯ä¸€ä¸ªæˆ‘å†™çš„ <a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="nofollow noopener noreferrer">custom Hook</a>ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useInterval</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> delay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> savedCallback <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ä¿å­˜æ–°å›è°ƒ</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    savedCallback<span class="token punctuation">.</span>current <span class="token operator">=</span> callback<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å»ºç«‹ interval</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      savedCallback<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>tick<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>delay<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>(è¿™æ˜¯å‰é¢çš„demoä¸­ï¼Œä½ å¯èƒ½é”™è¿‡çš„ <a href="https://codesandbox.io/s/105x531vkq" target="_blank" rel="nofollow noopener noreferrer">CodeSandbox demo</a>ã€‚)</em></p>
<p><strong>æˆ‘çš„ <code class="language-text">useInterval</code> Hook å†…ç½®äº†ä¸€ä¸ª interval å¹¶åœ¨ unmounting çš„æ—¶å€™æ¸…é™¤</strong>ï¼Œå®ƒæ˜¯ä¸€ä¸ªä½œç”¨åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé‡Œçš„ <code class="language-text">setInterval</code> å’Œ <code class="language-text">clearInterval</code> çš„ç»„åˆã€‚</p>
<p>ä½ å¯ä»¥éšæ„å°†å®ƒå¤åˆ¶ç²˜è´´åˆ°é¡¹ç›®ä¸­æˆ–è€…ç”¨ npm å¯¼å…¥ã€‚</p>
<p><strong>å¦‚æœä½ ä¸åœ¨ä¹å®ƒæ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä½ å¯ä»¥åœæ­¢é˜…è¯»äº†ï¼æ¥ä¸‹æ¥çš„éƒ¨åˆ†æ˜¯ç»™æƒ³æ·±åº¦æŒ–æ˜ React Hooks çš„ä¹¡äº²ä»¬å‡†å¤‡çš„</strong>ã€‚</p>
<hr>
<h2 id="ç­‰ä»€ä¹ˆ-"><a href="#%E7%AD%89%E4%BB%80%E4%B9%88-" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç­‰ä»€ä¹ˆ?! ğŸ¤”</h2>
<p>æˆ‘çŸ¥é“ä½ åœ¨æƒ³ä»€ä¹ˆï¼š</p>
<blockquote>
<p>Danï¼Œè¿™æ®µä»£ç æ ¹æœ¬æ²¡ä»€ä¹ˆæ„æ€ï¼Œã€Œå•å•æ˜¯ JavaScriptã€èƒ½æœ‰ä»€ä¹ˆï¼Ÿæ‰¿è®¤ React ç”¨ Hooks é’“åˆ°äº† ã€Œé²¨é±¼ã€ å§ï¼</p>
</blockquote>
<p><strong>ä¸€å¼€å§‹æˆ‘ä¹Ÿæ˜¯è¿™æ ·æƒ³çš„ï¼Œä½†åæ¥æˆ‘æ”¹å˜æƒ³æ³•äº†ï¼Œæˆ‘ä¹Ÿè¦æ”¹å˜ä½ çš„</strong>ã€‚åœ¨è§£é‡Šè¿™æ®µä»£ç ä¸ºä»€ä¹ˆæœ‰æ„ä¹‰ä¹‹å‰ï¼Œæˆ‘æƒ³å±•ç¤ºä¸‹å®ƒèƒ½åšä»€ä¹ˆã€‚</p>
<hr>
<h2 id="ä¸ºä»€ä¹ˆ-useinterval-æ˜¯æ›´å¥½çš„api"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88-useinterval-%E6%98%AF%E6%9B%B4%E5%A5%BD%E7%9A%84api" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä¸ºä»€ä¹ˆ <code class="language-text">useInterval()</code> æ˜¯æ›´å¥½çš„API</h2>
<p>æé†’ä½ ä¸‹ï¼Œæˆ‘çš„ <code class="language-text">useInterval</code> Hook æ¥æ”¶ ä¸€ä¸ª function å’Œ ä¸€ä¸ª delay å‚æ•°ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>è¿™æ ·çœ‹èµ·å¾ˆåƒ <code class="language-text">setInterval</code>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><strong>æ‰€ä»¥ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ <code class="language-text">setInterval</code> å‘¢</strong>ï¼Ÿ</p>
<p>ä¸€å¼€å§‹å¯èƒ½ä¸æ˜æ˜¾ï¼Œä½†ä½ å‘ç°æˆ‘çš„ <code class="language-text">useInterval</code> ä¸ <code class="language-text">setInterval</code> ä¹‹é—´çš„ä¸åŒåï¼Œä½ ä¼šçœ‹å‡º <strong>å®ƒçš„å‚æ•°æ˜¯ã€ŒåŠ¨æ€åœ°ã€</strong>ã€‚</p>
<p>æˆ‘å°†ç”¨å…·ä½“çš„ä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚</p>
<hr>
<p>å‡è®¾æˆ‘ä»¬å¸Œæœ› delay å¯è°ƒï¼š</p>
<p><img src="/counter_delay-35e4f35a8585255b11c090aed9f72433.gif" alt="Counter with an input that adjusts the interval delay"></p>
<p>è™½ç„¶ä½ ä¸ä¸€å®šè¦ç”¨åˆ°è¾“å…¥æ§åˆ¶ delayï¼Œä½†åŠ¨æ€è°ƒæ•´å¯èƒ½å¾ˆæœ‰ç”¨ â€”â€” ä¾‹å¦‚ï¼Œç”¨æˆ·åˆ‡æ¢åˆ°å…¶ä»–é€‰é¡¹å¡æ—¶ï¼Œè¦å‡å°‘ AJAX è½®è¯¢æ›´æ–°é—´éš”ã€‚</p>
<p>æ‰€ä»¥åœ¨ class é‡Œä½ è¦æ€ä¹ˆç”¨ <code class="language-text">setInterval</code> åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿæˆ‘ä¼šè¿™ä¹ˆåšï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    delay<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tick<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevState<span class="token punctuation">.</span>delay <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>delay<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tick<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  <span class="token function-variable function">tick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      count<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>
  <span class="token function-variable function">handleDelayChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> delay<span class="token punctuation">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>delay<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleDelayChange<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>ï¼ˆè¿™æ˜¯ <a href="https://codesandbox.io/s/mz20m600mp" target="_blank" rel="nofollow noopener noreferrer">CodeSandbox demo</a>ã€‚ï¼‰</em></p>
<p>è¿™æ ·ä¹Ÿä¸é”™ï¼</p>
<p>Hook ç‰ˆæœ¬çœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ</p>
<p><font size="50">ğŸ¥ğŸ¥ğŸ¥</font></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>delay<span class="token punctuation">,</span> setDelay<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// è¿™æ˜¯ä½ çš„è‡ªå®šä¹‰é€»è¾‘</span></span><span class="gatsby-highlight-code-line">    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">function</span> <span class="token function">handleDelayChange</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setDelay</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>delay<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleDelayChange<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>ï¼ˆè¿™æ˜¯ <a href="https://codesandbox.io/s/mz20m600mp" target="_blank" rel="nofollow noopener noreferrer">CodeSandbox demo</a>ã€‚ï¼‰</em></p>
<p>æ˜¯çš„ï¼Œ<em>è¿™å°±æ˜¯å…¨éƒ¨äº†</em>ã€‚</p>
<p>ä¸åƒ class çš„ç‰ˆæœ¬ï¼Œ<code class="language-text">useInterval</code> Hook ä¾‹å­ä¸­ï¼Œã€Œæ›´æ–°ã€æˆåŠ¨æ€è°ƒæ•´ delay å¾ˆç®€å•ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token comment">// å›ºå®š delay</span>
  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token comment">// å¯è°ƒæ•´ delay</span>
  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>å½“ <code class="language-text">useInterval</code> Hook æ¥æ”¶åˆ°ä¸åŒ delayï¼Œå®ƒä¼šé‡è®¾ intervalã€‚</p>
<p><strong>å£°æ˜ä¸€ä¸ªå¸¦æœ‰åŠ¨æ€è°ƒæ•´ delay çš„ intervalï¼Œæ¥æ›¿ä»£å†™ <em>æ·»åŠ </em>å’Œ<em>æ¸…é™¤</em> interval çš„ä»£ç  â€”â€” <code class="language-text">useInterval</code> Hook å¸®æˆ‘ä»¬åšåˆ°äº†</strong>ã€‚</p>
<p>å¦‚æœæˆ‘æƒ³æš‚æ—¶ <em>æš‚åœ</em> interval è¦æ€ä¹ˆåšï¼Ÿæˆ‘å¯ä»¥ç”¨ä¸€ä¸ª state æ¥åšåˆ°ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token keyword">const</span> <span class="token punctuation">[</span>delay<span class="token punctuation">,</span> setDelay<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isRunning<span class="token punctuation">,</span> setIsRunning<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> isRunning <span class="token operator">?</span> delay <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p><em>ï¼ˆè¿™æ˜¯ <a href="https://codesandbox.io/s/l240mp2pm7" target="_blank" rel="nofollow noopener noreferrer">demo</a>!ï¼‰</em></p>
<p>è¿™è®©æˆ‘å¯¹ React å’Œ Hooks å†æ¬¡æ„Ÿåˆ°å…´å¥‹ã€‚æˆ‘ä»¬å¯ä»¥åŒ…è£…ç°æœ‰çš„å‘½ä»¤å¼ APIs å’Œåˆ›å»ºæ›´è´´è¿‘è¡¨è¾¾æˆ‘ä»¬æ„å›¾çš„å£°æ˜å¼ APIsã€‚å°±æ‹¿æ¸²æŸ“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶å‡†ç¡®åœ°æè¿°æ¯ä¸ªæ—¶é—´ç‚¹è¿‡ç¨‹ï¼Œè€Œä¸ç”¨å°å¿ƒåœ°ç”¨æŒ‡ä»¤æ¥æ“ä½œå®ƒã€‚</p>
<hr>
<p>æˆ‘å¸Œæœ›åˆ°è¿™é‡Œä½ ä»¬å¼€å§‹è§‰å¾— <code class="language-text">useInterval()</code> Hook æ˜¯ä¸€ä¸ªæ›´å¥½çš„ API äº† â€”â€” è‡³å°‘å’Œç»„ä»¶æ¯”ã€‚</p>
<p><strong>ä½†ä¸ºä»€ä¹ˆåœ¨ Hooks ä¸­ä½¿ç”¨ <code class="language-text">setInterval()</code> å’Œ <code class="language-text">clearInterval()</code> è®©äººå¿ƒçƒ¦å‘¢</strong>ï¼Ÿè®©æˆ‘ä»¬å›åˆ°è®¡æ•°å™¨ä¾‹å­å¹¶è¯•ç€æ‰‹åŠ¨å®ç°å®ƒã€‚</p>
<hr>
<h2 id="ç¬¬ä¸€æ¬¡å°è¯•"><a href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç¬¬ä¸€æ¬¡å°è¯•</h2>
<p>æˆ‘ä¼šä»ä¸€ä¸ªåªæ¸²æŸ“åˆå§‹çŠ¶æ€çš„ç®€å•ä¾‹å­å¼€å§‹ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç°åœ¨æˆ‘æƒ³è¦ä¸€ä¸ªæ¯ç§’å¢åŠ çš„ intervalï¼Œå®ƒæ˜¯ä¸€ä¸ª<a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup" target="_blank" rel="nofollow noopener noreferrer">éœ€è¦æ¸…ç†å‰¯ä½œç”¨</a>çš„ï¼Œæ‰€ä»¥æˆ‘å°†ç”¨åˆ° <code class="language-text">useEffect()</code> å¹¶è¿”å›æ¸…ç†å‡½æ•°ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>ï¼ˆæŸ¥çœ‹ <a href="https://codesandbox.io/s/7wlxk1k87j" target="_blank" rel="nofollow noopener noreferrer">CodeSandbox demo</a>.ï¼‰</em></p>
<p>è¿™ç§å·¥ä½œçœ‹èµ·æ¥å¾ˆç®€å•å¯¹å§ï¼Ÿ</p>
<p><strong>ä½†æ˜¯ï¼Œè¿™ä»£ç æœ‰ä¸€ä¸ªå¥‡æ€ªçš„è¡Œä¸º</strong>ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒReact ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åé‡æ‰§è¡Œ effectsï¼Œè¿™æ˜¯æœ‰ç›®çš„çš„ï¼Œè¿™æœ‰åŠ©äºé¿å… React class ç»„ä»¶çš„<a href="https://reactjs.org/docs/hooks-effect.html#explanation-why-effects-run-on-each-update" target="_blank" rel="nofollow noopener noreferrer">æŸç§ bugs</a>ã€‚</p>
<p>è¿™é€šå¸¸æ˜¯å¥½çš„ï¼Œå› ä¸ºéœ€è¦è®¸å¤šè®¢é˜… API å¯ä»¥éšæ—¶é¡ºæ‰‹ç§»é™¤è€çš„ç›‘å¬è€…å’ŒåŠ ä¸ªæ–°çš„ã€‚ä½†æ˜¯ï¼Œ<code class="language-text">setInterval</code> å’Œå®ƒä»¬ä¸ä¸€æ ·ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ <code class="language-text">clearInterval</code> å’Œ <code class="language-text">setInterval</code> æ—¶ï¼Œå®ƒä»¬ä¼šè¿›å…¥æ—¶é—´é˜Ÿåˆ—é‡Œï¼Œå¦‚æœæˆ‘ä»¬é¢‘ç¹é‡æ¸²æŸ“å’Œé‡æ‰§è¡Œ effectsï¼Œinterval æœ‰å¯èƒ½æ²¡æœ‰æœºä¼šè¢«æ‰§è¡Œï¼</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥<em>æ›´çŸ­</em>é—´éš”é‡æ¸²æŸ“æˆ‘ä»¬çš„ç»„ä»¶ï¼Œæ¥å‘ç°è¿™ä¸ª bugï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// é‡æ¸²æŸ“å’Œé‡æ‰§è¡Œ Counter çš„ effects</span>
  <span class="token comment">// è¿™é‡Œä¼šå‘ç”Ÿ clearInterval()</span>
  <span class="token comment">// åœ¨ interval è¢«æ‰§è¡Œå‰ setInterval()</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Counter</span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span> rootElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><em>ï¼ˆçœ‹è¿™ä¸ª bug çš„ <a href="https://codesandbox.io/s/9j86r218y4" target="_blank" rel="nofollow noopener noreferrer">demo</a>ï¼‰</em></p>
<hr>
<h2 id="ç¬¬äºŒæ¬¡å°è¯•"><a href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%B0%9D%E8%AF%95" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç¬¬äºŒæ¬¡å°è¯•</h2>
<p>ä½ å¯èƒ½çŸ¥é“ <code class="language-text">useEffect()</code> å…è®¸æˆ‘ä»¬<a href="https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects" target="_blank" rel="nofollow noopener noreferrer"><em>é€‰æ‹©æ€§åœ°</em></a>è¿›è¡Œé‡æ‰§è¡Œ effectsï¼Œä½ å¯ä»¥è®¾å®šä¸€ä¸ªä¾èµ–æ•°ç»„ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼ŒReact åªä¼šåœ¨æ•°ç»„é‡Œçš„æŸä¸ªå‘ç”Ÿå˜åŒ–æ—¶é‡è¿è¡Œï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>å½“æˆ‘ä»¬ <em>åª</em> æƒ³åœ¨ mount æ—¶æ‰§è¡Œ effect å’Œ unmount æ—¶æ¸…ç†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥ä¼ ç©º <code class="language-text">[]</code> çš„ä¾èµ–æ•°ç»„ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸ç†Ÿæ‚‰ JavaScript çš„é—­åŒ…ï¼Œä¼šç¢°åˆ°ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ã€‚æˆ‘ä»¬ç°åœ¨å°±æ¥åˆ¶é€ è¿™ä¸ªé”™è¯¯ï¼ï¼ˆæˆ‘ä»¬è¿˜å»ºç«‹äº†ä¸€ä¸ªå°½æ—©åé¦ˆè¿™ä¸ªé”™è¯¯çš„ <a href="https://github.com/facebook/react/pull/14636" target="_blank" rel="nofollow noopener noreferrer">lint è§„åˆ™</a>ï¼Œä½†è¿˜æ²¡å‡†å¤‡å¥½ã€‚ï¼‰</p>
<p>åœ¨ç¬¬ä¸€æ¬¡å°è¯•ä¸­ï¼Œæˆ‘ä»¬çš„é—®é¢˜æ˜¯é‡è¿è¡Œ effects æ—¶ä½¿å¾— timer è¿‡æ—©è¢«æ¸…é™¤ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä¸é‡è¿è¡Œå»ä¿®å¤å®ƒä»¬ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½†æ˜¯ï¼Œç°åœ¨æˆ‘ä»¬çš„è®¡æ—¶å™¨æ›´æ–°åˆ° 1 å°±ä¸åŠ¨äº†ã€‚ï¼ˆ<a href="https://codesandbox.io/s/jj0mk6y683" target="_blank" rel="nofollow noopener noreferrer">æŸ¥çœ‹çœŸå® bug</a>ã€‚ï¼‰</p>
<p>å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿï¼</p>
<p><strong>é—®é¢˜åœ¨äºï¼Œ<code class="language-text">useEffect</code> åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶è·å–å€¼ä¸º 0 çš„ <code class="language-text">count</code></strong>ï¼Œæˆ‘ä»¬ä¸å†é‡æ‰§è¡Œ effectï¼Œæ‰€ä»¥ <code class="language-text">setInterval</code> ä¸€ç›´å¼•ç”¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶çš„é—­åŒ… <code class="language-text">count</code>ï¼Œä»¥è‡³äº <code class="language-text">count + 1</code> ä¸€ç›´æ˜¯ <code class="language-text">1</code>ã€‚å“å‘€å‘€ï¼</p>
<p><strong>æˆ‘å¯ä»¥å¬è§ä½ å’¬ç‰™åˆ‡é½¿äº†ï¼ŒHooks çœŸçƒ¦äººå¯¹å§</strong>ï¼Ÿ</p>
<p>ä¿®å¤å®ƒçš„<a href="https://codesandbox.io/s/j379jxrzjy" target="_blank" rel="nofollow noopener noreferrer">ä¸€ç§æ–¹æ³•</a>æ˜¯ç”¨åƒ <code class="language-text">setCount(c =&gt; c + 1)</code> è¿™æ ·çš„ ã€Œupdaterã€æ›¿æ¢ <code class="language-text">setCount(count + 1)</code>ï¼Œè¿™æ ·å¯ä»¥è¯»åˆ°æ–° state å˜é‡ã€‚ä½†è¿™ä¸ªæ— æ³•å¸®åŠ©ä½ è·å–åˆ°æ–°çš„ propsã€‚</p>
<p><a href="https://codesandbox.io/s/00o9o95jyv" target="_blank" rel="nofollow noopener noreferrer">å¦ä¸€ä¸ªæ–¹æ³•</a>æ˜¯ç”¨ <a href="https://reactjs.org/docs/hooks-reference.html#usereducer" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">useReducer()</code></a>ã€‚è¿™ç§æ–¹æ³•ä¸ºä½ æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ã€‚åœ¨ reducer ä¸­ï¼Œä½ å¯ä»¥è®¿é—®åˆ°å½“å‰ state å’Œæ–°çš„ propsã€‚<code class="language-text">dispatch</code> æ–¹æ³•æœ¬èº«æ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä»ä»»ä½•é—­åŒ…ä¸­å°†æ•°æ®æ”¾å…¥å…¶ä¸­ã€‚<code class="language-text">useReducer()</code> æœ‰ä¸ªçº¦æŸæ˜¯ä½ ä¸å¯ä»¥ç”¨å®ƒæ‰§è¡Œå‰¯ä½œç”¨ã€‚ï¼ˆä½†æ˜¯ï¼Œä½ å¯ä»¥è¿”å›æ–°çŠ¶æ€ â€”â€” è§¦å‘ä¸€äº› effectã€‚ï¼‰</p>
<p><strong>ä½†ä¸ºä»€ä¹ˆè¦å˜å¾—è¿™ä¹ˆå¤æ‚</strong>ï¼Ÿ</p>
<hr>
<h2 id="é˜»æŠ—ä¸åŒ¹é…"><a href="#%E9%98%BB%E6%8A%97%E4%B8%8D%E5%8C%B9%E9%85%8D" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>é˜»æŠ—ä¸åŒ¹é…</h2>
<p>è¿™ä¸ªæœ¯è¯­æœ‰æ—¶ä¼šè¢«æåˆ°ï¼Œ<a href="https://haacked.com/archive/2004/06/15/impedance-mismatch.aspx/" target="_blank" rel="nofollow noopener noreferrer">Phil Haack</a> è§£é‡Šå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>æœ‰äººè¯´æ•°æ®åº“æ¥è‡ªç«æ˜Ÿè€Œå¯¹è±¡æ¥è‡ªé‡‘æ˜Ÿï¼Œæ•°æ®åº“ä¸ä¼šè‡ªç„¶åœ°æ˜ å°„åˆ°å¯¹è±¡æ¨¡å‹ã€‚è¿™å¾ˆåƒè¯•å›¾å°†ç£é“çš„ä¸¤ææ¨åˆ°ä¸€èµ·ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬çš„ã€Œé˜»æŠ—åŒ¹é…ã€ä¸åœ¨æ•°æ®åº“å’Œå¯¹è±¡ä¹‹é—´ï¼Œå®ƒåœ¨ React ç¼–ç¨‹æ¨¡å‹å’Œå‘½ä»¤å¼ <code class="language-text">setInterval</code> API ä¹‹é—´ã€‚</p>
<p><strong>ä¸€ä¸ª React ç»„ä»¶å¯èƒ½åœ¨ mounted ä¹‹å‰æµç»è®¸å¤šä¸åŒçš„ stateï¼Œä½†å®ƒçš„æ¸²æŸ“ç»“æœå°†<em>ä¸€æ¬¡æ€§å…¨éƒ¨</em>æè¿°å‡ºæ¥</strong>ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token comment">// æè¿°æ¯æ¬¡æ¸²æŸ“</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre></div>
<p>Hooks ä½¿æˆ‘ä»¬æŠŠç›¸åŒçš„å£°æ˜æ–¹æ³•ç”¨åœ¨ effects ä¸Šï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token comment">// æè¿°æ¯ä¸ªé—´éš”çŠ¶æ€</span>
  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> isRunning <span class="token operator">?</span> delay <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>æˆ‘ä»¬ä¸<em>è®¾ç½®</em> intervalï¼Œä½†æŒ‡å®šå®ƒ<em>æ˜¯å¦</em>è®¾ç½®å»¶è¿Ÿæˆ–å»¶è¿Ÿå¤šå°‘ï¼Œæˆ‘ä»¬çš„ Hooks åšåˆ°äº†ï¼Œç”¨ç¦»æ•£æœ¯è¯­æè¿°è¿ç»­è¿‡ç¨‹</p>
<p><strong>ç›¸åï¼Œ<code class="language-text">setInterval</code> æ²¡æœ‰åŠæ—¶åœ°æè¿°è¿‡ç¨‹ â€”â€” ä¸€æ—¦è®¾å®šäº† intervalï¼Œé™¤äº†æ¸…é™¤å®ƒï¼Œä½ æ— æ³•å¯¹å®ƒåšä»»ä½•æ”¹å˜</strong>ã€‚</p>
<p>è¿™å°±æ˜¯ React æ¨¡å‹å’Œ <code class="language-text">setInterval</code> API ä¹‹é—´çš„ä¸åŒ¹é…ã€‚</p>
<hr>
<p>React ç»„ä»¶ä¸­çš„ props å’Œ state æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œ React ä¼šé‡æ¸²æŸ“å®ƒä»¬ä¸”ã€Œä¸¢å¼ƒã€ä»»ä½•å…³äºä¸Šä¸€æ¬¡æ¸²æŸ“çš„ç»“æœï¼Œå®ƒä»¬ä¹‹é—´ä¸å†æœ‰ç›¸å…³æ€§ã€‚</p>
<p><code class="language-text">useEffect()</code> Hook ä¹Ÿã€Œä¸¢å¼ƒã€ä¸Šä¸€æ¬¡æ¸²æŸ“ç»“æœï¼Œå®ƒä¼šæ¸…é™¤ä¸Šä¸€æ¬¡ effect å†å»ºç«‹ä¸‹ä¸€ä¸ª effectï¼Œä¸‹ä¸€ä¸ª effect é”ä½æ–°çš„ props å’Œ stateï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬<a href="https://codesandbox.io/s/7wlxk1k87j" target="_blank" rel="nofollow noopener noreferrer">ç¬¬ä¸€æ¬¡å°è¯•</a>ç®€å•ç¤ºä¾‹å¯ä»¥æ­£ç¡®å·¥ä½œçš„åŸå› ã€‚</p>
<p><strong>ä½† <code class="language-text">setInterval</code> ä¸ä¼šã€Œä¸¢å¼ƒã€ã€‚</strong> å®ƒä¼šä¸€ç›´å¼•ç”¨è€çš„ props å’Œ state ç›´åˆ°ä½ æŠŠå®ƒæ¢æ‰ â€”â€” ä¸é‡ç½®æ—¶é—´ä½ æ˜¯æ— æ³•åšåˆ°çš„ã€‚</p>
<p>æˆ–è€…ç­‰ç­‰ï¼Œä½ å¯ä»¥åšåˆ°ï¼Ÿ</p>
<hr>
<h2 id="refs-å¯ä»¥åšåˆ°ï¼"><a href="#refs-%E5%8F%AF%E4%BB%A5%E5%81%9A%E5%88%B0%EF%BC%81" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Refs å¯ä»¥åšåˆ°ï¼</h2>
<p>è¿™ä¸ªé—®é¢˜å½’ç»“ä¸ºä¸‹é¢è¿™æ ·ï¼š</p>
<ul>
<li>æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œå¸¦ <code class="language-text">callback1</code> çš„ <code class="language-text">setInterval(callback1, delay)</code>ã€‚</li>
<li>æˆ‘ä»¬åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶å¾—åˆ°æºå¸¦æ–°çš„ props å’Œ state çš„ <code class="language-text">callbaxk2</code>ã€‚</li>
<li>æˆ‘ä»¬æ— æ³•åœ¨ä¸é‡ç½®æ—¶é—´çš„æƒ…å†µä¸‹æ›¿æ¢æ‰å·²ç»å­˜åœ¨çš„ intervalã€‚</li>
</ul>
<p><strong>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ ¹æœ¬ä¸æ›¿æ¢ intervalï¼Œè€Œæ˜¯å¼•å…¥ä¸€ä¸ªæŒ‡å‘<em>æ–°</em> interval å›è°ƒçš„å¯å˜ <code class="language-text">savedCallback</code> ä¼šæ€ä¹ˆæ ·</strong>ï¼Ÿ</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ¡ˆï¼š</p>
<ul>
<li>æˆ‘ä»¬è°ƒç”¨ <code class="language-text">setInterval(fn, delay)</code>ï¼Œå…¶ä¸­ <code class="language-text">fn</code> è°ƒç”¨ <code class="language-text">savedCallback</code>ã€‚</li>
<li>ç¬¬ä¸€æ¬¡æ¸²æŸ“åå°† <code class="language-text">savedCallback</code> è®¾ä¸º <code class="language-text">callback1</code>ã€‚</li>
<li>ä¸‹ä¸€æ¬¡æ¸²æŸ“åå°† <code class="language-text">savedCallback</code> è®¾ä¸º <code class="language-text">callback2</code>ã€‚</li>
<li>???</li>
<li>å®Œæˆ</li>
</ul>
<p>è¿™ä¸ªå¯å˜çš„ <code class="language-text">savedCallback</code> éœ€è¦åœ¨é‡æ–°æ¸²æŸ“æ—¶ã€Œå¯æŒç»­ï¼ˆpersistï¼‰ã€ï¼Œæ‰€ä»¥ä¸å¯ä»¥æ˜¯ä¸€ä¸ªå¸¸è§„å˜é‡ï¼Œæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªç±»ä¼¼å®ä¾‹çš„å­—æ®µã€‚</p>
<p><a href="https://reactjs.org/docs/hooks-faq.html#is-there-something-like-instance-variables" target="_blank" rel="nofollow noopener noreferrer">æ­£å¦‚æˆ‘ä»¬ä» Hooks FAQ ä¸­å­¦åˆ°çš„</a>ï¼Œ<code class="language-text">useRef()</code> ç»™å‡ºäº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token keyword">const</span> savedCallback <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// { current: null }</span></code></pre></div>
<p><em>ï¼ˆä½ å¯èƒ½ç†Ÿæ‚‰ React ä¸­çš„ <a href="https://reactjs.org/docs/refs-and-the-dom.html" target="_blank" rel="nofollow noopener noreferrer">DOM refs</a>ï¼‰ã€‚Hooks ä½¿ç”¨ç›¸åŒçš„æ¦‚å¿µæ¥ä¿å­˜ä»»æ„å¯å˜å€¼ã€‚ref å°±åƒä¸€ä¸ªã€Œç›’å­ã€ï¼Œä½ å¯ä»¥æ”¾ä»»ä½•ä¸œè¥¿</em></p>
<p><code class="language-text">useRef()</code> è¿”å›ä¸€ä¸ªæœ‰å¸¦æœ‰ <code class="language-text">current</code> å¯å˜å±æ€§çš„æ™®é€šå¯¹è±¡åœ¨ renders é—´å…±äº«ï¼Œæˆ‘ä»¬å¯ä»¥ä¿å­˜<em>æ–°</em>çš„ interval å›æ‰ç»™å®ƒï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¯ä»¥è¯»åˆ°æ–° propsï¼Œstateç­‰ã€‚</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// æ¯æ¬¡æ¸²æŸ“åï¼Œä¿å­˜æ–°çš„å›è°ƒåˆ°æˆ‘ä»¬çš„ ref é‡Œã€‚</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    savedCallback<span class="token punctuation">.</span>current <span class="token operator">=</span> callback<span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ä¹‹åæˆ‘ä»¬ä¾¿å¯ä»¥ä»æˆ‘ä»¬çš„ interval ä¸­è¯»å–å’Œè°ƒç”¨å®ƒï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      savedCallback<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>tick<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>æ„Ÿè°¢ <code class="language-text">[]</code>ï¼Œä¸é‡æ‰§è¡Œæˆ‘ä»¬çš„ effectï¼Œinterval å°±ä¸ä¼šè¢«é‡ç½®ã€‚åŒæ—¶ï¼Œæ„Ÿè°¢ <code class="language-text">savedCallback</code> refï¼Œè®©æˆ‘ä»¬å¯ä»¥ä¸€ç›´åœ¨æ–°æ¸²æŸ“ä¹‹åè¯»å–åˆ°å›è°ƒï¼Œå¹¶åœ¨ interval tick é‡Œè°ƒç”¨å®ƒã€‚</p>
<p>è¿™æ˜¯å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> savedCallback <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    savedCallback<span class="token punctuation">.</span>current <span class="token operator">=</span> callback<span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      savedCallback<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>tick<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>ï¼ˆçœ‹ <a href="https://codesandbox.io/s/3499qqr565" target="_blank" rel="nofollow noopener noreferrer">CodeSandbox demo</a>ã€‚ï¼‰</em></p>
<hr>
<h2 id="æå–ä¸€ä¸ª-hook"><a href="#%E6%8F%90%E5%8F%96%E4%B8%80%E4%B8%AA-hook" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æå–ä¸€ä¸ª Hook</h2>
<p>ä¸å¯å¦è®¤ï¼Œä¸Šé¢çš„ä»£ç ä»¤äººå›°æƒ‘ï¼Œæ··åˆç›¸åçš„èŒƒå¼ä»¤äººè´¹è§£ï¼Œè¿˜å¯èƒ½å¼„ä¹±å¯å˜ refsã€‚</p>
<p><strong>æˆ‘è§‰å¾— Hooks æä¾›äº†æ¯” class æ›´ä½çº§çš„åŸè¯­ â€”â€” ä½†å®ƒä»¬çš„ç¾ä¸½åœ¨äºå®ƒä»¬ä½¿æˆ‘ä»¬èƒ½å¤Ÿåˆ›ä½œå¹¶åˆ›é€ å‡ºæ›´å¥½çš„é™ˆè¿°æ€§æŠ½è±¡</strong>ã€‚</p>
<p>ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘åªæƒ³è¿™æ ·å†™ï¼š</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æˆ‘å°†æˆ‘ ref æœºåˆ¶çš„ä»£ç å¤åˆ¶ç²˜è´´åˆ°ä¸€ä¸ª custom Hookï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">useInterval</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> savedCallback <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    savedCallback<span class="token punctuation">.</span>current <span class="token operator">=</span> callback<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      savedCallback<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>tick<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å½“å‰ï¼Œ<code class="language-text">1000</code> delay æ˜¯å†™æ­»çš„ï¼Œæˆ‘æƒ³æŠŠå®ƒå˜æˆä¸€ä¸ªå‚æ•°ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">useInterval</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> delay<span class="token punctuation">)</span> <span class="token punctuation">{</span></code></pre></div>
<p>æˆ‘ä¼šåœ¨åˆ›å»ºå¥½ interval åä½¿ç”¨å®ƒï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>tick<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p> ç°åœ¨ <code class="language-text">delay</code> å¯ä»¥åœ¨ renders ä¹‹é—´æ”¹å˜ï¼Œæˆ‘éœ€è¦åœ¨æˆ‘çš„ interval effect ä¾èµ–éƒ¨åˆ†å£°æ˜å®ƒï¼š</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      savedCallback<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>tick<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>delay<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>ç­‰ç­‰ï¼Œæˆ‘ä»¬ä¸æ˜¯è¦é¿å…é‡ç½® interval effectï¼Œå¹¶ä¸“é—¨é€šè¿‡ <code class="language-text">[]</code> æ¥é¿å…å®ƒå—ï¼Ÿä¸å®Œå…¨æ˜¯ï¼Œæˆ‘ä»¬åªæƒ³åœ¨<em>å›è°ƒ</em>æ”¹å˜æ—¶é¿å…é‡ç½®å®ƒï¼Œä½†å½“ <code class="language-text">delay</code> æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬<em>æƒ³è¦</em>é‡å¯ timerï¼</p>
<p>è®©æˆ‘ä»¬æ£€æŸ¥ä¸‹æˆ‘ä»¬çš„ä»£ç æ˜¯å¦æœ‰æ•ˆï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useInterval</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> delay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> savedCallback <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    savedCallback<span class="token punctuation">.</span>current <span class="token operator">=</span> callback<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      savedCallback<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>tick<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>delay<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>ï¼ˆå°è¯•å®ƒ <a href="https://codesandbox.io/s/xvyl15375w" target="_blank" rel="nofollow noopener noreferrer">CodeSandbox</a>ã€‚ï¼‰</em></p>
<p>æœ‰æ•ˆï¼æˆ‘ä»¬ç°åœ¨å¯ä»¥ä¸ç”¨æƒ³å¤ªå¤š <code class="language-text">useInterval()</code> çš„å®ç°è¿‡ç¨‹ï¼Œåœ¨ä»»æ„ç»„ä»¶ä¸­ä½¿ç”¨å®ƒã€‚</p>
<h2 id="ç¦åˆ©ï¼šæš‚åœ-interval"><a href="#%E7%A6%8F%E5%88%A9%EF%BC%9A%E6%9A%82%E5%81%9C-interval" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç¦åˆ©ï¼šæš‚åœ Interval</h2>
<p>å‡è®¾æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿé€šè¿‡ä¼ é€’ <code class="language-text">null</code> ä½œä¸º <code class="language-text">delay</code> æ¥æš‚åœæˆ‘ä»¬çš„ intervalï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token keyword">const</span> <span class="token punctuation">[</span>delay<span class="token punctuation">,</span> setDelay<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isRunning<span class="token punctuation">,</span> setIsRunning<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> isRunning <span class="token operator">?</span> delay <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>å¦‚ä½•å®ç°è¿™ä¸ªï¼Ÿç­”æ¡ˆæ—¶ï¼šä¸åˆ›å»º intervalã€‚</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      savedCallback<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>      <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>tick<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>delay<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><em>ï¼ˆçœ‹ <a href="https://codesandbox.io/s/l240mp2pm7" target="_blank" rel="nofollow noopener noreferrer">CodeSandbox demo</a>ã€‚ï¼‰</em></p>
<p>å°±æ˜¯è¿™æ ·ã€‚æ­¤ä»£ç å¤„ç†äº†æ‰€æœ‰å¯èƒ½çš„å˜åŒ–ï¼šæ”¹å˜ delayã€æš‚åœã€æˆ–è€…æ¢å¤ intervalã€‚<code class="language-text">useEffect()</code> API è¦æ±‚æˆ‘ä»¬èŠ±è´¹æ›´å¤šçš„å‰æœŸå·¥ä½œæ¥æè¿°å»ºç«‹å’Œæ¸…é™¤ â€”â€” ä½†æ·»åŠ æ–°æ¡ˆä¾‹å¾ˆå®¹æ˜“ã€‚</p>
<h2 id="ç¦åˆ©ï¼šæœ‰è¶£çš„-demo"><a href="#%E7%A6%8F%E5%88%A9%EF%BC%9A%E6%9C%89%E8%B6%A3%E7%9A%84-demo" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç¦åˆ©ï¼šæœ‰è¶£çš„ Demo</h2>
<p><code class="language-text">useInterval()</code> Hook çœŸçš„å¾ˆå¥½ç©ï¼Œå½“å‰¯ä½œç”¨æ˜¯é™ˆè¿°æ€§çš„ï¼Œå°†å¤æ‚çš„è¡Œä¸ºç¼–æ’åœ¨ä¸€èµ·è¦å®¹æ˜“å¾—å¤šã€‚</p>
<p><strong>ä¾‹å¦‚ï¼šæˆ‘ä»¬ interval ä¸­ <code class="language-text">delay</code> å¯ä»¥å—æ§äºå¦å¤–ä¸€ä¸ªï¼š</strong></p>
<p><img src="/counter_inception-10cfc4b38497a46980d3a13048a56e36.gif" alt="Counter that automatically speeds up"> <h1>!!!!</h1></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>delay<span class="token punctuation">,</span> setDelay<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å¢åŠ è®¡æ•°å™¨</span>
  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token comment">// æ¯ç§’åŠ é€Ÿ</span></span><span class="gatsby-highlight-code-line">  <span class="token function">useInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token function">setDelay</span><span class="token punctuation">(</span>delay <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">function</span> <span class="token function">handleReset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setDelay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>h1<span class="token operator">></span>Counter<span class="token punctuation">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&lt;</span>h4<span class="token operator">></span>Delay<span class="token punctuation">:</span> <span class="token punctuation">{</span>delay<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleReset<span class="token punctuation">}</span><span class="token operator">></span>
        Reset delay
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>ï¼ˆçœ‹ <a href="https://codesandbox.io/s/znr418qp13" target="_blank" rel="nofollow noopener noreferrer">CodeSandbox demo</a>ï¼ï¼‰</em></p>
<h2 id="å°¾å£°æ€»ç»“"><a href="#%E5%B0%BE%E5%A3%B0%E6%80%BB%E7%BB%93" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å°¾å£°æ€»ç»“</h2>
<p>Hooks éœ€è¦èŠ±æ—¶é—´å»ä¹ æƒ¯ â€”â€” <em>ç‰¹åˆ«</em>æ˜¯åœ¨è·¨è¶Šå‘½ä»¤å¼å’Œå£°æ˜å¼çš„ä»£ç ä¸Šã€‚ä½ å¯ä»¥åˆ›å»ºåƒ <a href="http://react-spring.surge.sh/hooks" target="_blank" rel="nofollow noopener noreferrer">React Spring</a> ä¸€æ ·çš„æŠ½è±¡ï¼Œä½†æœ‰æ—¶å®ƒä»¬ä¼šè®©ä½ ä¸å®‰ã€‚</p>
<p>Hooks è¿˜å¤„äºå‰æœŸé˜¶æ®µï¼Œæ— ç–‘æ­¤æ¨¡å¼ä»éœ€è¦ä¿®ç‚¼å’Œæ¯”è¾ƒã€‚å¦‚æœä½ ä¹ æƒ¯è·Ÿéšä¼—æ‰€å‘¨çŸ¥çš„ã€Œæœ€ä½³å®è·µã€ï¼Œä¸è¦æ€¥äºé‡‡ç”¨ Hooksï¼Œå®ƒéœ€è¦å¾ˆå¤šçš„å°è¯•å’Œæ¢ç´¢ã€‚</p>
<p>æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯ä»¥å¸®åŠ©ä½ ç†è§£å¸¦æœ‰ <code class="language-text">setInterval()</code> ç­‰ API çš„ Hooks çš„ç›¸å…³å¸¸è§é—®é¢˜ã€å¯ä»¥å¸®åŠ©ä½ å…‹æœå®ƒä»¬çš„æ¨¡å¼ã€åŠäº«ç”¨å»ºç«‹åœ¨å®ƒä»¬ä¹‹ä¸Šæ›´å…·è¡¨è¾¾åŠ›çš„å£°æ˜å¼ APIs çš„ç”œèœœæœå®ã€‚</p></div><footer><p><a href="https://mobile.twitter.com/search?q=https%3A%2F%2Foverreacted.io%2Fmaking-setinterval-declarative-with-react-hooks%2F" target="_blank" rel="noopener noreferrer">Discuss on Twitter</a> â€¢ <a href="https://github.com/gaearon/overreacted.io/edit/master/src/pages/making-setinterval-declarative-with-react-hooks/index.zh-hans.md" target="_blank" rel="noopener noreferrer">Edit on GitHub</a></p></footer></article></main><aside><div style="margin:90px 0 40px 0;font-family:system-ui, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
    &quot;Roboto&quot;, &quot;Oxygen&quot;, &quot;Ubuntu&quot;, &quot;Cantarell&quot;, &quot;Fira Sans&quot;,
    &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif"><form action="https://app.convertkit.com/forms/812047/subscriptions" class="seva-form formkit-form" method="post" min-width="400 500 600 700 800" style="background-color:rgb(255, 255, 255);border-radius:6px"><div data-style="full"><div data-element="column" class="formkit-column" style="background-color:rgb(249, 250, 251)"><h1 class="formkit-header" data-element="header" style="color:rgb(77, 77, 77);font-size:20px;font-weight:700">Join the Newsletter</h1><div data-element="subheader" class="formkit-subheader" style="color:rgb(104, 104, 104)"><p>Subscribe to get my latest content by email.</p></div><div class="formkit-image"><svg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 46 46" style="max-width:100%"><g fill="none" fill-rule="evenodd"><path fill="#DD92AB" d="M23,36 C22.813,36 22.627,35.948 22.463,35.844 L0.463,21.844 C0.159,21.651 -0.017,21.308 0.001,20.948 C0.02,20.589 0.23,20.266 0.553,20.105 L23,6 L45.447,20.105 C45.769,20.266 45.98,20.588 45.999,20.948 C46.018,21.308 45.841,21.65 45.537,21.844 L23.537,35.844 C23.373,35.948 23.187,36 23,36 Z"></path><path fill="#FFF" d="M38,37 L8,37 L8,1 C8,0.448 8.448,0 9,0 L37,0 C37.552,0 38,0.448 38,1 L38,37 Z"></path><path fill="#FFA7C4" d="M45,46 C44.916,46 44.831,45.989 44.748,45.968 L21.748,39.968 L22,33 L46,21 L46,45 C46,45.31 45.856,45.602 45.611,45.792 C45.435,45.928 45.219,46 45,46 Z"></path><path fill="#FFC3D7" d="M45,46 L1,46 C0.447,46 0,45.552 0,45 L0,21 L45.479,44.122 C45.88,44.341 46.083,44.804 45.969,45.247 C45.856,45.69 45.457,46 45,46 Z"></path><path fill="#FFA7C4" d="M19 20.414L14.293 15.707C13.902 15.316 13.902 14.684 14.293 14.293L19 9.586 20.414 11 16.414 15 20.414 19 19 20.414zM27 20.414L25.586 19 29.586 15 25.586 11 27 9.586 31.707 14.293C32.098 14.684 32.098 15.316 31.707 15.707L27 20.414z"></path></g></svg></div></div><div data-element="column" class="formkit-column"><ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul><div data-element="fields" class="seva-fields formkit-fields"><div class="formkit-field"><input type="text" class="formkit-input" aria-label="Your first name" name="fields[first_name]" placeholder="Your first name" style="border-color:rgb(227, 227, 227);border-radius:4px;color:rgb(0, 0, 0);font-weight:400"/></div><div class="formkit-field"><input type="email" class="formkit-input" name="email_address" aria-label="Your email address" placeholder="Your email address" style="border-color:rgb(227, 227, 227);border-radius:4px;color:rgb(0, 0, 0);font-weight:400"/></div><button data-element="submit" class="formkit-submit formkit-submit" style="background-color:hsl(340, 63%, 55%);border-radius:24px;color:white;font-weight:700"><div class="formkit-spinner"></div><span>Subscribe</span></button></div><div data-element="guarantee" class="formkit-guarantee" style="color:rgb(77, 77, 77);font-size:13px;font-weight:400"><p>I wonâ€™t send you spam.</p><p>Unsubscribe at <em>any</em> time.</p></div></div></div></form></div><h3 style="font-family:Montserrat, sans-serif;margin-top:0.4375rem"><a style="box-shadow:none;text-decoration:none;color:var(--pink)" href="/">Overreacted</a></h3><div style="display:flex;margin-bottom:3.5rem"><img src="/static/profile-pic-69c77131fd248a7aaaf26fab021f469f.png" alt="Yusuf Unlu" style="margin-right:0.875rem;margin-bottom:0;height:3.5rem;border-radius:50%"/><p style="max-width:310px">Personal blog by <a href="https://mobile.twitter.com/yufusunlu">Yusuf Unlu</a>.<!-- --> <!-- -->IÂ explain with words and code.</p></div><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li></li><li></li></ul></nav></aside></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-130227707-1', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"zh-hans-making-setinterval-declarative-with-react-hooks-a62","path":"/zh-hans/making-setinterval-declarative-with-react-hooks/"};window.dataPath="661/path---zh-hans-making-setinterval-declarative-with-react-hooks-a-62-bc3-3AQLyCZjbz2COfIef2q2sw3E";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-83825dcbe188439d174e.js"],"component---src-templates-blog-index-js":["/component---src-templates-blog-index-js-1d061c91bf8b4d1ed13d.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.f3aea2f29a9b96501823.css","/component---src-templates-blog-post-js-5ff9d93420b5b2cefece.js"],"component---src-pages-404-js":["/component---src-pages-404-js.e9c5c3b80c5e9b8c6fa0.css","/component---src-pages-404-js-6115a896c1bd484b3973.js"],"component---src-pages-confirm-js":["/component---src-pages-confirm-js.e9c5c3b80c5e9b8c6fa0.css","/component---src-pages-confirm-js-e5c8bcda280c240e1d6e.js"],"component---src-pages-thanks-js":["/component---src-pages-thanks-js.e9c5c3b80c5e9b8c6fa0.css","/component---src-pages-thanks-js-bd098f6660863fbb8af2.js"],"pages-manifest":["/pages-manifest-f3e11a74ebf6959e04be.js"]};/*]]>*/</script><script src="/webpack-runtime-dea655677e505366ecd7.js" async=""></script><script src="/1-1b550cd61a5e170131aa.js" async=""></script><script src="/2-31a6021f1637c5720eda.js" async=""></script><script src="/0-b197e8c6c7ff26484233.js" async=""></script><script src="/app-83825dcbe188439d174e.js" async=""></script><script src="/component---src-templates-blog-post-js-5ff9d93420b5b2cefece.js" async=""></script></body></html>