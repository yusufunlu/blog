<!DOCTYPE html><html lang="fr"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/Personal-Blog/2.8bee379ac3150e408f97.css">@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:url(/Personal-Blog/static/merriweather-400-l-8796b7875d52e9cb9b280211e8d3f82d.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:url(/Personal-Blog/static/montserrat-900-l-5751237264c0468be0d48ad1cea75b90.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}body{--pink:#ffa7c4;background-color:var(--bg)}body.light{--bg:#fff;--header:var(--pink);--textNormal:#222;--textTitle:#222;--textLink:#d23669;--hr:rgba(0,0,0,0.2);--inlineCode-bg:rgba(255,229,100,0.2);--inlineCode-text:#1a1a1a}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--textLink:var(--pink);--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:#373c49;--inlineCode-text:#e6e6e6}body:lang(ar) article,body:lang(fa) article{direction:rtl}body:lang(ar) .language-text,body:lang(ar) article .translations,body:lang(ar) article pre,body:lang(fa) .language-text,body:lang(fa) article .translations,body:lang(fa) article pre{direction:ltr}body:lang(ar) .language-text,body:lang(fa) .language-text{display:inline-block}body:lang(ar) blockquote,body:lang(fa) blockquote{border-left:unset;border-right:.32813rem solid rgba(0,0,0,.9);padding-right:1.42188rem;padding-left:unset;margin-left:.75rem;margin-right:-1.75rem}body:lang(fa) article,body:lang(fa) header>h1{font-family:Vazir}body:lang(ar) article,body:lang(ar) header>h1{font-family:Cairo,sans-serif}body:lang(ko) article,body:lang(ko) header{word-break:keep-all}code[class*=language-],pre[class*=language-]{color:#fff;background:none;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;-webkit-font-feature-settings:normal;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:var(--inlineCode-bg);color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;padding-right:1em;padding-left:1.25em;border-left:.25em solid #ffa7c4}.gatsby-highlight,.gatsby-highlight-code-line{margin-right:-1.3125rem;margin-left:-1.3125rem}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#011627;-webkit-overflow-scrolling:touch;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}.react-toggle{touch-action:pan-x;display:inline-block;position:relative;cursor:pointer;background-color:transparent;border:0;padding:0;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.react-toggle-screenreader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle-track{width:50px;height:24px;padding:0;border-radius:30px;background-color:#0f1114;transition:all .2s ease}.react-toggle-track-check{position:absolute;width:17px;height:17px;left:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0;opacity:0;transition:opacity .25s ease}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{position:absolute;width:17px;height:17px;right:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{position:absolute;top:1px;left:1px;width:22px;height:22px;border-radius:50%;background-color:#fafafa;box-sizing:border-box;transition:all .5s cubic-bezier(.23,1,.32,1) 0ms;-webkit-transform:translateX(0);transform:translateX(0)}.react-toggle--checked .react-toggle-thumb{-webkit-transform:translateX(26px);transform:translateX(26px);border-color:#19ab27}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #ffa7c4}.react-toggle:active .react-toggle-thumb{box-shadow:0 0 5px 5px #ffa7c4}</style><style data-href="/Personal-Blog/component---src-templates-blog-post-js.77da55083c18bdb7fbef.css">@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:url(/Personal-Blog/static/merriweather-400-i-l-9a3ea56a5f449980432ace5972181ef6.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:url(/Personal-Blog/static/merriweather-700-l-e24e02bb044cb07539a3a6bd12348d14.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:url(/Personal-Blog/static/merriweather-700-i-l-ad085ede31afcc5585ff34869b1cd029.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}.formkit-form *{box-sizing:border-box}.formkit-form legend{border:none;font-size:inherit;margin-bottom:10px;padding:0;position:relative;display:table}.formkit-form fieldset{border:0;padding:.01em 0 0;margin:0;min-width:0}.formkit-form body:not(:-moz-handler-blocked) fieldset{display:table-cell}.formkit-form p{color:inherit;font-size:inherit;font-weight:inherit}.formkit-form[data-format="slide in"],.formkit-form[data-format=modal]{display:none}.formkit-form .formkit-checkboxes,.formkit-form .formkit-input,.formkit-form .formkit-select{width:100%}.formkit-form .formkit-button,.formkit-form .formkit-submit{border:0;border-radius:5px;color:#fff;cursor:pointer;display:inline-block;text-align:center;font-size:15px;font-weight:500;margin-bottom:15px;overflow:hidden;padding:0;position:relative;vertical-align:middle}.formkit-form .formkit-button:focus,.formkit-form .formkit-button:hover,.formkit-form .formkit-submit:focus,.formkit-form .formkit-submit:hover{outline:none}.formkit-form .formkit-button:focus>span,.formkit-form .formkit-button:hover>span,.formkit-form .formkit-submit:focus>span,.formkit-form .formkit-submit:hover>span{background-color:#dc658d}.formkit-form .formkit-button>span,.formkit-form .formkit-submit>span{display:block;transition:all .3s ease-in-out;padding:12px 24px}.formkit-form .formkit-input{background:#fff;font-size:15px;padding:12px;border:1px solid #e3e3e3;flex:1 0 auto;line-height:1.4;margin:0;transition:border-color .3s ease-out}.formkit-form .formkit-input:focus{outline:none;border-color:#1677be;transition:border-color .3s ease}.formkit-form .formkit-input::-webkit-input-placeholder{color:#848585}.formkit-form .formkit-input:-ms-input-placeholder{color:#848585}.formkit-form .formkit-input::-ms-input-placeholder{color:#848585}.formkit-form .formkit-input::placeholder{color:#848585}.formkit-form [data-group=dropdown]{position:relative;display:inline-block;width:100%}.formkit-form [data-group=dropdown]:before{content:"";top:calc(50% - 2.5px);right:10px;position:absolute;pointer-events:none;border-color:#4f4f4f transparent transparent;border-style:solid;border-width:6px 6px 0;height:0;width:0;z-index:999}.formkit-form [data-group=dropdown] select{height:auto;width:100%;cursor:pointer;color:#333;line-height:1.4;margin-bottom:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:15px;padding:12px 25px 12px 12px;border:1px solid #e3e3e3;background:#fff}.formkit-form [data-group=dropdown] select:focus{outline:none}.formkit-form [data-group=checkboxes]{text-align:left;margin:0}.formkit-form [data-group=checkboxes] [data-group=checkbox]{margin-bottom:10px}.formkit-form [data-group=checkboxes] [data-group=checkbox] *{cursor:pointer}.formkit-form [data-group=checkboxes] [data-group=checkbox]:last-of-type{margin-bottom:0}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]{display:none}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]+label:after{content:none}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label:after{border-color:#fff;content:""}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label:before{background:#10bf7a;border-color:#10bf7a}.formkit-form [data-group=checkboxes] [data-group=checkbox] label{position:relative;display:inline-block;padding-left:28px}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:after,.formkit-form [data-group=checkboxes] [data-group=checkbox] label:before{position:absolute;content:"";display:inline-block}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:before{height:16px;width:16px;border:1px solid #e3e3e3;background:#fff;left:0;top:3px}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:after{height:4px;width:8px;border-left:2px solid #4d4d4d;border-bottom:2px solid #4d4d4d;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);left:4px;top:8px}.formkit-form .formkit-alert{background:#f9fafb;border:1px solid #e3e3e3;border-radius:5px;flex:1 0 auto;list-style:none;margin:25px auto;padding:12px;text-align:center;width:100%}.formkit-form .formkit-alert:empty{display:none}.formkit-form .formkit-alert-success{background:#d3fbeb;border-color:#10bf7a;color:#0c905c}.formkit-form .formkit-alert-error{background:#fde8e2;border-color:#f2643b;color:#ea4110}.formkit-form .formkit-spinner{display:flex;height:0;width:0;margin:0 auto;position:absolute;top:0;left:0;right:0;overflow:hidden;text-align:center;transition:all .3s ease-in-out}.formkit-form .formkit-spinner>div{margin:auto;width:12px;height:12px;background-color:#fff;opacity:.3;border-radius:100%;display:inline-block;-webkit-animation:formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd- 1.4s ease-in-out infinite both;animation:formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd- 1.4s ease-in-out infinite both}.formkit-form .formkit-spinner>div:first-child{-webkit-animation-delay:-.32s;animation-delay:-.32s}.formkit-form .formkit-spinner>div:nth-child(2){-webkit-animation-delay:-.16s;animation-delay:-.16s}.formkit-form .formkit-submit[data-active] .formkit-spinner{opacity:1;height:100%;width:50px}.formkit-form .formkit-submit[data-active] .formkit-spinner~span{opacity:0}@-webkit-keyframes formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd-{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd-{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.formkit-form{box-shadow:0 2px 15px 0 rgba(210,214,220,.5);max-width:700px;overflow:hidden}.formkit-form [data-style=full]{width:100%;display:block}.formkit-form .formkit-header{margin-top:0;margin-bottom:20px;font-family:inherit}.formkit-form .formkit-subheader{margin:15px 0}.formkit-form .formkit-column{background-size:cover;background-repeat:no-repeat;background-position:50%;padding:20px}.formkit-form .formkit-column:nth-child(2){border-top:1px solid #e9ecef}.formkit-form .formkit-field{margin:0 0 15px}.formkit-form .formkit-input,.formkit-form .formkit-submit{width:100%}.formkit-form .formkit-guarantee{font-size:13px;margin:0 0 15px}.formkit-form .formkit-guarantee>p{margin:0}.formkit-form .formkit-powered-by{color:#7d7d7d;display:block;font-size:12px;margin-bottom:0;text-align:center}.formkit-form .formkit-powered-by[data-active=false]{opacity:.5}.formkit-form[min-width~="600"] [data-style=full],.formkit-form[min-width~="700"] [data-style=full],.formkit-form[min-width~="800"] [data-style=full]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.formkit-form[min-width~="600"] .formkit-submit,.formkit-form[min-width~="700"] .formkit-submit,.formkit-form[min-width~="800"] .formkit-submit{width:auto}.formkit-form[min-width~="600"] .formkit-column,.formkit-form[min-width~="700"] .formkit-column,.formkit-form[min-width~="800"] .formkit-column{padding:40px}.formkit-form[min-width~="600"] .formkit-column:nth-child(2),.formkit-form[min-width~="700"] .formkit-column:nth-child(2),.formkit-form[min-width~="800"] .formkit-column:nth-child(2){border-top:none}</style><meta name="generator" content="Gatsby 2.0.91"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="Dan Abramov&#x27;s Overreacted Blog RSS Feed" href="/Personal-Blog/rss.xml"/><link rel="shortcut icon" href="/Personal-Blog/icons/icon-48x48.png"/><link rel="manifest" href="/Personal-Blog/manifest.webmanifest"/><title data-react-helmet="true">React vu comme une Runtime dâ€™UI â€” Overreacted</title><meta data-react-helmet="true" name="theme-color" content="#282c35"/><meta data-react-helmet="true" name="description" content="Une description en profondeur du modÃ¨le de programmation de React."/><meta data-react-helmet="true" property="og:url" content="https://yusufunlu.github.io/Personal-Blog//fr/react-as-a-ui-runtime/"/><meta data-react-helmet="true" property="og:title" content="React vu comme une Runtime dâ€™UI"/><meta data-react-helmet="true" property="og:description" content="Une description en profondeur du modÃ¨le de programmation de React."/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@dan_abramov"/><meta data-react-helmet="true" name="twitter:title" content="React vu comme une Runtime dâ€™UI"/><meta data-react-helmet="true" name="twitter:description" content="Une description en profondeur du modÃ¨le de programmation de React."/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:inherit;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);border-left-color:inherit;opacity:0.8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:var(--hr);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"â€” ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:var(--textLink);text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}a.anchor{box-shadow:none;}a.anchor svg[aria-hidden="true"]{stroke:var(--textLink);}p code{font-size:1rem;}h1 code, h2 code, h3 code, h4 code, h5 code, h6 code{font-size:inherit;}li code{font-size:1rem;}blockquote.translation{font-size:1em;}</style><link as="script" rel="preload" href="/Personal-Blog/component---src-templates-blog-post-js-ef2898a2e81c47683f5b.js"/><link as="script" rel="preload" href="/Personal-Blog/app-198cd55e69a6a03b3f73.js"/><link as="script" rel="preload" href="/Personal-Blog/0-b197e8c6c7ff26484233.js"/><link as="script" rel="preload" href="/Personal-Blog/2-469c709c476faea7103a.js"/><link as="script" rel="preload" href="/Personal-Blog/1-1b550cd61a5e170131aa.js"/><link as="script" rel="preload" href="/Personal-Blog/webpack-runtime-816b037bee21ad2c738f.js"/><link as="fetch" rel="preload" href="/Personal-Blog/static/d/353/path---fr-react-as-a-ui-runtime-155-e80-P64LCvUbqfAY2MQSH3dhuH3NBAs.json" crossorigin="use-credentials"/></head><body class="light"><script>
              (function() {
                window.__onThemeChange = function() {};
                function setTheme(newTheme) {
                  window.__theme = newTheme;
                  preferredTheme = newTheme;
                  document.body.className = newTheme;
                  window.__onThemeChange(newTheme);
                }

                var preferredTheme;
                try {
                  preferredTheme = localStorage.getItem('theme');
                } catch (err) { }

                window.__setPreferredTheme = function(newTheme) {
                  setTheme(newTheme);
                  try {
                    localStorage.setItem('theme', newTheme);
                  } catch (err) {}
                }

                var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
                darkQuery.addListener(function(e) {
                  window.__setPreferredTheme(e.matches ? 'dark' : 'light')
                });

                setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
              })();
            </script><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="color:var(--textNormal);background:var(--bg);transition:color 0.2s ease-out, background 0.2s ease-out;min-height:100vh"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2.625rem"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:0;height:42px;line-height:2.625rem"><a style="box-shadow:none;text-decoration:none;color:rgb(255, 167, 196)" href="/Personal-Blog/">Overreacted</a></h3><div style="height:24px"></div></header><main><article><header><h1 style="color:var(--textTitle)">React vu comme une Runtime dâ€™UI</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.4rem">February 2, 2019<!-- --> â€¢ ğŸ±ğŸ±ğŸ± 43 min read</p><div class="translations"><p style="font-size:0.9em;border:1px solid var(--hr);border-radius:0.75em;padding:0.75em;background:var(--inlineCode-bg);word-break:keep-all;font-family:system-ui, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
    &quot;Roboto&quot;, &quot;Oxygen&quot;, &quot;Ubuntu&quot;, &quot;Cantarell&quot;, &quot;Fira Sans&quot;,
    &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif"><span><span>Translated by readers into: </span><a href="/Personal-Blog/es/react-as-a-ui-runtime/">EspaÃ±ol</a> â€¢ <b>FranÃ§ais</b> â€¢ <a href="/Personal-Blog/zh-hans/react-as-a-ui-runtime/">ç®€ä½“ä¸­æ–‡</a> â€¢ <a href="/Personal-Blog/ko/react-as-a-ui-runtime/">í•œêµ­ì–´</a></span><br/><br/><a href="/Personal-Blog/react-as-a-ui-runtime/">Read the original</a> â€¢ <a href="https://github.com/gaearon/overreacted.io/edit/master/src/pages/react-as-a-ui-runtime/index.fr.md" target="_blank" rel="noopener noreferrer">Improve this translation</a> â€¢ <a href="/Personal-Blog/fr">View all translated posts</a> </p></div></header><div><p>La plupart des tutos prÃ©sentent React comme une bibliothÃ¨que UI.  Câ€™est logique puisque React <em>est</em> une bibliothÃ¨que UI.  Câ€™est littÃ©ralement dans son sloganÂ !</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/Personal-Blog/static/0429fcb4a2f2022852afc698ff8968f1/74bd4/react.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 29.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEElEQVQY011Qy07DMBD0v1CniRM7dt4Pp01VWgmQOKEeekKCA0hIFUcOSIgfH9amDaWH0c4+ZrxeFiY5zjGPswlBqMCvIvCZ8Ajm8t/MpcZxdmkYyoKECubmAcv3b1S7J8Iz6v0L8vs95pH2c9I0MKWFLnqorJ2MWSBoE2H+QEVOm8jxDv3rB+zbJ4bDF5rHA8ztDjxMEcnSmzitM4nTyhsnugaTpoai19K8hc47z11T0pAQGkrliGMDlZKJrrw4qyxh8BqHhOpClcQ7MFP2aPoV+sV6QjesMYwb1N2IjnLXt8trLFZbtNbxDey49bmrO41QhT8DO32V0218PPIpP4v8OOu2dBvN6Ps8+u2dbvoDB8/AqO9EOdcAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Capture dâ€™Ã©cran de la page dâ€™accueil de ReactÂ : Â«Â Une bibliothÃ¨que JavaScript pour construire des interfaces utilisateursÂ Â»"
        title=""
        src="/Personal-Blog/static/0429fcb4a2f2022852afc698ff8968f1/74bd4/react.png"
        srcset="/Personal-Blog/static/0429fcb4a2f2022852afc698ff8968f1/309d6/react.png 148w,
/Personal-Blog/static/0429fcb4a2f2022852afc698ff8968f1/fe30e/react.png 295w,
/Personal-Blog/static/0429fcb4a2f2022852afc698ff8968f1/74bd4/react.png 500w"
        sizes="(max-width: 500px) 100vw, 500px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>Jâ€™ai dÃ©jÃ  parlÃ© des dÃ©fis de la crÃ©ation dâ€™<a href="/Personal-Blog/the-elements-of-ui-engineering/">interfaces utilisateurs</a>.   Mais cet article parle de React sous un autre angleâ€”plutÃ´t en tant quâ€™<a href="https://en.wikipedia.org/wiki/Runtime_system" target="_blank" rel="nofollow noopener noreferrer">environnement dâ€™exÃ©cution</a>. <em>(Dans la suite de cet article, pour des raisons de concision, nous emploierons le terme gÃ©nÃ©rique anglais <strong>runtime</strong>, NdT)</em></p>
<p><strong>Cet article ne vous apprendera rien sur la crÃ©ation dâ€™interfaces utilisateurs.</strong>  Mais il vous aidera peut-Ãªtre Ã  comprendre plus en profondeur le modÃ¨le de programmation de React.</p>
<hr>
<p><strong>NoteÂ : si vous <em>apprenez</em> React, jetez plutÃ´t un Å“il aux <a href="https://reactjs.org/docs/getting-started.html#learn-react" target="_blank" rel="nofollow noopener noreferrer">docs</a>.</strong></p>
<p><font size="60">âš ï¸</font></p>
<p><strong>On part pour une exploration en profondeurâ€”cet article Nâ€™EST PAS destinÃ© aux personnes qui dÃ©butent en React.</strong>  Dans cet article, je dÃ©cris la majeure partie du modÃ¨le de programmation de React en partant de principes premiers.  Je nâ€™explique pas comment on sâ€™en sertâ€”plutÃ´t comment il fonctionne.</p>
<p>Je vise ici un lectorat de dÃ©veloppeurÂ·seÂ·s chevronnÃ©Â·eÂ·s et de personnes qui bossent sur dâ€™autres bibliothÃ¨ques UI et se demandent quels compromis React a retenus.  Jâ€™espÃ¨re que vous trouverez ce texte utileÂ !</p>
<p><strong>Beaucoup de monde utilise React avec succÃ¨s pendant des annÃ©es sans avoir Ã  rÃ©flÃ©chir Ã  la plupart de ces questions.</strong>  On adopte ici clairement un regard sur React orientÃ© dÃ©veloppeurs, par opposition Ã , par exemple, une <a href="http://mrmrs.cc/writing/2016/04/21/developing-ui/" target="_blank" rel="nofollow noopener noreferrer">vision de designer</a>.  Mais je trouve quâ€™il nâ€™est pas inutile de proposer des ressources pour ces deux mondes.</p>
<p>Cet avertissement derriÃ¨re nous, allons-yÂ !</p>
<hr>
<h2 id="arbre-hÃ´te"><a href="#arbre-h%C3%B4te" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Arbre hÃ´te</h2>
<p>Certains programmes produisent des nombres.  Dâ€™autres produisent des poÃ¨mes.  Les diffÃ©rents langages et leurs runtimes sont souvent optimisÃ©s pour un ensemble particulier de tÃ¢ches, et React ne fait pas exception.</p>
<p>Les programmes utilisant React produisent en gÃ©nÃ©ral <strong>un arbre qui peut changer avec le temps</strong>.  Ce peut Ãªtre un <a href="https://www.npmjs.com/package/react-dom" target="_blank" rel="nofollow noopener noreferrer">arbre DOM</a>, ou une <a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/Devpedia-CocoaApp/View%20Hierarchy.html" target="_blank" rel="nofollow noopener noreferrer">hiÃ©rarchie iOS</a>, un arbre de <a href="https://react-pdf.org/" target="_blank" rel="nofollow noopener noreferrer">primitives PDF</a>, ou mÃªme <a href="https://reactjs.org/docs/test-renderer.html" target="_blank" rel="nofollow noopener noreferrer">des objets JSON</a>. Dans tous les cas, on cherche en gÃ©nÃ©ral Ã  reprÃ©senter une forme dâ€™UI grÃ¢ce Ã  lui.  Nous lâ€™appellerons lâ€™arbre <em>hÃ´te</em> parce quâ€™il fait partie de <em>lâ€™environnement hÃ´te</em> hors de Reactâ€”tel que le DOM ou iOS.  Lâ€™arbre hÃ´te a gÃ©nÃ©ralement une <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild" target="_blank" rel="nofollow noopener noreferrer">API</a> impÃ©rative qui lui est <a href="https://developer.apple.com/documentation/uikit/uiview/1622616-addsubview" target="_blank" rel="nofollow noopener noreferrer">propre</a>.  React est une couche au-dessus de Ã§a.</p>
<p>Alors en quoi React est-il utileÂ ?  En termes abstraits, il vous aide Ã  Ã©crire un programme qui manipule de faÃ§on prÃ©visible un arbre hÃ´te complexe en rÃ©ponse Ã  des Ã©vÃ©nements extÃ©rieurs tels que des interactions, une rÃ©ponse rÃ©seau, des timers, etc.</p>
<p>Un outil spÃ©cialisÃ© marche en gÃ©nÃ©ral mieux quâ€™un outil gÃ©nÃ©rique parce quâ€™il peut imposer des contraintes particuliÃ¨res qui lui procurent un avantage.  React se base sur deux suppositions principalesÂ :</p>
<ul>
<li>
<p><strong>La stabilitÃ©.</strong>  Lâ€™arbre hÃ´te est relativement stable et la plupart des mises Ã  jour nâ€™en changent pas radicalement la structure gÃ©nÃ©rale.  Si une appli redisposait tous ses Ã©lÃ©ments interactifs dans une configuration totalement diffÃ©rente Ã  chaque seconde, elle serait bien difficile Ã  utiliser.  OÃ¹ est passÃ© ce boutonÂ ? Pourquoi mon Ã©cran danse-t-ilÂ ?</p>
</li>
<li>
<p><strong>La rÃ©gularitÃ©.</strong>  Lâ€™arbre hÃ´te peut Ãªtre dÃ©composÃ© en motifs dâ€™UI qui gardent un aspect et un comportement cohÃ©rents (tels que des boutons, des listes, des avatars) plutÃ´t que des formes alÃ©atoires.</p>
</li>
</ul>
<p><strong>Ces suppositions sâ€™avÃ¨rent justes dans la plupart des UIs.</strong>  Le cÃ´tÃ© face, câ€™est que React nâ€™est pas lâ€™outil adaptÃ© lorsquâ€™on manque de Â«Â motifsÂ Â» stables dans la sortie produite.  Par exemple, React pourrait vous aider Ã  Ã©crire un client Twitter mais ne serait guÃ¨re utile pour un <a href="https://www.youtube.com/watch?v=Uzx9ArZ7MUU" target="_blank" rel="nofollow noopener noreferrer">Ã©conomiseur dâ€™Ã©cran de tuyaux en 3D</a>.</p>
<h2 id="instances-hÃ´tes"><a href="#instances-h%C3%B4tes" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Instances hÃ´tes</h2>
<p>Lâ€™arbre hÃ´te est constituÃ© de nÅ“uds.  Nous les appellerons des Â«Â instances hÃ´tesÂ Â».</p>
<p>Dans un environnement DOM, les instances hÃ´tes sont des nÅ“uds DOM normauxâ€”comme ces objets que vous obtenez en appelant <code class="language-text">document.createElement(&#39;div&#39;)</code>.  Sur iOS, les instances hÃ´tes pourraient Ãªtre des valeurs JavaScript identifiant de faÃ§on unique des vues natives.</p>
<p>Les instances hÃ´tes ont leurs propriÃ©tÃ©s propres (ex. <code class="language-text">domNode.className</code> ou <code class="language-text">view.tintColor</code>).  Elles peuvent aussi avoir dâ€™autres instances hÃ´tes comme Ã©lÃ©ments enfants.</p>
<p>(Ceci nâ€™a rien Ã  voir avec Reactâ€”je dÃ©cris ici les environnements hÃ´tes.)</p>
<p>Une API est gÃ©nÃ©ralement disponible pour manipuler les instances hÃ´tes. Par exemple, le DOM fournit des APIs telles que <code class="language-text">appendChild</code>, <code class="language-text">removeChild</code>, <code class="language-text">setAttribute</code> et ainsi de suite.  Dans des applis React, nous nâ€™appelons gÃ©nÃ©ralement pas ces APIs. Câ€™est le boulot de React.</p>
<h2 id="renderers"><a href="#renderers" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Renderers</h2>
<p>Un <em>renderer (moteur de rendu, mais nous utiliserons sans italiques le terme anglais Ã©tabli <strong>renderer</strong>, NdT)</em> apprend Ã  React Ã  parler Ã  un environnement hÃ´te spÃ©cifique et gÃ¨re ses instances hÃ´tes.  React DOM, React Native, et mÃªme <a href="https://mobile.twitter.com/vadimdemedes/status/1089344289102942211" target="_blank" rel="nofollow noopener noreferrer">Ink</a> sont des renderers React. Vous pouvez aussi <a href="https://github.com/facebook/react/tree/master/packages/react-reconciler" target="_blank" rel="nofollow noopener noreferrer">crÃ©er votre propre renderer React</a>.</p>
<p>Les renderers React peuvent fonctionner dans lâ€™un de deux modes.</p>
<p>La vaste majoritÃ© des renderers sont Ã©crits sur le mode Â«Â mutatifÂ Â». Câ€™est le mode de fonctionnement du DOMÂ : on peut crÃ©er un nÅ“ud, dÃ©finir ses propriÃ©tÃ©s, et plus tard lui ajouter ou retirer des enfants. Les instances hÃ´tes sont complÃ¨tement modifiables.</p>
<p>React peut Ã©galement fonctionner en mode Â«Â persistantÂ Â». Ce mode est lÃ  pour les environnements qui ne fournissent pas de mÃ©thodes du type <code class="language-text">appendChild()</code>, mais au contraire clonent lâ€™arbre parent et remplacent systÃ©matiquement lâ€™enfant de plus haut niveau.  Lâ€™immutabilitÃ© au niveau de lâ€™arbre hÃ´te facilite le recours au multi-thread. <a href="https://facebook.github.io/react-native/blog/2018/06/14/state-of-react-native-2018" target="_blank" rel="nofollow noopener noreferrer">React Fabric</a> en tire parti.</p>
<p>En tant quâ€™utilisateurs de React, nous nâ€™avons jamais besoin de penser Ã  ces nÅ“uds.  Je veux juste insister sur le fait que React nâ€™est pas juste un adaptateur entre deux modes.  Son utilitÃ© est indÃ©pendante du paradigme dâ€™API des vues de bas niveau quâ€™il cible.</p>
<h2 id="Ã©lÃ©ments-react"><a href="#%C3%A9l%C3%A9ments-react" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ã‰lÃ©ments React</h2>
<p>Dans lâ€™environnement hÃ´te, une instance hÃ´te (telle quâ€™un nÅ“ud DOM) constitue le plus petit bloc de construction.  Dans React, ce plus petit bloc est un <em>Ã©lÃ©ment React</em>.</p>
<p>Un Ã©lÃ©ment React est un objet JavaScript nu.  Il <em>dÃ©crit</em> une instance hÃ´te.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// JSX est un sucre syntaxique pour ces objets.</span>
<span class="token comment">// &lt;button className="blue" /></span>
<span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">'button'</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span> className<span class="token punctuation">:</span> <span class="token string">'blue'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Un Ã©lÃ©ment React est lÃ©ger et nâ€™est pas associÃ© Ã  une instance hÃ´te. Encore une fois, il se contente de <em>dÃ©crire</em> ce que vous voulez voir Ã  lâ€™Ã©cran.</p>
<p>Tout comme les instances hÃ´tes, les Ã©lÃ©ments React peuvent former un arbreÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// JSX est un sucre syntaxique pour ces objets.</span>
<span class="token comment">// &lt;dialog></span>
<span class="token comment">//   &lt;button className="blue" /></span>
<span class="token comment">//   &lt;button className="red" /></span>
<span class="token comment">// &lt;/dialog></span>
<span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">'dialog'</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">'button'</span><span class="token punctuation">,</span>
      props<span class="token punctuation">:</span> <span class="token punctuation">{</span> className<span class="token punctuation">:</span> <span class="token string">'blue'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">'button'</span><span class="token punctuation">,</span>
      props<span class="token punctuation">:</span> <span class="token punctuation">{</span> className<span class="token punctuation">:</span> <span class="token string">'red'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>(RemarqueÂ : jâ€™ai laissÃ© de cÃ´tÃ© <a href="/Personal-Blog/why-do-react-elements-have-typeof-property/">certaines propriÃ©tÃ©s</a> qui nâ€™ont pas dâ€™intÃ©rÃªt pour cette explication.)</em></p>
<p>Rappelez-vous cependant que <strong>les Ã©lÃ©ments React nâ€™ont pas leur propre identitÃ© persistante.</strong>  Ils sont censÃ©s Ãªtre re-crÃ©Ã©s et jetÃ©s Ã  tout bout de champ.</p>
<p>Les Ã©lÃ©ments React sont immuables.  Par exemple, vous ne pouvez pas changer les enfants ni une propriÃ©tÃ© dâ€™un Ã©lÃ©ment React.  Si vous voulez afficher quelque chose de diffÃ©rent par la suite, vous devrez le <em>dÃ©crire</em> Ã  lâ€™aide dâ€™un nouvel arbre dâ€™Ã©lÃ©ments React crÃ©Ã© Ã  partir de zÃ©ro.</p>
<p>Jâ€™aime considÃ©rer les Ã©lÃ©ments React comme les images distinctes dâ€™un film.  Ils reprÃ©sentent ce Ã  quoi lâ€™UI devrait ressembler Ã  un point prÃ©cis dans le temps.  Ils ne changent pas.</p>
<h2 id="point-dentrÃ©e"><a href="#point-dentr%C3%A9e" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Point dâ€™entrÃ©e</h2>
<p>Chaque renderer React a un Â«Â point dâ€™entrÃ©eÂ Â».  Câ€™est lâ€™API qui nous permet de dire Ã  React dâ€™afficher un arbre dâ€™Ã©lÃ©ments React donnÃ© au sein dâ€™une instance hÃ´te conteneur.</p>
<p>Par exemple, le point dâ€™entrÃ©e de React DOM est <code class="language-text">ReactDOM.render</code>Â :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token comment">// { type: 'button', props: { className: 'blue' } }</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Quand nous Ã©crivons <code class="language-text">ReactDOM.render(reactElement, domContainer)</code>, nous disons en faitÂ : <strong>Â«Â Cher React, fais que lâ€™arbre hÃ´te dans <code class="language-text">domContainer</code> reflÃ¨te celui de mon <code class="language-text">reactElement</code>.Â Â»</strong></p>
<p>React va regarder <code class="language-text">reactElement.type</code> (dans notre exemple, <code class="language-text">&#39;button&#39;</code>) et demander au renderer de React DOM de crÃ©er une instance hÃ´te adaptÃ©e et dâ€™en dÃ©finir les propriÃ©tÃ©sÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Quelque part dans le renderer ReactDOM (simplifiÃ©)</span>
<span class="token keyword">function</span> <span class="token function">createHostInstance</span><span class="token punctuation">(</span>reactElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">let</span> domNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>reactElement<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  domNode<span class="token punctuation">.</span>className <span class="token operator">=</span> reactElement<span class="token punctuation">.</span>props<span class="token punctuation">.</span>className<span class="token punctuation">;</span></span>  <span class="token keyword">return</span> domNode<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Dans cet exemple, en pratique React fera ceciÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">let</span> domNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">domNode<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span></span>
domContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>domNode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Si lâ€™Ã©lÃ©ment React a des Ã©lÃ©ments enfants dans <code class="language-text">reactElement.props.children</code>, React va rÃ©cursivement crÃ©er des instances hÃ´tes pour eux aussi lors du premier rendu.</p>
<h2 id="rÃ©conciliation"><a href="#r%C3%A9conciliation" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RÃ©conciliation</h2>
<p>Que se passe-t-il si nous appelons <code class="language-text">ReactDOM.render()</code> deux fois avec le mÃªme conteneurÂ ?</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span></span>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ... plus tard ...</span>

<span class="token comment">// Ce code doit-il *remplacer* lâ€™instance hÃ´te du</span>
<span class="token comment">// bouton, ou simplement mettre Ã  jour une propriÃ©tÃ©</span>
<span class="token comment">// sur lâ€™instance existante ?</span>
<span class="gatsby-highlight-code-line">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Encore une fois, le boulot de React consiste Ã  <em>faire que lâ€™arbre hÃ´te corresponde Ã  lâ€™arbre dâ€™Ã©lÃ©ments React fourni</em>. Le processus qui dÃ©termine <em>quoi</em> faire dans lâ€™arbre dâ€™instances hÃ´tes en rÃ©ponse Ã  de nouvelles informations est parfois appelÃ© <a href="https://reactjs.org/docs/reconciliation.html" target="_blank" rel="nofollow noopener noreferrer">rÃ©conciliation</a>.</p>
<p>Il y a deux faÃ§ons de sâ€™y prendre.  Une version simplifiÃ©e de React pourrait juste dÃ©gager lâ€˜arbre existant et le recrÃ©er Ã  partir de zÃ©roÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> domContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Effacer lâ€™arbre</span>
domContainer<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token comment">// CrÃ©er le nouvel arbre dâ€™instances hÃ´tes</span>
<span class="token keyword">let</span> domNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
domNode<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>
domContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>domNode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Mais dans le DOM, cette approche est lente et perd des informations importantes telles que le focus, la sÃ©lection, lâ€™Ã©tat du dÃ©filement, et ainsi de suite.  Au lieu de Ã§a, nous voulons que React fasse quelque chose comme ceciÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> domNode <span class="token operator">=</span> domContainer<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
<span class="token comment">// Mettre Ã  jour lâ€™instance hÃ´te existante</span>
domNode<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span></code></pre></div>
<p>En dâ€™autres termes, React a besoin de dÃ©cider quand <em>mettre Ã  jour</em> une instance hÃ´te existante pour correspondre Ã  un nouvel Ã©lÃ©ment React, et quand en crÃ©er une <em>nouvelle</em>.</p>
<p>Ce qui pose la question de <em>lâ€™identitÃ©</em>.  Lâ€™Ã©lÃ©ment React peut Ãªtre diffÃ©rent Ã  chaque fois, mais quand se rapporte-t-il Ã  la mÃªme instance hÃ´te, conceptuellementÂ ?</p>
<p>Dans notre exemple, la rÃ©ponse est simple.  Nous affichions un <code class="language-text">&lt;button&gt;</code> comme premier (et seul) enfant, et nous voulons afficher un <code class="language-text">&lt;button&gt;</code> Ã  nouveau, Ã  la mÃªme position.  Nous avons dÃ©jÃ  une instance hÃ´te <code class="language-text">&lt;button&gt;</code> alors pourquoi en re-crÃ©er uneÂ ?  Contentons-nous de la rÃ©utiliser.</p>
<p>VoilÃ  qui est assez proche de la faÃ§on dont React aborde ce problÃ¨me.</p>
<p><strong>Si un type dâ€™Ã©lÃ©ment Ã  la mÃªme position dans lâ€™arbre Â«Â correspondÂ Â» entre les rendus prÃ©cÃ©dent et suivant, React rÃ©utilise lâ€™instance hÃ´te existante.</strong></p>
<p>Voici un exemple commentÃ© qui montre <em>grosso modo</em> ce que fait ReactÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// let domNode = document.createElement('button');</span>
<span class="token comment">// domNode.className = 'blue';</span>
<span class="token comment">// domContainer.appendChild(domNode);</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line"><span class="token comment">// Instance hÃ´te rÃ©utilisable ? Oui ! (button â†’ button)</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// domNode.className = 'red';</span></span>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line"><span class="token comment">// Instance hÃ´te rÃ©utilisable ? Non ! (button â†’ p)</span></span><span class="token comment">// domContainer.removeChild(domNode);</span>
<span class="token comment">// domNode = document.createElement('p');</span>
<span class="token comment">// domNode.textContent = 'Hello';</span>
<span class="token comment">// domContainer.appendChild(domNode);</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line"><span class="token comment">// Instance hÃ´te rÃ©utilisable ? Oui ! (p â†’ p)</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// domNode.textContent = 'Goodbye';</span></span>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Goodbye</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>La mÃªme heuristique est utilisÃ©e pour les arbres enfants.  Par exemple, quand nous mettons Ã  jour un <code class="language-text">&lt;dialog&gt;</code> avec deux <code class="language-text">&lt;button&gt;s</code> Ã  lâ€™intÃ©rieur, React dÃ©cide dâ€™abord sâ€™il peut rÃ©utiliser le <code class="language-text">&lt;dialog&gt;</code>, puis rÃ©pÃ¨te cette procÃ©dure de dÃ©cision pour chaque enfant.</p>
<h2 id="conditions"><a href="#conditions" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conditions</h2>
<p>Si React rÃ©utilise les instances hÃ´tes seulement quand les types dâ€™Ã©lÃ©ments Â«Â correspondentÂ Â» dâ€™une mise Ã  jour Ã  lâ€™autre, comment produire du contenu conditionnelÂ ?</p>
<p>Imaginons que nous voulions commencer par afficher seulement un champ, pour ensuite produire un message avant luiÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Premier rendu</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dialog</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  domContainer
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Rendu suivant</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dialog</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Je viens dâ€™Ãªtre ajoutÃ© ici !</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  domContainer
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Dans cet exemple, lâ€™instance hÃ´te <code class="language-text">&lt;input&gt;</code> serait re-crÃ©Ã©e.  React parcourerait lâ€™arbre des Ã©lÃ©ments, le comparant Ã  la version prÃ©cÃ©denteÂ :</p>
<ul>
<li>
<p><code class="language-text">dialog â†’ dialog</code>Â : Instance hÃ´te rÃ©utilisableÂ ? <strong>Ouiâ€”le type correspond.</strong></p>
<ul>
<li><code class="language-text">input â†’ p</code>Â : Instance hÃ´te rÃ©utilisableÂ ? <strong>Non, le type a changÃ©Â !</strong> Il faut retirer le <code class="language-text">input</code> existant et crÃ©e une nouvelle instance hÃ´te <code class="language-text">p</code>.</li>
<li><code class="language-text">(rien) â†’ input</code>Â : Il faut crÃ©er une nouvelle instance hÃ´te <code class="language-text">input</code>.</li>
</ul>
</li>
</ul>
<p>Ainsi, le code de mise Ã  jour exÃ©cutÃ© par React ressemblerait Ã  ceciÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">let</span> oldInputNode <span class="token operator">=</span> dialogNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">dialogNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>oldInputNode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token keyword">let</span> pNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pNode<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Je viens dâ€™Ãªtre ajoutÃ© ici !'</span><span class="token punctuation">;</span>
dialogNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>pNode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">let</span> newInputNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">dialogNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newInputNode<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>Ce nâ€™est pas idÃ©al parce que <em>conceptuellement</em> le <code class="language-text">&lt;input&gt;</code> nâ€™a pas Ã©tÃ© <em>remplacÃ©</em> par le <code class="language-text">&lt;p&gt;</code>â€”il a juste bougÃ©.  On ne veut pas perdre sa sÃ©lection, son Ã©tat de focus, et son contenu en re-crÃ©ant son DOM.</p>
<p>MÃªme si ce problÃ¨me a une solution simple (que nous allons voir dans un instant), il ne survient que rarement dans les applications React.  Il est intÃ©ressant de voir pourquoi.</p>
<p>En pratique, vous appeleriez rarement <code class="language-text">ReactDOM.render</code>.  Les applis React ont plutÃ´t tendance Ã  Ãªtre dÃ©composÃ©es en fonctions du genre de celle-ciÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showMessage <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>showMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    message <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Je viens dâ€™Ãªtre ajoutÃ© ici !</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dialog</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Cet exemple ne souffre pas du problÃ¨me que nous venons de dÃ©crire.  Il est peut-Ãªtre plus facile de comprendre pourquoi en examinant la notation objet plutÃ´t que son JSX.  Regardez donc lâ€™arbre des Ã©lÃ©ments enfants de <code class="language-text">dialog</code>Â :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showMessage <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>showMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    message <span class="token operator">=</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
      props<span class="token punctuation">:</span> <span class="token punctuation">{</span> children<span class="token punctuation">:</span> <span class="token string">'Je viens dâ€™Ãªtre ajoutÃ© ici !'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'dialog'</span><span class="token punctuation">,</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      children<span class="token punctuation">:</span> <span class="token punctuation">[</span></span><span class="gatsby-highlight-code-line">        message<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span> props<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">]</span></span>    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Peu importe que <code class="language-text">showMessage</code> soit <code class="language-text">true</code> ou <code class="language-text">false</code>, le <code class="language-text">&lt;input&gt;</code> est le second enfant et sa position dans lâ€™arbre ne change pas dâ€™un rendu Ã  lâ€™autre.</strong></p>
<p>Si <code class="language-text">showMessage</code> passait de <code class="language-text">false</code> Ã  <code class="language-text">true</code>, React parcourerait lâ€™arbre dâ€™Ã©lÃ©ments, en le comparant Ã  la version prÃ©cÃ©denteÂ :</p>
<ul>
<li>
<p><code class="language-text">dialog â†’ dialog</code>Â : Instance hÃ´te rÃ©utilisableÂ ? <strong>Ouiâ€”le type correspond.</strong></p>
<ul>
<li><code class="language-text">(null) â†’ p</code>Â : Il faut crÃ©er une nouvelle instance hÃ´te <code class="language-text">p</code>.</li>
<li><code class="language-text">input â†’ input</code>Â : Instance hÃ´te rÃ©utilisableÂ ? <strong>Ouiâ€”le type correspond.</strong></li>
</ul>
</li>
</ul>
<p>Et le code exÃ©cutÃ© par React ressemblerait Ã  ceciÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> inputNode <span class="token operator">=</span> dialogNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
<span class="token keyword">let</span> pNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pNode<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Je viens dâ€™Ãªtre ajoutÃ© ici !'</span><span class="token punctuation">;</span>
dialogNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>pNode<span class="token punctuation">,</span> inputNode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Pas de perte de lâ€˜Ã©tat du champ dÃ©sormais.</p>
<h2 id="listes"><a href="#listes" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Listes</h2>
<p>Il suffit gÃ©nÃ©ralement de comparer les types dâ€™Ã©lÃ©ments pour une position donnÃ©e dans lâ€™arbre afin de dÃ©cider si on rÃ©utilise ou re-crÃ©e lâ€™instance hÃ´te correspondante.</p>
<p>Mais Ã§a ne marche bien que si les positions des enfants sont stables, sans rÃ©ordonnancement.  Dans notre exemple prÃ©cÃ©dent, mÃªme si on pourrait qualifier <code class="language-text">message</code> de Â«Â trouÂ Â», nous savions quand mÃªme que le champ apparaÃ®t aprÃ¨s le message, et quâ€™il nâ€™y avait pas dâ€™autre enfant.</p>
<p>Avec des listes dynamiques, on ne peut jamais Ãªtre sÃ»rs que lâ€™ordre est stableÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ShoppingList</span><span class="token punctuation">(</span><span class="token punctuation">{</span> list <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
          Vous avez achetÃ© </span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><span class="token plain-text">
          Combien en voulez-vous : </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Si jamais la <code class="language-text">list</code> de notre panier de courses est rÃ©ordonnÃ©e, React verra que tous les Ã©lÃ©ments <code class="language-text">p</code> et <code class="language-text">input</code> Ã  lâ€™intÃ©rieur ont le mÃªme type, et ne saura pas quâ€™il doit les dÃ©placer. (Du point de vue de React, les <em>Ã©lÃ©ments eux-mÃªmes</em> ont changÃ©, et non leur ordre.)</p>
<p>Le code exÃ©cutÃ© par React pour rÃ©ordonner 10 Ã©lÃ©ments ressemblerait Ã  ceciÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> pNode <span class="token operator">=</span> formNode<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> textNode <span class="token operator">=</span> pNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
  textNode<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Vous avez achetÃ© '</span> <span class="token operator">+</span> items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Ainsi, au lieu de les <em>rÃ©ordonner</em>, React opterait plutÃ´t pour <em>mettre Ã  jour</em> chacun dâ€™eux.  Ã‡a peut engendrer des problÃ¨mes de performance, voire des bugs.  Par exemple, le contenu du premier champ resterait reflÃ©tÃ© dans le premier champ <em>aprÃ¨s</em> le triâ€”mÃªme si conceptuellement ils pouvaient utiliser des produits distincts dans le panierÂ !</p>
<p><strong>Câ€™est pourquoi React vous asticote pour que vous fournissiez une propriÃ©tÃ© spÃ©ciale appelÃ©e <code class="language-text">key</code> chaque fois que vous utilisez un tableau dâ€™Ã©lÃ©ments dans votre renduÂ :</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ShoppingList</span><span class="token punctuation">(</span><span class="token punctuation">{</span> list <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=></span> <span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>productId<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">          Vous avez achetÃ© </span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">          Combien en voulez-vous : </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Une <code class="language-text">key</code> indique Ã  React quâ€™il devrait considÃ©rer un Ã©lÃ©ment comme Ã©tant <em>conceptuellement</em> le mÃªme, quand bien mÃªme sa <em>position</em> au sein de son Ã©lÃ©ment parent Ã©volue dâ€™un rendu Ã  lâ€™autre.</p>
<p>Quand React verra <code class="language-text">&lt;p key=&quot;42&quot;&gt;</code> au sein dâ€™un <code class="language-text">&lt;form&gt;</code>, il vÃ©rifiera que le rendu prÃ©cÃ©dent contenait Ã©galement un <code class="language-text">&lt;p key=&quot;42&quot;&gt;</code> au sein du mÃªme <code class="language-text">&lt;form&gt;</code>.  Ã‡a marche mÃªme si les enfants du <code class="language-text">&lt;form&gt;</code> ont changÃ© dâ€™ordre.  React rÃ©utilisera lâ€™instance hÃ´te prÃ©cÃ©dente avec la mÃªme clÃ© si elle existe, et rÃ©ordonnera les autres Ã©lÃ©ments de mÃªme niveau en fonction de Ã§a.</p>
<p>Remarquez bien que <code class="language-text">key</code> nâ€™a dâ€™importance quâ€™au sein dâ€™un Ã©lÃ©ment parent React prÃ©cis, tel que <code class="language-text">&lt;form&gt;</code>.  React nâ€™essaiera pas de faire correspondre des Ã©lÃ©ments de clÃ© identique situÃ©s dans des parents diffÃ©rents. (React nâ€™a pas de mÃ©thode idiomatique pour dÃ©placer une instance hÃ´te dâ€™un parent Ã  lâ€™autre sans la re-crÃ©er).</p>
<p>Comment choisir une bonne valeur pour <code class="language-text">key</code>Â ?  Une maniÃ¨re simple de rÃ©pondre Ã  cette question consiste Ã  se demanderÂ : <strong>quand est-ce que <em>vous</em> diriez quâ€™un Ã©lÃ©ment est le Â«Â mÃªmeÂ Â», indÃ©pendamment de lâ€™ordreÂ ?</strong>  Par exemple, dans notre panier dâ€™achats, lâ€™ID du produit identifie chaque Ã©lÃ©ment de faÃ§on unique parmi ceux de mÃªme niveau.</p>
<h2 id="composants"><a href="#composants" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Composants</h2>
<p>Nous avons dÃ©jÃ  vu des fonctions qui renvoient des Ã©lÃ©ments ReactÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showMessage <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>showMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    message <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Je viens dâ€™Ãªtre ajoutÃ© ici !</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dialog</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Nous appelons ces fonctions des <em>composants</em>.  Elles nous permettent de crÃ©er notre propre Â«Â boÃ®te Ã  outilsÂ Â» de boutons, avatars, commentaires, etc.  Les composants sont la raison dâ€™Ãªtre de React.</p>
<p>Les composants prennent un argumentâ€”un objet. Il contient des Â«Â propsÂ Â» (le raccourci de Â«Â propriÃ©tÃ©sÂ Â»).  Ici, <code class="language-text">showMessage</code> est une prop.  Elles jouent un rÃ´le similaire Ã  des arguments nommÃ©s.</p>
<h2 id="puretÃ©"><a href="#puret%C3%A9" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PuretÃ©</h2>
<p>Les composants React sont supposÃ©s purs vis-Ã -vis de leurs props.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ğŸ”´ Ã‡a ne marche pas</span>
  props<span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>De faÃ§on gÃ©nÃ©rale, le code mutatif nâ€™est pas du React idiomatique. (Nous explorerons plus tard la maniÃ¨re idiomatique de mettre Ã  jour lâ€™UI en rÃ©ponse Ã  des Ã©vÃ©nements.)</p>
<p>En revanche, les <em>mutations locales</em> ne posent aucun souciÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">FriendList</span><span class="token punctuation">(</span><span class="token punctuation">{</span> friends <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">let</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> friends<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> friend <span class="token operator">=</span> friends<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">    items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Friend</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span> <span class="token attr-name">friend</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>items<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Nous avons crÃ©Ã© <code class="language-text">items</code> <em>pendant le rendu</em> et aucun autre composant ne lâ€™a Â«Â vuÂ Â», de sorte que nous pouvons le modifier autant quâ€™on le souhaite avant de lâ€™intÃ©grer au rÃ©sultat du rendu.  Pas besoin de faire des contorsions de code pour Ã©viter ce genre de mutations locales.</p>
<p>Dans le mÃªme esprit, lâ€™initialisation tardive est acceptable mÃªme si elle nâ€™est pas totalement Â«Â pureÂ Â»Â :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ExpenseForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Acceptable si Ã§a nâ€™affecte pas dâ€™autres composants :</span>
  SuperCalculator<span class="token punctuation">.</span><span class="token function">initializeIfNotReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Suite du rendu...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Tant quâ€™il reste possible dâ€™appeler le composant plusieurs fois de faÃ§on fiable, et que Ã§a nâ€™affecte pas le rendu dâ€™autres composants, React ne se soucie pas de savoir si votre composant est 100% pur au sens strict de la programmation fonctionnelle. Lâ€™<a href="https://stackoverflow.com/questions/1077412/what-is-an-idempotent-operation" target="_blank" rel="nofollow noopener noreferrer">idempotence</a> est plus importante pour React que la puretÃ©.</p>
<p>Ceci Ã©tant dit, les effets de bord qui sont directement visibles pour lâ€™utilisateur ne sont pas autorisÃ©s dans les composants React.  En dâ€™autres termes, simplement <em>appeler</em> une fonction composant ne devrait pas en soi produire de changement Ã  lâ€™Ã©cran.</p>
<h2 id="rÃ©cursivitÃ©"><a href="#r%C3%A9cursivit%C3%A9" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RÃ©cursivitÃ©</h2>
<p>Comment <em>utiliser</em> des composants au sein dâ€™autres composantsÂ ?  Les composants sont des fonctions, donc on <em>pourrait</em> juste les appelerÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> reactElement <span class="token operator">=</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showMessage<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>reactElement<span class="token punctuation">,</span> domContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Cependant, ce nâ€™est <em>pas</em> la faÃ§on idiomatique dâ€™utiliser des composants dans la runtime React.</p>
<p>Non, la maniÃ¨re idiomatique dâ€™utiliser un composant consiste Ã  utiliser le mÃªme mÃ©canisme que nous avons dÃ©jÃ  vuÂ : les Ã©lÃ©ments React. <strong>Ã‡a signifie que vous nâ€™appelez pas directement une fonction composant, mais laissez React le faire plus tard pour vous</strong>Â :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// { type: Form, props: { showMessage: true } }</span>
<span class="token keyword">let</span> reactElement <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Form</span> <span class="token attr-name">showMessage</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>reactElement<span class="token punctuation">,</span> domContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Et quelque part dans React, votre composant sera appelÃ©Â :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Quelque part dans React</span>
<span class="token keyword">let</span> type <span class="token operator">=</span> reactElement<span class="token punctuation">.</span>type<span class="token punctuation">;</span> <span class="token comment">// Form</span>
<span class="token keyword">let</span> props <span class="token operator">=</span> reactElement<span class="token punctuation">.</span>props<span class="token punctuation">;</span> <span class="token comment">// { showMessage: true }</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ce que Form renvoie</span></code></pre></div>
<p>Les noms des fonctions composants ont par convention des initiales majuscules.  Lorsque la transformation du JSX voit <code class="language-text">&lt;Form&gt;</code> au lieu de <code class="language-text">&lt;form&gt;</code>, elle transforme le <code class="language-text">type</code> de lâ€™objet en identifiant plutÃ´t quâ€™en chaÃ®neÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token punctuation">/></span></span><span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ChaÃ®ne 'form'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Form</span> <span class="token punctuation">/></span></span><span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Fonction Form</span></code></pre></div>
<p>Il nâ€™y a pas de mÃ©canisme global dâ€™enregistrementâ€”on rÃ©fÃ¨re littÃ©ralement Ã  <code class="language-text">Form</code> par son nom lorsquâ€™on tape <code class="language-text">&lt;Form /&gt;</code>. Si <code class="language-text">Form</code> nâ€™existe pas dans la portÃ©e courante, vous verrez une erreur JavaScript comme lorsque vous utilisez un nom de variable incorrect.</p>
<p><strong>OK, alors que fait React quand le type dâ€™un Ã©lÃ©ment est une fonctionÂ ?  Il appelle votre composant, et demande quel Ã©lÃ©ment <em>celui-ci</em> veut afficher.</strong></p>
<p>Ce processus continue rÃ©cursivement, comme le dÃ©crit en dÃ©tail <a href="https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html" target="_blank" rel="nofollow noopener noreferrer">cet article</a>.  En rÃ©sumÃ©, Ã§a ressemble Ã  Ã§aÂ :</p>
<ul>
<li><strong>VousÂ :</strong> <code class="language-text">ReactDOM.render(&lt;App /&gt;, domContainer)</code></li>
<li>
<p><strong>ReactÂ :</strong> HÃ© <code class="language-text">App</code>, tu affiches quoiÂ ?</p>
<ul>
<li><code class="language-text">App</code>: Jâ€™affiche un <code class="language-text">&lt;Layout&gt;</code> avec un <code class="language-text">&lt;Content&gt;</code> dedans.</li>
</ul>
</li>
<li>
<p><strong>ReactÂ :</strong> HÃ© <code class="language-text">Layout</code>, tu affiches quoiÂ ?</p>
<ul>
<li><code class="language-text">Layout</code>: Jâ€™affiche mes enfants dans un <code class="language-text">&lt;div&gt;</code>. LÃ  jâ€™ai comme enfant un <code class="language-text">&lt;Content&gt;</code> du coup jâ€™imagine quâ€™il va dans le <code class="language-text">&lt;div&gt;</code>.</li>
</ul>
</li>
<li>
<p><strong>ReactÂ :</strong> HÃ© <code class="language-text">&lt;Content&gt;</code>, tu affiches quoiÂ ?</p>
<ul>
<li><code class="language-text">Content</code>: Jâ€™affiche un <code class="language-text">&lt;article&gt;</code> avec du texte et un <code class="language-text">&lt;Footer&gt;</code> Ã  lâ€™intÃ©rieur.</li>
</ul>
</li>
<li>
<p><strong>ReactÂ :</strong> HÃ© <code class="language-text">&lt;Footer&gt;</code>, tu affiches quoiÂ ?</p>
<ul>
<li><code class="language-text">Footer</code>: Jâ€™affiche un <code class="language-text">&lt;footer&gt;</code> avec encore du texte.</li>
</ul>
</li>
<li><strong>ReactÂ :</strong> OK, alors voilÃ Â :</li>
</ul>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Structure DOM rÃ©sultante</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span><span class="token punctuation">></span></span><span class="token plain-text">
    Du texte
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span><span class="token plain-text">encore du texte</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<p>VoilÃ  pourquoi nous disons que la rÃ©conciliation est rÃ©cursive.  Quand React parcourt lâ€™arbre dâ€™Ã©lÃ©ments, il peut rencontrer un Ã©lÃ©ment dont le <code class="language-text">type</code> est un composant.  Il va alors lâ€™appeler et continuer Ã  descendre dans lâ€™arbre des Ã©lÃ©ments React renvoyÃ©s.  Lorsquâ€™il ne restera plus de composants Ã  appeler, React saura quoi changer dans lâ€™arbre hÃ´te.</p>
<p>Les mÃªmes rÃ¨gles de rÃ©conciliation que nous avons vues plus haut sâ€™appliquent ici aussi. Si le <code class="language-text">type</code> Ã  une position donnÃ©e (dÃ©terminÃ©e par lâ€™index et la <code class="language-text">key</code> optionnelle) Ã©volue, React jettera les instances hÃ´tes Ã  lâ€™intÃ©rieur et les re-crÃ©era.</p>
<h2 id="inversion-de-contrÃ´le"><a href="#inversion-de-contr%C3%B4le" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Inversion de contrÃ´le</h2>
<p>Vous vous demandez peut-Ãªtre pourquoi nous nâ€™appelons pas simplement les composants en directÂ ?  Pourquoi Ã©crire <code class="language-text">&lt;Form /&gt;</code> plutÃ´t que <code class="language-text">Form()</code>Â ?</p>
<p><strong>React est mieux Ã  mÃªme de faire son boulot sâ€™il Â«Â voitÂ Â» vos composants plutÃ´t que juste lâ€™arbre des Ã©lÃ©ments React obtenu aprÃ¨s les avoir appelÃ©s rÃ©cursivement.</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ğŸ”´ React ignore lâ€™existence-mÃªme de Layout et Article.</span>
<span class="token comment">// Câ€™est vous qui les appelez.</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token function">Layout</span><span class="token punctuation">(</span><span class="token punctuation">{</span> children<span class="token punctuation">:</span> <span class="token function">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  domContainer
<span class="token punctuation">)</span>

<span class="token comment">// âœ… React sait que Layout et Article existent.</span>
<span class="token comment">// React les appelle.</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Layout</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Article</span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Layout</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  domContainer
<span class="token punctuation">)</span></code></pre></div>
<p>Câ€™est un exemple classique dâ€™<a href="https://fr.wikipedia.org/wiki/Inversion_de_contr%C3%B4le" target="_blank" rel="nofollow noopener noreferrer">inversion de contrÃ´le</a>.  En laissant React prendre le contrÃ´le des appels de nos composants, on obtient quelques possibilitÃ©s intÃ©ressantesÂ :</p>
<ul>
<li>
<p><strong>Les composants deviennent plus que de simples fonctions.</strong>  React peut ajouter des fonctionnalitÃ©s aux fonctions composants telles quâ€™un <em>Ã©tat local</em> associÃ© Ã  lâ€™identitÃ© du composant dans lâ€™arbre.  Une bonne runtime fournit des abstractions fondamentales qui correspondent au problÃ¨me traitÃ©.  Comme nous lâ€™avons dÃ©jÃ  mentionnÃ©, React est spÃ©cifiquement conÃ§u pour des programmes qui affichent des arbres dâ€™UI et rÃ©pondent aux interactions.  Si vous appelez les composants directement, vous devez construire ces fonctionnalitÃ©s vous-mÃªmes.</p>
</li>
<li>
<p><strong>Les types de composants participent Ã  la rÃ©conciliation.</strong>  En laissant React appeler vos composants, vous lui en dites davantage sur la structure conceptuelle de votre arbre.  Par exemple, quand vous passez du rendu dâ€™une page  <code class="language-text">&lt;Feed&gt;</code> Ã  celui dâ€™une page <code class="language-text">&lt;Profile&gt;</code>, React nâ€™essaiera pas de rÃ©-utiliser des instances hÃ´tes Ã  lâ€™intÃ©rieurâ€”tout comme lorsque vous remplacez un <code class="language-text">&lt;button&gt;</code> par un <code class="language-text">&lt;p&gt;</code>.  Tout lâ€™Ã©tat disparaÃ®tâ€”ce qui est gÃ©nÃ©ralement une bonne chose lorsquâ€™on passe au rendu dâ€™une vue conceptuellement distincte.  Vous nâ€™avez sans doute pas envie de prÃ©server les valeurs des champs lorsque vous passez dâ€™un <code class="language-text">&lt;PasswordForm&gt;</code> Ã  un <code class="language-text">&lt;MessengerChat&gt;</code>, mÃªme si des positions de <code class="language-text">&lt;input&gt;</code> dans lâ€™arbre correspondent par pur hasard.</p>
</li>
<li>
<p><strong>React peut diffÃ©rer la rÃ©conciliation.</strong>  Si React a la main sur lâ€™appel de vos composants, il peut faire pas mal de choses intÃ©ressantes.  Par exemple, il peut laisser le navigateur avancer sur ses autres tÃ¢ches entre des appels de composants, afin que le rendu dâ€™un gros arbre de composants <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html" target="_blank" rel="nofollow noopener noreferrer">ne bloque pas le thread principal</a>.  Il est dÃ©licat dâ€™orchestrer ce genre de choses manuellement sans rÃ©-implÃ©menter une large portion de React.</p>
</li>
<li>
<p><strong>Le dÃ©bogage est facilitÃ©.</strong>  Si les composants sont des citoyens de premier ordre dont la bibliothÃ¨que a connaissance, on peut construire <a href="https://github.com/facebook/react-devtools" target="_blank" rel="nofollow noopener noreferrer">des outils dÃ©veloppeurs avancÃ©s</a> pour lâ€™introspection lors du dÃ©veloppement.</p>
</li>
</ul>
<p>Le dernier avantage que prÃ©sente lâ€™appel de nos fonctions composants par React, câ€™est <em>lâ€™Ã©valuation paresseuse</em>.  Voyons ce que jâ€™entends par lÃ .</p>
<h2 id="Ã©valuation-paresseuse"><a href="#%C3%A9valuation-paresseuse" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ã‰valuation paresseuse</h2>
<p>Quand on appelle des fonctions en JavaScript, leurs arguments sont Ã©valuÃ©s avant lâ€™appelÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// (2) Ceci est calculÃ© en second</span>
<span class="token function">eat</span><span class="token punctuation">(</span>
  <span class="token comment">// (1) Ceci est calculÃ© en premier</span>
  <span class="token function">prepareMeal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Câ€™est gÃ©nÃ©ralement ce Ã  quoi les dÃ©veloppeurs JavaScript sâ€™attendent, parce que les fonctions JavaScript peuvent avoir des effets de bord implicites.  Ce serait surprenant dâ€™appeler une fonction qui ne sâ€™exÃ©cuterait en fait quâ€™une fois que JavaScript Â«Â utiliseÂ Â» son rÃ©sultat dâ€™une faÃ§on ou dâ€™une autre.</p>
<p>Cependant, les composants React sont <a href="#puret%C3%A9">relativement</a> purs. Il nâ€™y a absolument aucune raison de les exÃ©cuter si nous savons que leur rÃ©sultat nâ€™apparaÃ®tra pas Ã  lâ€™Ã©cran.</p>
<p>Prenons le composant suivant qui met un <code class="language-text">&lt;Comments&gt;</code> dans une <code class="language-text">&lt;Page&gt;</code>Â :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Story</span><span class="token punctuation">(</span><span class="token punctuation">{</span> currentUser <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// return {</span>
  <span class="token comment">//   type: Page,</span>
  <span class="token comment">//   props: {</span>
  <span class="token comment">//     user: currentUser,</span>
  <span class="token comment">//     children: { type: Comments, props: {} }</span>
  <span class="token comment">//   }</span>
  <span class="token comment">// }</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Page</span> <span class="token attr-name">user</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>currentUser<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Comments</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Page</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Le composant <code class="language-text">Page</code> pourrait afficher ses enfants Ã  lâ€™intÃ©rieur dâ€™un <code class="language-text">Layout</code>Â :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Layout</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Layout</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>(<code class="language-text">&lt;A&gt;&lt;B /&gt;&lt;/A&gt;</code> en JSX est la mÃªme chose que <code class="language-text">&lt;A children={&lt;B /&gt;} /&gt;</code>.)</em></p>
<p>Mais que se passerait-il si on avait une condition de court-circuitÂ ?</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>isLoggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Veuillez vous identifier</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Layout</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Layout</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Si nous appelions <code class="language-text">Comments()</code> en tant que fonction, il sâ€™exÃ©cuterait immÃ©diatement, que <code class="language-text">Page</code> veuille ou non lâ€™utiliser dans le renduÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// {</span>
<span class="token comment">//   type: Page,</span>
<span class="token comment">//   props: {</span>
<span class="gatsby-highlight-code-line"><span class="token comment">//     children: Comments() // Toujours exÃ©cutÃ© !</span></span><span class="token comment">//   }</span>
<span class="token comment">// }</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Page</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">  </span><span class="token punctuation">{</span><span class="token function">Comments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Page</span><span class="token punctuation">></span></span></code></pre></div>
<p>Mais si nous passons un Ã©lÃ©ment React, nous nâ€™Ã©xÃ©cutons pas du tout <code class="language-text">Comments</code> nous-mÃªmesÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// {</span>
<span class="token comment">//   type: Page,</span>
<span class="token comment">//   props: {</span>
<span class="gatsby-highlight-code-line"><span class="token comment">//     children: { type: Comments }</span></span><span class="token comment">//   }</span>
<span class="token comment">// }</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Page</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Comments</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Page</span><span class="token punctuation">></span></span></code></pre></div>
<p>Ã‡a permet Ã  React de dÃ©cider quand et <em>si</em> il va lâ€™appeler.  Si notre composant <code class="language-text">Page</code> ignore sa prop <code class="language-text">children</code> et affiche <code class="language-text">&lt;h1&gt;Veuillez vous identifier&lt;/h1&gt;</code> Ã  la place, React nâ€™essaiera mÃªme pas dâ€™appeler la fonction <code class="language-text">Comments</code>.  Ã‡a servirait Ã  quoiÂ ?</p>
<p>Câ€™est une bonne chose, parce que Ã§a nous permet non seulement dâ€™Ã©viter un travail de rendu superflu qui serait ensuite jetÃ©, mais Ã§a rend aussi notre code plus robuste.  (On se fiche de savoir si <code class="language-text">Comments</code> lÃ¨verait ou non une exception lorsque lâ€™utilisateur nâ€™est pas identifiÃ©â€”elle ne sera pas appelÃ©e.)</p>
<h2 id="Ã©tat"><a href="#%C3%A9tat" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ã‰tat</h2>
<p>Nous avons parlÃ© <a href="#r%C3%A9conciliation">plus haut</a> de lâ€™identitÃ©, et de la faÃ§on dont la Â«Â positionÂ Â» conceptuelle dâ€™un Ã©lÃ©ment dans lâ€™arbre indique Ã  React sâ€™il doit rÃ©utiliser une instance hÃ´te ou en crÃ©er une nouvelle. Les instances hÃ´tes peuvent avoir des tas dâ€™Ã©tats locauxÂ : le focus, la sÃ©lection, la valeur saisie, etc.  Nous voulons prÃ©server cet Ã©tat Ã  travers les mises Ã  jour qui affichent conceptuellement la mÃªme UI.  Nous voulons aussi le dÃ©truire de faÃ§on prÃ©visible lorsque nous affichons quelque chose de conceptuellement distinct (comme lorsque nous passons dâ€™un <code class="language-text">&lt;SignupForm&gt;</code> Ã  un <code class="language-text">&lt;MessengerChat&gt;</code>).</p>
<p><strong>Lâ€™Ã©tat local est si utile que React permet Ã  <em>vos propres</em> composants dâ€™en avoir un aussi.</strong>  Les composants restent des fonctions mais React les dope avec des fonctionnalitÃ©s utiles pour faire de lâ€™UI.  Lâ€™Ã©tat local associÃ© Ã  leur position dans lâ€™arbre fait partie de ces amÃ©liorations.</p>
<p>Nous appelons ces fonctionnalitÃ©s des <em>Hooks</em>. Par exemple, <code class="language-text">useState</code> est un Hook.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Vous avez cliquÃ© </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> fois</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">        Cliquez-moi</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Il renvoie un duo de valeursÂ : lâ€™Ã©tat courant et une fonction qui le met Ã  jour.</p>
<p>La syntaxe de <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Op%C3%A9rateurs/Affecter_par_d%C3%A9composition#D%C3%A9composition_d&#x27;un_tableau" target="_blank" rel="nofollow noopener noreferrer">dÃ©structuration positionnelle</a> nous permet de donner des noms libres Ã  nos variables dâ€™Ã©tat.  Par exemple, jâ€™ai appelÃ© ce duo <code class="language-text">count</code> et <code class="language-text">setCount</code>, mais Ã§a aurait tout aussi bien pu Ãªtre <code class="language-text">banana</code> et <code class="language-text">setBanana</code>.  Dans la suite de cet article, jâ€™utilisera <code class="language-text">setState</code> pour parler de la deuxiÃ¨me valeur, indÃ©pendamment de son nom effectif dans les diffÃ©rents exemples.</p>
<p><em>(Vous pouvez en apprendre davantage sur <code class="language-text">useState</code> et les autres Hooks fournis par React <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="nofollow noopener noreferrer">ici</a>.)</em></p>
<h2 id="cohÃ©rence"><a href="#coh%C3%A9rence" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CohÃ©rence</h2>
<p>MÃªme si nous souhaitions dÃ©couper le processus de rÃ©conciliation lui-mÃªme en Ã©tapes de travail <a href="https://www.youtube.com/watch?v=mDdgfyRB5kg" target="_blank" rel="nofollow noopener noreferrer">non-bloquantes</a>, nous devrions tout de mÃªme effectuer les opÃ©rations rÃ©elles sur lâ€™arbre hÃ´te en une seule passe synchrone.  Ainsi nous pouvons nous assurer que lâ€™utilisateur ne verra pas une UI mise Ã  jour Ã  moitiÃ©, et que le navigateur nâ€™effectuera pas inutilement de la mise en page ou des calculs de style pour des Ã©tats intermÃ©diaires que lâ€™utilisateur ne devrait mÃªme pas voir.</p>
<p>Câ€™est pourquoi React dÃ©coupe tout son travail en Â«Â phase de renduÂ Â» et Â«Â phase de commitÂ Â». La <em>phase de rendu</em> dÃ©crit lâ€™appel de vos composants par React et la rÃ©conciliation.  Elle peut Ãªtre interrompue de faÃ§on fiable et <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html" target="_blank" rel="nofollow noopener noreferrer">Ã  lâ€™avenir</a> sera asynchrone. La <em>phase de commit</em> dÃ©crit les manipulations de lâ€™arbre hÃ´te par React.  Elle est toujours synchrone.</p>
<h2 id="mÃ©moÃ¯sation"><a href="#m%C3%A9mo%C3%AFsation" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MÃ©moÃ¯sation</h2>
<p>Quand un parent planifie une mise Ã  jour en appelant <code class="language-text">setState</code>, React rÃ©concilie par dÃ©faut tout lâ€™arbre de ses enfants.  Il procÃ¨de ainsi parce quâ€™il ne sait pas si une mise Ã  jour dans le parent affecterait ou non les enfants, aussi il opte par dÃ©faut pour une garantie de cohÃ©rence.  Ã‡a semble trÃ¨s coÃ»teux dit comme Ã§a, mais en pratique ce nâ€™est jamais un problÃ¨me pour des arbres enfants de petite et moyenne tailles.</p>
<p>Lorsque ces arbres deviennent trop profonds ou larges, vous pouvez dire Ã  React de <a href="https://fr.wikipedia.org/wiki/M%C3%A9mo%C3%AFsation" target="_blank" rel="nofollow noopener noreferrer">mÃ©moÃ¯ser</a> un sous-arbre et de rÃ©utiliser un rÃ©sultat de rendu prÃ©cÃ©dent lorsque les props mises Ã  jour restent identiques en surfaceÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Row<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>Ã€ prÃ©sent un <code class="language-text">setState</code> dans le composant <code class="language-text">&lt;Table&gt;</code> parent sauterait la rÃ©conciliation des <code class="language-text">Row</code>s dont la prop <code class="language-text">item</code> rÃ©fÃ©rence la mÃªme valeur (pour des objets, le mÃªme objet en mÃ©moire) que la prop <code class="language-text">item</code> du rendu prÃ©cÃ©dent.</p>
<p>Vous pouvez affiner le degrÃ© de mÃ©moÃ¯sation jusquâ€™au niveau dâ€™expressions individuelles avec le <a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="nofollow noopener noreferrer">Hook <code class="language-text">useMemo()</code></a>. Le cache est local Ã  la position dans lâ€™arbre de composants et sera dÃ©truit avec lâ€™Ã©tat local.  Il ne contient que la derniÃ¨re valeur utilisÃ©e.</p>
<p>React ne mÃ©moÃ¯se pas par dÃ©faut les composants, et câ€™est volontaire.  De nombreux composants reÃ§oivent toujours des props diffÃ©rentes, de sorte que les mÃ©moÃ¯ser serait inutilement coÃ»teux.</p>
<h2 id="des-modÃ¨les-bruts"><a href="#des-mod%C3%A8les-bruts" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Des modÃ¨les bruts</h2>
<p>Câ€™est assez ironique, mais React nâ€™utilise pas de systÃ¨me Â«Â rÃ©actifÂ Â» pour des mises Ã  jour fines.  En dâ€™autres termes, toute mise Ã  jour au sommet dÃ©clenche une rÃ©conciliation au lieu de ne mettre Ã  jour que les composants affectÃ©s par les modifications.</p>
<p>Cette dÃ©cision de conception est volontaire.  Le <a href="https://calibreapp.com/blog/time-to-interactive/" target="_blank" rel="nofollow noopener noreferrer">Time to interactive</a> est une mÃ©trique cruciale pour les applis web grand public, et la traversÃ©e des modÃ¨les pour dÃ©finir des Ã©couteurs fins consommerait trop de ce prÃ©cieux temps initial.  Qui plus est, pour de nombreuses applis les interactions ont tendance Ã  produire  des mises Ã  jour trÃ¨s localisÃ©es (survol de bouton) ou au contraire trÃ¨s globales (transition de page), deux cas pour lesquels une supervision fine serait un gÃ¢chis de ressources en mÃ©moire.</p>
<p>Un des principes de conception fondamentaux de React, câ€™est quâ€™il doit fonctionner avec des donnÃ©es brutes.  Si vous avez un tas dâ€™objets JavaScript reÃ§us par le rÃ©seau, vous devez pouvoir les injecter dans vos composants sans traitement prÃ©alable.  On ne voulait pas de piÃ¨ges vous empÃªchant dâ€™accÃ©der Ã  certaines propriÃ©tÃ©s, ou de soucis soudains de performance sur certains changements subtils de structure.  Le rendu de React est en O(<em>taille de la vue</em>) plutÃ´t quâ€™en O(<em>taille du modÃ¨le</em>), et on peut significativement rÃ©duire la <em>taille de la vue</em> grÃ¢ce au <a href="https://react-window.now.sh/#/examples/list/fixed-size" target="_blank" rel="nofollow noopener noreferrer">fenÃªtrage virtuel</a>.</p>
<p>Pour certaines applis, des abonnements fins restent trÃ¨s utilesâ€”par exemple des affichages temps rÃ©el dâ€™indices boursiers.  Ce sont des exemples rares de situations oÃ¹ Â«Â tout est toujours mis Ã  jour en mÃªme tempsÂ Â».  MÃªme sâ€™il dispose de certaines sorties de secours orientÃ©es code impÃ©ratif pour optimiser ce type de cas, React nâ€™est sans doute pas la meilleure option dans ces situations.  Quoi quâ€™il en soit, rien ne vous empÃªche dâ€™implÃ©menter votre propre systÃ¨me dâ€™abonnements fins par-dessus React.</p>
<p><strong>Notez toutefois quâ€™on trouve des problÃ¨mes de performances classiques que mÃªme les abonnements fins et les sytÃ¨mes Â«Â rÃ©actifsÂ Â» ne peuvent rÃ©soudre.</strong>  Par exemple, faire le rendu dâ€™un <em>nouvel</em> arbre profond (ce qui arrive Ã  chaque transition de page) sans bloquer le navigateur.  Suivre finement les modifications nâ€™aiderait en rienâ€”en fait, Ã§a ralentirait mÃªme le traitement parce quâ€™on aurait davantage de boulot pour mettre en place les abonnements.  Autre souci classiqueÂ : devoir attendre des donnÃ©es pour commencer le rendu dâ€™une vue.  Avec React, nous espÃ©rons rÃ©soudre ces deux problÃ©matiques grÃ¢ce au <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html" target="_blank" rel="nofollow noopener noreferrer">Rendu Concurrent</a>.</p>
<h2 id="traitement-par-lots"><a href="#traitement-par-lots" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Traitement par lots</h2>
<p>Plusieurs composants pourraient vouloir mettre Ã  jour leur Ã©tat en rÃ©ponse Ã  un mÃªme Ã©vÃ©nement.  Lâ€™exemple ci-dessous est artificiel mais il illustre un schÃ©ma courantÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">      Vous avez cliquÃ© </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> fois sur le parent</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">      Vous avez cliquÃ© </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> fois sur lâ€™enfant</span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Quand un Ã©vÃ©nement survient, la prop <code class="language-text">onClick</code> de lâ€™enfant est dÃ©clenchÃ©e dâ€™abord (ce qui exÃ©cute un <code class="language-text">setState</code>).  Puis le parent appelle <code class="language-text">setState</code> au sein de son propre gestionnaire <code class="language-text">onClick</code>.</p>
<p>Si React lanÃ§ait immÃ©diatement un nouveau rendu de composants en rÃ©ponse aux appels Ã  <code class="language-text">setState</code>,  on se retrouverait Ã  faire le rendu de lâ€™enfant deux foisÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token operator">**</span><span class="token operator">*</span> <span class="token constant">D</span>Ã©but du gestionnaire dâ€™Ã©vÃ©nement click de React <span class="token operator">**</span><span class="token operator">*</span>
<span class="token function">Child</span> <span class="token punctuation">(</span>onClick<span class="token punctuation">)</span>
  <span class="token operator">-</span> setState
<span class="gatsby-highlight-code-line">  <span class="token operator">-</span> rendu de Child <span class="token comment">// ğŸ˜ inutile</span></span><span class="token function">Parent</span> <span class="token punctuation">(</span>onClick<span class="token punctuation">)</span>
  <span class="token operator">-</span> setState
  <span class="token operator">-</span> rendu de Parent
<span class="gatsby-highlight-code-line">  <span class="token operator">-</span> rendu de Child</span><span class="token operator">**</span><span class="token operator">*</span> Fin du gestionnaire dâ€™Ã©vÃ©nement click de React <span class="token operator">**</span><span class="token operator">*</span></code></pre></div>
<p>Le premier rendu de <code class="language-text">Child</code> est gaspillÃ©.  Et nous ne pourrions pas faire que React saute le deuxiÃ¨me rendu de <code class="language-text">Child</code> parce que <code class="language-text">Parent</code> lui passe peut-Ãªtre des donnÃ©es diffÃ©rentes suite Ã  la mise Ã  jour de son Ã©tat.</p>
<p><strong>VoilÃ  pourquoi React traite les mises Ã  jour au sein des gestionnaires dâ€™Ã©vÃ©nements par lotÂ :</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token operator">**</span><span class="token operator">*</span> <span class="token constant">D</span>Ã©but du gestionnaire dâ€™Ã©vÃ©nement click de React <span class="token operator">**</span><span class="token operator">*</span>
<span class="token function">Child</span> <span class="token punctuation">(</span>onClick<span class="token punctuation">)</span>
  <span class="token operator">-</span> setState
<span class="token function">Parent</span> <span class="token punctuation">(</span>onClick<span class="token punctuation">)</span>
  <span class="token operator">-</span> setState
<span class="token operator">**</span><span class="token operator">*</span> Traitement des mises Ã  jour dâ€™Ã©tat               <span class="token operator">**</span><span class="token operator">*</span>
  <span class="token operator">-</span> rendu de Parent
  <span class="token operator">-</span> rendu de Child
<span class="token operator">**</span><span class="token operator">*</span> Fin du gestionnaire dâ€™Ã©vÃ©nement click de React   <span class="token operator">**</span><span class="token operator">*</span></code></pre></div>
<p>Les appels Ã  <code class="language-text">setState</code> dans les composants ne causent pas immÃ©diatement un nouveau rendu.  Au lieu de Ã§a, React exÃ©cute dâ€™abord tous les gestionnaires dâ€™Ã©vÃ©nements, puis dÃ©clenche un unique rendu qui regroupe toutes les mises Ã  jour dâ€™Ã©tat.</p>
<p>Le regroupement en lots amÃ©liore les performances mais peut surprendre lorsque vous Ã©crivez ce genre de codeÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setCounter</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>Si on a commencÃ© avec un <code class="language-text">count</code> Ã  <code class="language-text">0</code>, on aurait juste trois appels Ã  <code class="language-text">setCount(1)</code>.  Pour corriger Ã§a, <code class="language-text">setState</code> peut aussi Ãªtre appelÃ© avec une fonction de Â«Â mise Ã  jourÂ Â»Â :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setCounter</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>React mettrait ces fonctions dans une file, et plus tard les dÃ©clencherait en sÃ©quence, aboutissant Ã  un nouveau rendu avec <code class="language-text">count</code> Ã  <code class="language-text">3</code>.</p>
<p>Si votre logique de gestion dâ€™Ã©tat devient plus complexe que quelques appels Ã  <code class="language-text">setState</code>, je vous recommande de lâ€™exprimer sous forme dâ€™un rÃ©ducteur dâ€™Ã©tat local grÃ¢ce au <a href="https://reactjs.org/docs/hooks-reference.html#usereducer" target="_blank" rel="nofollow noopener noreferrer">Hook <code class="language-text">useReducer</code></a>. Câ€™est une sorte dâ€˜Ã©volution de cette approche dans laquelle chaque type de mise Ã  jour dispose dâ€™un nomÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">===</span> <span class="token string">'increment'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>Lâ€™argument <code class="language-text">action</code> peut Ãªtre nâ€™importe quoi, mÃªme si câ€™est le plus souvent un objet.</p>
<h2 id="arbre-dappels"><a href="#arbre-dappels" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Arbre dâ€™appels</h2>
<p>La runtime dâ€™un langage de programmation a gÃ©nÃ©ralement une <a href="https://medium.freecodecamp.org/understanding-the-javascript-call-stack-861e41ae61d4" target="_blank" rel="nofollow noopener noreferrer">pile dâ€™appels</a>.  Quand une fonction <code class="language-text">a()</code> appelle <code class="language-text">b()</code> qui elle-mÃªme appelle <code class="language-text">c()</code>, quelque part dans le moteur JavaScript on trouve une structure de donnÃ©es du style <code class="language-text">[a, b, c]</code> qui Â«Â garde traceÂ Â» de lâ€™endroit oÃ¹ vous Ãªtes et du code Ã  exÃ©cuter ensuite.    Une fois que vous quittez <code class="language-text">c</code>, son descripteur dans la pile dâ€™appel disparaÃ®tâ€”poufÂ ! On nâ€™a plus besoin de lui.  On revient Ã  lâ€™intÃ©rieur de <code class="language-text">b</code>.  Lorsquâ€™on finit par quitter <code class="language-text">a</code>, la pile dâ€™appels est vide.</p>
<p>Bien sÃ»r, React lui-mÃªme est en JavaScript et obÃ©it aux rÃ¨gles de ce langage.  Mais on peut imaginer quâ€™en interne React ait une sorte de pile dâ€™appels Ã  lui pour se rappeler quel composant est en train de faire son rendu, par exemple <code class="language-text">[App, Page, Layout, Article /* Nous sommes ici */]</code>.</p>
<p>LÃ  oÃ¹ React diffÃ¨re dâ€™une runtime de langage traditionnelle, câ€™est quâ€™il est spÃ©cialisÃ© dans le rendu dâ€™arbres dâ€™UI.  Ces arbres ont besoin de Â«Â rester en vieÂ Â» afin que nous puissions interagir avec eux.  Le DOM ne disparaÃ®t pas aprÃ¨s notre premier appel Ã  <code class="language-text">ReactDOM.render()</code>.</p>
<p>Je tire sans doute un peu trop sur la mÃ©taphore, mais jâ€™aime imaginer que les composants React sont dans une sorte Â«Â dâ€™arbre dâ€™appelsÂ Â» plutÃ´t quâ€™une simple Â«Â pile dâ€™appelsÂ Â».  Quand on Â«Â sortÂ Â» dâ€™un composant <code class="language-text">Article</code>, son descripteur dans Â«Â lâ€™arbre dâ€™appelsÂ Â» de React nâ€™est pas dÃ©truit.  Il faut bien quâ€™on conserve lâ€™Ã©tat local et les rÃ©fÃ©rences vers les instances hÃ´tes <a href="https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7" target="_blank" rel="nofollow noopener noreferrer">quelque part</a>.</p>
<p>Ces descripteurs de Â«Â lâ€™arbre dâ€™appelsÂ Â» <em>sont bien</em> dÃ©truits, avec leur Ã©tat local et leurs instances hÃ´tes, mais uniquement quand les rÃ¨gles de la <a href="#r%C3%A9conciliation">rÃ©conciliation</a> le jugent nÃ©cessaire.  Si vous avez dÃ©jÃ  lu le code source de React, vous avez peut-Ãªtre entendu parler de ces descripteurs, dont le nom technique est <a href="https://fr.wikipedia.org/wiki/Fibre_(informatique)" target="_blank" rel="nofollow noopener noreferrer">Fibres</a>.</p>
<p>Câ€™est dans ces Fibres que lâ€™Ã©tat local est maintenu.  Quand lâ€™Ã©tat change, React considÃ¨re que les Fibres dans lâ€™arbre sous-jacent ont besoin dâ€™une rÃ©conciliation, et appelle ces composants.</p>
<h2 id="contexte"><a href="#contexte" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Contexte</h2>
<p>Dans React, on transmet des donnÃ©es aux autres composants Ã  lâ€™aide des props.  Parfois, la majoritÃ© des composants ont besoin de la mÃªme choseâ€”par exemple, le thÃ¨me visuel actuellement employÃ©.  Ã‡a devient vite fastidieux de transmettre cette info Ã  chaque niveau de profondeur.</p>
<p>React rÃ©sout Ã§a avec le <a href="https://reactjs.org/docs/context.html" target="_blank" rel="nofollow noopener noreferrer">Contexte</a>.  Câ€™est dans le principe comme une <a href="http://wiki.c2.com/?DynamicScoping" target="_blank" rel="nofollow noopener noreferrer">portÃ©e dynamique</a> pour les composants.  Câ€™est comme un trou de ver qui vous permet de placer une info tout en haut, et que chaque enfant plus bas dans lâ€™arbre soit capable de la lire et de relancer son rendu quand elle change.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>
  <span class="token string">'light'</span> <span class="token comment">// Valeur par dÃ©faut et valeur de secours</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">DarkApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThemeContext.Provider</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dark<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyComponents</span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ThemeContext.Provider</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">SomeDeeplyNestedChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// DÃ©pend dâ€™oÃ¹ lâ€™enfant fait son rendu</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Quand <code class="language-text">SomeDeeplyNestedChild</code> fait son rendu, <code class="language-text">useContext(ThemeContext)</code> ira chercher le plus proche <code class="language-text">&lt;ThemeContext.Provider&gt;</code> en remontant lâ€™arbre, et utilisera sa <code class="language-text">value</code>.</p>
<p>(En pratique, React maintient une pile de contexte pendant le rendu.)</p>
<p>Sâ€™il nâ€™y a pas de <code class="language-text">ThemeContext.Provider</code> au-dessus, le rÃ©sultat dâ€™un appel Ã  <code class="language-text">useContext(ThemeContext)</code> sera la valeur par dÃ©faut fournie lors de lâ€™appel Ã  <code class="language-text">createContext()</code>.  Dans notre exemple, ce serait <code class="language-text">&#39;light&#39;</code>.</p>
<h2 id="effets"><a href="#effets" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Effets</h2>
<p>Nous avons mentionnÃ© plus tÃ´t que les composants React ne devraient pas avoir dâ€™effet de bord observable pendant le rendu.  Mais les effets de bord sont parfois nÃ©cessaires.  On peut vouloir gÃ©rer le focus, dessiner sur un canevas, sâ€™abonner Ã  une source de donnÃ©es, et ainsi de suite.</p>
<p>Dans React, on fait Ã§a en dÃ©clarant un effetÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`Vous avez cliquÃ© </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> fois`</span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Vous avez cliquÃ© </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> fois</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Cliquez-moi</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Chaque fois que possible, React diffÃ¨re lâ€™exÃ©cution des effets jusquâ€™Ã  ce que le navigateur redessine Ã  lâ€™Ã©cran.  Lâ€™intÃ©rÃªt est de minimiser des mÃ©triques telles que <a href="https://calibreapp.com/blog/time-to-interactive/" target="_blank" rel="nofollow noopener noreferrer">time to interactive</a> et <a href="https://developers.google.com/web/tools/lighthouse/audits/first-meaningful-paint" target="_blank" rel="nofollow noopener noreferrer">time to first paint</a>, qui ne devraient pas pÃ¢tir de tÃ¢ches comme lâ€™abonnement Ã  une source de donnÃ©es. (Il y a un Hook <a href="https://reactjs.org/docs/hooks-reference.html#uselayouteffect" target="_blank" rel="nofollow noopener noreferrer">rarement utilisÃ©</a> qui vous permet de contourner ce comportement pour faire des traitements synchrones.  Ã‰vitez.)</p>
<p>Les effets ne sâ€™exÃ©cutent pas quâ€™une seule fois.  Ils ont lieu aussi bien aprÃ¨s que le composant est affichÃ© Ã  lâ€™utilisateur pour la premiÃ¨re fois, quâ€™aprÃ¨s ses mises Ã  jour.  Les effets peuvent exploiter les props et lâ€™Ã©tat local courants, grÃ¢ce Ã  la fermeture lexicale <em>(closure, NdT)</em>, comme avec <code class="language-text">count</code> dans lâ€™exemple ci-dessus.</p>
<p>Certains effets peuvent avoir besoin dâ€™un code de nettoyage, comme dans le cas des abonnements.  Pour nettoyer derriÃ¨re lui, un effet peut renvoyer une fonctionÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    DataSource<span class="token punctuation">.</span><span class="token function">addSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> DataSource<span class="token punctuation">.</span><span class="token function">removeSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>React exÃ©cutera la fonction renvoyÃ©e avant dâ€™appliquer lâ€™effet la fois suivante, ainsi quâ€™avant de dÃ©truire le composant.</p>
<p>Parfois, re-exÃ©cuter lâ€™effet Ã  chaque rendu nâ€™est pas souhaitable.  On peut demander Ã  React de <a href="https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects" target="_blank" rel="nofollow noopener noreferrer">sauter</a> lâ€™exÃ©cution de lâ€™effet si certaines variables nâ€™ont pas changÃ©Â :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`Vous avez cliquÃ© </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> fois`</span></span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>Ceci dit, câ€™est souvent une optimisation prÃ©maturÃ©e, et Ã§a peut amener des problÃ¨mes si vous nâ€™Ãªtes pas bien Ã  lâ€™aise avec le fonctionnement des fermetures lexicales en JavaScript.</p>
<p>Par exemple, le code suivant est dÃ©fectueuxÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    DataSource<span class="token punctuation">.</span><span class="token function">addSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> DataSource<span class="token punctuation">.</span><span class="token function">removeSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Il bugue parce que <code class="language-text">[]</code> dit en substance Â«Â ne re-exÃ©cute jamais cet effetÂ Â».  Mais lâ€™effet utilise le <code class="language-text">handleChange</code> de la portÃ©e englobante, et le corps de <code class="language-text">handleChange</code> pourrait exploiter des props ou de lâ€™Ã©tat localÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>Si on ne laisse jamais lâ€™effet se re-exÃ©cuter, <code class="language-text">handleChange</code> continuera Ã  rÃ©fÃ©rencer sa version du premier rendu, et <code class="language-text">count</code> y sera toujours Ã  <code class="language-text">0</code>.</p>
<p>Pour Ã©viter Ã§a, assurez-vous que si vous prÃ©cisez un tableau de dÃ©pendances, il contienne bien <strong>toutes</strong> les choses qui peuvent changer, y compris les fonctionsÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    DataSource<span class="token punctuation">.</span><span class="token function">addSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> DataSource<span class="token punctuation">.</span><span class="token function">removeSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>handleChange<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>En fonction de votre code, vous verriez peut-Ãªtre encore des rÃ©-abonnements superflus parce que <code class="language-text">handleChange</code> elle-mÃªme est diffÃ©rente Ã  chaque <code class="language-text">render</code>.  Le Hook <a href="https://reactjs.org/docs/hooks-reference.html#usecallback" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">useCallback</code></a> peut vous aider dans ce type de situation.  Ou alors, vous pouvez laisser le rÃ©-abonnement se faire.  Par exemple, lâ€™API <code class="language-text">addEventListener</code> du navigateur est extrÃªmement rapide, et sauter Ã  travers des cerceaux en flamme pour Ã©viter de lâ€™appeler risque dâ€™Ãªtre plus problÃ©matique que de la laisser faire.</p>
<p><em>(Vous pouvez en apprendre davantage sur <code class="language-text">useEffect</code> et les autres Hooks fournis par React <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="nofollow noopener noreferrer">ici</a>.)</em></p>
<h2 id="hooks-personnalisÃ©s"><a href="#hooks-personnalis%C3%A9s" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hooks personnalisÃ©s</h2>
<p>Dans la mesure oÃ¹ des Hooks comme <code class="language-text">useState</code> et <code class="language-text">useEffect</code> sont des appels de fonctions, nous pouvons les composer pour crÃ©er nos propres HooksÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">MyResponsiveComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> width <span class="token operator">=</span> <span class="token function">useWindowWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Notre Hook personnalisÃ©</span></span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">La fenÃªtre fait </span><span class="token punctuation">{</span>width<span class="token punctuation">}</span><span class="token plain-text"> de large</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">function</span> <span class="token function">useWindowWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>width<span class="token punctuation">,</span> setWidth<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleResize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setWidth</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> width<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Les Hooks personnalisÃ©s permettent Ã  diffÃ©rents composants de partager une logique Ã  Ã©tat rÃ©utilisable.  Notez que <em>lâ€™Ã©tat lui-mÃªme</em> nâ€™est pas partagÃ©.  Chaque appel Ã  un Hook dÃ©clare son propre Ã©tat isolÃ©.</p>
<p><em>(Vous pouvez en apprendre davantage sur lâ€™Ã©criture de vos propres Hooks <a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="nofollow noopener noreferrer">ici</a>.)</em></p>
<h2 id="ordre-statique-dutilisation"><a href="#ordre-statique-dutilisation" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ordre statique dâ€™utilisation</h2>
<p>Vous pouvez considÃ©rer <code class="language-text">useState</code> comme une syntaxe pour dÃ©finir une Â«Â variable dâ€™Ã©tat ReactÂ Â».  Ce nâ€™est pas <em>vraiment</em> une syntaxe, naturellement.  Nous Ã©crivons toujours du JavaScript.  Mais nous considÃ©rons ici React comme un environnement dâ€™exÃ©cution, et parce que React spÃ©cialise JavaScript pour la description dâ€™arbres dâ€™UI, ses fonctionnalitÃ©s sont parfois au plus prÃ¨s de la couche langage.</p>
<p>Si <code class="language-text">use</code> <em>Ã©tait</em> une syntaxe, il serait logique quâ€™elle existe au niveau racine des composantsÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ğŸ˜‰ Note : cette syntaxe nâ€™existe pas</span>
component <span class="token function">Example</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      &lt;pVous avez cliquÃ© </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> fois</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Cliquez-moi</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Du coup, que pourrait bien signifier le recours Ã  cette syntaxe Ã  lâ€™intÃ©rieur dâ€™un bloc conditionnel, dâ€™une fonction de rappel, ou hors dâ€™un composantÂ ?</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ğŸ˜‰ Note : cette syntaxe nâ€™existe pas</span>

<span class="token comment">// Est-ce un Ã©tat local... ou autre chose ?</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

component <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Que se passe-t-il si la condition est fausse ?</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Que se passe-t-il quand on quitte cette fonction ?</span>
    <span class="token comment">// En quoi est-ce diffÃ©rent dâ€™une variable ?</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>Lâ€™Ã©tat dans React est local au <em>composant</em> et Ã  son identitÃ© dans lâ€™arbre. Si <code class="language-text">use</code> Ã©tait une vÃ©ritable syntaxe, il serait du coup logique quâ€™on limite son utilisabilitÃ© Ã  la portÃ©e racine dâ€™un composantÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ğŸ˜‰ Note : cette syntaxe nâ€™existe pas</span>
component <span class="token function">Example</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Seulement valide ici</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Ici Ã§a donnerait une erreur de syntaxe</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>Câ€™est un peu comme le fait que <code class="language-text">import</code> ne marche quâ€™au niveau racine dâ€™un module.</p>
<p><strong>Bien sÃ»r, <code class="language-text">use</code> nâ€˜est pas rÃ©ellement une syntaxe.</strong> (Ã‡a nâ€™aurait pas beaucoup dâ€™avantages mais Ã§a entraÃ®nerait une tonne de friction.)</p>
<p>Ceci dit, React <em>sâ€™attend bien</em> Ã  ce que tous les appels aux Hooks surviennent uniquement au niveau racine de composants, et de faÃ§on inconditionnelle. Ces <a href="https://reactjs.org/docs/hooks-rules.html" target="_blank" rel="nofollow noopener noreferrer">RÃ¨gles des Hooks</a> peuvent Ãªtre garanties avec un <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks" target="_blank" rel="nofollow noopener noreferrer">plugin de linter</a>.  Ce choix de conception a donnÃ© lieu Ã  des dÃ©bats houleux mais en pratique je nâ€™ai pas eu vent de personnes qui auraient Ã©tÃ© surprises Ã  lâ€™usage.  Jâ€™ai Ã©galement Ã©crit un article qui explique pourquoi les alternatives couramment suggÃ©rÃ©es <a href="/Personal-Blog/why-do-hooks-rely-on-call-order/">ne fonctionnent pas</a>.</p>
<p>En interne, les Hooks sont implÃ©mentÃ©s avec des <a href="https://dev.to/aspittel/thank-u-next-an-introduction-to-linked-lists-4pph" target="_blank" rel="nofollow noopener noreferrer">listes liÃ©es</a>.  Quand on appelle <code class="language-text">useState</code>, on dÃ©place un pointeur sur le prochain Ã©lÃ©ment.  Quand on quitte le <a href="#arbre-dappels">descripteur dans Â«Â lâ€™arbre dâ€™appelsÂ Â»</a> du composant, on sauve la liste rÃ©sultat jusquâ€™au prochain rendu.</p>
<p><a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e" target="_blank" rel="nofollow noopener noreferrer">Cet article</a> fournit une explication simplifiÃ©e du fonctionnement interne des Hooks.  Il est peut-Ãªtre plus facile dâ€™y penser en termes de tableaux quâ€™en termes de listes liÃ©esÂ :</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Pseudocode</span>
<span class="token keyword">let</span> hooks<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Rendus suivants</span>
    <span class="token keyword">return</span> hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Premier rendu</span>
  hooks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// On se prÃ©pare au rendu</span>
i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
hooks <span class="token operator">=</span> fiber<span class="token punctuation">.</span>hooks <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// Appel du composant</span>
<span class="token function">YourComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// MÃ©moriser lâ€™Ã©tat des Hooks</span>
fiber<span class="token punctuation">.</span>hooks <span class="token operator">=</span> hooks<span class="token punctuation">;</span></code></pre></div>
<p><em>(Si vous Ãªtes curieuxÂ·se, le vÃ©ritable code est <a href="https://github.com/facebook/react/blob/master/packages/react-reconciler/src/ReactFiberHooks.js" target="_blank" rel="nofollow noopener noreferrer">ici</a>.)</em></p>
<p>Câ€™est <em>grosso modo</em> comme Ã§a que les appels Ã  <code class="language-text">useState()</code> obtiennent le bon Ã©tat.  Comme nous lâ€™avons vu <a href="#r%C3%A9conciliation">plus tÃ´t</a>, Â«Â faire correspondre des trucsÂ Â» nâ€™a rien de nouveau pour Reactâ€”la rÃ©conciliation repose de faÃ§on similaire sur la correspondance entre Ã©lÃ©ments dâ€™un rendu Ã  lâ€™autre.</p>
<h2 id="et-le-reste"><a href="#et-le-reste" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Et le reste</h2>
<p>Nous avons abordÃ© pratiquement tous les aspects importants de React comme environnement dâ€™exÃ©cution.  Si vous avez fini cette page, vous avez sans doute une connaissance plus pointue de React que 90% de ses utilisateurs.  Et il nâ€™y a rien de mal Ã  Ã§aÂ !</p>
<p>Jâ€™ai laissÃ© de cÃ´tÃ© certaines partiesâ€”principalement parce quâ€™elles ne sont pas encore parfaitement claires mÃªme pour nous.  React nâ€™a pas pour le moment de solution satisfaisante pour des rendus multi-passes, câ€™est-Ã -dire quand le rendu du parent a besoin dâ€™infos issues de ses enfants.  Et puis, lâ€™<a href="https://reactjs.org/docs/error-boundaries.html" target="_blank" rel="nofollow noopener noreferrer">API de gestion dâ€™erreurs</a> nâ€™a pas encore de version Hook.  Il est possible que ces deux points soient rÃ©solus dâ€™un seul coup.  Le Mode Concurrent nâ€™est pas encore stable, et son interaction avec Suspense soulÃ¨ve des questions intÃ©ressantes.  Peut-Ãªtre que je ferai un article complÃ©mentaire lorsque nous aurons de meilleures rÃ©ponses Ã  ces questions, et que Suspense sera prÃªt pour davantage que du <a href="https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactlazy-code-splitting-with-suspense" target="_blank" rel="nofollow noopener noreferrer">chargement paresseux</a>.</p>
<p><strong>Je trouve que Ã§a en dit long sur le succÃ¨s de lâ€™API de React, quâ€™on puisse aller aussi loin avec sans jamais avoir Ã  se prÃ©occuper de la majoritÃ© de ces questions.</strong>  De bons comportements par dÃ©faut comme lâ€™heuristique de la rÃ©conciliation fonctionnent impeccablement la plupart du temps.  Et des avertissements comme celui sur <code class="language-text">key</code> vous donnent une petite tape sur lâ€™Ã©paule quand vous risquez de vous tirer dans le pied.</p>
<p>Si vous Ãªtes accroc de bibliothÃ¨ques UI, jâ€™espÃ¨re que cet article vous aura diverti, et aura clarifiÃ© le fonctionnement profond de React.  Ou peut-Ãªtre avez-vous dÃ©cidÃ© que React est trop compliquÃ© et que vous ne voulez plus en entendre parler.  Quoi quâ€™il en soit, jâ€™adorerais avoir votre rÃ©action sur TwitterÂ !  Merci de mâ€™avoir lu.</p></div><footer><p><a href="https://mobile.twitter.com/search?q=https%3A%2F%2Fyusufunlu.github.io%2FPersonal-Blog%2F%2Freact-as-a-ui-runtime%2F" target="_blank" rel="noopener noreferrer">Discuss on Twitter</a> â€¢ <a href="https://github.com/gaearon/overreacted.io/edit/master/src/pages/react-as-a-ui-runtime/index.fr.md" target="_blank" rel="noopener noreferrer">Edit on GitHub</a></p></footer></article></main><aside><div style="margin:90px 0 40px 0;font-family:system-ui, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
    &quot;Roboto&quot;, &quot;Oxygen&quot;, &quot;Ubuntu&quot;, &quot;Cantarell&quot;, &quot;Fira Sans&quot;,
    &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif"><form action="https://app.convertkit.com/forms/812047/subscriptions" class="seva-form formkit-form" method="post" min-width="400 500 600 700 800" style="background-color:rgb(255, 255, 255);border-radius:6px"><div data-style="full"><div data-element="column" class="formkit-column" style="background-color:rgb(249, 250, 251)"><h1 class="formkit-header" data-element="header" style="color:rgb(77, 77, 77);font-size:20px;font-weight:700">Join the Newsletter</h1><div data-element="subheader" class="formkit-subheader" style="color:rgb(104, 104, 104)"><p>Subscribe to get my latest content by email.</p></div><div class="formkit-image"><svg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 46 46" style="max-width:100%"><g fill="none" fill-rule="evenodd"><path fill="#DD92AB" d="M23,36 C22.813,36 22.627,35.948 22.463,35.844 L0.463,21.844 C0.159,21.651 -0.017,21.308 0.001,20.948 C0.02,20.589 0.23,20.266 0.553,20.105 L23,6 L45.447,20.105 C45.769,20.266 45.98,20.588 45.999,20.948 C46.018,21.308 45.841,21.65 45.537,21.844 L23.537,35.844 C23.373,35.948 23.187,36 23,36 Z"></path><path fill="#FFF" d="M38,37 L8,37 L8,1 C8,0.448 8.448,0 9,0 L37,0 C37.552,0 38,0.448 38,1 L38,37 Z"></path><path fill="#FFA7C4" d="M45,46 C44.916,46 44.831,45.989 44.748,45.968 L21.748,39.968 L22,33 L46,21 L46,45 C46,45.31 45.856,45.602 45.611,45.792 C45.435,45.928 45.219,46 45,46 Z"></path><path fill="#FFC3D7" d="M45,46 L1,46 C0.447,46 0,45.552 0,45 L0,21 L45.479,44.122 C45.88,44.341 46.083,44.804 45.969,45.247 C45.856,45.69 45.457,46 45,46 Z"></path><path fill="#FFA7C4" d="M19 20.414L14.293 15.707C13.902 15.316 13.902 14.684 14.293 14.293L19 9.586 20.414 11 16.414 15 20.414 19 19 20.414zM27 20.414L25.586 19 29.586 15 25.586 11 27 9.586 31.707 14.293C32.098 14.684 32.098 15.316 31.707 15.707L27 20.414z"></path></g></svg></div></div><div data-element="column" class="formkit-column"><ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul><div data-element="fields" class="seva-fields formkit-fields"><div class="formkit-field"><input type="text" class="formkit-input" aria-label="Your first name" name="fields[first_name]" placeholder="Your first name" style="border-color:rgb(227, 227, 227);border-radius:4px;color:rgb(0, 0, 0);font-weight:400"/></div><div class="formkit-field"><input type="email" class="formkit-input" name="email_address" aria-label="Your email address" placeholder="Your email address" style="border-color:rgb(227, 227, 227);border-radius:4px;color:rgb(0, 0, 0);font-weight:400"/></div><button data-element="submit" class="formkit-submit formkit-submit" style="background-color:hsl(340, 63%, 55%);border-radius:24px;color:white;font-weight:700"><div class="formkit-spinner"></div><span>Subscribe</span></button></div><div data-element="guarantee" class="formkit-guarantee" style="color:rgb(77, 77, 77);font-size:13px;font-weight:400"><p>I wonâ€™t send you spam.</p><p>Unsubscribe at <em>any</em> time.</p></div></div></div></form></div><h3 style="font-family:Montserrat, sans-serif;margin-top:0.4375rem"><a style="box-shadow:none;text-decoration:none;color:var(--pink)" href="/Personal-Blog/">Overreacted</a></h3><div style="display:flex;margin-bottom:3.5rem"><img src="/Personal-Blog/static/profile-pic-69c77131fd248a7aaaf26fab021f469f.png" alt="Yusuf Unlu" style="margin-right:0.875rem;margin-bottom:0;height:3.5rem;border-radius:50%"/><p style="max-width:310px">Personal blog by <a href="https://mobile.twitter.com/yufusunlu">Yusuf Unlu</a>.<!-- --> <!-- -->IÂ explain with words and code.</p></div><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li></li><li></li></ul></nav></aside></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-130227707-1', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"fr-react-as-a-ui-runtime-155","path":"/fr/react-as-a-ui-runtime/"};window.dataPath="353/path---fr-react-as-a-ui-runtime-155-e80-P64LCvUbqfAY2MQSH3dhuH3NBAs";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-198cd55e69a6a03b3f73.js"],"component---src-templates-blog-index-js":["/component---src-templates-blog-index-js-1d061c91bf8b4d1ed13d.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.77da55083c18bdb7fbef.css","/component---src-templates-blog-post-js-ef2898a2e81c47683f5b.js"],"component---src-pages-404-js":["/component---src-pages-404-js.fd288bb02445d10643fa.css","/component---src-pages-404-js-b3cd5f330471999955d6.js"],"component---src-pages-confirm-js":["/component---src-pages-confirm-js.fd288bb02445d10643fa.css","/component---src-pages-confirm-js-009d25afd727cbb30f51.js"],"component---src-pages-thanks-js":["/component---src-pages-thanks-js.fd288bb02445d10643fa.css","/component---src-pages-thanks-js-8fa56c06867d62f44f13.js"],"pages-manifest":["/pages-manifest-39a0dca89e16fd875f78.js"]};/*]]>*/</script><script src="/Personal-Blog/webpack-runtime-816b037bee21ad2c738f.js" async=""></script><script src="/Personal-Blog/1-1b550cd61a5e170131aa.js" async=""></script><script src="/Personal-Blog/2-469c709c476faea7103a.js" async=""></script><script src="/Personal-Blog/0-b197e8c6c7ff26484233.js" async=""></script><script src="/Personal-Blog/app-198cd55e69a6a03b3f73.js" async=""></script><script src="/Personal-Blog/component---src-templates-blog-post-js-ef2898a2e81c47683f5b.js" async=""></script></body></html>