<!DOCTYPE html><html lang="zh-hans"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/Blog/2.f85feb40488ceebc6a0b.css">@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:url(/Blog/static/merriweather-400-l-8796b7875d52e9cb9b280211e8d3f82d.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:url(/Blog/static/montserrat-900-l-5751237264c0468be0d48ad1cea75b90.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}body{--pink:#ffa7c4;background-color:var(--bg)}body.light{--bg:#fff;--header:var(--pink);--textNormal:#222;--textTitle:#222;--textLink:#d23669;--hr:rgba(0,0,0,0.2);--inlineCode-bg:rgba(255,229,100,0.2);--inlineCode-text:#1a1a1a}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--textLink:var(--pink);--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:#373c49;--inlineCode-text:#e6e6e6}body:lang(ar) article,body:lang(fa) article{direction:rtl}body:lang(ar) .language-text,body:lang(ar) article .translations,body:lang(ar) article pre,body:lang(fa) .language-text,body:lang(fa) article .translations,body:lang(fa) article pre{direction:ltr}body:lang(ar) .language-text,body:lang(fa) .language-text{display:inline-block}body:lang(ar) blockquote,body:lang(fa) blockquote{border-left:unset;border-right:.32813rem solid rgba(0,0,0,.9);padding-right:1.42188rem;padding-left:unset;margin-left:.75rem;margin-right:-1.75rem}body:lang(fa) article,body:lang(fa) header>h1{font-family:Vazir}body:lang(ar) article,body:lang(ar) header>h1{font-family:Cairo,sans-serif}body:lang(ko) article,body:lang(ko) header{word-break:keep-all}code[class*=language-],pre[class*=language-]{color:#fff;background:none;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;-webkit-font-feature-settings:normal;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:var(--inlineCode-bg);color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;padding-right:1em;padding-left:1.25em;border-left:.25em solid #ffa7c4}.gatsby-highlight,.gatsby-highlight-code-line{margin-right:-1.3125rem;margin-left:-1.3125rem}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#011627;-webkit-overflow-scrolling:touch;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}.react-toggle{touch-action:pan-x;display:inline-block;position:relative;cursor:pointer;background-color:transparent;border:0;padding:0;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.react-toggle-screenreader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle-track{width:50px;height:24px;padding:0;border-radius:30px;background-color:#0f1114;transition:all .2s ease}.react-toggle-track-check{position:absolute;width:17px;height:17px;left:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0;opacity:0;transition:opacity .25s ease}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{position:absolute;width:17px;height:17px;right:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{position:absolute;top:1px;left:1px;width:22px;height:22px;border-radius:50%;background-color:#fafafa;box-sizing:border-box;transition:all .5s cubic-bezier(.23,1,.32,1) 0ms;-webkit-transform:translateX(0);transform:translateX(0)}.react-toggle--checked .react-toggle-thumb{-webkit-transform:translateX(26px);transform:translateX(26px);border-color:#19ab27}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #ffa7c4}.react-toggle:active .react-toggle-thumb{box-shadow:0 0 5px 5px #ffa7c4}</style><style data-href="/Blog/component---src-templates-blog-post-js.4bdd783f220516bbb519.css">@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:url(/Blog/static/merriweather-400-i-l-9a3ea56a5f449980432ace5972181ef6.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:url(/Blog/static/merriweather-700-l-e24e02bb044cb07539a3a6bd12348d14.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:url(/Blog/static/merriweather-700-i-l-ad085ede31afcc5585ff34869b1cd029.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}.formkit-form *{box-sizing:border-box}.formkit-form legend{border:none;font-size:inherit;margin-bottom:10px;padding:0;position:relative;display:table}.formkit-form fieldset{border:0;padding:.01em 0 0;margin:0;min-width:0}.formkit-form body:not(:-moz-handler-blocked) fieldset{display:table-cell}.formkit-form p{color:inherit;font-size:inherit;font-weight:inherit}.formkit-form[data-format="slide in"],.formkit-form[data-format=modal]{display:none}.formkit-form .formkit-checkboxes,.formkit-form .formkit-input,.formkit-form .formkit-select{width:100%}.formkit-form .formkit-button,.formkit-form .formkit-submit{border:0;border-radius:5px;color:#fff;cursor:pointer;display:inline-block;text-align:center;font-size:15px;font-weight:500;margin-bottom:15px;overflow:hidden;padding:0;position:relative;vertical-align:middle}.formkit-form .formkit-button:focus,.formkit-form .formkit-button:hover,.formkit-form .formkit-submit:focus,.formkit-form .formkit-submit:hover{outline:none}.formkit-form .formkit-button:focus>span,.formkit-form .formkit-button:hover>span,.formkit-form .formkit-submit:focus>span,.formkit-form .formkit-submit:hover>span{background-color:#dc658d}.formkit-form .formkit-button>span,.formkit-form .formkit-submit>span{display:block;transition:all .3s ease-in-out;padding:12px 24px}.formkit-form .formkit-input{background:#fff;font-size:15px;padding:12px;border:1px solid #e3e3e3;flex:1 0 auto;line-height:1.4;margin:0;transition:border-color .3s ease-out}.formkit-form .formkit-input:focus{outline:none;border-color:#1677be;transition:border-color .3s ease}.formkit-form .formkit-input::-webkit-input-placeholder{color:#848585}.formkit-form .formkit-input:-ms-input-placeholder{color:#848585}.formkit-form .formkit-input::-ms-input-placeholder{color:#848585}.formkit-form .formkit-input::placeholder{color:#848585}.formkit-form [data-group=dropdown]{position:relative;display:inline-block;width:100%}.formkit-form [data-group=dropdown]:before{content:"";top:calc(50% - 2.5px);right:10px;position:absolute;pointer-events:none;border-color:#4f4f4f transparent transparent;border-style:solid;border-width:6px 6px 0;height:0;width:0;z-index:999}.formkit-form [data-group=dropdown] select{height:auto;width:100%;cursor:pointer;color:#333;line-height:1.4;margin-bottom:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:15px;padding:12px 25px 12px 12px;border:1px solid #e3e3e3;background:#fff}.formkit-form [data-group=dropdown] select:focus{outline:none}.formkit-form [data-group=checkboxes]{text-align:left;margin:0}.formkit-form [data-group=checkboxes] [data-group=checkbox]{margin-bottom:10px}.formkit-form [data-group=checkboxes] [data-group=checkbox] *{cursor:pointer}.formkit-form [data-group=checkboxes] [data-group=checkbox]:last-of-type{margin-bottom:0}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]{display:none}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]+label:after{content:none}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label:after{border-color:#fff;content:""}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label:before{background:#10bf7a;border-color:#10bf7a}.formkit-form [data-group=checkboxes] [data-group=checkbox] label{position:relative;display:inline-block;padding-left:28px}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:after,.formkit-form [data-group=checkboxes] [data-group=checkbox] label:before{position:absolute;content:"";display:inline-block}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:before{height:16px;width:16px;border:1px solid #e3e3e3;background:#fff;left:0;top:3px}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:after{height:4px;width:8px;border-left:2px solid #4d4d4d;border-bottom:2px solid #4d4d4d;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);left:4px;top:8px}.formkit-form .formkit-alert{background:#f9fafb;border:1px solid #e3e3e3;border-radius:5px;flex:1 0 auto;list-style:none;margin:25px auto;padding:12px;text-align:center;width:100%}.formkit-form .formkit-alert:empty{display:none}.formkit-form .formkit-alert-success{background:#d3fbeb;border-color:#10bf7a;color:#0c905c}.formkit-form .formkit-alert-error{background:#fde8e2;border-color:#f2643b;color:#ea4110}.formkit-form .formkit-spinner{display:flex;height:0;width:0;margin:0 auto;position:absolute;top:0;left:0;right:0;overflow:hidden;text-align:center;transition:all .3s ease-in-out}.formkit-form .formkit-spinner>div{margin:auto;width:12px;height:12px;background-color:#fff;opacity:.3;border-radius:100%;display:inline-block;-webkit-animation:formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd- 1.4s ease-in-out infinite both;animation:formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd- 1.4s ease-in-out infinite both}.formkit-form .formkit-spinner>div:first-child{-webkit-animation-delay:-.32s;animation-delay:-.32s}.formkit-form .formkit-spinner>div:nth-child(2){-webkit-animation-delay:-.16s;animation-delay:-.16s}.formkit-form .formkit-submit[data-active] .formkit-spinner{opacity:1;height:100%;width:50px}.formkit-form .formkit-submit[data-active] .formkit-spinner~span{opacity:0}@-webkit-keyframes formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd-{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd-{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.formkit-form{box-shadow:0 2px 15px 0 rgba(210,214,220,.5);max-width:700px;overflow:hidden}.formkit-form [data-style=full]{width:100%;display:block}.formkit-form .formkit-header{margin-top:0;margin-bottom:20px;font-family:inherit}.formkit-form .formkit-subheader{margin:15px 0}.formkit-form .formkit-column{background-size:cover;background-repeat:no-repeat;background-position:50%;padding:20px}.formkit-form .formkit-column:nth-child(2){border-top:1px solid #e9ecef}.formkit-form .formkit-field{margin:0 0 15px}.formkit-form .formkit-input,.formkit-form .formkit-submit{width:100%}.formkit-form .formkit-guarantee{font-size:13px;margin:0 0 15px}.formkit-form .formkit-guarantee>p{margin:0}.formkit-form .formkit-powered-by{color:#7d7d7d;display:block;font-size:12px;margin-bottom:0;text-align:center}.formkit-form .formkit-powered-by[data-active=false]{opacity:.5}.formkit-form[min-width~="600"] [data-style=full],.formkit-form[min-width~="700"] [data-style=full],.formkit-form[min-width~="800"] [data-style=full]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.formkit-form[min-width~="600"] .formkit-submit,.formkit-form[min-width~="700"] .formkit-submit,.formkit-form[min-width~="800"] .formkit-submit{width:auto}.formkit-form[min-width~="600"] .formkit-column,.formkit-form[min-width~="700"] .formkit-column,.formkit-form[min-width~="800"] .formkit-column{padding:40px}.formkit-form[min-width~="600"] .formkit-column:nth-child(2),.formkit-form[min-width~="700"] .formkit-column:nth-child(2),.formkit-form[min-width~="800"] .formkit-column:nth-child(2){border-top:none}</style><meta name="generator" content="Gatsby 2.0.91"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="Yusuf Unlu&#x27;s Personal Blog RSS Feed" href="/Blog/rss.xml"/><link rel="shortcut icon" href="/Blog/icons/icon-48x48.png"/><link rel="manifest" href="/Blog/manifest.webmanifest"/><title data-react-helmet="true">ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶ â€” yusufunlu</title><meta data-react-helmet="true" name="theme-color" content="#282c35"/><meta data-react-helmet="true" name="description" content="æŒ‡å‘æ­£ç¡®é“è·¯çš„å››é¡¹åŸºæœ¬åŸåˆ™."/><meta data-react-helmet="true" property="og:url" content="https://yusufunlu.github.io/blog//zh-hans/writing-resilient-components/"/><meta data-react-helmet="true" property="og:title" content="ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶"/><meta data-react-helmet="true" property="og:description" content="æŒ‡å‘æ­£ç¡®é“è·¯çš„å››é¡¹åŸºæœ¬åŸåˆ™."/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@yufusunlu"/><meta data-react-helmet="true" name="twitter:title" content="ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶"/><meta data-react-helmet="true" name="twitter:description" content="æŒ‡å‘æ­£ç¡®é“è·¯çš„å››é¡¹åŸºæœ¬åŸåˆ™."/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:inherit;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);border-left-color:inherit;opacity:0.8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:var(--hr);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"â€” ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:var(--textLink);text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}a.anchor{box-shadow:none;}a.anchor svg[aria-hidden="true"]{stroke:var(--textLink);}p code{font-size:1rem;}h1 code, h2 code, h3 code, h4 code, h5 code, h6 code{font-size:inherit;}li code{font-size:1rem;}blockquote.translation{font-size:1em;}</style><link as="script" rel="preload" href="/Blog/component---src-templates-blog-post-js-982b770947b8f057294a.js"/><link as="script" rel="preload" href="/Blog/app-34cbd8f5387764ab7c9b.js"/><link as="script" rel="preload" href="/Blog/0-b197e8c6c7ff26484233.js"/><link as="script" rel="preload" href="/Blog/2-729ce5f39e8863375f6f.js"/><link as="script" rel="preload" href="/Blog/1-1b550cd61a5e170131aa.js"/><link as="script" rel="preload" href="/Blog/webpack-runtime-c5f23e2dfa285887902d.js"/><link as="fetch" rel="preload" href="/Blog/static/d/445/path---zh-hans-writing-resilient-components-65-b-c24-956umHag7kcK9bGqFRQryzpHL0c.json" crossorigin="use-credentials"/></head><body class="light"><script>
              (function() {
                window.__onThemeChange = function() {};
                function setTheme(newTheme) {
                  window.__theme = newTheme;
                  preferredTheme = newTheme;
                  document.body.className = newTheme;
                  window.__onThemeChange(newTheme);
                }

                var preferredTheme;
                try {
                  preferredTheme = localStorage.getItem('theme');
                } catch (err) { }

                window.__setPreferredTheme = function(newTheme) {
                  setTheme(newTheme);
                  try {
                    localStorage.setItem('theme', newTheme);
                  } catch (err) {}
                }

                var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
                darkQuery.addListener(function(e) {
                  window.__setPreferredTheme(e.matches ? 'dark' : 'light')
                });

                setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
              })();
            </script><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="color:var(--textNormal);background:var(--bg);transition:color 0.2s ease-out, background 0.2s ease-out;min-height:100vh"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2.625rem"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:0;height:42px;line-height:2.625rem"><a style="box-shadow:none;text-decoration:none;color:rgb(255, 167, 196)" href="/Blog/">yusufunlu</a></h3><div style="height:24px"></div></header><main><article><header><h1 style="color:var(--textTitle)">ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.4rem">2019 M03 16<!-- --> â€¢ â˜•ï¸â˜•ï¸â˜•ï¸ 16 min read</p><div class="translations"><p style="font-size:0.9em;border:1px solid var(--hr);border-radius:0.75em;padding:0.75em;background:var(--inlineCode-bg);word-break:keep-all;font-family:system-ui, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
    &quot;Roboto&quot;, &quot;Oxygen&quot;, &quot;Ubuntu&quot;, &quot;Cantarell&quot;, &quot;Fira Sans&quot;,
    &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif"><span><span>Translated by readers into: </span><b>ç®€ä½“ä¸­æ–‡</b></span><br/><br/><a href="/Blog/writing-resilient-components/">Read the original</a> â€¢ <a href="https://github.com/yusufunlu/Blog/edit/master/src/pages/writing-resilient-components/index.zh-hans.md" target="_blank" rel="noopener noreferrer">Improve this translation</a> â€¢ <a href="/Blog/zh-hans">View all translated posts</a> </p></div></header><div><p>å½“å¤§å®¶å¼€å§‹å­¦ä¹  React æ—¶ï¼Œå¸¸å¸¸é—®åˆ°é£æ ¼æŒ‡å—ã€‚è™½ç„¶å‘¢ï¼Œé¡¹ç›®ä¸­åº”ç”¨ä¸€è‡´çš„è§„åˆ™ï¼Œæ˜¯ä¸ªä¸é”™çš„ä¸»æ„ï¼Œä½†æ˜¯å¾ˆå¤šè§„åˆ™æŒºéšæ„çš„â€”â€”æ‰€ä»¥ React å¯¹è¿™äº›å¹¶æ²¡æœ‰å¼ºçƒˆçš„æ„è§ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç±»å‹ç³»ç»Ÿï¼Œä½¿ç”¨å‡½æ•°å£°æ˜æˆ–è€…ç®­å¤´å‡½æ•°ï¼Œä¹Ÿå¯ä»¥å¯¹ä½ çš„å±æ€§æŒ‰å­—æ¯åºæˆ–ä»»ä½•ä½ æ„¿æ„çš„å…¶ä»–é¡ºåºæ¥æ’åºã€‚</p>
<p>è¿™æ ·çš„çµæ´»æ€§å…è®¸åœ¨é¡¹ç›®ä¸­ <a href="https://reactjs.org/docs/add-react-to-a-website.html" target="_blank" rel="nofollow noopener noreferrer">æ•´åˆ React</a> æ—¶ï¼Œèƒ½åº”ç”¨å·²æœ‰çš„ä¸€äº›çº¦å®šä¹ æƒ¯ã€‚ä¸è¿‡åŒæ—¶ï¼Œè¿™ä¹Ÿä¼šå¼•å‘æ— ä¼‘æ­¢çš„äº‰è®ºã€‚</p>
<p><strong><em>æœ‰</em>ä¸€äº›æ¯ä¸ªç»„ä»¶éƒ½åº”æåŠ›éµå®ˆçš„è®¾è®¡åŸåˆ™ã€‚ä½†æˆ‘ä¸è®¤ä¸ºé£æ ¼æŒ‡å—èƒ½å¾ˆå¥½åœ°æ•æ‰è¿™äº›åŸåˆ™ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆè°ˆè°ˆé£æ ¼æŒ‡å—ï¼Œç„¶å<a href="#%E7%BC%96%E5%86%99%E6%9C%89%E5%BC%B9%E6%80%A7%E7%9A%84%E7%BB%84%E4%BB%B6">å†çœ‹çœ‹çœŸçš„æœ‰ç”¨çš„è®¾è®¡åŸåˆ™</a>ã€‚</strong></p>
<hr>
<h2 id="åˆ«è¢«è™šå¹»çš„é—®é¢˜åˆ†æ•£äº†æ³¨æ„åŠ›"><a href="#%E5%88%AB%E8%A2%AB%E8%99%9A%E5%B9%BB%E7%9A%84%E9%97%AE%E9%A2%98%E5%88%86%E6%95%A3%E4%BA%86%E6%B3%A8%E6%84%8F%E5%8A%9B" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>åˆ«è¢«è™šå¹»çš„é—®é¢˜åˆ†æ•£äº†æ³¨æ„åŠ›</h2>
<p>åœ¨æˆ‘ä»¬è®¨è®ºç»„ä»¶çš„è®¾è®¡åŸåˆ™å‰ï¼Œæˆ‘æƒ³å…ˆç®€å•è¯´è¯´é£æ ¼æŒ‡å—ã€‚è¿™ä¸æ˜¯ä¸ªæµè¡Œçš„è§‚ç‚¹ï¼Œä½†æœ‰äººå¾—è¯´å‡ºæ¥ï¼</p>
<p>åœ¨ JavaScript ç¤¾åŒºä¸­ï¼Œæœ‰ä¸€äº›ç”± linter å¼ºåˆ¶çº¦æŸçš„æ ·å¼æŒ‡å—ã€‚æˆ‘ä¸ªäººçš„è§‚å¯Ÿæ˜¯ï¼Œä»–ä»¬ä¼šäº§æ¯”ä»–ä»¬ä»·å€¼æ›´å¤šçš„éº»çƒ¦ã€‚æˆ‘ç®—ä¸æ¸…æœ‰å¤šå°‘äººå‘æˆ‘å±•ç¤ºè¿‡ä¸€äº›å®Œå…¨æœ‰æ•ˆçš„ä»£ç ï¼Œç„¶åè·Ÿæˆ‘è¯´ â€œReact æç¤ºè¿™æœ‰é—®é¢˜å•Šï¼â€ï¼Œä½†è¿™å…¶å®æ˜¯ç”±ä»–ä»¬çš„ lint é…ç½®äº§ç”Ÿçš„ï¼è¿™å°±å¯¼è‡´äº†ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>
<p>äººä»¬ä¹ æƒ¯äºå°† linter çœ‹ä½œæ˜¯ä¸€ä¸ªè¿‡åˆ†çƒ­å¿ƒåˆåµé—¹çš„çœ‹é—¨äººï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ã€‚ æœ‰ç”¨çš„è­¦å‘Šè¢«é£æ ¼æç¤ºçš„æµ·æ´‹æ·¹æ²¡äº†ã€‚å› æ­¤ï¼Œäººä»¬åœ¨è°ƒè¯•æ—¶ä¸çœ‹ linter çš„æç¤ºï¼Œé”™è¿‡æœ‰ç”¨çš„ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œä¹‹å‰ä¸å¤ªå†™ JavaScript çš„äººç¾¤ï¼ˆä¾‹å¦‚ï¼Œè®¾è®¡äººå‘˜ï¼‰ä¹Ÿå› æ­¤æ›´éš¾ä½¿ç”¨ä»£ç ã€‚</p>
</li>
<li>
<p>å¯¹äºæŸç§æ¨¡å¼ï¼Œå¤§å®¶ä¸å¤ªå­¦ç€<strong>åŒºåˆ†æœ‰æ•ˆå’Œæ— æ•ˆçš„ç”¨æ³•</strong>ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€æ¡æµè¡Œçš„è§„åˆ™æ˜¯ï¼Œç¦æ­¢åœ¨ <code class="language-text">componentDidMount</code> ä¸­è°ƒç”¨ <code class="language-text">setState</code>ã€‚ä½†å¦‚æœè¿™ä¸ªç”¨æ³•æ€»æ˜¯ â€œé”™çš„â€ï¼Œé‚£ React æ ¹æœ¬ä¸ä¼šå…è®¸å®ƒï¼è¿™å°±æœ‰ä¸€ä¸ªåˆæ³•çš„ç”¨ä¾‹ï¼Œé‚£å°±æ˜¯æµ‹é‡ DOM èŠ‚ç‚¹å¸ƒå±€â€”â€”ä¾‹å¦‚ï¼Œå®šä½ tooltipã€‚æˆ‘è§è¿‡æœ‰äººæ·»åŠ  <code class="language-text">setTimeout</code> æ¥ â€œè§£å†³â€ è¿™æ¡è§„åˆ™ï¼Œè¿™å®Œå…¨æé”™äº†ã€‚</p>
</li>
<li>
<p>æœ€ç»ˆï¼Œäººä»¬é‡‡ç”¨ â€œæ‰§æ³•è€…å¿ƒæ€â€ï¼Œå¯¹é‚£äº›<strong>æ²¡å¸¦æ¥æœ‰æ„ä¹‰å˜åŒ–</strong>ä½†åœ¨ä»£ç ä¸­æ˜“äºå‘ç°çš„åœ°æ–¹æŒæ‰¹è¯„æ€åº¦ã€‚â€œä½ ç”¨äº†å‡½æ•°å£°æ˜ï¼Œä½†<em>æˆ‘ä»¬çš„</em>é¡¹ç›®ç”¨çš„æ˜¯ç®­å¤´å‡½æ•°ã€‚â€ æ¯æ¬¡æˆ‘æœ‰å¼ºçƒˆæ„æ„¿ï¼Œæƒ³è¦å¼ºåˆ¶æ‰§è¡Œç±»ä¼¼çš„è§„åˆ™æ—¶ï¼Œä»”ç»†æƒ³æƒ³å°±ä¼šå‘ç°ï¼Œæˆ‘æŠŠä¸ªäººæƒ…ç»ªæŠ•å…¥åˆ°äº†è¿™ä¸ªè§„åˆ™ä¸­â€”â€”ç„¶ååˆåŠªåŠ›è®©è¿™æ¶ˆå¤±ã€‚è¿™è®©æˆ‘é™·å…¥è™šå‡çš„æˆå°±æ„Ÿï¼Œè€Œä¸æ¯«æ²¡æœ‰æ”¹è¿›æˆ‘çš„ä»£ç ã€‚</p>
</li>
</ul>
<p>æˆ‘è¿™æ˜¯åœ¨å®£æ‰¬åœæ­¢ä½¿ç”¨ linter å—ï¼Ÿ ä¸ï¼</p>
<p><strong>é€šè¿‡è‰¯å¥½çš„é…ç½®ï¼Œlinter æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œå®ƒå¯ä»¥åœ¨ bug å‡ºç°å‰å°±èƒ½å‘ç°å®ƒä»¬ã€‚</strong>ä½†å®ƒå¯¹<em>ä»£ç é£æ ¼</em>çš„å…³æ³¨è¿‡å¤šï¼Œä½¿å…¶å˜å¾—ä¼šåˆ†æ•£æ³¨æ„åŠ›ã€‚</p>
<hr>
<h2 id="æ•´ç†ä½ çš„-lint-é…ç½®"><a href="#%E6%95%B4%E7%90%86%E4%BD%A0%E7%9A%84-lint-%E9%85%8D%E7%BD%AE" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ•´ç†ä½ çš„ Lint é…ç½®</h2>
<p>è¿™æ˜¯æˆ‘å»ºè®®ä½ åœ¨å‘¨ä¸€è¦åšçš„äº‹ã€‚æŠŠä½ çš„å›¢é˜Ÿå«åˆ°ä¸€èµ·èŠ±åŠä¸ªå°æ—¶æ—¶é—´ï¼Œä¸€æ¡æ¡è¿‡ä¸€ä¸‹ä½ ä»¬é¡¹ç›®ä¸­å¯ç”¨çš„ lint è§„åˆ™ï¼Œæ¥ç€é—®é—®è‡ªå·±ï¼š<em>â€œè¿™æ¡è§„åˆ™æœ‰å¸®æˆ‘æ‰¾åˆ°è¿‡ bug å—?â€</em> å¦‚æœä¸æ˜¯ï¼Œ<em>å…³æ‰è¿™æ¡è§„åˆ™</em>ã€‚ï¼ˆä½ ä¹Ÿå¯ä»¥ç”¨ <a href="https://www.npmjs.com/package/eslint-config-react-app" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">eslint-config-react-app</code></a> ä»å¤´å¼€å§‹åˆ›å»ºï¼Œé‡Œé¢ä¸å«ä»»ä½•ä»£ç é£æ ¼çš„è§„åˆ™ï¼‰</p>
<p>è‡³å°‘ï¼Œä½ çš„å›¢é˜Ÿåº”è¯¥æœ‰ä¸€ä¸ªæµç¨‹ï¼Œä¼šå»åˆ é™¤å¼•èµ·å¹²æ‰°çš„è§„åˆ™é¡¹ã€‚ä¸è¦å‡è®¾ä¸€å¹´å‰ä½ æˆ–åˆ«äººæ·»åŠ åˆ°ä½ çš„ lint é…ç½®ä¸­çš„ä»»ä½•ä¸œè¥¿ï¼Œéƒ½æ˜¯â€œæœ€ä½³å®è·µâ€ã€‚ä¿æŒè´¨ç–‘ï¼Œæ‰¾åˆ°ç­”æ¡ˆã€‚åˆ«è®©ä»»ä½•äººå‘Šè¯‰ä½ ï¼Œä½ ä¸å¤Ÿèªæ˜ï¼Œä¸èƒ½é€‰æ‹© lint è§„åˆ™ã€‚</p>
<p><strong>é‚£ä»£ç æ ¼å¼åŒ–å‘¢ï¼Ÿ</strong> ç”¨ <a href="https://prettier.io/" target="_blank" rel="nofollow noopener noreferrer">Prettier</a> ç„¶åå¿˜æ‰ â€œé£æ ¼â€ã€‚ä½ å®Œå…¨ä¸éœ€è¦ä¸€ä¸ªå·¥å…·å‘Šè¯‰ä½ å¾—åœ¨è¿™åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œå¦‚æœæœ‰åˆ«çš„å·¥å…·èƒ½ä¸ºä½ ä¿®å¤å®ƒã€‚ç”¨ linter æ‰¾ <em>bug</em>ï¼Œè€Œä¸æ˜¯åš <em>ä»£ ç  ç¾ å­¦</em>ã€‚</p>
<p>å½“ç„¶ï¼ŒæŸäº›æ–¹é¢æ¥è¯´ï¼Œç¼–ç é£æ ¼å’Œæ ¼å¼æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä½†åœ¨æ•´ä¸ªé¡¹ç›®ä¸­å­˜åœ¨ä¸ä¸€è‡´æ—¶è¿˜æ˜¯å¾ˆæ¼äººã€‚</p>
<p>ç„¶è€Œï¼Œå®ƒä»¬ä¸­çš„è®¸å¤šéƒ½å¤ªå¾®å¦™äº†ï¼Œæ— æ³•é€šè¿‡ä¸€æ¡ lint è§„åˆ™æ•æ‰åˆ°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¯´ï¼Œåœ¨å›¢é˜Ÿæˆå‘˜ä¹‹é—´<strong>å»ºç«‹ä¿¡ä»»</strong>ï¼Œåœ¨ wiki æˆ–ç®€çŸ­çš„è®¾è®¡æŒ‡å—é‡Œåˆ†äº«æœ‰ç”¨çš„çŸ¥è¯†ï¼Œæ˜¯éå¸¸é‡è¦çš„äº‹äº†ã€‚</p>
<p>ä¸æ˜¯ä¸€åˆ‡éƒ½å€¼å¾—è‡ªåŠ¨åŒ–ï¼ä» <em>å®é™…é˜…è¯»</em> ä¸­è·å¾—çš„è§è§£ï¼Œè¿™ç§æŒ‡å—ä¸­çš„ç†ç”±å¯èƒ½æ¯”éµå¾ª â€œè§„åˆ™â€ æ›´æœ‰ä»·å€¼ã€‚</p>
<p><strong>å¦‚æœéµå¾ªä¸¥æ ¼çš„é£æ ¼æŒ‡å—æ˜¯ä¸€ç§åˆ†å¿ƒï¼Œé‚£åˆ°åº•ä»€ä¹ˆæ‰æ˜¯é‡è¦çš„å‘¢ï¼Ÿ</strong></p>
<p>è¿™å°±æ˜¯è¿™ç¯‡æ–‡ç« çš„ä¸»é¢˜ã€‚</p>
<hr>
<h2 id="ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶"><a href="#%E7%BC%96%E5%86%99%E6%9C%89%E5%BC%B9%E6%80%A7%E7%9A%84%E7%BB%84%E4%BB%B6" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶</h2>
<p>ä¸è®ºå¤šå°‘ç¼©è¿›æˆ–æŒ‰å­—æ¯åºæ’åˆ—ï¼Œéƒ½ä¸èƒ½ä¿®å¤ç³Ÿç³•çš„è®¾è®¡ã€‚å› æ­¤ï¼Œæˆ‘ä¸ä¼šä¸“æ³¨äºæŸäº›ä»£ç <em>çœ‹èµ·æ¥å¦‚ä½•</em>ï¼Œè€Œæ˜¯ä¸“æ³¨äºå¦‚ä½•è®©å®ƒ<em>å·¥ä½œ</em>ã€‚è¿™æœ‰ä¸€äº›ç»„ä»¶è®¾è®¡åŸåˆ™æˆ‘è®¤ä¸ºæ˜¯éå¸¸æœ‰ç”¨ï¼š</p>
<ol>
<li><strong><a href="#%E5%8E%9F%E5%88%99-1%EF%BC%9A%E4%B8%8D%E9%98%BB%E6%96%AD%E6%95%B0%E6%8D%AE%E6%B5%81">ä¸é˜»æ–­æ•°æ®æµ</a></strong></li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-2%EF%BC%9A%E6%97%B6%E5%88%BB%E5%87%86%E5%A4%87%E6%B8%B2%E6%9F%93">æ—¶åˆ»å‡†å¤‡æ¸²æŸ“</a></strong></li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-3%EF%BC%9A%E6%B2%A1%E6%9C%89%E5%8D%95%E4%BE%8B%E7%BB%84%E4%BB%B6">æ²¡æœ‰å•ä¾‹ç»„ä»¶</a></strong></li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-4%EF%BC%9A%E9%9A%94%E7%A6%BB%E6%9C%AC%E5%9C%B0%E7%8A%B6%E6%80%81">éš”ç¦»æœ¬åœ°çŠ¶æ€</a></strong></li>
</ol>
<p>å³ä½¿ä½ ä¸ä½¿ç”¨ Reactï¼Œå¯¹äºå­˜åœ¨å•å‘æ•°æ®æµçš„ä»»ä½• UI ç»„ä»¶æ¨¡å‹ï¼Œå¯èƒ½ä¹Ÿèƒ½é€šè¿‡åå¤è¯•éªŒå‘ç°ç›¸åŒçš„åŸåˆ™ã€‚</p>
<hr>
<h2 id="åŸåˆ™-1ï¼šä¸é˜»æ–­æ•°æ®æµ"><a href="#%E5%8E%9F%E5%88%99-1%EF%BC%9A%E4%B8%8D%E9%98%BB%E6%96%AD%E6%95%B0%E6%8D%AE%E6%B5%81" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>åŸåˆ™ 1ï¼šä¸é˜»æ–­æ•°æ®æµ</h2>
<h3 id="æ¸²æŸ“ä¸­ä¸è¦é˜»æ–­æ•°æ®æµ"><a href="#%E6%B8%B2%E6%9F%93%E4%B8%AD%E4%B8%8D%E8%A6%81%E9%98%BB%E6%96%AD%E6%95%B0%E6%8D%AE%E6%B5%81" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¸²æŸ“ä¸­ä¸è¦é˜»æ–­æ•°æ®æµ</h3>
<p>å½“åˆ«äººä½¿ç”¨ä½ çš„ç»„ä»¶æ—¶ï¼Œä»–ä»¬çš„é¢„æœŸæ˜¯ï¼Œä¸è®ºä¼ é€’å±æ€§å¦‚ä½•å˜åŒ–, ç»„ä»¶éƒ½å°†åæ˜ è¿™äº›å˜åŒ–ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// isOk ä¹Ÿè®¸åœ¨ state é‡Œï¼Œéšæ—¶ä¼šå˜åŒ–</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token attr-name">color</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>isOk <span class="token operator">?</span> <span class="token string">'blue'</span> <span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span></code></pre></div>
<p>é€šå¸¸ï¼Œè¿™æ˜¯ React é»˜è®¤å·¥ä½œçš„æ–¹å¼ã€‚å¦‚æœä½ åœ¨ <code class="language-text">Button</code> ç»„ä»¶ä¸­ä½¿ç”¨ <code class="language-text">color</code>ï¼Œä½ ä¼šçœ‹åˆ°ä»ä¸Šå±‚ä¸ºè¯¥æ¸²æŸ“æä¾›çš„å€¼ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// âœ… `color` æ°¸è¿œæ˜¯æ–°çš„</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'Button-'</span> <span class="token operator">+</span> color<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¶è€Œï¼Œå­¦ä¹  React æ—¶å¸¸è§çš„ä¸€ä¸ªé”™è¯¯æ˜¯ï¼ŒæŠŠ props å¤åˆ¶åˆ° stateï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    color<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> color <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ `color` ä¸æ–°é²œäº†ï¼</span></span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'Button-'</span> <span class="token operator">+</span> color<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™ä¹Ÿè®¸çœ‹èµ·æ¥æ›´ç›´è§‚ï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡ React ä¹‹å¤–çš„ä¸œè¥¿ã€‚ <strong>ä½†æ˜¯ï¼Œé€šè¿‡å°† prop å¤åˆ¶åˆ° stateï¼Œä½ å¿½ç•¥äº†å¯¹å®ƒçš„æ‰€æœ‰æ›´æ–°ã€‚</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ğŸ”´ ä¸Šé¢çš„å®ç°åœ¨æ›´æ–°æ—¶æ— æ³•æ­£å¸¸å·¥ä½œäº†</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token attr-name">color</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>isOk <span class="token operator">?</span> <span class="token string">'blue'</span> <span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span></code></pre></div>
<p>å¾ˆå°‘æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„è¡Œä¸º <em>æ˜¯</em> æœ‰æ„ä¸ºä¹‹çš„ï¼Œè¯·ç¡®è®¤å°†è¿™æ ·çš„å±æ€§å–åä¸º <code class="language-text">initialColor</code> æˆ– <code class="language-text">defaultColor</code> æ¥è¡¨æ˜ç»„ä»¶ä¼šå¿½ç•¥è¿™ä¸ªå±æ€§çš„æ”¹å˜ã€‚</p>
<p>ä½†é€šå¸¸ä½ ä¼šæƒ³åœ¨ä½ çš„ç»„ä»¶ä¸­ <strong>ç›´æ¥è¯»å– props</strong>ï¼Œé¿å…å¤åˆ¶ propsï¼ˆæˆ–ä» props ä¸­è®¡ç®—å¾—åˆ°çš„å€¼) åˆ° stateï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// âœ… `color` æ°¸è¿œæ˜¯æ–°çš„!</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'Button-'</span> <span class="token operator">+</span> color<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<hr>
<p>è®¡ç®—å€¼æ˜¯å¦ä¸€ä¸ªå¤§å®¶å¯èƒ½ä¼šå°† props å¤åˆ¶åˆ° state çš„åœºæ™¯ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæƒ³è±¡ä¸€ä¸‹ <em>æŒ‰é’®æ–‡å­—</em> çš„é¢œè‰²æ˜¯æ ¹æ® <code class="language-text">color</code> å±æ€§é€šè¿‡æ˜‚è´µè®¡ç®—å¾—æ¥ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    textColor<span class="token punctuation">:</span> <span class="token function">slowlyCalculateTextColor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">)</span></span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
        <span class="token string">'Button-'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color <span class="token operator">+</span>
<span class="gatsby-highlight-code-line">        <span class="token string">' Button-text-'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>textColor <span class="token comment">// ğŸ”´ `color` æ”¹å˜çš„æ—¶å€™å°±ä¸æ–°é²œäº†</span></span>      <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™ä¸ªç»„ä»¶æœ‰ bugï¼Œå®ƒåœ¨ <code class="language-text">color</code> å±æ€§æ”¹å˜æ—¶æ— æ³•é‡æ–°è®¡ç®— <code class="language-text">this.state.textColor</code>ã€‚æœ€ç®€å•çš„ä¿®å¤æ˜¯æŠŠ <code class="language-text">textColor</code> çš„è®¡ç®—æ”¾åˆ° <code class="language-text">render</code> æ–¹æ³•ä¸­ï¼Œç„¶åæŠŠç»„ä»¶æ”¹ä¸º <code class="language-text">PureComponent</code>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> textColor <span class="token operator">=</span> <span class="token function">slowlyCalculateTextColor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
        <span class="token string">'Button-'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color <span class="token operator">+</span>
        <span class="token string">' Button-text-'</span> <span class="token operator">+</span> textColor <span class="token comment">// âœ… æ°¸è¿œæ˜¯æ–°çš„</span>
      <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>é—®é¢˜è§£å†³äº†ï¼ç°åœ¨å½“ props æ”¹å˜æ—¶é‡æ–°è®¡ç®— <code class="language-text">textColor</code>ï¼Œä½†æ˜¯åœ¨å±æ€§ä¸å˜æ—¶ï¼Œèƒ½é¿å…é‡å¤è¿›è¡Œæ˜‚è´µè®¡ç®—ã€‚</p>
<p>ç„¶è€Œï¼Œä¹Ÿè®¸æˆ‘ä»¬è¿˜èƒ½å†ä¼˜åŒ–ä¸€ä¸‹ã€‚å¦‚æœ <code class="language-text">children</code> æ”¹å˜äº†å‘¢ï¼Ÿå¾ˆé—æ†¾ <code class="language-text">textColor</code> åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šé‡å¤è®¡ç®—ã€‚æˆ‘ä»¬ç¬¬äºŒæ¬¡å°è¯•å¯èƒ½æ˜¯é€šè¿‡åœ¨ <code class="language-text">componentDidUpdate</code> ä¸­è°ƒç”¨è®¡ç®—ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    textColor<span class="token punctuation">:</span> <span class="token function">slowlyCalculateTextColor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span>color <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token comment">// ğŸ˜” é¢å¤–çš„é‡å¤æ¸²æŸ“</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        textColor<span class="token punctuation">:</span> <span class="token function">slowlyCalculateTextColor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
        <span class="token string">'Button-'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color <span class="token operator">+</span>
        <span class="token string">' Button-text-'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>textColor <span class="token comment">// âœ… åœ¨æœ€åä¸€æ¬¡æ¸²æŸ“åæ˜¯æ–°çš„</span>
      <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¶è€Œï¼Œè¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬çš„ç»„ä»¶åœ¨æ¯æ¬¡æ›´æ–°åï¼Œéƒ½æœ‰ä¸¤æ¬¡ render è°ƒç”¨ã€‚å¦‚æœæˆ‘ä»¬è¯•å›¾ä¼˜åŒ–å®ƒï¼Œé‚£ä¹Ÿä¸ç†æƒ³ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨å·²ä¸æ¨èçš„ <code class="language-text">componentWillReceiveProps</code> ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚ç„¶è€Œï¼Œå¤§å®¶ç»å¸¸æŠŠ side effects æ”¾è¿™ã€‚è¿™åè¿‡æ¥åˆå¾€å¾€ä¼šç»™å³å°†åˆ°æ¥çš„å¹¶å‘æ¸²æŸ“ <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html" target="_blank" rel="nofollow noopener noreferrer">ç‰¹æ€§åƒ Time Slicing å’Œ Suspense</a> å¸¦æ¥é—®é¢˜ã€‚è€Œæ›´ â€œå®‰å…¨â€ çš„ <code class="language-text">getDerivedStateFromProps</code> åˆæœ‰ç‚¹éš¾ç”¨ã€‚</p>
<p>è®©æˆ‘ä»¬é€€ä¸€æ­¥ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬æƒ³è¦ <a href="https://en.wikipedia.org/wiki/Memoization" target="_blank" rel="nofollow noopener noreferrer"><em>memoization</em></a>ã€‚æˆ‘ä»¬æœ‰ä¸€äº›è¾“å…¥ï¼Œé™¤éè¾“å…¥å‘ç”Ÿå˜åŒ–ï¼Œå¦åˆ™æˆ‘ä»¬ä¸æƒ³é‡æ–°è®¡ç®—è¾“å‡ºã€‚</p>
<p>ä½¿ç”¨ç±»ï¼Œä½ å¯ä»¥ä½¿ç”¨<a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#what-about-memoization" target="_blank" rel="nofollow noopener noreferrer">å¸®åŠ©ç¨‹åº</a>å®Œæˆ memoizationã€‚ä½†æ˜¯ï¼ŒHooks æ›´è¿›äº†ä¸€æ­¥ï¼Œæä¾›äº†ä¸€ç§è®°å¿†æ˜‚è´µè®¡ç®—çš„å†…ç½®æ–¹æ³•ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> textColor <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">slowlyCalculateTextColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span>color<span class="token punctuation">]</span> <span class="token comment">// âœ… é™¤é `color` æ”¹å˜ï¼Œä¸ä¼šé‡æ–°è®¡ç®—</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'Button-'</span> <span class="token operator">+</span> color <span class="token operator">+</span> <span class="token string">' Button-text-'</span> <span class="token operator">+</span> textColor<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™å°±æ˜¯æ‰€ä»¥ä½ éœ€è¦çš„å…¨éƒ¨ä»£ç äº†ï¼</p>
<p>åœ¨ class ç»„ä»¶ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¸®åŠ©ç¨‹åºç±»ä¼¼ <a href="https://github.com/alexreardon/memoize-one" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">memoize-one</code></a>ã€‚åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œ<code class="language-text">useMemo</code> Hook æä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬çœ‹åˆ°<strong>ä¼˜åŒ–æ˜‚è´µçš„è®¡ç®—ä¹Ÿä¸æ˜¯å°† props å¤åˆ¶åˆ° state çš„å¥½ç†ç”±</strong>ã€‚æˆ‘ä»¬çš„æ¸²æŸ“ç»“æœåº”è¯¥å“åº” props çš„å˜åŒ–ã€‚</p>
<hr>
<h3 id="ä¸è¦åœ¨-side-effects-é‡Œé˜»æ–­æ•°æ®æµ"><a href="#%E4%B8%8D%E8%A6%81%E5%9C%A8-side-effects-%E9%87%8C%E9%98%BB%E6%96%AD%E6%95%B0%E6%8D%AE%E6%B5%81" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä¸è¦åœ¨ Side Effects é‡Œé˜»æ–­æ•°æ®æµ</h3>
<p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®¨è®ºäº†å…³äºå¦‚ä½•åœ¨å±æ€§å˜åŒ–æ—¶ä¿æŒæ¸²æŸ“ç»“æœçš„ä¸€è‡´ã€‚é¿å…å¤åˆ¶ props åˆ° state æ˜¯ä¸€éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œ<strong>side effectsï¼ˆä¾‹å¦‚è·å–æ•°æ®ï¼‰ä¹Ÿæ˜¯æ•°æ®æµé‡è¦çš„ä¸€éƒ¨åˆ†</strong></p>
<p>çœ‹çœ‹è¿™ä¸ª React ç»„ä»¶ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">SearchResults</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–æ•°æ®...</span>
  <span class="token punctuation">}</span>
  <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'http://myapi/results?query'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¾ˆå¤š React ç»„ä»¶éƒ½åƒè¿™æ ·â€”â€”ä½†å¦‚æœçœ‹çœ‹ï¼Œä¼šå‘ç°è¿™æœ‰ä¸ª bugã€‚<code class="language-text">fetchResults</code> æ–¹æ³•ä½¿ç”¨äº† <code class="language-text">query</code> å±æ€§æ¥åšæ•°æ®è·å–ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">'http://myapi/results?query'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query<span class="token punctuation">;</span></span>  <span class="token punctuation">}</span></code></pre></div>
<p>ä½†å¦‚æœ <code class="language-text">query</code> å˜äº†å‘¢ï¼Ÿåœ¨è¿™ä¸ªç»„ä»¶ä¸­ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚<strong>è¿™æ„å‘³ç€ç»„ä»¶çš„ side effects æ²¡æœ‰å“åº”å®ƒ props çš„å˜åŒ–</strong>ã€‚è¿™åœ¨ React åº”ç”¨ä¸­æ˜¯å¸¸è§ bug çš„æ ¹æºã€‚</p>
<p>ä¸ºäº†ä¿®å¤è¿™ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p>
<ul>
<li>
<p>æŸ¥çœ‹ <code class="language-text">componentDidMount</code> å’Œå®ƒæ‰€è°ƒç”¨çš„æ‰€æœ‰æ–¹æ³•</p>
<ul>
<li>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯ <code class="language-text">fetchResults</code> å’Œ <code class="language-text">getFetchUrl</code></li>
</ul>
</li>
<li>
<p>å†™ä¸‹æ‰€æœ‰è¢«ä»–ä»¬ä½¿ç”¨çš„ props å’Œ state</p>
<ul>
<li>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯ <code class="language-text">this.props.query</code></li>
</ul>
</li>
<li>
<p>ç¡®ä¿ä¸è®º props å¦‚ä½•å˜åŒ–ï¼Œéƒ½é‡æ–°æ‰§è¡Œ side effect</p>
<ul>
<li>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code class="language-text">componentDidUpdate</code> æ–¹æ³•å®ç°</li>
</ul>
</li>
</ul>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">SearchResults</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span>query <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// âœ… é‡æ–°è·å–æ•°æ®</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–æ•°æ®...</span>
  <span class="token punctuation">}</span>
  <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">'http://myapi/results?query'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query<span class="token punctuation">;</span> <span class="token comment">// âœ… æ›´æ–°ä¹Ÿå¤„ç†å¥½äº†</span></span>  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç°åœ¨æˆ‘ä»¬çš„ä»£ç èƒ½å“åº”æ‰€æœ‰çš„ props å˜åŒ–äº†ï¼Œç”šè‡³æ˜¯ side effectsã€‚</p>
<p>ç„¶è€Œï¼Œç‰¢è®°ä¸è¦å†æç ¸äº†ï¼Œè¿™çœŸæ˜¯ä¸ªæŒ‘æˆ˜ã€‚ä¾‹å¦‚ï¼Œä¹Ÿè®¸åˆåŠ äº† <code class="language-text">currentPage</code> åˆ° stateï¼Œç„¶ååœ¨ <code class="language-text">getFetchUrl</code> ä¸­ä½¿ç”¨äº†å®ƒï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">SearchResults</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    currentPage<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span>query <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–æ•°æ®...</span>
  <span class="token punctuation">}</span>
  <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token string">'http://myapi/results?query'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query <span class="token operator">+</span>
<span class="gatsby-highlight-code-line">      <span class="token string">'&amp;page='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>currentPage <span class="token comment">// ğŸ”´ æ›´æ–°è¢«å¿½ç•¥äº†</span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å“å‘€ï¼Œæˆ‘ä»¬çš„ä»£ç åˆæœ‰ bug äº†ï¼Œè¿™æ˜¯å› ä¸º side effect æ²¡æœ‰å“åº” <code class="language-text">currentPage</code> çš„å˜åŒ–ã€‚</p>
<p><strong>props å’Œ state æ˜¯ React æ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚åœ¨è¿™ä¸ªæ•°æ®æµä¸­ï¼Œrendering å’Œ side effects éƒ½åº”å“åº”å®ƒä»¬çš„å˜åŒ–ï¼Œè€Œä¸æ˜¯å¿½ç•¥å®ƒä»¬ï¼</strong></p>
<p>ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼š</p>
<ul>
<li>
<p>æŸ¥çœ‹ <code class="language-text">componentDidMount</code> å’Œå®ƒæ‰€è°ƒç”¨çš„æ‰€æœ‰æ–¹æ³•</p>
<ul>
<li>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯ <code class="language-text">fetchResults</code> å’Œ <code class="language-text">getFetchUrl</code></li>
</ul>
</li>
<li>
<p>å†™ä¸‹æ‰€æœ‰è¢«ä»–ä»¬ä½¿ç”¨çš„ props å’Œ state</p>
<ul>
<li>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯ <code class="language-text">this.props.query</code> <strong>å’Œ <code class="language-text">this.state.currentPage</code></strong></li>
</ul>
</li>
<li>
<p>ç¡®ä¿ä¸è®º props å¦‚ä½•å˜åŒ–ï¼Œéƒ½é‡æ–°æ‰§è¡Œ side effect</p>
<ul>
<li>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code class="language-text">componentDidUpdate</code> æ–¹æ³•å®ç°</li>
</ul>
</li>
</ul>
<p>è®©æˆ‘ä»¬ä¿®å¤æˆ‘ä»¬çš„ç»„ä»¶ï¼Œç”¨ä»¥å¤„ç† <code class="language-text">currentPage</code> çš„æ›´æ–°å§ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">SearchResults</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    currentPage<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">      prevState<span class="token punctuation">.</span>currentPage <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>currentPage <span class="token operator">||</span> <span class="token comment">// âœ… æ›´æ–°åé‡æ–°è·å–æ•°æ®</span></span>      prevProps<span class="token punctuation">.</span>query <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–æ•°æ®...</span>
  <span class="token punctuation">}</span>
  <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token string">'http://myapi/results?query'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query <span class="token operator">+</span>
<span class="gatsby-highlight-code-line">      <span class="token string">'&amp;page='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>currentPage <span class="token comment">// âœ… æ›´æ–°è¢«å¤„ç†äº†</span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä»¥æŸç§æ–¹å¼è‡ªåŠ¨æ•æ‰åˆ°è¿™äº›é”™è¯¯ï¼Œé‚£ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿ</strong>éš¾é“æ²¡æœ‰ä»€ä¹ˆ linter å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†è¿™äº‹å—ï¼Ÿ</p>
<hr>
<p>é—æ†¾çš„æ˜¯ï¼Œè‡ªåŠ¨æ£€æŸ¥ç±»ç»„ä»¶çš„ä¸€è‡´æ€§å¤ªå›°éš¾äº†ã€‚ä»»ä½•æ–¹æ³•éƒ½å¯ä»¥è°ƒç”¨ä»»ä½•å…¶ä»–æ–¹æ³•ã€‚é™æ€åˆ†ææ¥è‡ª <code class="language-text">componentDidMount</code> å’Œ <code class="language-text">componentDidUpdate</code> çš„è°ƒç”¨å……æ»¡äº†è¯¯æŠ¥ã€‚</p>
<p>ä½†æ˜¯ï¼Œ<em>å¯èƒ½</em> å¯ä»¥è®¾è®¡ä¸€ä¸ª <em>èƒ½</em> è¢«é™æ€åˆ†æçš„ä¸€è‡´æ€§ APIã€‚<a href="/Blog/a-complete-guide-to-useeffect/">React <code class="language-text">useEffect</code> Hook</a> å°±æ˜¯è¿™æ · API çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>currentPage<span class="token punctuation">,</span> setCurrentPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// æ•°æ®è·å–...</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">        <span class="token string">'http://myapi/results?query'</span> <span class="token operator">+</span> query <span class="token operator">+</span></span><span class="gatsby-highlight-code-line">        <span class="token string">'&amp;page='</span> <span class="token operator">+</span> currentPage</span>      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>currentPage<span class="token punctuation">,</span> query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ›´æ–°åé‡æ–°è·å–</span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æˆ‘ä»¬å°†é€»è¾‘ <em>æ”¾åœ¨</em> effect ä¸­ï¼Œè¿™æ ·å¯ä»¥æ›´å®¹æ˜“åœ°çœ‹åˆ°<em>å®ƒä» React æ•°æ®æµä¸­ä¾èµ–äº†å“ªäº›å€¼</em>ã€‚è¿™äº›å€¼ç§°ä¸ºâ€œä¾èµ–â€ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­å®ƒä»¬æ˜¯ <code class="language-text">[currentPage, query]</code>ã€‚</p>
<p>æ³¨æ„è¿™ä¸ªâ€œeffect ä¾èµ–â€æ•°ç»„å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°æ¦‚å¿µã€‚åœ¨ç±»ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»éå†æ‰€æœ‰æ–¹æ³•è°ƒç”¨ï¼Œæ¥æœç´¢è¿™äº›â€œä¾èµ–é¡¹â€ã€‚<code class="language-text">useEffect</code> API åªæ˜¯æ˜¾å¼åœ°ä½¿ç”¨äº†ç›¸åŒçš„æ¦‚å¿µã€‚</p>
<p>åè¿‡æ¥è¯´ï¼Œè¿™å¯ä»¥è®©æˆ‘ä»¬è‡ªåŠ¨éªŒè¯å®ƒä»¬ï¼š</p>
<p><img src="/Blog/useeffect-bc7a074c528f3b0be1b7e509b6a8683b.gif" alt="Demo of exhaustive-deps lint rule"></p>
<p><em>ï¼ˆè¿™ä¸ª demo æ¥è‡ªæœ€æ–°æ¨èçš„ <code class="language-text">exhaustive-deps</code> lint è§„åˆ™ï¼Œè¿™æ˜¯ <code class="language-text">eslint-plugin-react-hooks</code> å…¶ä¸­ä¸€éƒ¨åˆ†ã€‚å®ƒå°†ä¸ä¹…åŠ å…¥åˆ° Create React App ä¸­ï¼‰</em></p>
<p><strong>æ³¨æ„ï¼Œæ— è®ºæ˜¯å°†ç»„ä»¶ç¼–å†™ä¸ºç±»è¿˜æ˜¯å‡½æ•°ï¼Œéƒ½å¿…é¡»ä¸º effect å“åº”æ‰€æœ‰ props å’Œ state çš„æ›´æ–°ã€‚</strong></p>
<p>ä½¿ç”¨ class APIï¼Œä½ å¿…é¡»è‡ªå·±è€ƒè™‘ä¸€è‡´æ€§ï¼Œå¹¶éªŒè¯å¯¹æ¯ä¸ªç›¸å…³ prop æˆ– state çš„æ›´æ”¹æ˜¯å¦è¯¥ç”± <code class="language-text">componentDidUpdate</code> å¤„ç†ã€‚å¦åˆ™ï¼Œç»„ä»¶å¯¹ prop å’Œ state çš„æ›´æ”¹ä¸å…·æœ‰å¼¹æ€§ã€‚è¿™ç”šè‡³ä¸æ˜¯ä¸“å±äº React çš„é—®é¢˜ã€‚å®ƒé€‚ç”¨äºä»»ä½•å…è®¸ä½ å•ç‹¬å¤„ç† â€œåˆ›å»ºâ€ å’Œ â€œæ›´æ–°â€ äº‹ä»¶çš„ UI åº“</p>
<p><strong><code class="language-text">useEffect</code> API é€šè¿‡é¼“åŠ±ä¸€è‡´æ€§æ¥ç¿»è½¬é»˜è®¤å€¼ã€‚</strong> è¿™ <a href="/Blog/a-complete-guide-to-useeffect/">å¯èƒ½åœ¨å¼€å§‹æ—¶è§‰å¾—ä¼šä¸ç†Ÿæ‚‰</a>ï¼Œä½†è¿™æ ·çš„ç»“æœæ˜¯ä½ çš„ç»„ä»¶å¯¹é€»è¾‘æ›´æ”¹æ›´å…·å¼¹æ€§äº†ã€‚ç”±äº â€œä¾èµ–å…³ç³»â€ ç°åœ¨æ˜¯æ˜¾å¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ lint è§„åˆ™<em>æ£€éªŒ</em>æ˜¯å¦ä¸€è‡´ã€‚ æˆ‘ä»¬ç”¨ linter æ¥æ•æ‰ bugï¼</p>
<hr>
<h3 id="ä¸è¦åœ¨ä¼˜åŒ–ä¸­é˜»æ–­æ•°æ®æµ"><a href="#%E4%B8%8D%E8%A6%81%E5%9C%A8%E4%BC%98%E5%8C%96%E4%B8%AD%E9%98%BB%E6%96%AD%E6%95%B0%E6%8D%AE%E6%B5%81" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä¸è¦åœ¨ä¼˜åŒ–ä¸­é˜»æ–­æ•°æ®æµ</h3>
<p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œä½ å¯èƒ½ä¼šæ„å¤–å¿½ç•¥å¯¹ props çš„æ›´æ”¹ã€‚å½“ä½ æ‰‹åŠ¨ä¼˜åŒ–ç»„ä»¶æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç±»é”™è¯¯ã€‚</p>
<p>æ³¨æ„ï¼Œä½¿ç”¨æµ…æ¯”è¾ƒçš„ä¼˜åŒ–æ–¹æ³•ï¼ˆå¦‚ <code class="language-text">PureComponent</code> å’Œ <code class="language-text">React.memo</code>ï¼‰ä¸é»˜è®¤æ¯”è¾ƒæ˜¯å®‰å…¨çš„ã€‚</p>
<p><strong>ä½†æ˜¯ï¼Œå¦‚æœä½ å°è¯•é€šè¿‡ç¼–å†™è‡ªå·±çš„æ¯”è¾ƒæ–¹æ³•æ¥ â€œä¼˜åŒ–â€ ç»„ä»¶ï¼Œä½ å¯èƒ½ä¼šé”™è¯¯åœ°å¿˜è®°æ¯”è¾ƒå‡½æ•°å±æ€§ï¼š</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// ğŸ”´ æ²¡æ¯”è¾ƒ this.props.onClick</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>color<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> onClick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onClick<span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ å°†ä¸å“åº”æ›´æ–°</span></span>    <span class="token keyword">const</span> textColor <span class="token operator">=</span> <span class="token function">slowlyCalculateTextColor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span>
        <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'Button-'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color <span class="token operator">+</span> <span class="token string">' Button-text-'</span> <span class="token operator">+</span> textColor<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä¸€å¼€å§‹å¾ˆå®¹æ˜“é”™è¿‡è¿™ä¸ªé”™è¯¯ï¼Œå› ä¸ºå¯¹äºç±»ï¼Œä½ é€šå¸¸ä¼šä¼ é€’ä¸€ä¸ª<em>æ–¹æ³•</em>ï¼Œæ‰€ä»¥å®ƒä¼šæœ‰ç›¸åŒçš„èº«ä»½ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">MyForm</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// âœ… æ€»æ˜¯åŒä¸€ä¸ªå‡½æ•°</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// Do something</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Hello!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>green<span class="token punctuation">'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">          Press me</span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æ‰€ä»¥æˆ‘ä»¬çš„ä¼˜åŒ–ä¸ä¼š<em>é©¬ä¸Š</em>è¢«ç ´åã€‚ä½†æ˜¯ï¼Œå®ƒå°†æŒç»­ â€œçœ‹åˆ°â€ æ—§çš„ <code class="language-text">onClick</code> å€¼ï¼Œä½†å…¶ä»– props ä¸ä¼šè¿™æ ·ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">MyForm</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    isEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isEnabled<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token comment">// Do something</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Hello!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>green<span class="token punctuation">'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">          <span class="token comment">// ğŸ”´ Button å¿½ç•¥äº† onClick çš„æ›´æ–°</span></span><span class="gatsby-highlight-code-line">          <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isEnabled <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token punctuation">:</span> <span class="token keyword">null</span></span>        <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">          Press me</span>
<span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåº”è¯¥ç¦ç”¨æŒ‰é’®ç‚¹å‡»äº‹ä»¶â€”â€”ä½†è¿™ä¸ä¼šå‘ç”Ÿï¼Œå› ä¸º <code class="language-text">Button</code> ç»„ä»¶å¿½ç•¥äº†å¯¹<code class="language-text">onClick</code> å±æ€§çš„ä»»ä½•æ›´æ–°ã€‚</p>
<p>å¦‚æœå‡½æ•°æ ‡è¯†æœ¬èº«ä¾èµ–äºå¯èƒ½éšæ—¶é—´å˜åŒ–çš„ä¸œè¥¿ï¼Œä¾‹å¦‚æœ¬ä¾‹ä¸­çš„ <code class="language-text">draft.content</code>ï¼Œè¿™å¯èƒ½ä¼šè®©äººæ›´åŠ å›°æƒ‘ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  drafts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>draft <span class="token operator">=></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
      <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>blue<span class="token punctuation">'</span></span>
      <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>draft<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>
      <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token comment">// ğŸ”´ Button å¿½ç•¥äº† onClick çš„æ›´æ–°</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">this</span><span class="token punctuation">.</span>handlePublish<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> draft<span class="token punctuation">.</span>content<span class="token punctuation">)</span></span>      <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      Publish</span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Button</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span></code></pre></div>
<p>è™½ç„¶ <code class="language-text">draft.content</code> å¯èƒ½éšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ <code class="language-text">Button</code> ç»„ä»¶å¿½ç•¥äº†å¯¹<code class="language-text">onClick</code> å±æ€§çš„æ”¹å˜ï¼Œæ‰€ä»¥å®ƒç»§ç»­çœ‹åˆ° <code class="language-text">onClick</code> ç»‘å®šæ–¹æ³•çš„ â€œç¬¬ä¸€ä¸ªç‰ˆæœ¬â€ ä¸åŸå§‹çš„<code class="language-text">draft.content</code>ã€‚</p>
<p><strong>é‚£æ€ä¹ˆé¿å…è¿™ä¸ªé—®é¢˜ï¼Ÿ</strong></p>
<p>æˆ‘å»ºè®®é¿å…æ‰‹åŠ¨å®ç° <code class="language-text">shouldComponentUpdate</code> ï¼Œä¹Ÿè¦é¿å…åœ¨ <code class="language-text">React.memo()</code> ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„æ¯”è¾ƒæ–¹æ³•ã€‚<code class="language-text">React.memo</code> ä¸­é»˜è®¤çš„æµ…æ¯”è¾ƒä¼šå“åº”å‡½æ•°æ ‡è¯†çš„æ›´æ–°ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">{</span> onClick<span class="token punctuation">,</span> color<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> textColor <span class="token operator">=</span> <span class="token function">slowlyCalculateTextColor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
      <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span></span>
      <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'Button-'</span> <span class="token operator">+</span> color <span class="token operator">+</span> <span class="token string">' Button-text-'</span> <span class="token operator">+</span> textColor<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Button<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… ä½¿ç”¨æµ…æ¯”è¾ƒ</span></span></code></pre></div>
<p>åœ¨ç±»ä¸­ï¼Œ<code class="language-text">PureComponent</code> ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸º.</p>
<p>è¿™ç¡®ä¿äº†ä¼ é€’ä¸åŒçš„å‡½æ•°ä½œä¸º propï¼Œå§‹ç»ˆèƒ½æœ‰æ•ˆå·¥ä½œã€‚</p>
<p>å¦‚æœä½ åšæŒä½¿ç”¨è‡ªå®šä¹‰çš„æ¯”è¾ƒï¼Œ<strong>è¯·ç¡®ä¿ä¸è·³è¿‡å‡½æ•°ï¼š</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// âœ… æ¯”è¾ƒ this.props.onClick</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>color <span class="token operator">||</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onClick <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>onClick</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>æ­£å¦‚ä¹‹å‰æåˆ°çš„ï¼Œåœ¨ç±»ç»„ä»¶ä¸­å¾ˆå®¹æ˜“é”™è¿‡è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ–¹æ³•æ ‡è¯†é€šå¸¸æ˜¯ç¨³å®šçš„ï¼ˆä½†å¹¶éæ€»æ˜¯å¦‚æ­¤â€”â€”è€Œè¿™å°±æ˜¯ debug å›°éš¾çš„åœ°æ–¹ï¼‰ã€‚æœ‰äº†Hooksï¼Œæƒ…å†µä¸åŒäº†ï¼š</p>
<ol>
<li>function åœ¨<em>æ¯ä¸ªæ¸²æŸ“</em>ä¸­éƒ½ä¸åŒï¼Œæ‰€ä»¥ä½ èƒ½<a href="https://github.com/facebook/react/issues/14972#issuecomment-468280039" target="_blank" rel="nofollow noopener noreferrer">é©¬ä¸Š</a>å‘ç°è¿™ä¸ªé—®é¢˜</li>
<li>é€šè¿‡ <code class="language-text">useCallback</code> å’Œ <code class="language-text">useContext</code>ï¼Œä½ èƒ½ <a href="https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down" target="_blank" rel="nofollow noopener noreferrer">é¿å…å¾€ä¸‹ä¼ é€’å‡½æ•°</a>ã€‚è¿™è®©ä½ ä¼˜åŒ–æ¸²æŸ“æ—¶ä¸ç”¨å¤ªæ‹…å¿ƒå‡½æ•°çš„é—®é¢˜ã€‚</li>
</ol>
<hr>
<p>æ€»ç»“ä¸€ä¸‹è¿™éƒ¨åˆ†ï¼Œ<strong>ä¸è¦é˜»æ–­æ•°æ®æµï¼</strong></p>
<p>æ— è®ºä½•æ—¶ä½¿ç”¨ props å’Œ stateï¼Œè¯·è€ƒè™‘å¦‚æœå®ƒä»¬å‘ç”Ÿå˜åŒ–ä¼šå‘ç”Ÿä»€ä¹ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»„ä»¶ä¸åº”ä»¥ä¸åŒæ–¹å¼å¤„ç†åˆå§‹æ¸²æŸ“å’Œæ›´æ–°æµç¨‹ã€‚è¿™ä½¿å®ƒèƒ½å¤Ÿé€‚åº”é€»è¾‘ä¸Šçš„å˜åŒ–ã€‚</p>
<p>å¯¹äºç±»ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­ä½¿ç”¨ props å’Œ state æ—¶å¾ˆå®¹æ˜“å¿˜è®°æ›´æ–°ã€‚Hooks æ¨åŠ¨ä½ åšæ­£ç¡®çš„äº‹æƒ…â€”â€”ä½†æ˜¯å¦‚æœä½ ä¸ä¹ æƒ¯äºè¿™æ ·åšï¼Œå®ƒä¼šéœ€è¦ä¸€äº›å¿ƒç†è°ƒæ•´ã€‚</p>
<hr>
<h2 id="åŸåˆ™-2ï¼šæ—¶åˆ»å‡†å¤‡æ¸²æŸ“"><a href="#%E5%8E%9F%E5%88%99-2%EF%BC%9A%E6%97%B6%E5%88%BB%E5%87%86%E5%A4%87%E6%B8%B2%E6%9F%93" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>åŸåˆ™ 2ï¼šæ—¶åˆ»å‡†å¤‡æ¸²æŸ“</h2>
<p>React ç»„ä»¶ä½¿ä½ å¯ä»¥ä¸ç”¨èŠ±å¤ªé•¿æ—¶é—´å°±èƒ½ç¼–å†™æ¸²æŸ“ä»£ç ã€‚ä½ æè¿°äº†åœ¨ä»»ä½•æ—¶åˆ» UI <em>åº”è¯¥</em> å¦‚ä½•ï¼Œæ¥ç€ React å»å®Œæˆã€‚å¥½å¥½åˆ©ç”¨é‚£ä¸ªæ¨¡å‹ï¼</p>
<p>ä¸è¦è¯•å›¾åœ¨ç»„ä»¶è¡Œä¸ºä¸­ï¼Œå‡è®¾ä»»ä½•ä¸å¿…è¦çš„æ—¶åºä¿¡æ¯ã€‚<strong>ä½ çš„ç»„ä»¶åº”è¯¥éšæ—¶å¯ä»¥é‡æ–°æ¸²æŸ“ã€‚</strong></p>
<p>è¿èƒŒè¿™ä¸ªåŸåˆ™çš„æ–¹å¼æ˜¯ä»€ä¹ˆæ ·çš„ï¼ŸReact è®©è¿™æ²¡é‚£ä¹ˆå®¹æ˜“å‘ç”Ÿâ€”â€”ä½†ä½ å¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„<code class="language-text">componentWillReceiveProps</code> ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ¥å®ç°å®ƒï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">TextInput</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token comment">// ğŸ”´ æ¯æ¬¡çˆ¶èŠ‚ç‚¹æ¸²æŸ“æ—¶é‡ç½®æœ¬åœ°çŠ¶æ€</span></span><span class="gatsby-highlight-code-line">  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token punctuation">:</span> nextProps<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">}</span></span>
        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span>
      <span class="token punctuation">/></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°† <code class="language-text">value</code> æ”¾åœ¨ state é‡Œï¼Œä½†æˆ‘ä»¬ <em>ä¹Ÿ</em> ä» props æ¥æ”¶ <code class="language-text">value</code>ã€‚æ¯å½“æˆ‘ä»¬ â€œæ¥æ”¶æ–° propsâ€ æ—¶ï¼Œå°±ä¼šé‡ç½®çŠ¶æ€ä¸­çš„ <code class="language-text">value</code>ã€‚</p>
<p><strong>è¿™ç§æ¨¡å¼çš„é—®é¢˜åœ¨äºå®ƒå®Œå…¨ä¾èµ–äºå¶ç„¶çš„æ—¶é—´ã€‚</strong></p>
<p>ä¹Ÿè®¸ä»Šå¤©è¿™ä¸ªç»„ä»¶çš„çˆ¶çº§å¾ˆå°‘æ›´æ–°ï¼Œæˆ‘ä»¬çš„ <code class="language-text">TextInput</code> ä»…åœ¨é‡è¦äº‹ä»¶å‘ç”Ÿæ—¶ â€œæ¥æ”¶ propsâ€ï¼Œæ¯”å¦‚ä¿å­˜è¡¨å•ã€‚</p>
<p>ä½†æ˜å¤©ä½ å¯èƒ½ä¼šå‘ <code class="language-text">TextInput</code> çš„çˆ¶ç»„ä»¶åŠ ä¸€äº›åŠ¨ç”»ã€‚å¦‚æœçˆ¶ç»„ä»¶ç»å¸¸é‡æ¸²æŸ“ï¼Œå®ƒå°† <a href="https://codesandbox.io/s/m3w9zn1z8x" target="_blank" rel="nofollow noopener noreferrer">â€œæ±¡æŸ“â€</a> å­ç»„ä»¶çš„çŠ¶æ€ï¼ä½ å¯ä»¥åœ¨ <a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html" target="_blank" rel="nofollow noopener noreferrer">â€œä½ å¯èƒ½ä¸éœ€è¦æ´¾ç”ŸçŠ¶æ€â€</a> ä¸­é˜…è¯»æœ‰å…³æ­¤é—®é¢˜çš„æ›´å¤šä¿¡æ¯ã€‚</p>
<p><strong>æ‰€ä»¥è¯¥æ€ä¹ˆä¿®å¤å‘¢ï¼Ÿ</strong></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¾—è°ƒæ•´ä¸€ä¸‹å¿ƒç†ï¼Œéœ€è¦åœæ­¢å°† â€œæ¥æ”¶ propsâ€ è§†ä¸ºä¸ â€œæ¸²æŸ“â€ ä¸åŒçš„ä¸œè¥¿ã€‚ ç”±çˆ¶ç»„ä»¶å¼•èµ·çš„é‡æ¸²æŸ“ä¸åº”ä¸ç”±æœ¬åœ°çŠ¶æ€æ›´æ”¹å¼•èµ·çš„é‡æ¸²æŸ“ä¸åŒã€‚<strong>ç»„ä»¶åº”è¯¥å…·æœ‰å¼¹æ€§ï¼Œèƒ½é€‚åº”æ›´å°‘æˆ–æ›´é¢‘ç¹åœ°æ¸²æŸ“ï¼Œå¦åˆ™å®ƒä»¬ä¸ç‰¹å®šçˆ¶ç»„ä»¶å­˜åœ¨è¿‡å¤šè€¦åˆã€‚</strong></p>
<p><em>(<a href="https://codesandbox.io/s/m3w9zn1z8x" target="_blank" rel="nofollow noopener noreferrer">è¿™ä¸ª demo</a> ç»™æˆ‘ä»¬å±•ç¤ºäº†é‡æ¸²æŸ“ä¼šå¦‚ä½•æ¯åè„†å¼±çš„ç»„ä»¶)</em></p>
<p>å½“ä½ çœŸæ­£æƒ³ä» props æ´¾ç”Ÿ state æ—¶ï¼Œå°½ç®¡æœ‰ä¸€äº›<a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#preferred-solutions" target="_blank" rel="nofollow noopener noreferrer">ä¸åŒ</a>çš„<a href="https://reactjs.org/docs/hooks-faq.html#how-do-i-implement-getderivedstatefromprops" target="_blank" rel="nofollow noopener noreferrer">è§£å†³æ–¹æ¡ˆ</a>ï¼Œé€šå¸¸ä½ åº”è¯¥ä½¿ç”¨ä¸€ä¸ªå®Œå…¨å—æ§åˆ¶çš„ç»„ä»¶ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Option 1: Fully controlled component.</span>
<span class="token keyword">function</span> <span class="token function">TextInput</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
      <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span>
      <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span></span>
    <span class="token punctuation">/></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æˆ–è€…ä½¿ç”¨ä¸€ä¸ªä¸å—æ§çš„ç»„ä»¶ï¼ŒåŠ ä¸Š key æ¥é‡ç½®å®ƒï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Option 2: Fully uncontrolled component.</span>
<span class="token keyword">function</span> <span class="token function">TextInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
      <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span>
      <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>e <span class="token operator">=></span> <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">/></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä¹‹åæˆ‘ä»¬èƒ½é€šè¿‡æ›´æ”¹ key æ¥é‡ç½®å†…éƒ¨ stateï¼š</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextInput</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>formId<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span></code></pre></div>
<p>æœ¬èŠ‚çš„å†…å®¹æ˜¯ï¼Œç»„ä»¶ä¸åº”è¯¥å› ä¸ºå®ƒæˆ–å…¶çˆ¶ç»„ä»¶é¢‘ç¹åœ°é‡æ¸²æŸ“è€Œåæ‰ã€‚å¦‚æœæƒ³é¿å…ä½¿ç”¨ä¼ ç»Ÿçš„ <code class="language-text">componentWillReceiveProps</code> ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ŒReact API çš„è®¾è®¡ï¼Œå¯ä»¥è½»æ¾å®ç°è¿™ä¸ªç›®çš„ã€‚</p>
<p>è¦å¯¹ä½ çš„ç»„ä»¶è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œå¯ä»¥å°†è¿™æ®µä»£ç ä¸´æ—¶æ·»åŠ åˆ°å®ƒçš„çˆ¶ç»„ä»¶ï¼š</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token comment">// ä¹‹ååˆ«å¿˜äº†åˆ é™¤è¿™è¡Œï¼</span></span>  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>å¯åˆ«æŠŠè¿™æ®µä»£ç ä¿ç•™åœ¨é¡¹ç›®é‡Œ</strong>â€”â€”è¿™åªæ˜¯ç”¨æ¥æ£€æŸ¥çˆ¶ç»„ä»¶é‡æ¸²æŸ“çš„é¢‘ç‡è¶…å‡ºé¢„æœŸæ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆçš„å¿«é€Ÿæ–¹æ³•ã€‚å®ƒä¸åº”è¯¥æŸåå­ç»„ä»¶ï¼</p>
<hr>
<p>ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œé‚£æˆ‘åœ¨ props æ”¹å˜æ—¶é‡ç½® stateï¼Œå†ä½¿ç”¨ <code class="language-text">PureComponent</code> æ¥é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“â€ã€‚</p>
<p>è¿™æ®µä»£ç åº”è¯¥èƒ½å·¥ä½œï¼Œå¯¹å§ï¼Ÿ</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token comment">// ğŸ¤” åº”è¯¥é˜»æ­¢ä¸å¿…è¦çš„é‡æ¸²æŸ“... å¯¹å§?</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">class</span> <span class="token class-name">TextInput</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span></span>  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// ğŸ”´ åœ¨çˆ¶ç»„ä»¶æ›´æ–°æ—¶é‡ç½®æœ¬åœ° state</span>
  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token punctuation">:</span> nextProps<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">}</span></span>
        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span>
      <span class="token punctuation">/></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä¹ä¸€çœ‹ï¼Œè¿™ä¸ªç»„ä»¶ä¼¼ä¹è§£å†³äº†çˆ¶çº§é‡æ¸²æŸ“æ—¶ â€œæ±¡æŸ“â€ state çš„é—®é¢˜ã€‚æ¯•ç«Ÿï¼Œå¦‚æœ props æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬ä¼šè·³è¿‡æ›´æ–°â€”â€”æ‰€ä»¥ <code class="language-text">componentWillReceiveProps</code> ä¸ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>ä½†æ˜¯è¿™éƒ½æ˜¯å¹»è§‰ã€‚<strong>è¿™ä¸ªç»„ä»¶å¯¹<em>å®é™…</em>çš„ prop æ›´æ”¹ä»ç„¶ä¸å…·å¤‡å¼¹æ€§ã€‚</strong>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æ·»åŠ <em>å¦ä¸€ä¸ª</em>ç»å¸¸å˜åŒ–çš„ propï¼Œå°±åƒç”¨æ¥åšåŠ¨ç”»çš„ <code class="language-text">style</code>ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¼š â€œä¸¢å¤±â€ å†…éƒ¨çŠ¶æ€ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextInput</span>
<span class="gatsby-highlight-code-line">  <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>opacity<span class="token punctuation">:</span> someValueFromState<span class="token punctuation">}</span><span class="token punctuation">}</span></span></span>  <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
    <span class="token comment">// ğŸ”´ componentWillReceiveProps in TextInput</span>
    <span class="token comment">// resets to this value on every animation tick.</span>
    value
  <span class="token punctuation">}</span></span>
<span class="token punctuation">/></span></span></code></pre></div>
<p>æ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä»ç„¶å­˜åœ¨ç¼ºé™·ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å„ç§ä¼˜åŒ–ï¼Œä¾‹å¦‚ <code class="language-text">PureComponent</code>ã€<code class="language-text">shouldComponentUpdate</code> å’Œ <code class="language-text">React.memo</code>ï¼Œå®ƒä»¬ä¸åº”è¯¥ç”¨äºæ§åˆ¶<em>è¡Œä¸º</em>ã€‚åªæœ‰æé«˜<em>æ€§èƒ½</em>çš„åœºæ™¯ä¸‹ï¼Œå»ä½¿ç”¨å®ƒä»¬ã€‚å¦‚æœåˆ é™¤ä¼˜åŒ–å°±ä¼š<em>ç ´å</em>æŸä¸ªç»„ä»¶ï¼Œé‚£ä¹ˆå®ƒå°±å¤ªè„†å¼±äº†ã€‚</p>
<p>è¿™é‡Œçš„è§£å†³æ–¹æ¡ˆå’Œä¹‹å‰æåˆ°çš„ä¸€æ ·ã€‚ä¸è¦å°† â€œæ¥å— propsâ€ è§†ä½œç‰¹æ®Šçš„äº‹ä»¶ã€‚é¿å… â€œåŒæ­¥â€ props å’Œ stateã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå€¼éƒ½åº”è¯¥æ˜¯å®Œå…¨æ§åˆ¶çš„ï¼ˆé€šè¿‡ propsï¼‰ï¼Œæˆ–è€…å®Œå…¨ä¸å—æ§åˆ¶çš„ï¼ˆåœ¨æœ¬åœ° state é‡Œï¼‰ã€‚å¯ä»¥çš„è¯ï¼Œé¿å…<a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#preferred-solutions" target="_blank" rel="nofollow noopener noreferrer">æ´¾ç”Ÿ state</a>ã€‚<strong>å½“ç„¶ï¼Œæ—¶åˆ»å‡†å¤‡æ¸²æŸ“ï¼</strong></p>
<hr>
<h2 id="åŸåˆ™-3ï¼šæ²¡æœ‰å•ä¾‹ç»„ä»¶"><a href="#%E5%8E%9F%E5%88%99-3%EF%BC%9A%E6%B2%A1%E6%9C%89%E5%8D%95%E4%BE%8B%E7%BB%84%E4%BB%B6" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>åŸåˆ™ 3ï¼šæ²¡æœ‰å•ä¾‹ç»„ä»¶</h2>
<p>æœ‰æ—¶æˆ‘ä»¬å‡è®¾æŸä¸ªç»„ä»¶åªä¼šæ˜¾ç¤ºä¸€æ¬¡ï¼Œå¦‚å¯¼èˆªæ ã€‚åœ¨ä¸€æ®µæ—¶é—´å†…è¿™ä¹Ÿè®¸æ˜¯å¯¹çš„ï¼Œç„¶è€Œï¼Œè¿™ç§å‡è®¾å¯¼è‡´çš„è®¾è®¡é—®é¢˜ï¼Œå¸¸å¸¸ä¼šåœ¨åæœŸæ˜¾ç°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä½ å¯èƒ½éœ€è¦åœ¨è·¯ç”±å˜åŒ–åï¼Œä¸¤ä¸ª <code class="language-text">Page</code> ç»„ä»¶åˆ‡æ¢<em>é—´</em>å®ç°åŠ¨ç”»â€”â€”å‰ä¸€ä¸ª <code class="language-text">Page</code> å’Œä¸‹ä¸€ä¸ª <code class="language-text">Page</code>ã€‚å®ƒä»¬éƒ½éœ€è¦åœ¨åŠ¨ç”»æœŸé—´è¢«åŠ è½½ã€‚ä½†æ˜¯ï¼Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œæ¯ä¸ªç»„ä»¶éƒ½å‡å®šå®ƒæ˜¯å±å¹•ä¸Šå”¯ä¸€çš„ <code class="language-text">Page</code>ã€‚</p>
<p>è¦é‡ç°è¿™ç±»é—®é¢˜ä¹Ÿå¾ˆå®¹æ˜“ï¼Œè¯•è¯•æ¸²æŸ“ä½ çš„åº”ç”¨ä¸¤æ¬¡ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyApp</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyApp</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>åˆ°å¤„ç‚¹å‡»çœ‹çœ‹ã€‚ï¼ˆä½ å¯èƒ½éœ€è¦ä¸ºè¿™ä¸ªå®éªŒè°ƒæ•´ä¸€äº› CSS æ ·å¼ï¼‰</p>
<p><strong>ä½ çš„åº”ç”¨ä»ç„¶æ­£å¸¸è¿è¡Œå—ï¼Ÿ</strong>æˆ–è€…ä½ æ˜¯å¦çœ‹åˆ°å¥‡æ€ªçš„å´©æºƒå’Œé”™è¯¯ï¼Ÿå¶å°”å¯¹å¤æ‚ç»„ä»¶è¿›è¡Œå‹åŠ›æµ‹è¯•æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå¯ä»¥ç¡®ä¿ç»„ä»¶å­˜åœ¨å¤šä¸ªæ‹·è´æ—¶ä¸ä¼šç›¸äº’å†²çªã€‚</p>
<p>æˆ‘è‡ªå·±å†™è¿‡å‡ æ¬¡æœ‰é—®é¢˜çš„ä»£ç ï¼Œä¾‹å¦‚åœ¨ <code class="language-text">componentWillUnmount</code> ä¸­æ‰§è¡Œå…¨å±€çŠ¶æ€ â€œæ¸…ç†â€ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token comment">// é‡ç½® Redux store é‡Œçš„ä¸€äº›ä¸œè¥¿</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">resetForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">}</span></code></pre></div>
<p>å½“ç„¶ï¼Œå¦‚æœé¡µé¢ä¸Šæœ‰ä¸¤ä¸ªè¿™æ ·çš„ç»„ä»¶ï¼Œå¸è½½å…¶ä¸­ä¸€ä¸ªç»„ä»¶å¯èƒ½ä¼šç ´åå¦ä¸€ä¸ªç»„ä»¶ã€‚åœ¨ <em>mount</em> åé‡ç½® â€œå…¨å±€â€ çŠ¶æ€ä¹Ÿä¸å¥½ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token comment">// é‡ç½® Redux store é‡Œçš„ä¸€äº›ä¸œè¥¿</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">resetForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">}</span></code></pre></div>
<p>åœ¨è¿™æƒ…å†µä¸‹ï¼Œ <em>æŒ‚è½½</em> ç¬¬äºŒä¸ª form å°±ä¼šç ´åå‰ä¸€ä¸ªã€‚</p>
<p>è¿™äº›æ¨¡å¼æ˜¯æ£€æµ‹ç»„ä»¶æ˜¯å¦è„†å¼±çš„å¥½æŒ‡æ ‡ã€‚<strong><em>æ˜¾ç¤º</em> æˆ– <em>éšè—</em> ä¸€é¢—æ ‘ï¼Œä¸åº”è¯¥ç ´åæ ‘ä¹‹å¤–çš„ç»„ä»¶ã€‚</strong></p>
<p>æ— è®ºä½ æ˜¯å¦æœ‰è®¡åˆ’å°†è¿™ä¸ªç»„ä»¶æ¸²æŸ“ä¸¤æ¬¡ï¼Œä»é•¿è¿œæ¥çœ‹ï¼Œè§£å†³è¿™äº›é—®é¢˜æ˜¯å€¼å¾—çš„ã€‚å®ƒå°†å¼•å¯¼ä½ è¿›è¡Œæ›´å…·å¼¹æ€§çš„è®¾è®¡ã€‚</p>
<hr>
<h2 id="åŸåˆ™-4ï¼šéš”ç¦»æœ¬åœ°çŠ¶æ€"><a href="#%E5%8E%9F%E5%88%99-4%EF%BC%9A%E9%9A%94%E7%A6%BB%E6%9C%AC%E5%9C%B0%E7%8A%B6%E6%80%81" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>åŸåˆ™ 4ï¼šéš”ç¦»æœ¬åœ°çŠ¶æ€</h2>
<p>å‡è®¾æœ‰ä¸€ä¸ª <code class="language-text">POST</code> ç¤¾äº¤ç»„ä»¶ï¼Œå®ƒæœ‰ä¸€ä¸ª <code class="language-text">Comment</code> åˆ—è¡¨ï¼ˆå¯æ‰©å±•ï¼‰å’Œä¸€ä¸ª <code class="language-text">NewComment</code> è¾“å…¥æ¡†ã€‚</p>
<p>React ç»„ä»¶å¯èƒ½æœ‰æœ¬åœ°çŠ¶æ€ã€‚ä½†æ˜¯å“ªä¸ªçŠ¶æ€çœŸçš„æ˜¯è‡ªå·±çš„å‘¢ï¼Ÿå¸–å­å†…å®¹æœ¬èº«æ˜¯å¦ä¸ºæœ¬åœ°çŠ¶æ€ï¼Ÿè¯„è®ºåˆ—è¡¨å‘¢ï¼Ÿæˆ–è€…è¯„è®ºæµçš„è®°å½•ï¼Ÿæˆ–è¯„è®ºæ¡†é‡Œè¾“å…¥çš„å€¼ï¼Ÿ</p>
<p>å¦‚æœä½ ä¹ æƒ¯äºå°†æ‰€æœ‰å†…å®¹éƒ½æ”¾å…¥ â€œçŠ¶æ€ç®¡ç†â€ï¼Œé‚£ä¹ˆå¯èƒ½å¾ˆéš¾å›ç­”è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥è¿™æœ‰ä¸€ä¸ªç®€å•çš„å†³å®šæ–¹å¼ã€‚</p>
<p><strong>å¦‚æœä½ ä¸ç¡®å®šæŸä¸ªçŠ¶æ€æ˜¯å¦å±äºæœ¬åœ°ï¼Œè¯·é—®è‡ªå·±ï¼šâ€œå¦‚æœæ­¤ç»„ä»¶å‘ˆç°ä¸¤æ¬¡ï¼Œäº¤äº’æ˜¯å¦åº”åæ˜ åœ¨å¦ä¸€ä¸ªå‰¯æœ¬ä¸­ï¼Ÿâ€ åªè¦ç­”æ¡ˆä¸ºâ€œå¦â€ï¼Œé‚£ä½ å°±æ‰¾åˆ°æœ¬åœ°çŠ¶æ€äº†ã€‚</strong></p>
<p>For example, imagine we rendered the same <code class="language-text">Post</code> twice. Letâ€™s look at different things inside of it that can change.
ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬ä¸¤æ¬¡æ¸²æŸ“ç›¸åŒçš„ <code class="language-text">Post</code>ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å“ªäº›å†…å®¹ä¼šæ›´æ–°ã€‚</p>
<ul>
<li>
<p><em>å‘å¸ƒå†…å®¹</em> ï¼šæˆ‘ä»¬å¸Œæœ›åœ¨ä¸€æ£µæ ‘ä¸­ç¼–è¾‘å¸–å­ï¼Œåœ¨å¦ä¸€æ£µæ ‘ä¸­ä¹Ÿæ›´æ–°ã€‚å› æ­¤ï¼Œå®ƒå¯èƒ½<strong>ä¸æ˜¯</strong> <code class="language-text">Post</code> ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ã€‚ï¼ˆç›¸åï¼Œå¸–å­å†…å®¹å¯èƒ½å­˜åœ¨äº Apolloã€Relay æˆ– Reduxç­‰ç¼“å­˜ä¸­ï¼‰</p>
</li>
<li>
<p><em>è¯„è®ºåˆ—è¡¨</em> ï¼šè¿™ä¸å¸–å­å†…å®¹ç±»ä¼¼ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨ä¸€æ£µæ ‘ä¸­æ·»åŠ ä¸€æ¡æ–°æ³¨é‡Šï¼Œä»¥åæ˜ åœ¨å¦ä¸€æ£µæ ‘ä¸­ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šä¸ºå®ƒä½¿ç”¨æŸç§ç¼“å­˜ï¼Œè€Œ <strong>ä¸åº”è¯¥æ˜¯</strong> æˆ‘ä»¬ <code class="language-text">Post</code> çš„æœ¬åœ°çŠ¶æ€ã€‚</p>
</li>
<li>
<p><em>è¢«å±•å¼€çš„è¯„è®º</em>ï¼šå¦‚æœåœ¨ä¸€æ£µæ ‘ä¸­å±•å¼€è¯„è®ºä¹Ÿä¼šåœ¨å¦ä¸€æ£µæ ‘ä¸­å±•å¼€ï¼Œè¿™æœ‰ç‚¹å¥‡æ€ªã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ç‰¹å®šçš„ <code class="language-text">Comment</code> <em>UI å…ƒç´ </em> è¿›è¡Œäº¤äº’ï¼Œè€Œä¸æ˜¯æŠ½è±¡çš„ â€œè¯„è®ºå®ä½“â€ã€‚å› æ­¤ï¼Œâ€œæ˜¯å¦å·²å±•å¼€â€ <strong>åº”è¯¥</strong> æ˜¯ <code class="language-text">Comment</code> çš„æœ¬åœ°çŠ¶æ€ã€‚</p>
</li>
<li>
<p><em>è¾“å…¥çš„æ–°è¯„è®ºçš„å€¼</em>ï¼šå¦‚æœåœ¨ä¸€ä¸ªè¾“å…¥æ¡†ä¸­è¾“å…¥è¯„è®ºï¼Œä¹Ÿä¼šæ›´æ–°åˆ°å¦ä¸€ä¸ªæ ‘ä¸­çš„è¾“å…¥æ¡†ï¼Œè¿™ä¹Ÿæœ‰ç‚¹å¥‡æ€ªã€‚é™¤éè¾“å…¥æ¡†æ˜ç¡®åœ°ç»„åˆåœ¨ä¸€èµ·ï¼Œå¦åˆ™é€šå¸¸äººä»¬æœŸæœ›å®ƒä»¬æ˜¯ç‹¬ç«‹çš„ã€‚æ‰€ä»¥è¾“å…¥å€¼ <strong>åº”è¯¥</strong> æ˜¯ <code class="language-text">NewComment</code> ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ã€‚</p>
</li>
</ul>
<p>æˆ‘ä¸å»ºè®®å¯¹è¿™äº›è§„åˆ™è¿›è¡Œæ•™æ¡å¼çš„è§£é‡Šã€‚å½“ç„¶ï¼Œåœ¨ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨æœ¬åœ°çŠ¶æ€æ¥å¤„ç†æ‰€æœ‰äº‹æƒ…ï¼ŒåŒ…æ‹¬ â€œç¼“å­˜â€ã€‚æˆ‘åªæ˜¯è°ˆè®ºåœ¨<a href="/Blog/the-elements-of-ui-engineering/">ç¬¬ä¸€åŸåˆ™</a>ä¸‹ï¼Œç†æƒ³çŠ¶æ€çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p><strong>åˆ«æŠŠè¯¥æœ¬åœ°çš„çŠ¶æ€å…¨å±€åŒ–äº†</strong> è¿™æ¶‰åŠåˆ°æˆ‘ä»¬çš„ â€œå¼¹æ€§â€ ä¸»é¢˜ï¼šç»„ä»¶ä¹‹é—´å‘ç”Ÿçš„æ„å¤–åŒæ­¥æ›´å°‘ã€‚ä½œä¸ºå¥–åŠ±ï¼Œè¿™<em>ä¹Ÿ</em>ä¿®å¤äº†ä¸€å¤§ç±»æ€§èƒ½é—®é¢˜ã€‚å½“ä½ çš„ state åœ¨æ­£ç¡®çš„åœ°æ–¹æ—¶ï¼Œâ€œè¿‡åº¦æ¸²æŸ“â€ éƒ½ä¸æˆé—®é¢˜äº†ã€‚</p>
<hr>
<h2 id="å›é¡¾"><a href="#%E5%9B%9E%E9%A1%BE" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å›é¡¾</h2>
<p>è®©æˆ‘ä»¬å†ä¸€æ¬¡å›é¡¾ä¸€ä¸‹è¿™äº›åŸåˆ™ï¼š</p>
<ol>
<li><strong><a href="#%E5%8E%9F%E5%88%99-1%EF%BC%9A%E4%B8%8D%E9%98%BB%E6%96%AD%E6%95%B0%E6%8D%AE%E6%B5%81">ä¸é˜»æ–­æ•°æ®æµ</a></strong> props å’Œ state å¯èƒ½ä¼šæ›´æ–°ï¼Œç»„ä»¶åº”è¯¥å¤„ç†å¥½è¿™äº›æ›´æ–°ï¼Œä¸è®ºä»€ä¹ˆæ—¶å€™ã€‚</li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-2%EF%BC%9A%E6%97%B6%E5%88%BB%E5%87%86%E5%A4%87%E6%B8%B2%E6%9F%93">æ—¶åˆ»å‡†å¤‡æ¸²æŸ“</a></strong> ä¸€ä¸ªç»„ä»¶ä¸åº”è¯¥è¢«æˆ–å¤šæˆ–å°‘çš„æ¸²æŸ“è€ŒæŸåã€‚</li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-3%EF%BC%9A%E6%B2%A1%E6%9C%89%E5%8D%95%E4%BE%8B%E7%BB%84%E4%BB%B6">æ²¡æœ‰å•ä¾‹ç»„ä»¶</a></strong> å³ä½¿ç»„ä»¶åªæ¸²æŸ“ä¸€æ¬¡ï¼Œä½†é€šè¿‡è®¾è®¡è®©å®ƒæ¸²æŸ“ä¸¤æ¬¡ä¹Ÿä¸ä¼šè¢«ç ´åï¼Œæ˜¯æ›´å¥½äº†ã€‚</li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-4%EF%BC%9A%E9%9A%94%E7%A6%BB%E6%9C%AC%E5%9C%B0%E7%8A%B6%E6%80%81">éš”ç¦»æœ¬åœ°çŠ¶æ€</a></strong> æƒ³æƒ³å“ªä¸ªçŠ¶æ€æ˜¯ç‰¹å®š UI å±•ç¤ºä¸‹çš„æœ¬åœ°çŠ¶æ€â€”â€”å¹¶ä¸”é™¤éå¿…è¦ï¼Œä¸è¦å°†è¯¥çŠ¶æ€æå‡åˆ°æ›´é«˜çš„åœ°æ–¹ã€‚</li>
</ol>
<p><strong>è¿™äº›åŸåˆ™èƒ½å¸®åŠ©ä½ ç¼–å†™<a href="/Blog/optimized-for-change/">é’ˆå¯¹æ›´æ–°è€Œä¼˜åŒ–</a>çš„ç»„ä»¶ã€‚è¿™è®©æ·»åŠ ï¼Œæ›´æ”¹å’Œåˆ é™¤é‚£äº›ç»„ä»¶æ›´å®¹æ˜“ã€‚</strong></p>
<p>é‡è¦çš„æ˜¯ï¼Œä¸€æ—¦æˆ‘ä»¬çš„ç»„ä»¶å…·æœ‰äº†å¼¹æ€§ï¼Œé‚£å°±å¯ä»¥å†å›è¿‡å¤´ï¼Œåˆ°æ˜¯å¦åº”æŒ‰å­—æ¯æ’åºçš„ç´§è¿«å›°å¢ƒä¸­å»äº†ã€‚</p></div><footer><p><a href="https://mobile.twitter.com/search?q=https%3A%2F%2Fyusufunlu.github.io%2Fblog%2F%2Fwriting-resilient-components%2F" target="_blank" rel="noopener noreferrer">Discuss on Twitter</a> â€¢ <a href="https://github.com/yusufunlu/Blog/edit/master/src/pages/writing-resilient-components/index.zh-hans.md" target="_blank" rel="noopener noreferrer">Edit on GitHub</a></p></footer></article></main><aside><div style="margin:90px 0 40px 0;font-family:system-ui, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
    &quot;Roboto&quot;, &quot;Oxygen&quot;, &quot;Ubuntu&quot;, &quot;Cantarell&quot;, &quot;Fira Sans&quot;,
    &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif"><form action="https://app.convertkit.com/forms/812047/subscriptions" class="seva-form formkit-form" method="post" min-width="400 500 600 700 800" style="background-color:rgb(255, 255, 255);border-radius:6px"><div data-style="full"><div data-element="column" class="formkit-column" style="background-color:rgb(249, 250, 251)"><h1 class="formkit-header" data-element="header" style="color:rgb(77, 77, 77);font-size:20px;font-weight:700">Join the Newsletter</h1><div data-element="subheader" class="formkit-subheader" style="color:rgb(104, 104, 104)"><p>Subscribe to get my latest content by email.</p></div><div class="formkit-image"><svg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 46 46" style="max-width:100%"><g fill="none" fill-rule="evenodd"><path fill="#DD92AB" d="M23,36 C22.813,36 22.627,35.948 22.463,35.844 L0.463,21.844 C0.159,21.651 -0.017,21.308 0.001,20.948 C0.02,20.589 0.23,20.266 0.553,20.105 L23,6 L45.447,20.105 C45.769,20.266 45.98,20.588 45.999,20.948 C46.018,21.308 45.841,21.65 45.537,21.844 L23.537,35.844 C23.373,35.948 23.187,36 23,36 Z"></path><path fill="#FFF" d="M38,37 L8,37 L8,1 C8,0.448 8.448,0 9,0 L37,0 C37.552,0 38,0.448 38,1 L38,37 Z"></path><path fill="#FFA7C4" d="M45,46 C44.916,46 44.831,45.989 44.748,45.968 L21.748,39.968 L22,33 L46,21 L46,45 C46,45.31 45.856,45.602 45.611,45.792 C45.435,45.928 45.219,46 45,46 Z"></path><path fill="#FFC3D7" d="M45,46 L1,46 C0.447,46 0,45.552 0,45 L0,21 L45.479,44.122 C45.88,44.341 46.083,44.804 45.969,45.247 C45.856,45.69 45.457,46 45,46 Z"></path><path fill="#FFA7C4" d="M19 20.414L14.293 15.707C13.902 15.316 13.902 14.684 14.293 14.293L19 9.586 20.414 11 16.414 15 20.414 19 19 20.414zM27 20.414L25.586 19 29.586 15 25.586 11 27 9.586 31.707 14.293C32.098 14.684 32.098 15.316 31.707 15.707L27 20.414z"></path></g></svg></div></div><div data-element="column" class="formkit-column"><ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul><div data-element="fields" class="seva-fields formkit-fields"><div class="formkit-field"><input type="text" class="formkit-input" aria-label="Your first name" name="fields[first_name]" placeholder="Your first name" style="border-color:rgb(227, 227, 227);border-radius:4px;color:rgb(0, 0, 0);font-weight:400"/></div><div class="formkit-field"><input type="email" class="formkit-input" name="email_address" aria-label="Your email address" placeholder="Your email address" style="border-color:rgb(227, 227, 227);border-radius:4px;color:rgb(0, 0, 0);font-weight:400"/></div><button data-element="submit" class="formkit-submit formkit-submit" style="background-color:hsl(340, 63%, 55%);border-radius:24px;color:white;font-weight:700"><div class="formkit-spinner"></div><span>Subscribe</span></button></div><div data-element="guarantee" class="formkit-guarantee" style="color:rgb(77, 77, 77);font-size:13px;font-weight:400"><p>I wonâ€™t send you spam.</p><p>Unsubscribe at <em>any</em> time.</p></div></div></div></form></div><h3 style="font-family:Montserrat, sans-serif;margin-top:0.4375rem"><a style="box-shadow:none;text-decoration:none;color:var(--pink)" href="/Blog/">Overreacted</a></h3><div style="display:flex;margin-bottom:3.5rem"><img src="/Blog/static/profile-pic-69c77131fd248a7aaaf26fab021f469f.png" alt="Yusuf Unlu" style="margin-right:0.875rem;margin-bottom:0;height:3.5rem;border-radius:50%"/><p style="max-width:310px">Personal blog by <a href="https://twitter.com/yufusunlu">Yusuf Unlu</a>.<!-- --> <!-- -->IÂ explain with words and code.</p></div><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li></li><li></li></ul></nav></aside></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-130227707-1', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"zh-hans-writing-resilient-components-65b","path":"/zh-hans/writing-resilient-components/"};window.dataPath="445/path---zh-hans-writing-resilient-components-65-b-c24-956umHag7kcK9bGqFRQryzpHL0c";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-34cbd8f5387764ab7c9b.js"],"component---src-templates-blog-index-js":["/component---src-templates-blog-index-js-e695f4291be285845b86.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.4bdd783f220516bbb519.css","/component---src-templates-blog-post-js-982b770947b8f057294a.js"],"component---src-pages-404-js":["/component---src-pages-404-js.001dcda4a354c1ee7b89.css","/component---src-pages-404-js-fd505449866731f3f537.js"],"component---src-pages-confirm-js":["/component---src-pages-confirm-js.001dcda4a354c1ee7b89.css","/component---src-pages-confirm-js-3413fd13b05068b9d878.js"],"component---src-pages-thanks-js":["/component---src-pages-thanks-js.001dcda4a354c1ee7b89.css","/component---src-pages-thanks-js-cc0b44732da024e03fd8.js"],"pages-manifest":["/pages-manifest-2c548d90a84793b4cf74.js"]};/*]]>*/</script><script src="/Blog/webpack-runtime-c5f23e2dfa285887902d.js" async=""></script><script src="/Blog/1-1b550cd61a5e170131aa.js" async=""></script><script src="/Blog/2-729ce5f39e8863375f6f.js" async=""></script><script src="/Blog/0-b197e8c6c7ff26484233.js" async=""></script><script src="/Blog/app-34cbd8f5387764ab7c9b.js" async=""></script><script src="/Blog/component---src-templates-blog-post-js-982b770947b8f057294a.js" async=""></script></body></html>