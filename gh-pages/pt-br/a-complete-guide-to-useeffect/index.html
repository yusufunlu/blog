<!DOCTYPE html><html lang="pt-br"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/2.4ac699a3d6a5be115d81.css">@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:url(/static/merriweather-400-l-8796b7875d52e9cb9b280211e8d3f82d.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:url(/static/montserrat-900-l-5751237264c0468be0d48ad1cea75b90.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}body{--pink:#ffa7c4;background-color:var(--bg)}body.light{--bg:#fff;--header:var(--pink);--textNormal:#222;--textTitle:#222;--textLink:#d23669;--hr:rgba(0,0,0,0.2);--inlineCode-bg:rgba(255,229,100,0.2);--inlineCode-text:#1a1a1a}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--textLink:var(--pink);--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:#373c49;--inlineCode-text:#e6e6e6}body:lang(ar) article,body:lang(fa) article{direction:rtl}body:lang(ar) .language-text,body:lang(ar) article .translations,body:lang(ar) article pre,body:lang(fa) .language-text,body:lang(fa) article .translations,body:lang(fa) article pre{direction:ltr}body:lang(ar) .language-text,body:lang(fa) .language-text{display:inline-block}body:lang(ar) blockquote,body:lang(fa) blockquote{border-left:unset;border-right:.32813rem solid rgba(0,0,0,.9);padding-right:1.42188rem;padding-left:unset;margin-left:.75rem;margin-right:-1.75rem}body:lang(fa) article,body:lang(fa) header>h1{font-family:Vazir}body:lang(ar) article,body:lang(ar) header>h1{font-family:Cairo,sans-serif}body:lang(ko) article,body:lang(ko) header{word-break:keep-all}code[class*=language-],pre[class*=language-]{color:#fff;background:none;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;-webkit-font-feature-settings:normal;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:var(--inlineCode-bg);color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;padding-right:1em;padding-left:1.25em;border-left:.25em solid #ffa7c4}.gatsby-highlight,.gatsby-highlight-code-line{margin-right:-1.3125rem;margin-left:-1.3125rem}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#011627;-webkit-overflow-scrolling:touch;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}.react-toggle{touch-action:pan-x;display:inline-block;position:relative;cursor:pointer;background-color:transparent;border:0;padding:0;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.react-toggle-screenreader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle-track{width:50px;height:24px;padding:0;border-radius:30px;background-color:#0f1114;transition:all .2s ease}.react-toggle-track-check{position:absolute;width:17px;height:17px;left:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0;opacity:0;transition:opacity .25s ease}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{position:absolute;width:17px;height:17px;right:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{position:absolute;top:1px;left:1px;width:22px;height:22px;border-radius:50%;background-color:#fafafa;box-sizing:border-box;transition:all .5s cubic-bezier(.23,1,.32,1) 0ms;-webkit-transform:translateX(0);transform:translateX(0)}.react-toggle--checked .react-toggle-thumb{-webkit-transform:translateX(26px);transform:translateX(26px);border-color:#19ab27}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #ffa7c4}.react-toggle:active .react-toggle-thumb{box-shadow:0 0 5px 5px #ffa7c4}</style><style data-href="/component---src-templates-blog-post-js.f3aea2f29a9b96501823.css">@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:url(/static/merriweather-400-i-l-9a3ea56a5f449980432ace5972181ef6.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:url(/static/merriweather-700-l-e24e02bb044cb07539a3a6bd12348d14.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:url(/static/merriweather-700-i-l-ad085ede31afcc5585ff34869b1cd029.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}.formkit-form *{box-sizing:border-box}.formkit-form legend{border:none;font-size:inherit;margin-bottom:10px;padding:0;position:relative;display:table}.formkit-form fieldset{border:0;padding:.01em 0 0;margin:0;min-width:0}.formkit-form body:not(:-moz-handler-blocked) fieldset{display:table-cell}.formkit-form p{color:inherit;font-size:inherit;font-weight:inherit}.formkit-form[data-format="slide in"],.formkit-form[data-format=modal]{display:none}.formkit-form .formkit-checkboxes,.formkit-form .formkit-input,.formkit-form .formkit-select{width:100%}.formkit-form .formkit-button,.formkit-form .formkit-submit{border:0;border-radius:5px;color:#fff;cursor:pointer;display:inline-block;text-align:center;font-size:15px;font-weight:500;margin-bottom:15px;overflow:hidden;padding:0;position:relative;vertical-align:middle}.formkit-form .formkit-button:focus,.formkit-form .formkit-button:hover,.formkit-form .formkit-submit:focus,.formkit-form .formkit-submit:hover{outline:none}.formkit-form .formkit-button:focus>span,.formkit-form .formkit-button:hover>span,.formkit-form .formkit-submit:focus>span,.formkit-form .formkit-submit:hover>span{background-color:#dc658d}.formkit-form .formkit-button>span,.formkit-form .formkit-submit>span{display:block;transition:all .3s ease-in-out;padding:12px 24px}.formkit-form .formkit-input{background:#fff;font-size:15px;padding:12px;border:1px solid #e3e3e3;flex:1 0 auto;line-height:1.4;margin:0;transition:border-color .3s ease-out}.formkit-form .formkit-input:focus{outline:none;border-color:#1677be;transition:border-color .3s ease}.formkit-form .formkit-input::-webkit-input-placeholder{color:#848585}.formkit-form .formkit-input:-ms-input-placeholder{color:#848585}.formkit-form .formkit-input::-ms-input-placeholder{color:#848585}.formkit-form .formkit-input::placeholder{color:#848585}.formkit-form [data-group=dropdown]{position:relative;display:inline-block;width:100%}.formkit-form [data-group=dropdown]:before{content:"";top:calc(50% - 2.5px);right:10px;position:absolute;pointer-events:none;border-color:#4f4f4f transparent transparent;border-style:solid;border-width:6px 6px 0;height:0;width:0;z-index:999}.formkit-form [data-group=dropdown] select{height:auto;width:100%;cursor:pointer;color:#333;line-height:1.4;margin-bottom:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:15px;padding:12px 25px 12px 12px;border:1px solid #e3e3e3;background:#fff}.formkit-form [data-group=dropdown] select:focus{outline:none}.formkit-form [data-group=checkboxes]{text-align:left;margin:0}.formkit-form [data-group=checkboxes] [data-group=checkbox]{margin-bottom:10px}.formkit-form [data-group=checkboxes] [data-group=checkbox] *{cursor:pointer}.formkit-form [data-group=checkboxes] [data-group=checkbox]:last-of-type{margin-bottom:0}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]{display:none}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]+label:after{content:none}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label:after{border-color:#fff;content:""}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label:before{background:#10bf7a;border-color:#10bf7a}.formkit-form [data-group=checkboxes] [data-group=checkbox] label{position:relative;display:inline-block;padding-left:28px}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:after,.formkit-form [data-group=checkboxes] [data-group=checkbox] label:before{position:absolute;content:"";display:inline-block}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:before{height:16px;width:16px;border:1px solid #e3e3e3;background:#fff;left:0;top:3px}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:after{height:4px;width:8px;border-left:2px solid #4d4d4d;border-bottom:2px solid #4d4d4d;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);left:4px;top:8px}.formkit-form .formkit-alert{background:#f9fafb;border:1px solid #e3e3e3;border-radius:5px;flex:1 0 auto;list-style:none;margin:25px auto;padding:12px;text-align:center;width:100%}.formkit-form .formkit-alert:empty{display:none}.formkit-form .formkit-alert-success{background:#d3fbeb;border-color:#10bf7a;color:#0c905c}.formkit-form .formkit-alert-error{background:#fde8e2;border-color:#f2643b;color:#ea4110}.formkit-form .formkit-spinner{display:flex;height:0;width:0;margin:0 auto;position:absolute;top:0;left:0;right:0;overflow:hidden;text-align:center;transition:all .3s ease-in-out}.formkit-form .formkit-spinner>div{margin:auto;width:12px;height:12px;background-color:#fff;opacity:.3;border-radius:100%;display:inline-block;-webkit-animation:formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd- 1.4s ease-in-out infinite both;animation:formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd- 1.4s ease-in-out infinite both}.formkit-form .formkit-spinner>div:first-child{-webkit-animation-delay:-.32s;animation-delay:-.32s}.formkit-form .formkit-spinner>div:nth-child(2){-webkit-animation-delay:-.16s;animation-delay:-.16s}.formkit-form .formkit-submit[data-active] .formkit-spinner{opacity:1;height:100%;width:50px}.formkit-form .formkit-submit[data-active] .formkit-spinner~span{opacity:0}@-webkit-keyframes formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd-{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd-{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.formkit-form{box-shadow:0 2px 15px 0 rgba(210,214,220,.5);max-width:700px;overflow:hidden}.formkit-form [data-style=full]{width:100%;display:block}.formkit-form .formkit-header{margin-top:0;margin-bottom:20px;font-family:inherit}.formkit-form .formkit-subheader{margin:15px 0}.formkit-form .formkit-column{background-size:cover;background-repeat:no-repeat;background-position:50%;padding:20px}.formkit-form .formkit-column:nth-child(2){border-top:1px solid #e9ecef}.formkit-form .formkit-field{margin:0 0 15px}.formkit-form .formkit-input,.formkit-form .formkit-submit{width:100%}.formkit-form .formkit-guarantee{font-size:13px;margin:0 0 15px}.formkit-form .formkit-guarantee>p{margin:0}.formkit-form .formkit-powered-by{color:#7d7d7d;display:block;font-size:12px;margin-bottom:0;text-align:center}.formkit-form .formkit-powered-by[data-active=false]{opacity:.5}.formkit-form[min-width~="600"] [data-style=full],.formkit-form[min-width~="700"] [data-style=full],.formkit-form[min-width~="800"] [data-style=full]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.formkit-form[min-width~="600"] .formkit-submit,.formkit-form[min-width~="700"] .formkit-submit,.formkit-form[min-width~="800"] .formkit-submit{width:auto}.formkit-form[min-width~="600"] .formkit-column,.formkit-form[min-width~="700"] .formkit-column,.formkit-form[min-width~="800"] .formkit-column{padding:40px}.formkit-form[min-width~="600"] .formkit-column:nth-child(2),.formkit-form[min-width~="700"] .formkit-column:nth-child(2),.formkit-form[min-width~="800"] .formkit-column:nth-child(2){border-top:none}</style><meta name="generator" content="Gatsby 2.0.91"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="Dan Abramov&#x27;s Overreacted Blog RSS Feed" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><title data-react-helmet="true">Um guia completo para useEffect ‚Äî Overreacted</title><meta data-react-helmet="true" name="theme-color" content="#282c35"/><meta data-react-helmet="true" name="description" content="Efeitos fazem parte do seu fluxo de dados."/><meta data-react-helmet="true" property="og:url" content="https://overreacted.io/pt-br/a-complete-guide-to-useeffect/"/><meta data-react-helmet="true" property="og:title" content="Um guia completo para useEffect"/><meta data-react-helmet="true" property="og:description" content="Efeitos fazem parte do seu fluxo de dados."/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@dan_abramov"/><meta data-react-helmet="true" name="twitter:title" content="Um guia completo para useEffect"/><meta data-react-helmet="true" name="twitter:description" content="Efeitos fazem parte do seu fluxo de dados."/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:inherit;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);border-left-color:inherit;opacity:0.8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:var(--hr);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"‚Äî ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:var(--textLink);text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}a.anchor{box-shadow:none;}a.anchor svg[aria-hidden="true"]{stroke:var(--textLink);}p code{font-size:1rem;}h1 code, h2 code, h3 code, h4 code, h5 code, h6 code{font-size:inherit;}li code{font-size:1rem;}blockquote.translation{font-size:1em;}</style><link as="script" rel="preload" href="/component---src-templates-blog-post-js-5ff9d93420b5b2cefece.js"/><link as="script" rel="preload" href="/app-83825dcbe188439d174e.js"/><link as="script" rel="preload" href="/0-b197e8c6c7ff26484233.js"/><link as="script" rel="preload" href="/2-31a6021f1637c5720eda.js"/><link as="script" rel="preload" href="/1-1b550cd61a5e170131aa.js"/><link as="script" rel="preload" href="/webpack-runtime-dea655677e505366ecd7.js"/><link as="fetch" rel="preload" href="/static/d/303/path---pt-br-a-complete-guide-to-useeffect-3-d-2-6c2-GDocE6uAqkzG0LKAcw0s9p5NEc.json" crossorigin="use-credentials"/></head><body class="light"><script>
              (function() {
                window.__onThemeChange = function() {};
                function setTheme(newTheme) {
                  window.__theme = newTheme;
                  preferredTheme = newTheme;
                  document.body.className = newTheme;
                  window.__onThemeChange(newTheme);
                }

                var preferredTheme;
                try {
                  preferredTheme = localStorage.getItem('theme');
                } catch (err) { }

                window.__setPreferredTheme = function(newTheme) {
                  setTheme(newTheme);
                  try {
                    localStorage.setItem('theme', newTheme);
                  } catch (err) {}
                }

                var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
                darkQuery.addListener(function(e) {
                  window.__setPreferredTheme(e.matches ? 'dark' : 'light')
                });

                setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
              })();
            </script><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="color:var(--textNormal);background:var(--bg);transition:color 0.2s ease-out, background 0.2s ease-out;min-height:100vh"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2.625rem"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:0;height:42px;line-height:2.625rem"><a style="box-shadow:none;text-decoration:none;color:rgb(255, 167, 196)" href="/">Overreacted</a></h3><div style="height:24px"></div></header><main><article><header><h1 style="color:var(--textTitle)">Um guia completo para useEffect</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.4rem">2019 M03 9<!-- --> ‚Ä¢ üç±üç±üç±üç± 52 min read</p><div class="translations"><p style="font-size:0.9em;border:1px solid var(--hr);border-radius:0.75em;padding:0.75em;background:var(--inlineCode-bg);word-break:keep-all;font-family:system-ui, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
    &quot;Roboto&quot;, &quot;Oxygen&quot;, &quot;Ubuntu&quot;, &quot;Cantarell&quot;, &quot;Fira Sans&quot;,
    &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif"><span><span>Translated by readers into: </span><b>Portugu√™s do Brasil</b> ‚Ä¢ <a href="/ja/a-complete-guide-to-useeffect/">Êó•Êú¨Ë™û</a> ‚Ä¢ <a href="/zh-hans/a-complete-guide-to-useeffect/">ÁÆÄ‰Ωì‰∏≠Êñá</a> ‚Ä¢ <a href="/zh-hant/a-complete-guide-to-useeffect/">ÁπÅÈ´î‰∏≠Êñá</a></span><br/><br/><a href="/a-complete-guide-to-useeffect/">Read the original</a> ‚Ä¢ <a href="https://github.com/gaearon/overreacted.io/edit/master/src/pages/a-complete-guide-to-useeffect/index.pt-br.md" target="_blank" rel="noopener noreferrer">Improve this translation</a> ‚Ä¢ <a href="/pt-br">View all translated posts</a> </p></div></header><div><p>Voc√™ escreveu alguns componentes com <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="nofollow noopener noreferrer">Hooks</a>. Talvez at√© um pequeno app. At√© ent√£o voc√™ est√° satisfeito. Est√° confort√°vel com a API e aprendeu alguns truques durante o caminho. Voc√™ at√© <a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="nofollow noopener noreferrer">criou alguns Hooks personalizados</a> para extrair l√≥gica repetitiva (l√° se foram 300 linhas!) e mostrou tudo isso para seus colegas. ‚Äú√ìtimo trabalho!‚Äù, eles disseram.</p>
<p>Mas, algumas vezes, quando voc√™ usa <code class="language-text">useEffect</code>, os peda√ßos n√£o se encaixam muito bem. Voc√™ tem aquela sensa√ß√£o inc√¥moda de que est√° perdendo alguma coisa. Parece semelhante aos ciclos de vida das classes‚Ä¶mas √© mesmo? Voc√™ se encontra fazendo perguntas como:</p>
<ul>
<li>ü§î Como fa√ßo para replicar <code class="language-text">componentDidMount</code> com <code class="language-text">useEffect</code>?</li>
<li>ü§î Como fa√ßo para buscar dados corretamente dentro de <code class="language-text">useEffect</code>? O que √© <code class="language-text">[]</code>?</li>
<li>ü§î Preciso especificar fun√ß√µes como depend√™ncias do efeito ou n√£o?</li>
<li>ü§î Por que √†s vezes recebo um loop infinito na busca de dados?</li>
<li>ü§î Por que √†s vezes recebo um <em>state</em> ou <em>props</em> antiga dentro do meu efeito?</li>
</ul>
<p>Quando comecei a usar o Hooks, tamb√©m fiquei confuso com todas essas perguntas. Mesmo ao escrever os documentos iniciais, eu n√£o tinha uma compreens√£o firme de algumas das sutilezas. Desde ent√£o, tive alguns momentos ‚Äúaha‚Äù que quero compartilhar com voc√™. <strong>Faremos um mergulho profundo nesses detalhes, trazendo a superf√≠cie as respostas a essas perguntas, que no final, parecer√£o √≥bvias para voc√™.</strong></p>
<p>Para <strong>ver</strong> essas respostas, precisamos dar um passo para tr√°s. O objetivo deste artigo n√£o √© fornecer uma lista de receitas. √â para ajudar voc√™ a realmente ‚Äúclicar‚Äù o <code class="language-text">useEffect</code>. N√£o haver√° muito a aprender. Na verdade, passaremos a maior parte do tempo de <em>desaprendendo</em>.</p>
<p><strong>S√≥ depois que parei de olhar para o Hook <code class="language-text">useEffect</code> atrav√©s do prisma que estou acostumado dos m√©todos de ciclo de vida de classes, que todos as pe√ßas se juntaram para mim.</strong></p>
<blockquote>
<p>‚ÄúDesaprenda o que voc√™ aprendeu.‚Äù ‚Äî Yoda</p>
</blockquote>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 497px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 64.38631790744466%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAwX/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAF5WKs71REF/8QAGxAAAQUBAQAAAAAAAAAAAAAAAgABAxESEyH/2gAIAQEAAQUCvzvk9Woz0njdBK5j/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bh//EAB0QAAICAQUAAAAAAAAAAAAAAAABAhEhMTJBUZH/2gAIAQEABj8CK4Nno10Obm8FvU//xAAbEAEBAQEAAwEAAAAAAAAAAAABEQAhMVFxgf/aAAgBAQABPyH0Zd076TuCbR9Rz80qZiwUvg37TTf/2gAMAwEAAgADAAAAEEPf/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERMUH/2gAIAQMBAT8QlaUf/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAx/9oACAECAQE/EFOQF//EABwQAQEAAgIDAAAAAAAAAAAAAAERACExQVFx0f/aAAgBAQABPxA0TUOLkyoSi0+4SldSl6yfaQttpzhvHAwULvWAwOi0F8zP/9k='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Yoda cheirando o ar. Legenda: ‚ÄúSinto cheiro de bacon.‚Äù"
        title=""
        src="/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg"
        srcset="/static/6203a1f1f2c771816a5ba0969baccd12/5645f/yoda.jpg 148w,
/static/6203a1f1f2c771816a5ba0969baccd12/3f2ca/yoda.jpg 295w,
/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg 497w"
        sizes="(max-width: 497px) 100vw, 497px"
      />
    </span>
  </span>
  
  </a>
    </p>
<hr>
<p><strong>Este artigo assume que voc√™ esteja familiarizado com a API do <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">useEffect</code></a>.</strong></p>
<p><strong>Tamb√©m √© <em>muito</em> longo. √â como um mini-livro. Esse √© apenas o meu formato preferido. Mas eu escrevi um TLDR logo abaixo se voc√™ est√° com pressa ou n√£o se importa.</strong></p>
<p><strong>Se voc√™ n√£o se sentir confort√°vel com guias que mergulham profundo nos detalhes, espere at√© que essas explica√ß√µes apare√ßam em outro lugar. Assim como quando o React saiu em 2013, levar√° algum tempo para que as pessoas reconhe√ßam um modelo mental diferente e o ensinem.</strong></p>
<hr>
<h2 id="tldr"><a href="#tldr" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TLDR</h2>
<p>Aqui est√° um r√°pido TLDR se voc√™ n√£o quiser ler a coisa toda. Se algumas partes n√£o fizerem sentido, voc√™ pode rolar para baixo at√© encontrar algo relacionado.</p>
<p>Sinta-se livre para ignor√°-lo se voc√™ pretende ler o post inteiro. Tamb√©m vou vincul√°-lo no final.</p>
<p><strong>ü§î Pergunta: Como fa√ßo para replicar <code class="language-text">componentDidMount</code> com <code class="language-text">useEffect</code>?</strong></p>
<p>Embora voc√™ possa usar o <code class="language-text">useEffect(fn, [])</code>, n√£o √© um equivalente exato. Ao contr√°rio do <code class="language-text">componentDidMount</code>, ele ir√° capturar <em>props</em> e <em>state</em>. Assim, mesmo dentro dos retornos de chamada, voc√™ ver√° os valores iniciais de <em>props</em> e <em>state</em>. Se voc√™ quiser ver algo ‚Äúmais recente‚Äù, voc√™ pode escrever uma <em>ref</em> para isso. Mas normalmente h√° uma maneira mais simples de estruturar o c√≥digo para que voc√™ n√£o precise fazer isso. Tenha em mente que o modelo mental para efeitos √© diferente de <code class="language-text">componentDidMount</code> e outros ciclos de vida, e tentar encontrar seus equivalentes exatos pode te confundir mais do que ajudar. Para se tornar produtivo, voc√™ precisa ‚Äúpensar em efeitos‚Äù, e modelo mental deles est√° mais perto de ‚Äúimplementar a sincroniza√ß√£o‚Äù do que ‚Äúresponder a eventos do ciclo de vida‚Äù.</p>
<p><strong>ü§î Pergunta: Como fa√ßo para buscar dados corretamente dentro de <code class="language-text">useEffect</code>? O que √© <code class="language-text">[]</code>?</strong></p>
<p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">Este artigo</a> √© um bom manual sobre como buscar dados com <code class="language-text">useEffect</code>. Certifique-se de ler at√© o fim! N√£o √© t√£o longo como este. <code class="language-text">[]</code> significa que o efeito n√£o usa nenhum valor que participa do fluxo de dados do React e, por esse motivo, √© seguro para ser aplicado apenas uma vez. Tamb√©m √© uma fonte comum de erros quando o valor √© realmente usado. Voc√™ precisar√° aprender algumas estrat√©gias (principalmente <code class="language-text">useReducer</code> e <code class="language-text">useCallback</code>) que podem remover a necessidade de uma depend√™ncia, ao inv√©s de omitir isso incorretamente.</p>
<p><strong>ü§î Pergunta: Preciso especificar fun√ß√µes como depend√™ncias do efeito ou n√£o?</strong></p>
<p>A recomenda√ß√£o √© mover fun√ß√µes que n√£o precisam de <em>props</em> ou <em>state</em> para fora do seu componente e extrair aquelas que s√£o usadas apenas por um efeito, para dentro desse efeito. Se mesmo depois disso, o efeito ainda acabar usando fun√ß√µes do escopo da renderiza√ß√£o (incluindo fun√ß√µes vindas de <em>props</em>), envolva-as em <code class="language-text">useCallback</code> aonde elas estiverem definidas e repita o processo. Por que isso √© importante? Fun√ß√µes podem ‚Äúver‚Äù valores de <em>props</em> e <em>state</em>, significa eles participam do fluxo de dados do React.</p>
<p><strong>ü§î Pergunta: Por que √†s vezes recebo um loop infinito na busca de dados?</strong></p>
<p>Isso pode acontecer se voc√™ estiver buscando dados em um efeito sem o segundo argumento de depend√™ncias. Sem ele, os efeitos s√£o executados ap√≥s cada renderiza√ß√£o - e definindo um novo estado acionar√° os efeitos novamente. Um loop infinito tamb√©m pode acontecer se voc√™ especificar um valor que sempre muda no array de depend√™ncias. Voc√™ pode descobrir qual deles, removendo-os um por um. No entanto, remover uma depend√™ncia usada (ou especificar cegamente <code class="language-text">[]</code>) geralmente √© uma corre√ß√£o incorreta. Ao inv√©s disso, corrija o problema na sua origem. Por exemplo, fun√ß√µes podem causar esse problema e coloc√°-las dentro de efeitos, movendo-as ou envolvendo-as com o uso de <code class="language-text">useCallback</code>. Para evitar a recria√ß√£o de objetos, o <code class="language-text">useMemo</code> pode servir a um prop√≥sito semelhante.</p>
<p><strong>ü§î Pergunta: Por que √†s vezes recebo um <em>state</em> ou <em>props</em> antiga dentro do meu efeito?</strong></p>
<p>Os efeitos sempre podem ‚Äúver‚Äù as <em>props</em> e <em>state</em> da renderiza√ß√£o em que foram definidos. <a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="nofollow noopener noreferrer">Isso ajuda a evitar erros</a>, mas em alguns casos pode ser irritante. Para esses casos, voc√™ pode manter, explicitamente, algum valor em uma <em>ref</em> mut√°vel (o artigo do link explica isso no final). Se voc√™ acha que est√° vendo <em>props</em> ou <em>state</em> a de uma renderiza√ß√£o antiga, mas n√£o √© o que voc√™ espera, voc√™ provavelmente deixou passar alguma depend√™ncia. Tente usar a <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="nofollow noopener noreferrer">regra do linter</a> para te treinar a exerg√°-los. Depois de alguns dias, ser√° como uma segunda natureza para voc√™. Veja tamb√©m <a href="https://reactjs.org/docs/hooks-faq.html#why-am-i-seeing-stale-props-or-state-inside-my-function" target="_blank" rel="nofollow noopener noreferrer">essa reposta</a> no nosso FAQ.</p>
<hr>
<p>Espero que este TLDR tenha sido √∫til! Caso contr√°rio, vamos continuar.</p>
<hr>
<h2 id="cada-renderiza√ß√£o-tem-seus-pr√≥prios-props-e-state"><a href="#cada-renderiza%C3%A7%C3%A3o-tem-seus-pr%C3%B3prios-props-e-state" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cada renderiza√ß√£o tem seus pr√≥prios <em>props</em> e <em>state</em></h2>
<p>Antes de falarmos sobre efeitos, precisamos falar sobre renderiza√ß√£o.</p>
<p>Aqui est√° um contador. Olhe a linha destacada de perto:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Click me</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>O que isso significa? Ser√° que <code class="language-text">count</code>, de alguma forma, ‚Äúfica olhando‚Äù as altera√ß√µes ao nosso estado e atualiza automaticamente? Essa pode ser uma primeira intui√ß√£o quando voc√™ aprende React, mas n√£o √© um <a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="nofollow noopener noreferrer">modelo mental preciso</a>.</p>
<p>Neste exemplo, <code class="language-text">count</code> √© apenas um n√∫mero. N√£o √© uma m√°gica de ‚Äúliga√ß√£o de dados‚Äù (<strong>data binding</strong>), um ‚Äúobservador‚Äù (<strong>watcher</strong>), um ‚Äúproxy‚Äù ou qualquer outra coisa. √â um bom e antigo n√∫mero como este:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token comment">// ...</span></code></pre></div>
<p>A primeira vez que nosso componente renderiza, a vari√°vel <code class="language-text">count</code> que obtemos de <code class="language-text">useState()</code> √© <code class="language-text">0</code>. Quando chamamos <code class="language-text">setCount(1)</code>, o React chama nosso componente novamente. Desta vez, a contagem ser√° <code class="language-text">1</code>. E assim por diante:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Durante primeira renderiza√ß√£o</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()</span></span>  <span class="token comment">// ...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ap√≥s um clique, nossa fun√ß√£o √© chamada novamente</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()</span></span>  <span class="token comment">// ...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ap√≥s outro clique, nossa fun√ß√£o √© chamada novamente</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()</span></span>  <span class="token comment">// ...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Sempre que atualizamos o estado, o React chama nosso componente. Cada renderiza√ß√£o ‚Äúv√™‚Äù seu pr√≥prio valor de <code class="language-text">count</code>, que √© uma <em>constante</em> dentro de nossa fun√ß√£o.</strong></p>
<p>Portanto, essa linha n√£o faz nenhuma liga√ß√£o de dados especial:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre></div>
<p><strong>Ela apenas incorpora um valor num√©rico na sa√≠da de renderiza√ß√£o.</strong> Esse n√∫mero √© fornecido pelo React. Quando chamamos <code class="language-text">setCount</code>, React chama nosso componente novamente com um valor de contagem diferente. Em seguida, o React atualiza o DOM para corresponder √† nossa nova sa√≠da de renderiza√ß√£o.</p>
<p>A principal conclus√£o √© que a constante <code class="language-text">count</code>, em qualquer renderiza√ß√£o, n√£o muda com o tempo. √â nosso componente que √© chamado novamente e cada renderiza√ß√£o ‚Äúv√™‚Äù seu pr√≥prio valor de contagem isolado entre renderiza√ß√µes.</p>
<p><em>(Para uma vis√£o detalhada desse processo, confira meu post <a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="nofollow noopener noreferrer">React as a UI Runtime</a>.)</em></p>
<h2 id="cada-renderiza√ß√£o-tem-seus-pr√≥prios-manipuladores-de-eventos"><a href="#cada-renderiza%C3%A7%C3%A3o-tem-seus-pr%C3%B3prios-manipuladores-de-eventos" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cada renderiza√ß√£o tem seus pr√≥prios manipuladores de eventos</h2>
<p>Por enquanto, tudo bem. E quanto aos manipuladores de eventos?</p>
<p>Veja este exemplo. Ele mostra um alerta com <code class="language-text">count</code> ap√≥s tr√™s segundos:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Click me</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">        Show alert</span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Digamos que eu fa√ßa a seguinte sequ√™ncia de etapas:</p>
<ul>
<li><strong>Incrementar</strong> o contador 3 vezes</li>
<li><strong>Pressionar</strong> ‚ÄúMostrar alerta‚Äù</li>
<li><strong>Incrementar</strong> o contador para 5 antes que o tempo limite seja disparado</li>
</ul>
<p><img src="/counter-46c55d5f1f749462b7a173f1e748e41e.gif" alt="Demonstra√ß√£o do Counter"></p>
<p>O que voc√™ espera que o alerta mostre? Voc√™ espera que seja 5 - que √© o estado do contador no momento do alerta? Ou que ir√° mostrar 3 - o estado quando eu cliquei?</p>
<hr>
<p><em>spoilers √† frente</em></p>
<hr>
<p>V√° em frente e <a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="nofollow noopener noreferrer">tente voc√™ mesmo!</a></p>
<p>Se o comportamento n√£o fizer muito sentido para voc√™, imagine um exemplo mais pr√°tico: um aplicativo de bate-papo com o ID do destinat√°rio atual no estado e um bot√£o Enviar. <a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="nofollow noopener noreferrer">Este artigo</a> explora as raz√µes em profundidade, mas a resposta correta √© 3.</p>
<p>O alerta ir√° ‚Äúcapturar‚Äù o estado no momento em que eu cliquei no bot√£o.</p>
<p><em>(Tamb√©m existem maneiras de implementar o outro comportamento, mas vou me concentrar no caso padr√£o por enquanto. Ao construir um modelo mental, √© importante distinguir o ‚Äúcaminho de menor resist√™ncia‚Äù das sa√≠das de emerg√™ncia que voc√™ pode utilizar uma vez ou outra.)</em></p>
<hr>
<p>Mas como isso funciona?</p>
<p>N√≥s vimos que o valor <code class="language-text">count</code> √© uma constante para cada chamada espec√≠fica da nossa fun√ß√£o. Vale a pena enfatizar isso - <strong>nossa fun√ß√£o √© chamada muitas vezes (uma vez para cada renderiza√ß√£o), mas em cada uma dessas vezes o valor de <code class="language-text">count</code> dentro dela √© constante e configurado para um valor espec√≠fico (o estado para aquela renderiza√ß√£o).</strong></p>
<p>Isso n√£o √© espec√≠fico do React - o comportamento regular de fun√ß√µes funcionam de maneira semelhante:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> name <span class="token operator">=</span> person<span class="token punctuation">.</span>name<span class="token punctuation">;</span></span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> someone <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Dan'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span>

someone <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Yuzhi'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span>

someone <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Dominic'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Nesse <a href="https://codesandbox.io/s/mm6ww11lk8" target="_blank" rel="nofollow noopener noreferrer">exemplo</a>, a vari√°vel externa <code class="language-text">someone</code> √© reatribu√≠da v√°rias vezes. (Assim como em algum lugar no React, o estado <em>atual</em> do component pode mudar.) <strong>No entanto, no interior de <code class="language-text">sayHi</code>, h√° uma constante local chamada <code class="language-text">name</code> associada a uma <code class="language-text">person</code> de uma chamada espec√≠fica.</strong> Essa constante √© local, por isso √© isolado entre as chamadas! Como resultado, quando os temporizadores s√£o acionados, cada alerta ‚Äúlembra‚Äù o pr√≥prio <code class="language-text">name</code>.</p>
<p>Isso explica como o manipulador de eventos captura <code class="language-text">count</code> no momento do clique. Se aplicarmos o mesmo princ√≠pio de substitui√ß√£o, cada render ‚Äúv√™‚Äù o seu pr√≥prio <code class="language-text">count</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Durante primeira renderiza√ß√£o</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()</span></span>  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ap√≥s um clique, nossa fun√ß√£o √© chamada novamente</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()</span></span>  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ap√≥s outro clique, nossa fun√ß√£o √© chamada novamente</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// Returned by useState()</span></span>  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Ent√£o, efetivamente, cada render retorna sua pr√≥pria ‚Äúvers√£o‚Äù de <code class="language-text">handleAlertClick</code>. Cada uma dessas vers√µes ‚Äúlembra‚Äù o seu pr√≥prio valor de <code class="language-text">count</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Durante primeira renderiza√ß√£o</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// Com 0 dentro</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ap√≥s um clique, nossa fun√ß√£o √© chamada novamente</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// Com 1 dentro</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ap√≥s outro clique, nossa fun√ß√£o √© chamada novamente</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// Com 2 dentro</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>√â por isso que <a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="nofollow noopener noreferrer">nesse exemplo</a>, os manipuladores de eventos ‚Äúpertencem‚Äù a uma determinada renderiza√ß√£o e quando voc√™ clica, ele mant√©m com o estado de <code class="language-text">counter</code> daquela renderiza√ß√£o.</p>
<p><strong>Dentro de qualquer renderiza√ß√£o em particular, os objetos e o estado permanecem para sempre iguais.</strong> Mas se <em>props</em> e <em>state</em> forem isolados entre renderizadores, o mesmo acontecer√° com qualquer valor usando-os (incluindo os manipuladores de eventos). Eles tamb√©m ‚Äúpertencem‚Äù a uma renderiza√ß√£o espec√≠fica. Assim, mesmo as fun√ß√µes ass√≠ncronas dentro de um manipulador de eventos ‚Äúir√£o ver‚Äù o mesmo valor de <code class="language-text">count</code>.</p>
<p><em>Nota: eu adicionei valores literais do <code class="language-text">count</code> diretamente nas fun√ß√µes <code class="language-text">handleAlertClick</code> acima. Essa substitui√ß√£o mental √© segura pois <code class="language-text">count</code> n√£o pode ser alterado em uma renderiza√ß√£o espec√≠fica. √â declarado como uma <code class="language-text">const</code> e √© um n√∫mero. Seria seguro pensar da mesma maneira sobre outros valores, como objetos, mas somente se concordarmos em evitar muta√ß√£o no estado. Chamar <code class="language-text">setSomething(newObj)</code> com um novo objeto rec√©m-criado, ao inv√©s de mut√°-lo, √© bom pois o estado pertencente a renderiza√ß√µes anteriores ficar√° intacto.</em></p>
<h2 id="cada-renderiza√ß√£o-tem-seus-pr√≥prios-efeitos"><a href="#cada-renderiza%C3%A7%C3%A3o-tem-seus-pr%C3%B3prios-efeitos" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cada renderiza√ß√£o tem seus pr√≥prios efeitos</h2>
<p>Este deveria ser um post sobre efeitos, mas ainda n√£o falamos sobre eles ainda! N√≥s vamos corrigir isso agora. Acontece que os efeitos n√£o s√£o realmente diferentes.</p>
<p>Vamos voltar a um <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="nofollow noopener noreferrer">exemplo da documenta√ß√£o</a>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Click me</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Aqui est√° uma pergunta para voc√™: como fazer para que o efeito leia o estado mais recente de <code class="language-text">count</code>?</strong></p>
<p>Talvez haja algum tipo de ‚Äúvincula√ß√£o de dados‚Äù ou ‚Äúobserva√ß√£o‚Äù que fa√ßa a atualiza√ß√£o cont√≠nua de <code class="language-text">count</code> dentro da fun√ß√£o de efeito? Talvez <code class="language-text">count</code> seja uma vari√°vel mut√°vel que o React define dentro de nosso componente para que nosso efeito sempre tenha o valor mais recente?</p>
<p>N√£o.</p>
<p>N√≥s j√° sabemos que <code class="language-text">count</code> √© constante dentro de uma determinada renderiza√ß√£o. Os manipuladores de eventos ‚Äúveem‚Äù o estado de <code class="language-text">count</code> da renderiza√ß√£o que eles ‚Äúpertencem‚Äù pois <code class="language-text">count</code> √© uma vari√°vel dentro do seu escopo. O mesmo √© verdade para efeitos!</p>
<p><strong>N√£o √© a vari√°vel <code class="language-text">count</code> que de alguma forma mudou dentro de um efeito ‚Äúimut√°vel‚Äù. √â a <em>fun√ß√£o do efeito em si</em> que √© diferente em cada renderiza√ß√£o.</strong></p>
<p>Cada vers√£o ‚Äúv√™‚Äù o valor de <code class="language-text">count</code> da renderiza√ß√£o que ela ‚Äúpertence‚Äù:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Durante primeira renderiza√ß√£o</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// Fun√ß√£o de efeito da primeira renderiza√ß√£o</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">0</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ap√≥s um clique, nossa fun√ß√£o √© chamada novamente</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// Fun√ß√£o de efeito da segunda renderiza√ß√£o</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ap√≥s outro clique, nossa fun√ß√£o √© chamada novamente</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// Fun√ß√£o de efeito da terceira renderiza√ß√£o</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span></code></pre></div>
<p>O React lembra a fun√ß√£o de efeito que voc√™ forneceu e a executa depois de liberar as altera√ß√µes para o DOM e permitir que o navegador pinte a tela.</p>
<p>Mesmo se falarmos de um conceitual √∫nico <em>efeito</em> aqui (atualizando o t√≠tulo do documento), ele √© representado por uma <em>fun√ß√£o diferente</em> em cada renderiza√ß√£o - e cada fun√ß√£o de efeito ‚Äúv√™‚Äù suas <em>props</em> e <em>state</em> da renderiza√ß√£o espec√≠fica √† qual ele ‚Äúpertence‚Äù.</p>
<p><strong>Conceitualmente, voc√™ pode imaginar que os efeitos <em>fazem parte do resultado da renderiza√ß√£o</em>.</strong></p>
<p>Falando rigorosamente, eles n√£o s√£o (tudo isso para <a href="https://overreacted.io/why-do-hooks-rely-on-call-order/" target="_blank" rel="nofollow noopener noreferrer">permitir a composi√ß√£o do Hook</a> sem uma sintaxe grotesca ou com alguma sobrecarga em tempo de execu√ß√£o). No modelo mental que estamos construindo, as fun√ß√µes de efeito pertencem a uma renderiza√ß√£o espec√≠fica, da mesma maneira que os manipuladores de eventos.</p>
<hr>
<p>Para ter certeza de que temos uma s√≥lida compreens√£o, vamos recapitular nossa primeira renderiza√ß√£o:</p>
<ul>
<li><strong>React</strong>: Me retorna a interface do usu√°rio quando o estado √© <code class="language-text">0</code>.</li>
<li>
<p><strong>Seu Componente</strong>:</p>
<ul>
<li>Aqui est√° o resultado da renderiza√ß√£o: <code class="language-text">&lt;p&gt;You clicked 0 times&lt;/p&gt;</code>.</li>
<li>Lembre-se de executar este efeito depois que voc√™ estiver pronto: <code class="language-text">() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>.</li>
</ul>
</li>
<li><strong>React</strong>: Claro. Atualizando a interface do usu√°rio. Ol√° navegador, estou adicionando algumas coisas ao DOM.</li>
<li><strong>Navegador</strong>: Legal, eu pintei para a tela.</li>
<li>
<p><strong>React</strong>: OK, agora vou executar o efeito que voc√™ me deu.</p>
<ul>
<li>Executando: <code class="language-text">() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>.</li>
</ul>
</li>
</ul>
<hr>
<p>Agora vamos recapitular o que acontece depois que clicamos:</p>
<ul>
<li><strong>Seu componente</strong>: Ei React, defina meu estado como <code class="language-text">1</code>.</li>
<li><strong>React</strong>: Me retorna a interface do usu√°rio quando o estado √© <code class="language-text">1</code></li>
<li>
<p><strong>Seu componente</strong>:</p>
<ul>
<li>Aqui est√° o resultado da renderiza√ß√£o: <code class="language-text">&lt;p&gt;You clicked 1 times&lt;/p&gt;</code>.</li>
<li>Lembre-se de executar este efeito depois que voc√™ estiver pronto: <code class="language-text">() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>.</li>
</ul>
</li>
<li><strong>React</strong>: Claro. Atualizando a interface do usu√°rio. Ei navegador, eu mudei o DOM.</li>
<li><strong>Navegador</strong>: Legal, eu pintei suas altera√ß√µes na tela.</li>
<li>
<p><strong>React</strong>: OK, agora eu vou executar o efeito que pertence a rendereriza√ß√£o que acabei de fazer.</p>
<ul>
<li>Executando: <code class="language-text">() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="cada-renderiza√ß√£o-tem-seu-pr√≥prio-tudo"><a href="#cada-renderiza%C3%A7%C3%A3o-tem-seu-pr%C3%B3prio-tudo" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cada renderiza√ß√£o tem seu pr√≥prio‚Ä¶ tudo</h2>
<p><strong>Sabemos agora que os efeitos s√£o executados ap√≥s cada renderiza√ß√£o, s√£o conceitualmente parte da sa√≠da do componente e ‚Äúveem‚Äù os objetos e o estado a partir dessa renderiza√ß√£o espec√≠fica.</strong></p>
<p>Vamos tentar um experimento mental. Considere este c√≥digo:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Click me</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Se eu clicar v√°rias vezes com um pequeno <em>delay</em>, como o log de registros ir√° ficar?</p>
<hr>
<p><em>spoilers √† frente</em></p>
<hr>
<p>Voc√™ pode pensar que isso √© uma pegadinha e o resultado final n√£o √© intuitivo. N√£o √©! Vamos ver uma sequ√™ncia de logs - cada um pertencente a uma renderiza√ß√£o espec√≠fica e, portanto, com seu pr√≥prio valor de <code class="language-text">count</code>. <a href="https://codesandbox.io/s/lyx20m1ol" target="_blank" rel="nofollow noopener noreferrer">Voc√™ pode tentar aqui</a>:</p>
<p><img src="/timeout_counter-a5727d333c270e05942f508707265378.gif" alt="Grava√ß√£o da tela com logs 1, 2, 3, 4, 5 em ordem"></p>
<p>Voc√™ pode pensar: ‚ÄúClaro que √© assim que funciona! De que outra forma poderia funcionar?</p>
<p>Bem, n√£o √© assim que <code class="language-text">this.state</code> funciona em <code class="language-text">class</code>. √â f√°cil cometer o erro de pensar que <a href="https://codesandbox.io/s/kkymzwjqz3" target="_blank" rel="nofollow noopener noreferrer">essa implementa√ß√£o</a> √© equivalente em <code class="language-text">class</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>No entanto, <code class="language-text">this.state.count</code> sempre aponta para a contagem mais recente ao inv√©s da que pertence a uma renderiza√ß√£o espec√≠fica. Ent√£o, voc√™ ver√° <code class="language-text">5</code> nos logs:</p>
<p><img src="/timeout_counter_class-264b329edc111a1973003bdf2bcacd65.gif" alt="Grava√ß√£o da tela com logs 5, 5, 5, 5, 5 em ordem"></p>
<p>Eu acho ir√¥nico que os Hooks dependam tanto de <strong>closures</strong> em JavaScript, e ainda assim, √© a implementa√ß√£o de classes que sofre com <a href="https://wsvincent.com/javascript-closure-settimeout-for-loop/" target="_blank" rel="nofollow noopener noreferrer">a confus√£o can√¥nica de valores errados em temporizadores</a> que √© freq√ºentemente associada com <strong>closures</strong>. Isso ocorre porque a fonte real da confus√£o neste exemplo √© a muta√ß√£o (o React faz muta√ß√£o em <code class="language-text">this.state</code> nas classes para apontar para o estado mais recente) e n√£o na <strong>closures</strong> em si.</p>
<p><strong>Closures s√£o √≥timas quando os valores que voc√™ encapsula nunca mudam. Isso os torna f√°ceis de se pensar porque voc√™ est√° essencialmente se referindo a uma constantes.</strong> E como discutimos, <em>props</em> e <em>state</em> nunca mudam dentro de uma renderiza√ß√£o espec√≠fica. A prop√≥sito, podemos consertar a vers√£o da classes‚Ä¶utilizando <a href="https://codesandbox.io/s/w7vjo07055" target="_blank" rel="nofollow noopener noreferrer">uma <strong>closure</strong></a>.</p>
<h2 id="nadando-contra-a-mar√©"><a href="#nadando-contra-a-mar%C3%A9" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Nadando contra a mar√©</h2>
<p>Neste ponto, √© importante falar explicitamente: cada fun√ß√£o dentro da renderiza√ß√£o do componente (incluindo manipuladores de eventos, efeitos, temporizadores ou chamadas de API dentro delas) capturam <em>props</em> e <em>state</em> da chamada de renderiza√ß√£o que a definiu.</p>
<p>Ent√£o, esses dois exemplos s√£o equivalentes:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> counter <span class="token operator">=</span> props<span class="token punctuation">.</span>counter<span class="token punctuation">;</span></span>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>N√£o importa se voc√™ l√™ as <em>props</em> ou as declara mais ‚Äúcedo‚Äù dentro do seu componente.</strong> Elas n√£o v√£o mudar! Dentro do escopo de uma √∫nica renderiza√ß√£o, as <em>props</em> e <em>state</em> permanecem as mesmas. (desestruturando as <em>props</em> tornam isso mais √≥bvio.)</p>
<p>Naturalmente, √†s vezes voc√™ deseja ler o valor mais recente ao inv√©s do que foi capturado, talvez em algum retorno de chamada definido em um efeito. A maneira mais f√°cil de fazer isso √© usando refs, conforme descrito na √∫ltima se√ß√£o <a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="nofollow noopener noreferrer">deste artigo</a>.</p>
<p>Fique ciente de que quando voc√™ quiser ler as <em>props</em> futuras, ou <em>state</em> de uma fun√ß√£o em uma renderiza√ß√£o passada, voc√™ estar√° nadando contra a mar√©. N√£o √© errado (e, em alguns casos, necess√°rio), mas isso pode parecer menos ‚Äúlimpo‚Äù, ao sair do paradigma. Essa √© uma consequ√™ncia intencional porque ajuda a destacar qual c√≥digo √© fr√°gil e depende de um tempo espec√≠fico. Nas <strong>class</strong>, √© menos √≥bvio quando isso acontece.</p>
<p>Aqui est√° uma <a href="https://codesandbox.io/s/rm7z22qnlp" target="_blank" rel="nofollow noopener noreferrer">vers√£o do nosso contador</a> que replica o comportamento da classe:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> latestCount <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// Define o √∫ltimo valor por muta√ß√£o</span></span><span class="gatsby-highlight-code-line">    latestCount<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span></span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token comment">// Lendo o √∫ltimo valor da muta√ß√£o</span></span><span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>latestCount<span class="token punctuation">.</span>current<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre></div>
<p><img src="/timeout_counter_refs-78f7948263dd13b023498b23cb99f4fc.gif" alt="Grava√ß√£o da tela com logs 5, 5, 5, 5, 5 em ordem"></p>
<p>Pode parecer estranho mutar algo em React. No entanto, √© exatamente assim que o pr√≥prio React √© reatribui <code class="language-text">this.state</code> em classes. Ao contr√°rio das <em>props</em> e <em>state</em> capturadas, voc√™ n√£o tem nenhuma garantia de que a leitura <code class="language-text">latestCount.current</code> forne√ßa o mesmo valor em qualquer chamada de retorno espec√≠fica. Por defini√ß√£o, voc√™ pode alter√°-lo a qualquer momento. √â por isso que n√£o √© um padr√£o, e voc√™ tem que optar manualmente por isso.</p>
<h2 id="ent√£o-o-que-acontece-no-momento-de-limpeza"><a href="#ent%C3%A3o-o-que-acontece-no-momento-de-limpeza" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ent√£o, o que acontece no momento de limpeza?</h2>
<p>Como <a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup" target="_blank" rel="nofollow noopener noreferrer">a documenta√ß√£o explica</a>, alguns efeitos podem ter uma fase de limpeza. Essencialmente, sua finalidade √© ‚Äúdesfazer‚Äù um efeito para casos como <strong>subscriptions</strong>.</p>
<p>Considere este c√≥digo:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Vamos supor que <em>props</em> est√° em <code class="language-text">{id: 10}</code> na primeira renderiza√ß√£o e <code class="language-text">{id: 20}</code> na segunda. Voc√™ pode pensar que algo assim acontece:</p>
<ul>
<li>React limpa o efeito para <code class="language-text">{id: 10}</code></li>
<li>React renderiza a interface do usu√°rio para <code class="language-text">{id: 20}</code></li>
<li>React executa o efeito para <code class="language-text">{id: 20}</code></li>
</ul>
<p>(Esse n√£o √© bem o caso.)</p>
<p>Com este modelo mental, voc√™ pode pensar que a limpeza ‚Äúv√™‚Äù os objetos antigos porque ela executa antes de renderizar novamente, e ent√£o o novo efeito ‚Äúv√™‚Äù as novas <em>props</em> porque executa ap√≥s a re-renderiza√ß√£o. Esse √© o modelo mental diretamente relacionado aos ciclos de vida das classes, e <strong>n√£o √© preciso nesse caso</strong>. Vamos ver o porque.</p>
<p>React apenas executa os efeitos <a href="https://medium.com/@dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f" target="_blank" rel="nofollow noopener noreferrer">depois de deixar o navegador pintar as altera√ß√µes na tela</a>. Isso torna seu aplicativo mais r√°pido, pois a maioria dos efeitos n√£o precisa bloquear as atualiza√ß√µes de tela. A limpeza do efeito tamb√©m √© atrasada. <strong>O efeito anterior √© limpo <em>ap√≥s</em> a nova renderiza√ß√£o com novas <em>props</em></strong>:</p>
<ul>
<li><strong>React renderiza a interface do usu√°rio para <code class="language-text">{id: 20}</code>.</strong></li>
<li>O navegador pinta a tela. N√≥s vemos a interface do usu√°rio para <code class="language-text">{id: 20}</code>na tela.</li>
<li><strong>React limpa o efeito para <code class="language-text">{id: 10}</code>.</strong></li>
<li>React executa o efeito para <code class="language-text">{id: 20}</code>.</li>
</ul>
<p>Voc√™ pode estar se perguntando: mas como a limpeza do efeito anterior ainda pode ‚Äúver‚Äù as <em>props</em> <code class="language-text">{id: 10}</code> se ele foi executado depois que os adere√ßos mudaram para <code class="language-text">{id: 20}</code>?</p>
<p>N√≥s estivemos aqui antes‚Ä¶ü§î</p>
<p><img src="/deja_vu-5fe238cf03a21dfa32af624124fcdcff.gif" alt="D√©j√† vu (cena do gato do filme Matrix)"></p>
<p>Citando a se√ß√£o anterior:</p>
<blockquote>
<p>Todas as fun√ß√µes dentro da renderiza√ß√£o do componente (incluindo manipuladores de eventos, efeitos, temporizadores ou chamadas de API dentro delas) capturam <em>props</em> e <em>state</em> da chamada de renderiza√ß√£o que a definiu.</p>
</blockquote>
<p>Agora a resposta √© clara! A limpeza do efeito n√£o l√™ as <em>props</em> ‚Äúmais recentes‚Äù, o que quer que isso signifique. Ela l√™ as <em>props</em> que pertencem √† renderiza√ß√£o que a definiu:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Primeira renderiza√ß√£o, props s√£o {id: 10}</span>
<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// Efeito da primeirza renderiza√ß√£o</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">      <span class="token comment">// Limpeza para o efeito da primeira renderiza√ß√£o</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Pr√≥xima renderiza√ß√£o, props s√£o {id: 20}</span>
<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// Efeito da segunda renderiza√ß√£o</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Limpeza para o efeito da segunda renderiza√ß√£o</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Reinos se elevar√£o e se transformar√£o em cinzas, o Sol ir√° ejetar suas camadas externas e se tornar uma <a href="https://pt.wikipedia.org/wiki/An%C3%A3_branca" target="_blank" rel="nofollow noopener noreferrer">an√£ branca</a> e a √∫ltima civiliza√ß√£o terminar√°. Mas nada far√° com que as <em>props</em> utilizadas pela etapa de limpeza da primeira renderiza√ß√£o sejam outras do que <code class="language-text">{id: 10}</code>.</p>
<p>Isso √© o que permite que o React lide com os efeitos logo ap√≥s a pintura - tornando seus aplicativos mais r√°pidos por padr√£o. As <em>props</em> antigas ainda est√£o l√°, se o nosso c√≥digo precisar delas.</p>
<h2 id="sincroniza√ß√£o-n√£o-ciclos-de-vida"><a href="#sincroniza%C3%A7%C3%A3o-n%C3%A3o-ciclos-de-vida" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sincroniza√ß√£o, n√£o Ciclos de Vida</h2>
<p>Uma das minhas coisas favoritas sobre o React √© que ele unifica a descri√ß√£o do resultado inicial da renderiza√ß√£o e das atualiza√ß√µes. Isso <a href="https://overreacted.io/the-bug-o-notation/" target="_blank" rel="nofollow noopener noreferrer">reduz a entropia do seu programa</a>.</p>
<p>Digamos que meu componente √© o seguinte:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>N√£o importa se eu renderizo <code class="language-text">&lt;Greeting name=&quot;Dan&quot; /&gt;</code> e depois <code class="language-text">&lt;Greeting name=&quot;Yuzhi&quot; /&gt;</code>, ou se apenas renderizo <code class="language-text">&lt;Greeting name=&quot;Yuzhi&quot; /&gt;</code>. No final, vamos ver <code class="language-text">&quot;Hello, Yuzhi&quot;</code> em ambos os casos.</p>
<p>As pessoas dizem: ‚Äú√â tudo sobre a jornada, n√£o o destino‚Äù. Com React, √© o oposto. <strong>√â tudo sobre o destino, n√£o a jornada</strong>. Essa √© a diferen√ßa entre as chamadas <code class="language-text">$.addClass</code> e <code class="language-text">$.removeClass</code> no c√≥digo jQuery (nossa ‚Äújornada‚Äù) e especificando <em>qual deve</em> ser a classe CSS no c√≥digo React (nosso ‚Äúdestino‚Äù).</p>
<p><strong>React sincroniza o DOM de acordo com nossas <em>props</em> e <em>state</em> atuais.</strong> N√£o h√° distin√ß√£o entre uma ‚Äúmontagem‚Äù ou uma ‚Äúatualiza√ß√£o‚Äù durante a renderiza√ß√£o.</p>
<p>Voc√™ deve pensar nos efeitos de maneira semelhante. <strong><code class="language-text">useEffect</code> permite sincronizar as coisas fora da √°rvore do React de acordo com as nossas <em>props</em> e <em>state</em></strong>.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Isso √© sutilmente diferente do modelo mental familiar de montagem/atualiza√ß√£o/desmontagem. <strong>√â importante realmente internalizar isso. Se voc√™ est√° tentando escrever um efeito que se comporta de maneira diferente dependendo se o componente renderiza pela primeira vez ou n√£o, voc√™ est√° nadando contra a mar√©!</strong> Falhamos em sincronizar se nosso resultado depende da ‚Äújornada‚Äù e n√£o do ‚Äúdestino‚Äù.</p>
<p>N√£o importa se renderizamos com as <em>props</em> A, B e C, ou se renderizamos com C imediatamente. Embora possa haver algumas diferen√ßas tempor√°rias (por exemplo, enquanto estamos buscando dados), eventualmente, o resultado final deve ser o mesmo.</p>
<p>Ainda assim, √© claro que executar todos os efeitos em cada render pode n√£o ser eficiente. (E em alguns casos, isso levaria a loops infinitos.)</p>
<p>Ent√£o, como podemos consertar isso?</p>
<h2 id="ensinando-react-a-diferenciar-seus-efeitos"><a href="#ensinando-react-a-diferenciar-seus-efeitos" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ensinando React a diferenciar seus efeitos</h2>
<p>N√≥s j√° aprendemos essa li√ß√£o com o pr√≥prio DOM. Ao inv√©s de alter√°-lo em cada nova renderiza√ß√£o, o React s√≥ atualiza as partes do DOM que realmente mudam.</p>
<p>Quando voc√™ est√° atualizando:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  Hello, Dan
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre></div>
<p>Para:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  Hello, Yuzhi
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre></div>
<p>React v√™ dois objetos:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> oldProps <span class="token operator">=</span> <span class="token punctuation">{</span>className<span class="token punctuation">:</span> <span class="token string">'Greeting'</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newProps <span class="token operator">=</span> <span class="token punctuation">{</span>className<span class="token punctuation">:</span> <span class="token string">'Greeting'</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token string">'Hello, Yuzhi'</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>React verifica cada uma de suas <em>props</em> e determina que <code class="language-text">children</code> mudou e por isso, precisa realizar uma atualiza√ß√£o no DOM, mas <code class="language-text">className</code> n√£o mudou. Ent√£o, ele pode apenas fazer:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">domNode<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'Hello, Yuzhi'</span><span class="token punctuation">;</span>
<span class="token comment">// N√£o precisa tocar `domNode.className`</span></code></pre></div>
<p><strong>Podemos fazer algo assim com efeitos tamb√©m? Seria bom evitar sua execu√ß√£o quando desnecess√°rio.</strong></p>
<p>Por exemplo, talvez nosso componente renderize novamente devido a uma altera√ß√£o de estado:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCounter</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">        Increment</span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Mas nosso efeito n√£o usa o estado <code class="language-text">counter</code>. <strong>Nosso efeito sincroniza o <code class="language-text">document.title</code> com a prop <code class="language-text">name</code>, mas nesse caso, a prop <code class="language-text">name</code> √© a mesma</strong>. Reatribuir <code class="language-text">document.title</code> em cada mudan√ßa de <code class="language-text">counter</code> n√£o √© ideal.</p>
<p>Certo, ent√£o‚Ä¶ React pode checar a diferen√ßa em efeitos?</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> <span class="token function-variable function">oldEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">newEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// O React pode ver entender que essas fun√ß√µes fazem a mesma coisa?</span></code></pre></div>
<p>Na verdade n√£o. React n√£o pode adivinhar o que a fun√ß√£o faz sem cham√°-la. (O c√≥digo fonte realmente n√£o cont√©m valores espec√≠ficos, apenas encapsula a prop <code class="language-text">name</code>.)</p>
<p>√â por isso que, se voc√™ quiser evitar a repeti√ß√£o desnecess√°rias de efeitos, voc√™ pode fornecer um array de depend√™ncias como segundo argumento (tamb√©m conhecido como ‚Äúdeps‚Äù) para <code class="language-text">useEffect</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Nossas "deps"</span></span></code></pre></div>
<p><strong>√â como dizer ao React: ‚ÄúEi, eu sei que voc√™ n√£o pode ‚Äúver‚Äù dentro desta fun√ß√£o, mas eu prometo que s√≥ a prop <code class="language-text">name</code> √© usada do escopo de renderiza√ß√£o e nada mais.‚Äù</strong></p>
<p>Se cada um desses valores for o mesmo entre a renderiza√ß√£o atual e a anterior, esse efeito n√£o ser√° sincronizado, portanto, o React pode pular o efeito:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">oldEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> oldDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Dan'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">newEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Dan'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// React n√£o pode "olhar" dentro de fun√ß√µes, apenas em "deps"</span>
<span class="token comment">// Como todas as "deps" s√£o as mesmas, ele n√£o precisa executar o efeito</span></code></pre></div>
<p>Se mesmo um dos valores do array de depend√™ncias for diferente entre renderiza√ß√µes, sabemos que a execu√ß√£o do efeito n√£o ser√° ignorada. Sincronizando todas as coisas!</p>
<h2 id="mentir-para-o-react-sobre-suas-deps-pode-causar-problemas"><a href="#mentir-para-o-react-sobre-suas-deps-pode-causar-problemas" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mentir para o React sobre suas ‚Äúdeps‚Äù pode causar problemas</h2>
<p>Mentir para o React sobre suas ‚Äúdeps‚Äù tem consequ√™ncias ruins. Intuitivamente, isso faz sentido, mas eu vi praticamente todo mundo que tenta usar <code class="language-text">useEffect</code> com um modelo mental das <code class="language-text">class</code>, tenta enganar as regras! (E eu fiz isso tamb√©m no come√ßo!)</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Isso √© certo? Nem sempre -- e tem um jeito melhor de escrever isso.</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>(O <a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="nofollow noopener noreferrer">FAQ dos Hooks explica</a> o que fazer ao inv√©s do exemplo acima. <a href="https://overreacted.io/a-complete-guide-to-useeffect/#moving-functions-inside-effects" target="_blank" rel="nofollow noopener noreferrer">Voltaremos nesse exemplo</a> mais para frente.)</em></p>
<p>‚ÄúMas eu s√≥ quero executar isso ao montar o componente!‚Äù, Voc√™ dir√°. Por enquanto, lembre-se: se voc√™ especificar ‚Äúdeps‚Äù, <strong>todos os valores de dentro de seu componente que s√£o usados ‚Äã‚Äãpelo efeito devem ser listados l√°</strong>. Incluindo <em>props</em>, <em>state</em>, fun√ß√µes - qualquer coisa no escopo do seu componente usado dentro do efeito.</p>
<p>√Äs vezes, quando voc√™ faz isso, isso causa algum problema. Por exemplo, talvez voc√™ veja um loop de infinito ao buscar dados ou um <strong>socket</strong> √© recriado com muita freq√º√™ncia. <strong>A solu√ß√£o para esse problema n√£o √© remover a depend√™ncia</strong> e iremos ver as solu√ß√µes em breve.</p>
<p>Mas antes de pularmos para as solu√ß√µes, vamos entender melhor o problema.</p>
<h2 id="o-que-acontece-se-mentirmos-na-nossa-lista-de-deps"><a href="#o-que-acontece-se-mentirmos-na-nossa-lista-de-deps" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>O que acontece se mentirmos na nossa lista de ‚Äúdeps‚Äù</h2>
<p>Se na nossa lista de ‚Äúdeps‚Äù estiverem todos os valores usados ‚Äã‚Äãpelo efeito, o React saber√° quando execut√°-lo novamente:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p><img src="/deps-compare-correct-fae247cd068eedbd4b62ba50592d2b3d.gif" alt="Diagrama de efeitos substituindo uns aos outros"></p>
<p><em>(Quando as depend√™ncias s√£o diferentes, n√≥s executamos novamente o efeito.)</em></p>
<p>Mas se especificamos <code class="language-text">[]</code> para este efeito, a nova fun√ß√£o de efeito n√£o seria executada:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Errado: `name` est√° faltando na lista de "deps"</span></span></code></pre></div>
<p><img src="/deps-compare-wrong-25f75db3f9f57ffe1426912093577445.gif" alt="Diagrama de efeitos substituindo uns aos outros"></p>
<p><em>(Como as depend√™ncias s√£o iguais, n√≥s pulamos o efeito.)</em></p>
<p>Nesse caso, o problema pode parecer √≥bvio. Mas a intui√ß√£o pode engan√°-lo em outros casos, especialmente se sua mem√≥ria muscular lembrar de solu√ß√µes com <em>class</em>.</p>
<p>Por exemplo, digamos que estamos escrevendo um contador que aumenta a cada segundo. Com <code class="language-text">class</code>, nossa intui√ß√£o √©: ‚ÄúConfigure o intervalo uma vez e destrua-o uma vez‚Äù. Aqui est√° um <a href="https://codesandbox.io/s/n5mjzjy9kl" target="_blank" rel="nofollow noopener noreferrer">exemplo</a> de como podemos fazer isso. Quando traduzimos mentalmente esse c√≥digo em <code class="language-text">useEffect</code>, instintivamente adicionamos <code class="language-text">[]</code> a lista de ‚Äúdeps‚Äù. ‚ÄúEu quero que seja executado uma vez‚Äù, certo?</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>No entanto, este exemplo <a href="https://codesandbox.io/s/91n5z8jo7r" target="_blank" rel="nofollow noopener noreferrer">s√≥ incrementa uma vez</a>. <em>Oops.</em></p>
<p>Se o seu modelo mental √© ‚Äúdepend√™ncias, deixe-me especificar quando quero reativar o efeito‚Äù, este exemplo pode dar a voc√™ uma crise existencial. Voc√™ <em>quer</em> acion√°-lo uma vez porque √© um intervalo - ent√£o por que ele est√° causando problemas?</p>
<p>No entanto, isso faz sentido se voc√™ sabe que a lista de depend√™ncias s√£o nossas dicas para o React sobre <em>tudo</em> o que o efeito usa do escopo de renderiza√ß√£o. Ele usa, <code class="language-text">count</code>, mas n√≥s mentimos para o React, dizendo que isso n√£o acontece com <code class="language-text">[]</code>. √â s√≥ uma quest√£o de tempo antes que isso nos morde de volta!</p>
<p>Na primeira renderiza√ß√£o, <code class="language-text">count</code> √© <code class="language-text">0</code>. Portanto, <code class="language-text">setCount(count + 1)</code> no primeiro efeito de renderiza√ß√£o significa <code class="language-text">setCount(0 + 1)</code>. <strong>Como nunca executamos novamente o efeito por causa das ‚Äúdeps‚Äù <code class="language-text">[]</code>, ele continuar√° chamando <code class="language-text">setCount(0 + 1)</code> cada segundo:</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Primeira renderiza√ß√£o, `state` √© 0</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// Efeito da primeira renderiza√ß√£o</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Always setCount(1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// Nunca re-execute o efeito</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Toda renderiza√ß√£o subsequente, `state` √© 1</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// Esse efeito √© sempre ignorado porque</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// n√≥s mentimos para o React sobre a lista</span></span>    <span class="token comment">// em branco de depend√™ncias</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>N√≥s mentimos para o React dizendo que nosso efeito n√£o depende de um valor de dentro de nosso componente, quando na verdade ele depende!</p>
<p>Nosso efeito usa <code class="language-text">count</code> - um valor dentro do escopo de renderiza√ß√£o do componente, por√©m fora do efeito:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token comment">// ...</span></span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Portanto, especificar <code class="language-text">[]</code> como uma depend√™ncia criar√° um erro. O React ir√° comparar as depend√™ncias e pular√° a atualiza√ß√£o desse efeito:</p>
<p><img src="/interval-wrong-29e53bd0c9b7d2ac70d3cd924886b030.gif" alt="Diagrama da closure do intervalo j√° obsoleto"></p>
<p><em>(As depend√™ncias s√£o iguais, ent√£o pulamos o efeito.)</em></p>
<p>Quest√µes como essa s√£o dif√≠ceis de se pensar. Portanto, eu te encorajo a adotar como uma regra rigorosa de sempre ser honesto sobre suas depend√™ncias de efeito e especificar todas elas. Fornecemos <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="nofollow noopener noreferrer">uma regra no linter</a> se voc√™ quiser impor isso ao seu time.</p>
<h2 id="duas-maneiras-de-ser-honesto-sobre-suas-depend√™ncias"><a href="#duas-maneiras-de-ser-honesto-sobre-suas-depend%C3%AAncias" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Duas maneiras de ser honesto sobre suas depend√™ncias</h2>
<p>Existem duas estrat√©gias para ser honesto sobre suas depend√™ncias. Geralmente, voc√™ deve come√ßar com o primeiro e depois aplicar o segundo, se necess√°rio.</p>
<p><strong>A primeira estrat√©gia √© arrumar o array de depend√™ncias para incluir todos os valores do escopo do componente que s√£o usados ‚Äã‚Äãdentro do efeito.</strong> Vamos incluir <code class="language-text">count</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>Isso faz com que o array de depend√™ncias fique correto. Pode n√£o ser <em>ideal</em>, mas esse √© o primeiro problema que precisamos corrigir. Agora, uma mudan√ßa em <code class="language-text">count</code> ir√° executar o efeito novamente, com cada pr√≥ximo intervalo referenciando <code class="language-text">count</code> do escopo de renderiza√ß√£o do seu component em <code class="language-text">setCount(count + 1)</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Primeira renderiza√ß√£o, `state` √© 0</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// Efeito na primeira renderiza√ß√£o</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// setCount(count + 1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// [count]</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Segunda renderiza√ß√£o, `state` √© 1</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// Effect from second render</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// setCount(count + 1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// [count]</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Isso <a href="https://codesandbox.io/s/0x0mnlyq8l" target="_blank" rel="nofollow noopener noreferrer">resolveria o problema</a>, mas nosso intervalo seria limpo e definido novamente sempre que altera√ß√µes no <code class="language-text">count</code> fossem feitas. Isso pode ser indesej√°vel:</p>
<p><img src="/interval-rightish-5734271ddfa94d2d65ac6160515e0069.gif" alt="Diagrama do intervalo que se reinscreve"></p>
<p><em>(As depend√™ncias s√£o diferentes, ent√£o executamos novamente o efeito.)</em></p>
<hr>
<p><strong>A segunda estrat√©gia √© alterar o c√≥digo do nosso efeito para que ele n√£o <em>precise</em> de um valor que mude com mais frequ√™ncia do que desejamos.</strong> N√≥s n√£o queremos mentir sobre as depend√™ncias - apenas queremos que nosso efeito tenha menos depend√™ncias.</p>
<p>Vamos ver algumas t√©cnicas comuns para remover depend√™ncias.</p>
<hr>
<h2 id="tornando-os-efeitos-auto-suficientes"><a href="#tornando-os-efeitos-auto-suficientes" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tornando os Efeitos Auto-Suficientes</h2>
<p>Queremos nos livrar de <code class="language-text">count</code> na lista de depend√™ncias em nosso efeito:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>Para fazer isso, precisamos nos perguntar: para que estamos utilizando <code class="language-text">count</code>? Parece que s√≥ usamos para a chamada de <code class="language-text">setCount</code>. E para esse caso, realmente n√£o precisamos de <code class="language-text">count</code>. Quando queremos atualizar o estado com base no estado anterior, podemos usar <a href="https://reactjs.org/docs/hooks-reference.html#functional-updates" target="_blank" rel="nofollow noopener noreferrer">a forma funcional</a> do <code class="language-text">setState</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Eu gosto de pensar nesses casos como ‚Äúfalsas depend√™ncias‚Äù. Sim, <code class="language-text">count</code> foi uma depend√™ncia necess√°ria porque escrevemos <code class="language-text">setCount(count + 1)</code> dentro do efeito. No entando, n√≥s s√≥ precis√°vamos de <code class="language-text">count</code> para transform√°-lo em <code class="language-text">count + 1</code> e ‚Äúenviar de volta‚Äù para o React. Mas o React <em>j√° conhece</em> o atual valor de <code class="language-text">count</code>. <strong>O que precisamos dizer ao React √© que ele incremente o estado - qualquer que seja seu valor atual.</strong></p>
<p>Isso √© exatamente o que <code class="language-text">setCount(c =&gt; c + 1)</code> faz. Voc√™ pode pensar nisso como ‚Äúenviar uma instru√ß√£o‚Äù para o React de como o estado deve mudar. Essa ‚Äúforma funcional‚Äù tamb√©m ajuda em outros casos, como quando voc√™ faz <a href="https://overreacted.io/react-as-a-ui-runtime/#batching" target="_blank" rel="nofollow noopener noreferrer">atualiza√ß√µes em lotes</a>.</p>
<p><strong>Perceba que n√≥s realmente <em>fizemos o trabalho</em> para remover a depend√™ncia. N√≥s n√£o trapace√°mos. Nosso efeito n√£o l√™ mais o valor <code class="language-text">count</code> do escopo de renderiza√ß√£o:</strong></p>
<p><img src="/interval-right-f128ad20c28317ed27a3cb68197fc906.gif" alt="Diagrama do interval que funciona"></p>
<p><em>(As depend√™ncias s√£o iguais, ent√£o pulamos o efeito.)</em></p>
<p>Voc√™ pode <a href="https://codesandbox.io/s/q3181xz1pj" target="_blank" rel="nofollow noopener noreferrer">tentar aqui</a>.</p>
<p>Embora esse efeito seja executado apenas uma vez, o retorno de chamada do intervalo que definimos pertencente √† primeira renderiza√ß√£o, √© perfeitamente capaz de enviar a instru√ß√£o de atualiza√ß√£o<code class="language-text">c =&gt; c + 1</code>  toda vez que o intervalo √© disparado. N√£o precisamos mais saber o estado atual de <code class="language-text">count</code>. React j√° o conhece.</p>
<h2 id="atualiza√ß√µes-funcionais-e-google-docs"><a href="#atualiza%C3%A7%C3%B5es-funcionais-e-google-docs" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Atualiza√ß√µes Funcionais e Google Docs</h2>
<p>Lembra que falamos sobre sincroniza√ß√£o sendo o modelo mental para efeitos? Um aspecto interessante da sincroniza√ß√£o √© que muitas vezes voc√™ deseja manter as ‚Äúmensagens‚Äù entre os sistemas separados de seu estado. Por exemplo, editar um documento no Google Docs n√£o envia a <em>p√°gina inteira</em> para o servidor. Isso seria muito ineficiente. Ao inv√©s disso, ele envia uma representa√ß√£o do que o usu√°rio tentou fazer.</p>
<p>Embora nosso caso de uso seja diferente, uma filosofia semelhante se aplica aos efeitos. <strong>Precisamos enviar apenas as informa√ß√µes m√≠nimas necess√°rias de dentro dos efeitos para um componente.</strong> O atualizador <code class="language-text">setCount(c =&gt; c + 1)</code>, por exemplo, tem menos informa√ß√µes do que <code class="language-text">setCount(count + 1)</code> porque ele n√£o est√° ‚Äúcontaminado‚Äù pela contagem atual. Ele apenas expressa a a√ß√£o desejada (‚Äúincrementar‚Äù). Pensar em React <a href="https://reactjs.org/docs/thinking-in-react.html#step-3-identify-the-minimal-but-complete-representation-of-ui-state" target="_blank" rel="nofollow noopener noreferrer">envolve encontrar o estado m√≠nimo</a>. √â o mesmo princ√≠pio, mas para atualiza√ß√µes.</p>
<p>Codificar a <em>inten√ß√£o</em> (ao inv√©s do resultado) √© semelhante a como o Google Docs <a href="https://medium.com/@srijancse/how-real-time-collaborative-editing-work-operational-transformation-ac4902d75682" target="_blank" rel="nofollow noopener noreferrer">resolve</a> a edi√ß√£o colaborativa. Embora tenhamos ampliando a analogia, as atualiza√ß√µes funcionais desempenham um papel semelhante no React. Eles garantem que atualiza√ß√µes de v√°rias fontes (manipuladores de eventos, assinaturas de efeitos, etc) possam ser aplicadas corretamente em um lote e de maneira previs√≠vel.</p>
<p><strong>No entanto, <code class="language-text">setCount(c =&gt; c + 1)</code> n√£o √© √≥timo.</strong> Parece um pouco estranho e √© muito limitado no que pode ele fazer. Por exemplo, se tiv√©ssemos duas vari√°veis ‚Äã‚Äãde estado cujos valores dependessem uns dos outros, ou se precisarmos calcular o pr√≥ximo estado com base em uma <em>prop</em>, isso n√£o nos ajudaria. Felizmente, <code class="language-text">setCount(c =&gt; c + 1)</code> tem um padr√£o poderoso. Seu nome √© <code class="language-text">useReducer</code>.</p>
<h2 id="desacoplando-atualiza√ß√µes-de-a√ß√µes"><a href="#desacoplando-atualiza%C3%A7%C3%B5es-de-a%C3%A7%C3%B5es" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Desacoplando Atualiza√ß√µes de A√ß√µes</h2>
<p>Vamos modificar o exemplo anterior para ter duas vari√°veis ‚Äã‚Äãde estado: <code class="language-text">count</code> e <code class="language-text">step</code>. Nosso intervalo ir√° incrementar o valor de <code class="language-text">count</code> pelo valor de entrada do <code class="language-text">step</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>step<span class="token punctuation">,</span> setStep<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c <span class="token operator">+</span> step<span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>step<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>step<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>e <span class="token operator">=></span> <span class="token function">setStep</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(Aqui est√° uma <a href="https://codesandbox.io/s/zxn70rnkx" target="_blank" rel="nofollow noopener noreferrer">demonstra√ß√£o</a> .)</p>
<p>Note que <strong>n√£o estamos trapaceando</strong>. Desde que comecei a usar <code class="language-text">step</code> dentro do efeito, eu adicionei ele nas depend√™ncias. E √© por isso que o c√≥digo √© executado corretamente.</p>
<p>O comportamento atual neste exemplo √© que realizando uma mudan√ßa em <code class="language-text">step</code>, reinicia o intervalo - porque ele √© uma das depend√™ncias. E em muitos casos, √© exatamente isso que voc√™ quer! N√£o h√° nada de errado em encerrar um efeito e defini-lo de novo, e n√£o devemos evitar isso a menos que tenhamos um bom motivo.</p>
<p>No entanto, digamos que queremos que o rel√≥gio de intervalo n√£o seja redefinido nas altera√ß√µes para o <code class="language-text">step</code>. Como removemos <code class="language-text">step</code> da depend√™ncia do nosso efeito?</p>
<p><strong>Ao definir uma vari√°vel de estado depende do valor atual de outra vari√°vel de estado, voc√™ pode tentar substituir ambos por <code class="language-text">useReducer</code>.</strong></p>
<p>Quando voc√™ se encontrar escrevendo <code class="language-text">setSomething(something =&gt; ...)</code>, √© um bom momento para considerar o uso de um redutor. Um redutor permite <strong>desassociar as ‚Äúa√ß√µes‚Äù que ocorreram em seu componente de como o estado √© atualizado.</strong></p>
<p>Vamos trocar a depend√™ncia <code class="language-text">step</code> por um <code class="language-text">dispatch</code> em nosso efeito:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'tick'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ao inv√©s de `setCount(c => c + step)`</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>(Veja aqui <a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="nofollow noopener noreferrer">uma demonstra√ß√£o</a>.)</p>
<p>Voc√™ pode me perguntar: ‚ÄúComo isso √© melhor?‚Äù A resposta √© que o <strong>React garante que a fun√ß√£o <code class="language-text">dispatch</code> seja constante durante toda a vida √∫til do componente. Portanto, o exemplo acima nunca precisa reescrever o intervalo.</strong></p>
<p>N√≥s resolvemos nosso problema!</p>
<p><em>(Voc√™ pode omitir os valores de <code class="language-text">dispatch</code>, <code class="language-text">setState</code> e <code class="language-text">useRef</code> das ‚Äúdeps‚Äù porque React garante que eles sejam est√°ticos. Mas tamb√©m n√£o faz mal especific√°-los.)</em></p>
<p>Ao inv√©s de ler o estado <em>dentro</em> de um efeito, ele envia uma <em>a√ß√£o</em> que descreve as informa√ß√µes <em>sobre o que aconteceu</em>. Isso permite que nosso efeito fique desacoplado do estado <code class="language-text">step</code>. Nosso efeito n√£o se importa em <em>como</em> atualizamos o estado, apenas nos informa <em>sobre o que aconteceu</em>. O redutor centraliza a l√≥gica de atualiza√ß√£o:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  step<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'tick'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> count <span class="token operator">+</span> step<span class="token punctuation">,</span> step <span class="token punctuation">}</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'step'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step<span class="token punctuation">:</span> action<span class="token punctuation">.</span>step <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(Aqui est√° <a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="nofollow noopener noreferrer">uma demonstra√ß√£o</a>, se voc√™ n√£o viu o link mais cedo).</p>
<h2 id="por-que-usereducer-√©-o-modo-trapa√ßa-dos-hooks"><a href="#por-que-usereducer-%C3%A9-o-modo-trapa%C3%A7a-dos-hooks" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Por que useReducer √© o ‚ÄúModo Trapa√ßa‚Äù dos Hooks</h2>
<p>N√≥s vimos como remover depend√™ncias quando um efeito precisa definir o estado com base no estado anterior ou em outra vari√°vel de estado. <strong>Mas e se precisarmos de ferramentas para calcular o pr√≥ximo estado?</strong> Por exemplo, talvez nossa API seja <code class="language-text">&lt;Counter step={1} /&gt;</code>. Certamente n√£o podemos evitar especificar <code class="language-text">props.step</code> como uma depend√™ncia, certo?</p>
<p>Na verdade, n√≥s podemos! Podemos colocar o redutor em si dentro do nosso componente para ler <em>props</em>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> step <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'tick'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> state <span class="token operator">+</span> step<span class="token punctuation">;</span></span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'tick'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Esse padr√£o desativa algumas otimiza√ß√µes, ent√£o tente n√£o us√°-lo em todos os lugares, mas voc√™ pode acessar totalmente suas <em>props</em> em um redutor se precisar. (Aqui est√° <a href="https://codesandbox.io/s/7ypm405o8q" target="_blank" rel="nofollow noopener noreferrer">uma demonstra√ß√£o</a>.)</p>
<p><strong>Mesmo nesse caso, a identidade do <code class="language-text">dispatch</code> ainda √© garantida como est√°vel entre as renderiza√ß√µes.</strong> Ent√£o voc√™ pode omiti-lo das deps de efeito, se quiser. Isso n√£o far√° com que o efeito seja executado novamente.</p>
<p>Voc√™ pode estar se perguntando: como isso funciona? Como o redutor ‚Äúsabe‚Äù as <em>props</em> chamadas de dentro de um efeito que pertence a outra renderiza√ß√£o? A resposta √© que, quando voc√™ usa <code class="language-text">dispatch</code>, React lembra a a√ß√£o - mas ele ir√° chamar seu redutor durante a pr√≥xima renderiza√ß√£o. Nesse ponto, as <em>props</em> novas estar√£o no escopo e voc√™ n√£o estar√° dentro de um efeito.</p>
<p><strong>√â por isso que eu gosto de pensar em <code class="language-text">useReducer</code> como o ‚ÄúModo Trapa√ßa‚Äù dos Hooks. Isso me permite desacoplar a l√≥gica de atualiza√ß√£o da descri√ß√£o do que aconteceu. Isso, por sua vez, me ajuda a remover depend√™ncias desnecess√°rias de meus efeitos e a evitar que sejam executados novamente com mais frequ√™ncia do que o necess√°rio.</strong></p>
<h2 id="movendo-fun√ß√µes-para-dentro-dos-efeitos"><a href="#movendo-fun%C3%A7%C3%B5es-para-dentro-dos-efeitos" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Movendo Fun√ß√µes Para Dentro Dos Efeitos</h2>
<p>Um erro comum √© pensar que as fun√ß√µes n√£o devem ser depend√™ncias. Por exemplo, isso parece funciona:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hits<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span>
      <span class="token string">'https://hn.algolia.com/api/v1/search?query=react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Isso t√° certo, n√©?</span></span>
  <span class="token comment">// ...</span></code></pre></div>
<p><em>(<a href="https://codesandbox.io/s/8j4ykjyv0" target="_blank" rel="nofollow noopener noreferrer">Este exemplo</a> √© adaptado de um √≥timo artigo do Robin Wieruch - <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">confira</a>!)</em></p>
<p>E para ser claro, esse c√≥digo <em>funciona</em>. <strong>Mas o problema de simplesmente omitir fun√ß√µes locais √© que fica dif√≠cil saber se estamos lidando com todos os casos √† medida que o componente cresce!</strong></p>
<p>Imagine que nosso c√≥digo foi dividido e cada fun√ß√£o era cinco vezes maior:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Imagine que essa fun√ß√£o √© longa</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query=react'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Imagine que essa fun√ß√£o tamb√©m √© longa</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Agora vamos dizer que futuramente usamos algum estado ou <em>props</em> em uma dessas fun√ß√µes:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Imagine que essa fun√ß√£o tamb√©m √© longa</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span>  <span class="token punctuation">}</span>

  <span class="token comment">// Imagine que essa fun√ß√£o tamb√©m √© longa</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Se nos esquecermos de atualizar as deps de qualquer um desses efeitos que chamam essas fun√ß√µes (possivelmente, atrav√©s de outras fun√ß√µes!), Nossos efeitos n√£o conseguir√£o sincronizar as mudan√ßas de nossas <em>props</em> e <em>state</em>. Isso n√£o soa ideal!</p>
<p>Luckily, there is an easy solution to this problem. <strong>If you only use some functions <em>inside</em> an effect, move them directly <em>into</em> that effect:</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// Movemos a fun√ß√£o para dentro do efeito!</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query=react'</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ‚úÖ As depend√™ncias est√£o corretas</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(<a href="https://codesandbox.io/s/04kp3jwwql" target="_blank" rel="nofollow noopener noreferrer">Aqui est√° uma demonstra√ß√£o</a>.)</p>
<p>Ent√£o, qual √© o benef√≠cio? N√£o precisamos mais pensar nas ‚Äúdepend√™ncias transitivas‚Äù. Nosso array de depend√™ncias n√£o est√° mais ocupado: <strong>realmente <em>n√£o</em> estamos usando nada do escopo externo do componente em nosso efeito.</strong></p>
<p>Se mudarmos <code class="language-text">getFetchUrl</code> para usar o estado <code class="language-text">query</code>, teremos uma probabilidade maior de perceber que estamos editando isso <em>dentro</em> de um efeito - e, portanto, precisamos adicionar <code class="language-text">query</code> √†s depend√™ncias do efeito:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span>    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ‚úÖ As depend√™ncias est√£o corretas</span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(Aqui est√° <a href="https://codesandbox.io/s/pwm32zx7z7" target="_blank" rel="nofollow noopener noreferrer">uma demonstra√ß√£o</a>.)</p>
<p>By adding this dependency, we‚Äôre not just ‚Äúappeasing React‚Äù. It <em>makes sense</em> to refetch the data when the query changes. <strong>The design of <code class="language-text">useEffect</code> forces you to notice the change in our data flow and choose how our effects should synchronize it ‚Äî instead of ignoring it until our product users hit a bug.</strong></p>
<p>Gra√ßas a regra <code class="language-text">exhaustive-deps</code> plugin <code class="language-text">eslint-plugin-react-hooks</code>, <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="nofollow noopener noreferrer">ele pode analisar os efeitos enquanto voc√™ digita no seu editor</a> e recebe sugest√µes sobre quais depend√™ncias est√£o faltando. Em outras palavras, uma m√°quina pode informar quais altera√ß√µes no fluxo de dados n√£o est√£o sendo tratadas corretamente por um componente:</p>
<p><img src="/exhaustive-deps-04a90dcbacb01105d634964880ebed19.gif" alt="Gif da regra do linter"></p>
<p>Bem maneiro.</p>
<h2 id="mas-eu-n√£o-posso-colocar-essa-fun√ß√£o-dentro-de-um-efeito"><a href="#mas-eu-n%C3%A3o-posso-colocar-essa-fun%C3%A7%C3%A3o-dentro-de-um-efeito" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mas Eu N√£o Posso Colocar Essa Fun√ß√£o Dentro De Um Efeito</h2>
<p>√Äs vezes voc√™ pode n√£o vai querer mover uma fun√ß√£o para dentro de um efeito. Por exemplo, v√°rios efeitos no mesmo componente podem chamar a mesma fun√ß√£o e voc√™ n√£o quer copiar e colar sua l√≥gica. Ou talvez seja uma <em>prop</em>.</p>
<p>Voc√™ deve evitar colocar uma fun√ß√£o como esta nas depend√™ncias do efeito? Eu acredito que n√£o. Novamente, os <strong>efeitos n√£o devem mentir sobre suas depend√™ncias.</strong> Geralmente existem solu√ß√µes melhores. Um equ√≠voco comum √© que ‚Äúuma fun√ß√£o nunca mudaria‚Äù. Mas, como aprendemos ao longo deste artigo, isso est√° longe de ser verdade. Na verdade, uma fun√ß√£o definida dentro de um componente muda em cada renderiza√ß√£o!</p>
<p><strong>Isso por si s√≥ apresenta um problema.</strong> Vamos dizer que dois efeitos chama <code class="language-text">getFetchUrl</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Busca dados e faz algo ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// üî¥ Depend√™ncia em falta: getFetchUrl</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Busca dados e faz algo ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// üî¥ Depend√™ncia em falta: getFetchUrl</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Nesse caso, talvez voc√™ n√£o queira mover <code class="language-text">getFetchUrldentro</code> para dentro de nenhum dos efeitos, pois n√£o seria capaz de compartilhar a l√≥gica.</p>
<p>Por outro lado, se voc√™ for ‚Äúhonesto‚Äù sobre as depend√™ncias de efeitos, poder√° encontrar um problema. Como ambos os nossos efeitos dependem de <code class="language-text">getFetchUrl</code> <strong>(o que √© diferente em cada renderiza√ß√£o)</strong>, nossos arrays de depend√™ncia s√£o in√∫teis:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token comment">// üî¥ Re-executa todos os efeitos em cada renderiza√ß√£o</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Busca dados e faz algo ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// üöß As depend√™ncias est√£o corretas, mas elas mudam frequentemente</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Busca dados e faz algo ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// üöß As depend√™ncias est√£o corretas, mas elas mudam frequentemente</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Uma solu√ß√£o tentadora para isso √© simplesmente evitar <code class="language-text">getFetchUrl</code> na lista de depend√™ncias. No entanto, n√£o acho que seja uma boa solu√ß√£o. Isso torna dif√≠cil perceber quando <em>estamos</em> adicionando uma altera√ß√£o no fluxo de dados que <em>precisa</em> ser tratado por um efeito. Isso leva a erros como o ‚Äúintervalo que nunca atualiza‚Äù que vimos anteriormente.</p>
<p>Ao inv√©s disso, existem duas outras solu√ß√µes que s√£o mais simples.</p>
<p><strong>Primeiro de tudo, se uma fun√ß√£o n√£o usa nada do escopo do componente, voc√™ pode mover ela para fora do componente e usa-l√° livremente dentro de seus efeitos:</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token comment">// ‚úÖ N√£o √© afetado pelo fluxo de dados</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span>
<span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Busca dados e faz algo ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ‚úÖ As depend√™ncias est√£o corretas</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Busca dados e faz algo ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ‚úÖ As depend√™ncias est√£o corretas</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>N√£o h√° necessidade de especific√°-las nas listas de deps porque a fun√ß√£o n√£o est√° no escopo de renderiza√ß√£o e n√£o pode ser afetada pelo fluxo de dados. Ela tamb√©m n√£o pode depender acidentalmente de <em>props</em> ou <em>state</em>.</p>
<p>Como alternativa, voc√™ pode encapsular a fun√ß√£o no <a href="https://reactjs.org/docs/hooks-reference.html#usecallback" target="_blank" rel="nofollow noopener noreferrer">Hook <code class="language-text">useCallback</code></a>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token comment">// ‚úÖ Preserva a identidade quando as *props* s√£o as mesmas</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ‚úÖ As depend√™ncias do Callback est√£o corretas</span></span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Busca dados e faz algo ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ‚úÖ As depend√™ncias do Efeito est√£o corretas</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Busca dados e faz algo ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ‚úÖ As depend√™ncias do Efeito est√£o corretas</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">useCallback</code> √© como adicionar outra camada de verifica√ß√µes de depend√™ncia. Ele est√° resolvendo o problema do outro lado - <strong>ao inv√©s de evitar uma depend√™ncia de fun√ß√£o, n√≥s fazemos a fun√ß√£o em si s√≥ mudar quando necess√°rio.</strong></p>
<p>Vamos ver porque esta abordagem √© √∫til. Anteriormente, nosso exemplo mostrava dois resultados de pesquisa (um para o termo ‚Äòreact‚Äô e outro para ‚Äòredux‚Äô). Mas digamos que queremos adicionar uma entrada para que voc√™ possa procurar por uma <code class="language-text">query</code> arbitr√°ria. Ent√£o, ao inv√©s de passarmos <code class="language-text">query</code> como um argumento, <code class="language-text">getFetchUrl</code> ir√° usar a vari√°vel do estado local.</p>
<p>N√≥s veremos imediatamente que est√° faltando <code class="language-text">query</code> na lista de depend√™ncia:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// N√£o temos `query` como argumento</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// üî¥ Est√° faltando uma depend√™ncia: `query`</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Se eu corrigir as depend√™ncias em <code class="language-text">useCallback</code> e incluir <code class="language-text">query</code>, qualquer efeito com <code class="language-text">getFetchUrl</code> listado em suas ‚Äúdeps‚Äù ser√° executado novamente sempre que a <code class="language-text">query</code> for alterada:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token comment">// ‚úÖ Preserva a identidade at√© a `query` mudar</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ‚úÖ As depend√™ncias do Callback est√£o corretas</span></span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... Busca dados e faz algo ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ‚úÖ As depend√™ncias do Efeito est√£o corretas</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Gra√ßas a <code class="language-text">useCallback</code>, se <code class="language-text">query</code> for a mesma, <code class="language-text">getFetchUrl</code> tamb√©m permanece a mesma, e nosso efeito n√£o √© executado novamente. Mas se houver altera√ß√µes na <code class="language-text">query</code> ent√£o <code class="language-text">getFetchUrl</code> tamb√©m ir√° mudar e n√≥s buscaremos os dados novamente. √â muito parecido com quando voc√™ altera alguma c√©lula em uma planilha do Excel, e as outras c√©lulas que a usam recalculam automaticamente.</p>
<p>Isso √© apenas uma conseq√º√™ncia de adotar o fluxo de dados e a mentalidade de sincroniza√ß√£o. <strong>A mesma solu√ß√£o funciona para objetos de fun√ß√£o passados pelos elementos pais:</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token comment">// ‚úÖ Preserva a identidade at√© a `query` mudar</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> fetchData <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// ... Fetch data and return it ...</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ‚úÖ As depend√™ncias do Callback est√£o corretas</span></span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>fetchData<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fetchData <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>setData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>fetchData<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ‚úÖ As depend√™ncias do Efeito est√£o corretas</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Como <code class="language-text">fetchData</code> s√≥ muda quando o estado <code class="language-text">query</code> do <code class="language-text">Parent</code> muda, <code class="language-text">Child</code> n√£o ir√° buscar dados at√© que seja realmente necess√°rio (houver alguma altera√ß√£o).</p>
<h2 id="as-fun√ß√µes-fazem-parte-do-fluxo-de-dados"><a href="#as-fun%C3%A7%C3%B5es-fazem-parte-do-fluxo-de-dados" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>As Fun√ß√µes Fazem Parte do Fluxo de Dados?</h2>
<p>Curiosamente, esse padr√£o quando quebrado com o paradigma de classes, realmente mostra a diferen√ßa entre efeitos e ciclos de vida. Considere esse exemplo:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    query<span class="token punctuation">:</span> <span class="token string">'react'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// ... Busca dados e faz algo ...</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Voc√™ pode estar pensando: ‚ÄúVamos Dan, todos n√≥s sabemos que <code class="language-text">useEffect</code> √© como <code class="language-text">componentDidMount</code> e <code class="language-text">componentDidUpdate</code> combinados, voc√™ n√£o pode continuar batendo naquele tambor!‚Äù <strong>No entanto, isso n√£o funciona nem com <code class="language-text">componentDidUpdate</code>:</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// üî¥ Essa condi√ß√£o nunca ser√° verdadeira</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>fetchData <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>fetchData<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Claro, <code class="language-text">fetchData</code> √© um m√©todo de classe! (Ou melhor, uma propriedade de classe - mas isso n√£o muda nada.) N√£o ser√° diferente por causa de uma mudan√ßa de estado. Ent√£o, <code class="language-text">this.props.fetchData</code> vai ser igual a <code class="language-text">prevProps.fetchData</code> e n√≥s nunca vamos buscar dados novamente. Vamos apenas remover essa condi√ß√£o ent√£o?</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>Oh, espere, isso busca dados em <em>cada</em> nova renderiza√ß√£o. (Se adicionarmos uma anima√ß√£o acima nessa √°rvore de componentes, √© uma maneira divertida de descobrir isso.) E se vincularmos com uma <code class="language-text">query</code> espec√≠fica?</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>Mas ent√£o <code class="language-text">this.props.fetchData !== prevProps.fetchData</code> √© <em>sempre</em> verdadeiro, mesmo que <code class="language-text">query</code> n√£o mude! Ent√£o, vamos <em>sempre</em> executar a busca de dados.</p>
<p>A √∫nica solu√ß√£o real para esse enigma com as classes √© morder a l√≠ngua e passar a <code class="language-text">query</code> em si para o componente <code class="language-text">Child</code>. Na verdade, <code class="language-text">Child</code>, acaba n√£o <em>usando</em> a <code class="language-text">query</code>, mas pode disparar uma busca quando muda:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    query<span class="token punctuation">:</span> <span class="token string">'react'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
    <span class="token comment">// ... Busca dados e faz algo ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">}</span></span> <span class="token attr-name">query</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Ao longo dos anos trabalhando com classes com o React, eu me acostumei em passar <em>props</em> desnecess√°rias e quebrar o encapsulamento de componentes pai, e eu s√≥ percebi o porque tivemos que fazer isso a uma semana atr√°s.</p>
<p><strong>Com as classes, as fun√ß√µes em <em>props</em> por si s√≥ n√£o fazem parte do fluxo de dados.</strong> Os m√©todos se misturam a vari√°vel mut√°vel <code class="language-text">this</code>, ent√£o n√£o podemos confiar em sua identidade para identificar qualquer coisa. Portanto, mesmo quando queremos apenas uma fun√ß√£o, temos que passar um monte de outros dados para poder ‚Äúdiferenci√°-la‚Äù. N√£o podemos saber se o <code class="language-text">this.props.fetchData</code> passado do pai depende de algum estado ou n√£o, e se esse estado acabou de mudar.</p>
<p><strong>Com <code class="language-text">useCallback</code>, fun√ß√µes podem participar totalmente no fluxo de dados.</strong> Podemos dizer que, se as entradas da fun√ß√£o forem alteradas, a fun√ß√£o em si mudou, mas se n√£o, ela permaneceu a mesma. Gra√ßas √† granularidade fornecida por <code class="language-text">useCallback</code>, mudan√ßas nas <em>props</em> em <code class="language-text">props.fetchData</code> podem se propagar automaticamente.</p>
<p>Da mesma forma, <a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">useMemo</code></a> nos permite fazer o mesmo para objetos complexos:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ColorPicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// N√£o quebra a compara√ß√£o raza no Child</span>
  <span class="token comment">// ao menos que `color` mude</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'pink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> color <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>color<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Eu quero enfatizar que colocar <code class="language-text">useCallback</code> em todos os lugares n√£o √© ideal.</strong> √â uma √≥tima sa√≠da de emerg√™ncia e √© √∫til quando uma fun√ß√£o √© passada e chamada de dentro de um efeito em elementos filhos. Ou se voc√™ est√° tentando impedir a quebra de memoiza√ß√£o de um componente filho. Mas Hooks fazem <a href="https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down" target="_blank" rel="nofollow noopener noreferrer">um melhor servi√ßo para evitar passar callbacks completamente</a></p>
<p>Nos exemplos acima, eu gostaria que <code class="language-text">fetchData</code> estivesse dentro do meu efeito (que por sua vez poderia ser extra√≠do para um Hook personalizado) ou uma importa√ß√£o de n√≠vel superior. Eu quero manter os efeitos simples, e utilizar retornos de chamadas neles n√£o ajudam. (‚ÄúE se alguma <code class="language-text">props.onComplete</code> for alterada enquando uma busca de dados estiver em andamento?‚Äú) Voc√™ pode <a href="https://overreacted.io/a-complete-guide-to-useeffect/#swimming-against-the-tide" target="_blank" rel="nofollow noopener noreferrer">simular o comportamento da classe</a>, mas isso n√£o resolve essa <strong>condi√ß√£o de corrida</strong> (<em>race conditions</em>).</p>
<h2 id="falando-em-condi√ß√µes-de-corrida"><a href="#falando-em-condi%C3%A7%C3%B5es-de-corrida" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Falando em Condi√ß√µes de Corrida</h2>
<p>Um exemplo cl√°ssico de busca de dados com classes pode ser feito assim:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    article<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">async</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> article <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Como voc√™ provavelmente sabe, esse c√≥digo √© <em>buggy</em>. Tamb√©m n√£o suporta atualiza√ß√µes. Ent√£o, o segundo exemplo cl√°ssico que voc√™ pode encontrar online √© algo assim:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    article<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span>id <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token keyword">async</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> article <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Isso definitivamente √© melhor! Mas ainda √© <em>buggy</em>. A raz√£o pela qual √© <em>buggy</em> √© que o pedido pode sair de ordem. Se eu estou buscando <code class="language-text">{id: 10}</code>, e mudo para <code class="language-text">{id: 20}</code>, mas a solicita√ß√£o <code class="language-text">{id: 20}</code> chegou primeiro lugar, a solicita√ß√£o que come√ßou mais cedo, e terminou depois, incorretamente substituiria meu estado.</p>
<p>Isso √© chamado de <strong>condi√ß√£o de corrida</strong>, e √© t√≠pico no c√≥digo que mistura <code class="language-text">async</code>/<code class="language-text">await</code> (que sup√µe que algo espera pelo resultado) com fluxo de dados de cima-baixo (<em>props</em> ou <em>state</em> podem mudar enquanto estamos no meio de uma fun√ß√£o ass√≠ncrona).</p>
<p>Os efeitos n√£o resolvem este problema magicamente, embora avisem se voc√™ tentar passar uma fun√ß√£o <code class="language-text">async</code> diretamente para o efeito. (Precisamos melhorar esse aviso para explicar melhor os problemas que voc√™ pode encontrar.)</p>
<p>Se a abordagem ass√≠ncrona que voc√™ usa suportar cancelamento, isso √© √≥timo! Voc√™ pode cancelar a solicita√ß√£o ass√≠ncrona diretamente na sua fun√ß√£o de limpeza.</p>
<p>Alternativamente, a abordagem tempor√°ria mais f√°cil √© rastre√°-la com um booleano:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Article</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>article<span class="token punctuation">,</span> setArticle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">let</span> didCancel <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>didCancel<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>        <span class="token function">setArticle</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      didCancel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">Este artigo</a> detalha como voc√™ pode manipular erros e estados de carregamento, al√©m de extrair essa l√≥gica em um Hook personalizado. Eu recomendo a leitura caso voc√™ queira saber mais sobre como buscar dados com Hooks.</p>
<h2 id="elevando-o-n√≠vel"><a href="#elevando-o-n%C3%ADvel" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Elevando o N√≠vel</h2>
<p>Com a mentalidade de ciclo de vida das classes, os efeitos colaterais se comportam de maneira diferente do que √© renderizado. A renderiza√ß√£o de uma interface do usu√°rio √© guiada por <em>props</em> e <em>state</em>, e √© garantido que seja consistente com eles, mas os efeitos colaterais n√£o s√£o. Esta √© uma fonte comum de erros.</p>
<p>Com a mentalidade de <code class="language-text">useEffect</code>, as coisas s√£o sincronizadas por padr√£o. Os efeitos colaterais tornam-se parte do fluxo de dados do React. Para cada chamada <code class="language-text">useEffect</code>, uma vez que voc√™ o fa√ßa corretamente, o seu componente cuida de casos extremos muito melhor.</p>
<p>No entanto, o custo inicial de acertar √© maior. Isso pode ser chato. Escrever um c√≥digo de sincroniza√ß√£o que lide bem com os casos extremos √© inerentemente mais dif√≠cil do que disparar efeitos colaterais √∫nicos que n√£o s√£o consistentes com a renderiza√ß√£o.</p>
<p>Isso poderia ser preocupante se <code class="language-text">useEffect</code> fosse <em>a</em> ferramenta que voc√™ usa a maior parte do tempo. No entanto, √© um bloco de constru√ß√£o de baixo n√≠vel. Estamos no in√≠cio dos Hooks, ent√£o todo mundo usa blocos de baixo n√≠vel o tempo todo, especialmente em tutoriais. Mas, na pr√°tica, √© prov√°vel que a comunidade comece a migrar para abstra√ß√µes em torno dos Hooks, pois boas APIs ganham impulso.</p>
<p>Estou vendo aplicativos diferentes criarem seus pr√≥prios Hooks, como <code class="language-text">useFetch</code>, que encapsula parte da l√≥gica de autentica√ß√£o do aplicativo ou<code class="language-text">useTheme</code>, que usa o contexto para injetar um tema. Uma vez que voc√™ tenha uma caixa de ferramentas dessas, voc√™ n√£o usar√° o <code class="language-text">useEffect</code> <em>t√£o</em> frequentemente. Mas a resili√™ncia que ele traz, cria benef√≠cios para Hooks constru√≠do por cima dele.</p>
<p>At√© agora, <code class="language-text">useEffect</code> √© mais usado para busca de dados. Mas a busca de dados n√£o √© exatamente um problema de sincroniza√ß√£o. Isto √© especialmente √≥bvio porque as nossas depend√™ncias s√£o frequentemente <code class="language-text">[]</code>. Ent√£o, o que estamos sincronizando?</p>
<p>A longo prazo, <a href="https://reactjs.org/blog/2018/11/27/react-16-roadmap.html#react-16x-mid-2019-the-one-with-suspense-for-data-fetching" target="_blank" rel="nofollow noopener noreferrer">Suspense para Busca de Dados</a> permitir√° que bibliotecas de terceiros tenham uma maneira, de primeira classe, de instruir o React a suspender a renderiza√ß√£o at√© que algo ass√≠ncrono (qualquer coisa: c√≥digo, dados, imagens) estejam prontos.</p>
<p>Como o Suspense cobre gradualmente mais casos de busca de dados, eu antecipo que <code class="language-text">useEffect</code> vai ficar no plano de fundo, como uma ferramenta avan√ßada para casos em que voc√™ realmente deseja sincronizar <em>props</em> e <em>state</em> para algum efeito colateral. Ao contr√°rio da busca de dados, ele lida com este caso naturalmente, pois ele foi projetado para isso. Mas at√© l√°, Hooks personalizados como <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">mostrado aqui</a>, s√£o uma boa maneira de reutilizar a l√≥gica de busca de dados.</p>
<h2 id="finalizando"><a href="#finalizando" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Finalizando</h2>
<p>Agora que voc√™ sabe tudo o que eu sei sobre o uso de efeitos, confira o <a href="#tldr">TLDR</a> no in√≠cio. Ele faz sentido? Perdi alguma coisa? (Eu ainda tenho mais papel aqui!)</p>
<p>Eu adoraria ouvir de voc√™ no Twitter! Obrigado pela leitura.</p></div><footer><p><a href="https://mobile.twitter.com/search?q=https%3A%2F%2Foverreacted.io%2Fa-complete-guide-to-useeffect%2F" target="_blank" rel="noopener noreferrer">Discuss on Twitter</a> ‚Ä¢ <a href="https://github.com/gaearon/overreacted.io/edit/master/src/pages/a-complete-guide-to-useeffect/index.pt-br.md" target="_blank" rel="noopener noreferrer">Edit on GitHub</a></p></footer></article></main><aside><div style="margin:90px 0 40px 0;font-family:system-ui, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
    &quot;Roboto&quot;, &quot;Oxygen&quot;, &quot;Ubuntu&quot;, &quot;Cantarell&quot;, &quot;Fira Sans&quot;,
    &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif"><form action="https://app.convertkit.com/forms/812047/subscriptions" class="seva-form formkit-form" method="post" min-width="400 500 600 700 800" style="background-color:rgb(255, 255, 255);border-radius:6px"><div data-style="full"><div data-element="column" class="formkit-column" style="background-color:rgb(249, 250, 251)"><h1 class="formkit-header" data-element="header" style="color:rgb(77, 77, 77);font-size:20px;font-weight:700">Join the Newsletter</h1><div data-element="subheader" class="formkit-subheader" style="color:rgb(104, 104, 104)"><p>Subscribe to get my latest content by email.</p></div><div class="formkit-image"><svg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 46 46" style="max-width:100%"><g fill="none" fill-rule="evenodd"><path fill="#DD92AB" d="M23,36 C22.813,36 22.627,35.948 22.463,35.844 L0.463,21.844 C0.159,21.651 -0.017,21.308 0.001,20.948 C0.02,20.589 0.23,20.266 0.553,20.105 L23,6 L45.447,20.105 C45.769,20.266 45.98,20.588 45.999,20.948 C46.018,21.308 45.841,21.65 45.537,21.844 L23.537,35.844 C23.373,35.948 23.187,36 23,36 Z"></path><path fill="#FFF" d="M38,37 L8,37 L8,1 C8,0.448 8.448,0 9,0 L37,0 C37.552,0 38,0.448 38,1 L38,37 Z"></path><path fill="#FFA7C4" d="M45,46 C44.916,46 44.831,45.989 44.748,45.968 L21.748,39.968 L22,33 L46,21 L46,45 C46,45.31 45.856,45.602 45.611,45.792 C45.435,45.928 45.219,46 45,46 Z"></path><path fill="#FFC3D7" d="M45,46 L1,46 C0.447,46 0,45.552 0,45 L0,21 L45.479,44.122 C45.88,44.341 46.083,44.804 45.969,45.247 C45.856,45.69 45.457,46 45,46 Z"></path><path fill="#FFA7C4" d="M19 20.414L14.293 15.707C13.902 15.316 13.902 14.684 14.293 14.293L19 9.586 20.414 11 16.414 15 20.414 19 19 20.414zM27 20.414L25.586 19 29.586 15 25.586 11 27 9.586 31.707 14.293C32.098 14.684 32.098 15.316 31.707 15.707L27 20.414z"></path></g></svg></div></div><div data-element="column" class="formkit-column"><ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul><div data-element="fields" class="seva-fields formkit-fields"><div class="formkit-field"><input type="text" class="formkit-input" aria-label="Your first name" name="fields[first_name]" placeholder="Your first name" style="border-color:rgb(227, 227, 227);border-radius:4px;color:rgb(0, 0, 0);font-weight:400"/></div><div class="formkit-field"><input type="email" class="formkit-input" name="email_address" aria-label="Your email address" placeholder="Your email address" style="border-color:rgb(227, 227, 227);border-radius:4px;color:rgb(0, 0, 0);font-weight:400"/></div><button data-element="submit" class="formkit-submit formkit-submit" style="background-color:hsl(340, 63%, 55%);border-radius:24px;color:white;font-weight:700"><div class="formkit-spinner"></div><span>Subscribe</span></button></div><div data-element="guarantee" class="formkit-guarantee" style="color:rgb(77, 77, 77);font-size:13px;font-weight:400"><p>I won‚Äôt send you spam.</p><p>Unsubscribe at <em>any</em> time.</p></div></div></div></form></div><h3 style="font-family:Montserrat, sans-serif;margin-top:0.4375rem"><a style="box-shadow:none;text-decoration:none;color:var(--pink)" href="/">Overreacted</a></h3><div style="display:flex;margin-bottom:3.5rem"><img src="/static/profile-pic-69c77131fd248a7aaaf26fab021f469f.png" alt="Yusuf Unlu" style="margin-right:0.875rem;margin-bottom:0;height:3.5rem;border-radius:50%"/><p style="max-width:310px">Personal blog by <a href="https://mobile.twitter.com/yufusunlu">Yusuf Unlu</a>.<!-- --> <!-- -->I¬†explain with words and code.</p></div><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li></li><li></li></ul></nav></aside></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-130227707-1', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"pt-br-a-complete-guide-to-useeffect-3d2","path":"/pt-br/a-complete-guide-to-useeffect/"};window.dataPath="303/path---pt-br-a-complete-guide-to-useeffect-3-d-2-6c2-GDocE6uAqkzG0LKAcw0s9p5NEc";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-83825dcbe188439d174e.js"],"component---src-templates-blog-index-js":["/component---src-templates-blog-index-js-1d061c91bf8b4d1ed13d.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.f3aea2f29a9b96501823.css","/component---src-templates-blog-post-js-5ff9d93420b5b2cefece.js"],"component---src-pages-404-js":["/component---src-pages-404-js.e9c5c3b80c5e9b8c6fa0.css","/component---src-pages-404-js-6115a896c1bd484b3973.js"],"component---src-pages-confirm-js":["/component---src-pages-confirm-js.e9c5c3b80c5e9b8c6fa0.css","/component---src-pages-confirm-js-e5c8bcda280c240e1d6e.js"],"component---src-pages-thanks-js":["/component---src-pages-thanks-js.e9c5c3b80c5e9b8c6fa0.css","/component---src-pages-thanks-js-bd098f6660863fbb8af2.js"],"pages-manifest":["/pages-manifest-f3e11a74ebf6959e04be.js"]};/*]]>*/</script><script src="/webpack-runtime-dea655677e505366ecd7.js" async=""></script><script src="/1-1b550cd61a5e170131aa.js" async=""></script><script src="/2-31a6021f1637c5720eda.js" async=""></script><script src="/0-b197e8c6c7ff26484233.js" async=""></script><script src="/app-83825dcbe188439d174e.js" async=""></script><script src="/component---src-templates-blog-post-js-5ff9d93420b5b2cefece.js" async=""></script></body></html>