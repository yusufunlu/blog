<!DOCTYPE html><html lang="zh-hant"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/2.4ac699a3d6a5be115d81.css">@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:url(/static/merriweather-400-l-8796b7875d52e9cb9b280211e8d3f82d.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:url(/static/montserrat-900-l-5751237264c0468be0d48ad1cea75b90.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}body{--pink:#ffa7c4;background-color:var(--bg)}body.light{--bg:#fff;--header:var(--pink);--textNormal:#222;--textTitle:#222;--textLink:#d23669;--hr:rgba(0,0,0,0.2);--inlineCode-bg:rgba(255,229,100,0.2);--inlineCode-text:#1a1a1a}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--textLink:var(--pink);--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:#373c49;--inlineCode-text:#e6e6e6}body:lang(ar) article,body:lang(fa) article{direction:rtl}body:lang(ar) .language-text,body:lang(ar) article .translations,body:lang(ar) article pre,body:lang(fa) .language-text,body:lang(fa) article .translations,body:lang(fa) article pre{direction:ltr}body:lang(ar) .language-text,body:lang(fa) .language-text{display:inline-block}body:lang(ar) blockquote,body:lang(fa) blockquote{border-left:unset;border-right:.32813rem solid rgba(0,0,0,.9);padding-right:1.42188rem;padding-left:unset;margin-left:.75rem;margin-right:-1.75rem}body:lang(fa) article,body:lang(fa) header>h1{font-family:Vazir}body:lang(ar) article,body:lang(ar) header>h1{font-family:Cairo,sans-serif}body:lang(ko) article,body:lang(ko) header{word-break:keep-all}code[class*=language-],pre[class*=language-]{color:#fff;background:none;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;-webkit-font-feature-settings:normal;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::selection{background:#27292a}pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:var(--inlineCode-bg);color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;padding-right:1em;padding-left:1.25em;border-left:.25em solid #ffa7c4}.gatsby-highlight,.gatsby-highlight-code-line{margin-right:-1.3125rem;margin-left:-1.3125rem}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#011627;-webkit-overflow-scrolling:touch;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}.react-toggle{touch-action:pan-x;display:inline-block;position:relative;cursor:pointer;background-color:transparent;border:0;padding:0;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.react-toggle-screenreader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle-track{width:50px;height:24px;padding:0;border-radius:30px;background-color:#0f1114;transition:all .2s ease}.react-toggle-track-check{position:absolute;width:17px;height:17px;left:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0;opacity:0;transition:opacity .25s ease}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{position:absolute;width:17px;height:17px;right:5px;top:0;bottom:0;margin-top:auto;margin-bottom:auto;line-height:0}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{position:absolute;top:1px;left:1px;width:22px;height:22px;border-radius:50%;background-color:#fafafa;box-sizing:border-box;transition:all .5s cubic-bezier(.23,1,.32,1) 0ms;-webkit-transform:translateX(0);transform:translateX(0)}.react-toggle--checked .react-toggle-thumb{-webkit-transform:translateX(26px);transform:translateX(26px);border-color:#19ab27}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #ffa7c4}.react-toggle:active .react-toggle-thumb{box-shadow:0 0 5px 5px #ffa7c4}</style><style data-href="/component---src-templates-blog-post-js.f3aea2f29a9b96501823.css">@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:url(/static/merriweather-400-i-l-9a3ea56a5f449980432ace5972181ef6.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:url(/static/merriweather-700-l-e24e02bb044cb07539a3a6bd12348d14.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:url(/static/merriweather-700-i-l-ad085ede31afcc5585ff34869b1cd029.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}.formkit-form *{box-sizing:border-box}.formkit-form legend{border:none;font-size:inherit;margin-bottom:10px;padding:0;position:relative;display:table}.formkit-form fieldset{border:0;padding:.01em 0 0;margin:0;min-width:0}.formkit-form body:not(:-moz-handler-blocked) fieldset{display:table-cell}.formkit-form p{color:inherit;font-size:inherit;font-weight:inherit}.formkit-form[data-format="slide in"],.formkit-form[data-format=modal]{display:none}.formkit-form .formkit-checkboxes,.formkit-form .formkit-input,.formkit-form .formkit-select{width:100%}.formkit-form .formkit-button,.formkit-form .formkit-submit{border:0;border-radius:5px;color:#fff;cursor:pointer;display:inline-block;text-align:center;font-size:15px;font-weight:500;margin-bottom:15px;overflow:hidden;padding:0;position:relative;vertical-align:middle}.formkit-form .formkit-button:focus,.formkit-form .formkit-button:hover,.formkit-form .formkit-submit:focus,.formkit-form .formkit-submit:hover{outline:none}.formkit-form .formkit-button:focus>span,.formkit-form .formkit-button:hover>span,.formkit-form .formkit-submit:focus>span,.formkit-form .formkit-submit:hover>span{background-color:#dc658d}.formkit-form .formkit-button>span,.formkit-form .formkit-submit>span{display:block;transition:all .3s ease-in-out;padding:12px 24px}.formkit-form .formkit-input{background:#fff;font-size:15px;padding:12px;border:1px solid #e3e3e3;flex:1 0 auto;line-height:1.4;margin:0;transition:border-color .3s ease-out}.formkit-form .formkit-input:focus{outline:none;border-color:#1677be;transition:border-color .3s ease}.formkit-form .formkit-input::-webkit-input-placeholder{color:#848585}.formkit-form .formkit-input:-ms-input-placeholder{color:#848585}.formkit-form .formkit-input::-ms-input-placeholder{color:#848585}.formkit-form .formkit-input::placeholder{color:#848585}.formkit-form [data-group=dropdown]{position:relative;display:inline-block;width:100%}.formkit-form [data-group=dropdown]:before{content:"";top:calc(50% - 2.5px);right:10px;position:absolute;pointer-events:none;border-color:#4f4f4f transparent transparent;border-style:solid;border-width:6px 6px 0;height:0;width:0;z-index:999}.formkit-form [data-group=dropdown] select{height:auto;width:100%;cursor:pointer;color:#333;line-height:1.4;margin-bottom:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:15px;padding:12px 25px 12px 12px;border:1px solid #e3e3e3;background:#fff}.formkit-form [data-group=dropdown] select:focus{outline:none}.formkit-form [data-group=checkboxes]{text-align:left;margin:0}.formkit-form [data-group=checkboxes] [data-group=checkbox]{margin-bottom:10px}.formkit-form [data-group=checkboxes] [data-group=checkbox] *{cursor:pointer}.formkit-form [data-group=checkboxes] [data-group=checkbox]:last-of-type{margin-bottom:0}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]{display:none}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]+label:after{content:none}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label:after{border-color:#fff;content:""}.formkit-form [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label:before{background:#10bf7a;border-color:#10bf7a}.formkit-form [data-group=checkboxes] [data-group=checkbox] label{position:relative;display:inline-block;padding-left:28px}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:after,.formkit-form [data-group=checkboxes] [data-group=checkbox] label:before{position:absolute;content:"";display:inline-block}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:before{height:16px;width:16px;border:1px solid #e3e3e3;background:#fff;left:0;top:3px}.formkit-form [data-group=checkboxes] [data-group=checkbox] label:after{height:4px;width:8px;border-left:2px solid #4d4d4d;border-bottom:2px solid #4d4d4d;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);left:4px;top:8px}.formkit-form .formkit-alert{background:#f9fafb;border:1px solid #e3e3e3;border-radius:5px;flex:1 0 auto;list-style:none;margin:25px auto;padding:12px;text-align:center;width:100%}.formkit-form .formkit-alert:empty{display:none}.formkit-form .formkit-alert-success{background:#d3fbeb;border-color:#10bf7a;color:#0c905c}.formkit-form .formkit-alert-error{background:#fde8e2;border-color:#f2643b;color:#ea4110}.formkit-form .formkit-spinner{display:flex;height:0;width:0;margin:0 auto;position:absolute;top:0;left:0;right:0;overflow:hidden;text-align:center;transition:all .3s ease-in-out}.formkit-form .formkit-spinner>div{margin:auto;width:12px;height:12px;background-color:#fff;opacity:.3;border-radius:100%;display:inline-block;-webkit-animation:formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd- 1.4s ease-in-out infinite both;animation:formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd- 1.4s ease-in-out infinite both}.formkit-form .formkit-spinner>div:first-child{-webkit-animation-delay:-.32s;animation-delay:-.32s}.formkit-form .formkit-spinner>div:nth-child(2){-webkit-animation-delay:-.16s;animation-delay:-.16s}.formkit-form .formkit-submit[data-active] .formkit-spinner{opacity:1;height:100%;width:50px}.formkit-form .formkit-submit[data-active] .formkit-spinner~span{opacity:0}@-webkit-keyframes formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd-{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes formkit-bouncedelay-formkit-form-data-uid-4a352cb1fd-{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.formkit-form{box-shadow:0 2px 15px 0 rgba(210,214,220,.5);max-width:700px;overflow:hidden}.formkit-form [data-style=full]{width:100%;display:block}.formkit-form .formkit-header{margin-top:0;margin-bottom:20px;font-family:inherit}.formkit-form .formkit-subheader{margin:15px 0}.formkit-form .formkit-column{background-size:cover;background-repeat:no-repeat;background-position:50%;padding:20px}.formkit-form .formkit-column:nth-child(2){border-top:1px solid #e9ecef}.formkit-form .formkit-field{margin:0 0 15px}.formkit-form .formkit-input,.formkit-form .formkit-submit{width:100%}.formkit-form .formkit-guarantee{font-size:13px;margin:0 0 15px}.formkit-form .formkit-guarantee>p{margin:0}.formkit-form .formkit-powered-by{color:#7d7d7d;display:block;font-size:12px;margin-bottom:0;text-align:center}.formkit-form .formkit-powered-by[data-active=false]{opacity:.5}.formkit-form[min-width~="600"] [data-style=full],.formkit-form[min-width~="700"] [data-style=full],.formkit-form[min-width~="800"] [data-style=full]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.formkit-form[min-width~="600"] .formkit-submit,.formkit-form[min-width~="700"] .formkit-submit,.formkit-form[min-width~="800"] .formkit-submit{width:auto}.formkit-form[min-width~="600"] .formkit-column,.formkit-form[min-width~="700"] .formkit-column,.formkit-form[min-width~="800"] .formkit-column{padding:40px}.formkit-form[min-width~="600"] .formkit-column:nth-child(2),.formkit-form[min-width~="700"] .formkit-column:nth-child(2),.formkit-form[min-width~="800"] .formkit-column:nth-child(2){border-top:none}</style><meta name="generator" content="Gatsby 2.0.91"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="Dan Abramov&#x27;s Overreacted Blog RSS Feed" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><title data-react-helmet="true">useEffect çš„å®Œæ•´æŒ‡å— â€” Overreacted</title><meta data-react-helmet="true" name="theme-color" content="#282c35"/><meta data-react-helmet="true" name="description" content="Effect æ˜¯ä½ è³‡æ–™æµçš„ä¸€éƒ¨åˆ†ã€‚"/><meta data-react-helmet="true" property="og:url" content="https://overreacted.io/zh-hant/a-complete-guide-to-useeffect/"/><meta data-react-helmet="true" property="og:title" content="useEffect çš„å®Œæ•´æŒ‡å—"/><meta data-react-helmet="true" property="og:description" content="Effect æ˜¯ä½ è³‡æ–™æµçš„ä¸€éƒ¨åˆ†ã€‚"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@dan_abramov"/><meta data-react-helmet="true" name="twitter:title" content="useEffect çš„å®Œæ•´æŒ‡å—"/><meta data-react-helmet="true" name="twitter:description" content="Effect æ˜¯ä½ è³‡æ–™æµçš„ä¸€éƒ¨åˆ†ã€‚"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:inherit;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);border-left-color:inherit;opacity:0.8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:var(--hr);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"â€” ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:var(--textLink);text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}a.anchor{box-shadow:none;}a.anchor svg[aria-hidden="true"]{stroke:var(--textLink);}p code{font-size:1rem;}h1 code, h2 code, h3 code, h4 code, h5 code, h6 code{font-size:inherit;}li code{font-size:1rem;}blockquote.translation{font-size:1em;}</style><link as="script" rel="preload" href="/component---src-templates-blog-post-js-5ff9d93420b5b2cefece.js"/><link as="script" rel="preload" href="/app-83825dcbe188439d174e.js"/><link as="script" rel="preload" href="/0-b197e8c6c7ff26484233.js"/><link as="script" rel="preload" href="/2-31a6021f1637c5720eda.js"/><link as="script" rel="preload" href="/1-1b550cd61a5e170131aa.js"/><link as="script" rel="preload" href="/webpack-runtime-dea655677e505366ecd7.js"/><link as="fetch" rel="preload" href="/static/d/288/path---zh-hant-a-complete-guide-to-useeffect-24-c-998-BcBa62OQojfelSLHwYmmdz6dcKs.json" crossorigin="use-credentials"/></head><body class="light"><script>
              (function() {
                window.__onThemeChange = function() {};
                function setTheme(newTheme) {
                  window.__theme = newTheme;
                  preferredTheme = newTheme;
                  document.body.className = newTheme;
                  window.__onThemeChange(newTheme);
                }

                var preferredTheme;
                try {
                  preferredTheme = localStorage.getItem('theme');
                } catch (err) { }

                window.__setPreferredTheme = function(newTheme) {
                  setTheme(newTheme);
                  try {
                    localStorage.setItem('theme', newTheme);
                  } catch (err) {}
                }

                var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
                darkQuery.addListener(function(e) {
                  window.__setPreferredTheme(e.matches ? 'dark' : 'light')
                });

                setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
              })();
            </script><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="color:var(--textNormal);background:var(--bg);transition:color 0.2s ease-out, background 0.2s ease-out;min-height:100vh"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2.625rem"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:0;height:42px;line-height:2.625rem"><a style="box-shadow:none;text-decoration:none;color:rgb(255, 167, 196)" href="/">Overreacted</a></h3><div style="height:24px"></div></header><main><article><header><h1 style="color:var(--textTitle)">useEffect çš„å®Œæ•´æŒ‡å—</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.4rem">2019 M03 9<!-- --> â€¢ ğŸ±ğŸ± 31 min read</p><div class="translations"><p style="font-size:0.9em;border:1px solid var(--hr);border-radius:0.75em;padding:0.75em;background:var(--inlineCode-bg);word-break:keep-all;font-family:system-ui, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
    &quot;Roboto&quot;, &quot;Oxygen&quot;, &quot;Ubuntu&quot;, &quot;Cantarell&quot;, &quot;Fira Sans&quot;,
    &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif"><span><span>Translated by readers into: </span><a href="/pt-br/a-complete-guide-to-useeffect/">PortuguÃªs do Brasil</a> â€¢ <a href="/ja/a-complete-guide-to-useeffect/">æ—¥æœ¬èª</a> â€¢ <a href="/zh-hans/a-complete-guide-to-useeffect/">ç®€ä½“ä¸­æ–‡</a> â€¢ <b>ç¹é«”ä¸­æ–‡</b></span><br/><br/><a href="/a-complete-guide-to-useeffect/">Read the original</a> â€¢ <a href="https://github.com/gaearon/overreacted.io/edit/master/src/pages/a-complete-guide-to-useeffect/index.zh-hant.md" target="_blank" rel="noopener noreferrer">Improve this translation</a> â€¢ <a href="/zh-hant">View all translated posts</a> </p></div></header><div><p>ä½ ç”¨ <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="nofollow noopener noreferrer">Hooks</a> å¯«äº†ä¸€äº›å…ƒä»¶ã€‚æˆ–è¨±ä¹Ÿå¯«äº†ä¸€å€‹å°çš„æ‡‰ç”¨ç¨‹å¼ã€‚ä½ æ„Ÿåˆ°å¾ˆæ»¿è¶³ã€‚ä½ å°å®ƒçš„ API æ„Ÿåˆ°æ»¿æ„è€Œä¸”åœ¨éç¨‹ä¸­å­¸ç¿’äº†ä¸€äº›æŠ€å·§ã€‚ä½ ç”šè‡³åšäº†ä¸€äº›<a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="nofollow noopener noreferrer">å®¢è£½åŒ–çš„ Hooks</a> ä¾†æŠ½å‡ºé‡è¤‡çš„é‚è¼¯ï¼ˆç§»é™¤ 300 è¡Œç¨‹å¼ç¢¼ï¼ï¼‰ç„¶å¾Œè·Ÿä½ çš„åŒäº‹ç‚«è€€ã€‚ä»–å€‘èªªã€Œåšå¾—å¥½ã€ã€‚</p>
<p>ä½†æœ‰æ™‚å€™ï¼Œç•¶ä½ ä½¿ç”¨ <code class="language-text">useEffect</code> æ™‚ï¼Œé‚£äº›ç‰‡æ®µæ„Ÿè¦ºä¸å¤ªå¥‘åˆã€‚ä½ æœ‰ä¸€ç¨®å¥½åƒä½ éºæ¼äº†ä»€éº¼çš„æ„Ÿè¦ºã€‚å®ƒçœ‹èµ·ä¾†åƒæ˜¯ class çš„ç”Ÿå‘½é€±æœŸâ€¦ ä½†å®ƒçœŸçš„æ˜¯å—ï¼Ÿä½ ç™¼ç¾ä½ å•è‡ªå·±åƒæ˜¯ä»¥ä¸‹çš„æŸäº›å•é¡Œï¼š</p>
<ul>
<li>ğŸ¤” æˆ‘è¦æ€éº¼ç”¨ <code class="language-text">useEffect</code> è¤‡è£½ <code class="language-text">componentDidMount</code> çš„è¡Œç‚ºï¼Ÿ</li>
<li>ğŸ¤” æˆ‘è©²æ€éº¼æ­£ç¢ºçš„åœ¨ <code class="language-text">useEffect</code> è£¡æ‹¿åˆ°è³‡æ–™ï¼Ÿ<code class="language-text">[]</code> æ˜¯ä»€éº¼ï¼Ÿ</li>
<li>ğŸ¤” æˆ‘æ‡‰è©²è¦æŠŠç”¨åˆ°çš„å‡½ç¤ºæŒ‡å®šæˆ effect çš„ä¾å±¬ (dependencies) å—ï¼Ÿ</li>
<li>ğŸ¤” ç‚ºä»€éº¼æˆ‘æœ‰æ™‚å€™æœƒé€²å…¥é‡è¤‡æ‹¿è³‡æ–™çš„ç„¡çª®è¿´åœˆï¼Ÿ</li>
<li>ğŸ¤” ç‚ºä»€éº¼æˆ‘æœ‰æ™‚å€™æœƒåœ¨ effect è£¡æ‹¿åˆ°èˆŠçš„ state æˆ– prop çš„å€¼ï¼Ÿ</li>
</ul>
<p>ç•¶æˆ‘å‰›é–‹å§‹ä½¿ç”¨ Hooks çš„æ™‚å€™ï¼Œæˆ‘ä¹Ÿå°ä¸Šè¿°çš„å•é¡Œæ„Ÿåˆ°å›°æƒ‘ã€‚ç”šè‡³ç•¶æˆ‘åœ¨å¯«åˆç‰ˆçš„æ–‡ä»¶æ™‚ï¼Œæˆ‘æ²’æœ‰ç‰¢ç‰¢æŒæ¡ä¸€äº›ç´°å¾®çš„éƒ¨åˆ†ã€‚åœ¨éç¨‹ä¸­æˆ‘æœ‰å¥½å¹¾æ¬¡çš„ã€Œå•Šå“ˆã€é “æ‚Ÿæ™‚åˆ»ï¼Œæˆ‘æƒ³åˆ†äº«å®ƒå€‘çµ¦ä½ ã€‚<strong>é€™æ¨£çš„æ·±å…¥ç ”ç©¶æœƒä½¿å¾—é€™äº›å•é¡Œçš„ç­”æ¡ˆè®Šå¾—æ˜é¡¯ã€‚</strong></p>
<p>ç‚ºäº†<em>çœ‹åˆ°</em>ç­”æ¡ˆï¼Œæˆ‘å€‘éœ€è¦å…ˆé€€å›ä¸€æ­¥ã€‚é€™ç¯‡æ–‡ç« çš„ç›®æ¨™ä¸æ˜¯çµ¦ä½ ä¸€å€‹æ¢åˆ—å¼çš„æ¸…å–®ï¼Œè€Œæ˜¯ç‚ºäº†å¹«åŠ©ä½ çœŸçš„ã€Œæ·±å…¥ç†è§£ã€<code class="language-text">useEffect</code>ã€‚é€™è£¡ä¸æœƒæœ‰å¾ˆå¤šéœ€è¦å­¸ç¿’çš„äº‹æƒ…ã€‚äº‹å¯¦ä¸Šï¼Œæˆ‘å€‘æœƒèŠ±å¤§éƒ¨åˆ†çš„æ™‚é–“<em>å¿˜è¨˜</em>å­¸ç¿’éçš„æ±è¥¿ã€‚</p>
<p><strong>ç›´åˆ°æˆ‘åœæ­¢é€é class ç”Ÿå‘½é€±æœŸçš„æ¿¾é¡è§€çœ‹ <code class="language-text">useEffect</code> Hookï¼Œæ‰€æœ‰æ±è¥¿æ‰åœ¨æˆ‘çœ¼ä¸­åŒ¯èšåœ¨ä¸€èµ·ã€‚</strong></p>
<blockquote>
<p>ã€Œå¿˜è¨˜ä½ å·²ç¶“å­¸ç¿’çš„ã€‚ã€ â€” å°¤é”</p>
</blockquote>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 497px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 64.38631790744466%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAwX/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAF5WKs71REF/8QAGxAAAQUBAQAAAAAAAAAAAAAAAgABAxESEyH/2gAIAQEAAQUCvzvk9Woz0njdBK5j/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bh//EAB0QAAICAQUAAAAAAAAAAAAAAAABAhEhMTJBUZH/2gAIAQEABj8CK4Nno10Obm8FvU//xAAbEAEBAQEAAwEAAAAAAAAAAAABEQAhMVFxgf/aAAgBAQABPyH0Zd076TuCbR9Rz80qZiwUvg37TTf/2gAMAwEAAgADAAAAEEPf/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERMUH/2gAIAQMBAT8QlaUf/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAx/9oACAECAQE/EFOQF//EABwQAQEAAgIDAAAAAAAAAAAAAAERACExQVFx0f/aAAgBAQABPxA0TUOLkyoSi0+4SldSl6yfaQttpzhvHAwULvWAwOi0F8zP/9k='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="å°¤é”å—…äº†å—…ç©ºæ°£ã€‚å­—å¹•ï¼šã€Œæˆ‘èåˆ°äº†åŸ¹æ ¹ã€‚ã€"
        title=""
        src="/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg"
        srcset="/static/6203a1f1f2c771816a5ba0969baccd12/5645f/yoda.jpg 148w,
/static/6203a1f1f2c771816a5ba0969baccd12/3f2ca/yoda.jpg 295w,
/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg 497w"
        sizes="(max-width: 497px) 100vw, 497px"
      />
    </span>
  </span>
  
  </a>
    </p>
<hr>
<p><strong>é€™ç¯‡æ–‡ç« å‡è¨­ä½ å·²ç¶“æœ‰é»ç†Ÿæ‚‰ <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">useEffect</code></a> çš„ API äº†ã€‚</strong></p>
<p><strong>é€™ç¯‡æ–‡ç« <em>çœŸçš„</em>å¾ˆé•·ã€‚ä»–å°±åƒæ˜¯ä¸€æœ¬è¿·ä½ æ›¸ã€‚é€™åªæ˜¯æˆ‘å–œæ­¡çš„å½¢å¼ã€‚ä½†æˆ‘æœƒåœ¨ä¸‹é¢å¯«å€‹æ‘˜è¦çµ¦é‚£äº›åŒ†å¿™æˆ–ä¸é‚£éº¼åœ¨ä¹çš„äººé–±è®€ã€‚</strong></p>
<p><strong>å¦‚æœä½ ä¸æƒ³è¦æ·±å…¥ç ”ç©¶ï¼Œä½ å¯èƒ½æœƒæƒ³è¦ç­‰åˆ°é€™äº›è§£é‡‹åœ¨å…¶ä»–åœ°æ–¹å‡ºç¾ã€‚å°±åƒ React åœ¨ 2013 å¹´å‡ºç¾çš„æ™‚å€™ï¼Œäººå€‘èŠ±äº†ä¸€äº›æ™‚é–“å»èªè­˜ä¸åŒçš„å¿ƒç†æ¨¡å‹ä¸¦æ•™å­¸å®ƒã€‚</strong></p>
<hr>
<h2 id="æ‘˜è¦"><a href="#%E6%91%98%E8%A6%81" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ‘˜è¦</h2>
<p>å¦‚æœä½ ä¸æƒ³é–±è®€æ•´ç¯‡æ–‡ç« ï¼Œä»¥ä¸‹æ˜¯å¿«é€Ÿçš„æ‘˜è¦ã€‚å¦‚æœæŸäº›éƒ¨åˆ†çœ‹èµ·ä¾†ä¸åˆç†ï¼Œä½ å¯ä»¥å¾€ä¸‹æ²å‹•ç›´åˆ°ä½ æ‰¾åˆ°ç›¸é—œçš„æ±è¥¿ã€‚</p>
<p>å¦‚æœä½ æ‰“ç®—é–±è®€æ•´ç¯‡æ–‡ç« ï¼Œæ­¡è¿è·³éæ‘˜è¦ï¼Œæˆ‘æœƒåœ¨æœ€å¾Œé€£çµå®ƒå€‘ã€‚</p>
<p><strong>ğŸ¤” å•é¡Œï¼šæˆ‘è¦æ€éº¼ç”¨ <code class="language-text">useEffect</code> è¤‡è£½ <code class="language-text">componentDidMount</code> çš„è¡Œç‚ºï¼Ÿ</strong></p>
<p>ç•¶ä½ å¯ä»¥ä½¿ç”¨ <code class="language-text">useEffect(fn, [])</code>ï¼Œå®ƒä¸¦ä¸æ˜¯å®Œå…¨ç›¸ç­‰ã€‚èˆ‡ <code class="language-text">componentDidMount</code> ä¸åŒï¼Œä»–æœƒ<em>æ•æ‰</em> props å’Œ stateã€‚æ‰€ä»¥å³ä½¿åœ¨ callbacks è£¡é¢ï¼Œä½ å°‡æœƒçœ‹åˆ°åˆå§‹çš„ props å’Œ stateã€‚å¦‚æœä½ æƒ³è¦çœ‹åˆ°<em>æœ€æ–°çš„</em>çš„æ±è¥¿ï¼Œä½ å¯ä»¥æŠŠå®ƒå¯«åˆ°ä¸€å€‹ refã€‚ä½†å…¶å¯¦é€šå¸¸æœ‰æ›´ç°¡å–®çš„æ–¹æ³•ä¾†æ¶æ§‹ä½ çš„ç¨‹å¼ç¢¼ï¼Œæ‰€ä»¥ä½ ä¸¦ä¸éœ€è¦é€™éº¼åšã€‚è¨˜ä½ä½ çš„ effects çš„å¿ƒç†æ¨¡å‹è·Ÿ <code class="language-text">componentDidMount</code> å’Œå…¶ä»–çš„ç”Ÿå‘½é€±æœŸæ˜¯ä¸åŒçš„ã€‚å˜—è©¦æƒ³è¦æ‰¾å‡ºå®ƒå€‘ç›¸ç­‰çš„åœ°æ–¹ä¸¦ä¸æœƒå¹«åŠ©åˆ°ä½ ï¼Œåè€Œåªæœƒè®“ä½ æ›´å›°æƒ‘ã€‚ç‚ºäº†èƒ½å¤ æ›´æœ‰æ•ˆç‡ï¼Œä½ å¿…é ˆè¦ã€Œæƒ³è‘— effectsã€ï¼Œä»–å€‘çš„å¿ƒç†æ¨¡å‹è·Ÿå›æ‡‰ç”Ÿå‘½é€±æœŸçš„äº‹ä»¶æ¯”è¼ƒèµ·ä¾†æ›´æ¥è¿‘å¯¦ä½œåŒæ­¥åŒ–ã€‚</p>
<p><strong>ğŸ¤” å•é¡Œï¼šæˆ‘è©²æ€éº¼æ­£ç¢ºçš„åœ¨ <code class="language-text">useEffect</code> è£¡æ‹¿åˆ°è³‡æ–™ï¼Ÿ<code class="language-text">[]</code> æ˜¯ä»€éº¼ï¼Ÿ</strong></p>
<p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">é€™ç¯‡æ–‡ç« </a>æ˜¯ä¸€å€‹é—œæ–¼ç”¨ <code class="language-text">useEffect</code> ç²å–è³‡æ–™çš„ä¸éŒ¯çš„å…¥é–€æ–‡ç« ã€‚ç¢ºå®šä½ æŠŠå®ƒå®Œå…¨è®€å®Œï¼å®ƒæ²’æœ‰è·Ÿæœ¬ç¯‡æ–‡ç« ä¸€æ¨£é•·ã€‚<code class="language-text">[]</code> è¡¨ç¤º effect æ²’æœ‰ç”¨ä»»ä½•åƒèˆ‡ React è³‡æ–™æµçš„å€¼ï¼Œä¸¦ä¸”å› æ­¤è€Œå®‰å…¨çš„åªä½¿ç”¨ä¸€æ¬¡ã€‚ç•¶é‚£å€‹å€¼<em>çœŸçš„</em>è¢«ç”¨åˆ°çš„æ™‚å€™ï¼Œå®ƒä¹Ÿæ˜¯å¸¸è¦‹çš„éŒ¯èª¤ä¾†æºã€‚ä½ å°‡æœƒéœ€è¦å­¸ç¿’å¹¾å€‹ç­–ç•¥ï¼ˆä¸»è¦æ˜¯ <code class="language-text">useReducer</code> å’Œ <code class="language-text">useCallback</code>ï¼‰ä¾†ç‚ºäº†ä¾å±¬ (dependencies) <em>ç§»é™¤é€™å€‹å¿…è¦</em>ï¼Œè€Œä¸æ˜¯éŒ¯èª¤çš„å¿½ç•¥å®ƒã€‚</p>
<p><strong>ğŸ¤” å•é¡Œï¼šæˆ‘æ‡‰è©²è¦æŠŠç”¨åˆ°çš„å‡½ç¤ºæŒ‡å®šæˆ effect çš„ä¾å±¬ (dependencies) å—ï¼Ÿ</strong></p>
<p>å»ºè­°çš„åšæ³•æ˜¯æŠŠä¸éœ€è¦ props æˆ– state çš„å‡½å¼æå‡åˆ°å…ƒä»¶<em>å¤–é¢</em>ï¼Œä¸¦ä¸”æŠŠåªè¢«æŸå€‹ effect ç”¨åˆ°çš„å‡½å¼æ”¾åˆ° effect <em>è£¡é¢</em>ã€‚å¦‚æœåœ¨é‚£ä¹‹å¾Œä½ çš„ effect ä»éœ€è¦åœ¨æ¸²æŸ“çš„ç¯„åœï¼ˆåŒ…å«äº† props å‚³é€²ä¾†çš„å‡½å¼ï¼‰ä½¿ç”¨å‡½å¼ï¼Œåœ¨å®šç¾©å®ƒå€‘çš„åœ°æ–¹æŠŠå®ƒå€‘åŒ…é€² <code class="language-text">useCallback</code>ï¼Œä¸¦é‡è¤‡é€™å€‹éç¨‹ã€‚ç‚ºä»€éº¼é€™å€‹é‡è¦ï¼Ÿå‡½å¼å¯ä»¥å¾ props å’Œ stateã€Œçœ‹è¦‹ã€å€¼ â€” æ‰€ä»¥å®ƒå€‘æœƒåƒèˆ‡è³‡æ–™æµã€‚é€™è£¡çš„å¸¸è¦‹å•é¡Œè£¡æœ‰æ›´<a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="nofollow noopener noreferrer">è©³ç´°çš„ç­”æ¡ˆ</a>ã€‚</p>
<p><strong>ğŸ¤” å•é¡Œï¼šç‚ºä»€éº¼æˆ‘æœ‰æ™‚å€™æœƒé€²å…¥é‡è¤‡æ‹¿è³‡æ–™çš„ç„¡çª®è¿´åœˆï¼Ÿ</strong></p>
<p>é€™å¯èƒ½ç™¼ç”Ÿåœ¨ç•¶ä½ æ²’æœ‰ç¬¬äºŒå€‹ä¾å±¬åƒæ•¸å»æƒ³è¦åœ¨ effect è£¡ç²å–è³‡æ–™çš„æ™‚å€™ã€‚æ²’æœ‰å®ƒï¼Œeffects æœƒåœ¨æ¯æ¬¡æ¸²æŸ“çš„æ™‚å€™ç™¼ç”Ÿ â€” ä¸¦ä¸”è¨­å®š state é€™ä»¶äº‹æœƒå†åº¦è§¸ç™¼ effectsã€‚ä¸€å€‹ç„¡çª®è¿´åœˆä¹Ÿå¯èƒ½æœƒåœ¨ä½ æƒ³è¦åœ¨ä¾å±¬çš„é™£åˆ—è£¡æŒ‡å®šä¸€å€‹<em>æ°¸é </em>éƒ½æœƒè®ŠåŒ–çš„å€¼ã€‚ä½ å¯ä»¥è—‰ç”±ä¸€å€‹ä¸€å€‹ç§»é™¤ä¾†ç™¼ç¾åˆ°åº•æ˜¯å“ªå€‹å€¼ã€‚ç„¶è€Œï¼Œç§»é™¤ä¸€å€‹ä¾å±¬ï¼ˆæˆ–ç›²ç›®åœ°ä½¿ç”¨ <code class="language-text">[]</code>ï¼‰é€šå¸¸æ˜¯éŒ¯èª¤çš„ä¿®æ­£æ–¹å¼ã€‚ç›¸åçš„ï¼Œä½ æ‡‰è©²è¦ä¿®æ­£é€™å€‹å•é¡Œçš„æ ¹æºã€‚ä¾‹å¦‚ï¼Œå‡½å¼å¯èƒ½é€ æˆé€™å€‹å•é¡Œï¼Œå°‡å®ƒå€‘æ”¾åˆ° effects è£¡ï¼ŒæŠ½å‡ºä»–å€‘åˆ°ä¸Šå±¤ï¼Œæˆ–æ˜¯å°‡ä»–å€‘åŒ…åœ¨ <code class="language-text">useCallback</code> è£¡å¯èƒ½æœ‰å¹«åŠ©ã€‚èª¤äº†é¿å…é‡è¤‡ç”¢ç”Ÿæ–°çš„ç‰©ä»¶ï¼Œ<code class="language-text">useMemo</code> å¯ä»¥é”åˆ°ç›¸åŒçš„ç›®çš„ã€‚</p>
<p><strong>ğŸ¤” ç‚ºä»€éº¼æˆ‘æœ‰æ™‚å€™æœƒåœ¨ effect è£¡æ‹¿åˆ°èˆŠçš„ state æˆ– prop çš„å€¼ï¼Ÿ</strong></p>
<p>Effects æ°¸é éƒ½æœƒåœ¨å®ƒå€‘è¢«å®šç¾©çš„æ¸²æŸ“çš„æ™‚å€™ã€Œçœ‹è¦‹ã€ props è·Ÿ stateã€‚é€™æ¨£èƒ½å¤ <a href="/how-are-function-components-different-from-classes/">å¹«åŠ©é¿å…éŒ¯èª¤</a>ï¼Œä½†æŸäº›æƒ…æ³ä¸‹å®ƒå¾ˆæƒ±äººã€‚åœ¨é‚£äº›æƒ…æ³ä¸‹ï¼Œä½ å¯ä»¥åœ¨ä¸€å€‹ æ˜“è®Šçš„ï¼ˆmutableï¼‰çš„ ref ç‰¹åˆ¥ç¶­è­·æŸäº›å€¼ï¼ˆé€£çµçš„æ–‡ç« åœ¨æœ€å¾Œè§£é‡‹äº†å®ƒï¼‰ã€‚è©¦è‘—ç”¨ <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="nofollow noopener noreferrer">lint rule</a> ä¾†è¨“ç·´å¦‚ä½•çœ‹å®ƒå€‘ã€‚ä¸€äº›æ—¥å­å¾Œï¼Œå®ƒæœƒè®Šå¾—åƒæ˜¯ç¬¬äºŒè‡ªç„¶çš„äº‹æƒ…ã€‚ä¹Ÿåœ¨å¸¸è¦‹å•é¡Œè£¡çœ‹çœ‹<a href="https://reactjs.org/docs/hooks-faq.html#why-am-i-seeing-stale-props-or-state-inside-my-function" target="_blank" rel="nofollow noopener noreferrer">é€™å€‹ç­”æ¡ˆ</a>ã€‚</p>
<hr>
<p>æˆ‘å¸Œæœ›é€™å€‹æ‘˜è¦æ˜¯æœ‰å¹«åŠ©çš„ï¼å¦‚æœæ²’æœ‰çš„è©±ï¼Œæˆ‘å€‘ç¹¼çºŒå¾€ä¸‹çœ‹ã€‚</p>
<hr>
<h2 id="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰ä»–è‡ªå·±çš„-props-å’Œ-state"><a href="#%E6%AF%8F%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E4%BB%96%E8%87%AA%E5%B7%B1%E7%9A%84-props-%E5%92%8C-state" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰ä»–è‡ªå·±çš„ Props å’Œ State</h2>
<p>åœ¨æˆ‘å€‘èƒ½å¤ è¨è«– effects ä»¥å‰ï¼Œæˆ‘å€‘éœ€è¦èŠèŠæ¸²æŸ“ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€å€‹è¨ˆæ•¸å™¨ã€‚ä»”ç´°çœ‹çœ‹å¼·èª¿çš„è¡Œæ•¸ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Click me</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å®ƒä»£è¡¨ä»€éº¼æ„æ€ï¼Ÿ <code class="language-text">count</code> æœ‰ã€Œè§€å¯Ÿã€è‘—æˆ‘å€‘çš„ state çš„è®ŠåŒ–ç„¶å¾Œè‡ªå‹•æ›´æ–°å—ï¼Ÿé€™å¯èƒ½æ˜¯ä½ å­¸ React æœ‰ç”¨çš„ç¬¬ä¸€å€‹ç›´è¦ºï¼Œä½†å®ƒä¸¦<em>ä¸æ˜¯</em><a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="nofollow noopener noreferrer">ç²¾ç¢ºçš„å¿ƒç†æ¨¡å‹</a>ã€‚</p>
<p><strong>åœ¨é€™å€‹ä¾‹å­è£¡ï¼Œ<code class="language-text">count</code> åªæ˜¯ä¸€å€‹æ•¸å­—ã€‚</strong>å®ƒä¸æ˜¯ç¥å¥‡çš„ã€Œdata bindingã€ã€ã€Œwatcherã€ã€ã€Œproxyã€æˆ–å…¶ä»–æ±è¥¿ã€‚å®ƒå¦‚åŒä»¥ä¸‹æƒ…å½¢ï¼Œæ˜¯å€‹å¥½çš„èˆŠçš„æ•¸å­—ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token comment">// ...</span></code></pre></div>
<p>ç•¶æˆ‘å€‘çš„å…ƒä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ™‚å€™ï¼Œæˆ‘å€‘å¾ <code class="language-text">useState()</code> æ‹¿åˆ°çš„ <code class="language-text">count</code> è®Šæ•¸æ˜¯ <code class="language-text">0</code>ã€‚ç•¶æˆ‘å€‘å‘¼å« <code class="language-text">setCount(1)</code> ä¹‹å¾Œï¼ŒReact å†æ¬¡å‘¼å«æˆ‘å€‘çš„å…ƒä»¶ã€‚é€™æ¬¡ï¼Œ<code class="language-text">count</code> å°‡è®Šæˆ <code class="language-text">1</code>ã€‚æ‰€ä»¥ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ™‚</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// è¢« useState() å›å‚³</span></span>  <span class="token comment">// ...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¶“éä¸€æ¬¡é»æ“Šï¼Œæˆ‘å€‘çš„å‡½å¼å†æ¬¡è¢«å‘¼å«</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// è¢« useState() å›å‚³</span></span>  <span class="token comment">// ...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¶“éå¦ä¸€æ¬¡é»æ“Šï¼Œæˆ‘å€‘çš„å‡½å¼å†æ¬¡è¢«å‘¼å«</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// è¢« useState() å›å‚³</span></span>  <span class="token comment">// ...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>æ¯ç•¶æˆ‘å€‘æ›´æ–° stateï¼Œ React å‘¼å«æˆ‘å€‘çš„å…ƒä»¶ã€‚æ¯æ¬¡æ¸²æŸ“çš„çµæœæœƒã€Œçœ‹è¦‹ã€ä»–è‡ªå·±çš„ <code class="language-text">counter</code> state çš„å€¼ï¼Œè€Œåœ¨æˆ‘å€‘çš„å‡½å¼è£¡å®ƒæ˜¯å€‹<em>å¸¸æ•¸</em>ã€‚</strong></p>
<p>æ‰€ä»¥é€™è¡Œä¸æœƒåšä»»ä½•ç‰¹åˆ¥çš„ data bindingï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre></div>
<p><strong>å®ƒåªæœƒå°‡ä¸€å€‹æ•¸å­—çš„å€¼æ”¾é€²æˆ‘å€‘æ¸²æŸ“çš„è¼¸å‡ºçµæœã€‚</strong>é‚£å€‹æ•¸å­—æ˜¯ç”± React æ‰€æä¾›çš„ã€‚ç•¶æˆ‘å€‘ <code class="language-text">setCount</code>ï¼ŒReact å¸¶è‘—ä¸åŒçš„ <code class="language-text">count</code> å€¼å†æ¬¡å‘¼å«æˆ‘å€‘çš„å…ƒä»¶ã€‚ç„¶å¾Œ React æ›´æ–° DOM ä¾†å°æ‡‰æˆ‘å€‘æœ€æ–°çš„æ¸²æŸ“çµæœã€‚</p>
<p>é—œéµè¦é»æ˜¯ï¼Œåœ¨ä»»ä½•æ¸²æŸ“è£¡é¢çš„ <code class="language-text">count</code> å¸¸æ•¸ä¸æœƒç¶“ç”±æ™‚é–“è€Œæ”¹è®Šã€‚æ˜¯æˆ‘å€‘çš„å…ƒä»¶å†æ¬¡è¢«å‘¼å« â€” ç„¶å¾Œæ¯æ¬¡çš„æ¸²æŸ“ã€Œçœ‹è¦‹ã€å®ƒè‡ªå·±çš„ <code class="language-text">count</code> å€¼ï¼Œé€™å€‹å€¼æ˜¯å­¤ç«‹æ–¼æ¯æ¬¡çš„æ¸²æŸ“çš„ã€‚</p>
<p><em>(æƒ³è¦æ›´æ·±å…¥äº†è§£é€™å€‹éç¨‹ï¼Œçœ‹çœ‹æˆ‘çš„ <a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="nofollow noopener noreferrer">React as a UI Runtime</a> çš„æ–‡ç« )</em></p>
<h2 id="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„-event-handlers"><a href="#%E6%AF%8F%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E5%AE%83%E8%87%AA%E5%B7%B1%E7%9A%84-event-handlers" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Event Handlers</h2>
<p>ç›®å‰ç‚ºæ­¢é‚„æ»¿å¥½çš„ã€‚é‚£ event handler å‘¢ï¼Ÿ</p>
<p>çœ‹çœ‹ä»¥ä¸‹çš„ä¾‹å­ï¼Œå®ƒåœ¨ä¸‰ç§’ä¹‹å¾Œå‘ˆç¾äº†ä¸€å€‹ <code class="language-text">count</code> çš„è­¦å‘Šï¼ˆalertï¼‰ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Click me</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">        Show alert</span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å‡è¨­æˆ‘åšäº†ä»¥ä¸‹å¹¾å€‹æ­¥é©Ÿï¼š</p>
<ul>
<li><strong>å¢åŠ </strong> è¨ˆæ•¸å™¨åˆ° 3</li>
<li><strong>æŒ‰ä¸‹</strong> ã€ŒShow alertã€</li>
<li><strong>å¢åŠ </strong> è¨ˆæ•¸å™¨åˆ° 5 ï¼ˆåœ¨ timeout ç™¼ç”Ÿä»¥å‰ï¼‰</li>
</ul>
<p><img src="/counter-46c55d5f1f749462b7a173f1e748e41e.gif" alt="è¨ˆæ•¸å™¨ç¤ºç¯„"></p>
<p>ä½ é æœŸ alert æœƒé¡¯ç¤ºä»€éº¼ï¼Ÿå®ƒæœƒé¡¯ç¤º 5 â€” è¨ˆæ•¸å™¨åœ¨ alert æ™‚çš„ç‹€æ…‹ï¼Ÿé‚„æ˜¯å®ƒæœƒé¡¯ç¤º 3 â€” ç•¶æˆ‘é»æ“Šæ™‚çš„ç‹€æ…‹ï¼Ÿ</p>
<hr>
<p><em>ä»¥ä¸‹æœ‰åŠ‡é€</em></p>
<hr>
<p>å»<a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="nofollow noopener noreferrer">è‡ªå·±è©¦è©¦çœ‹å§ï¼</a></p>
<p>å¦‚æœé€™å€‹è¡Œç‚ºå°ä½ ä¾†èªªä¸å¤ªåˆç†ï¼Œè«‹æƒ³åƒä¸€å€‹æ›´å¯¦éš›çš„ä¾‹å­ï¼šä¸€å€‹æ“æœ‰ç¾åœ¨æ¥æ”¶è€… ID çš„ç‹€æ…‹çš„èŠå¤©æ‡‰ç”¨ç¨‹å¼ï¼Œå’Œä¸€å€‹é€å‡ºæŒ‰éˆ•ã€‚<a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="nofollow noopener noreferrer">é€™ç¯‡æ–‡ç« </a>æ¢ç´¢äº†æ·±å…¥çš„åŸå› ï¼Œè€Œæ­£ç¢ºçš„ç­”æ¡ˆæ˜¯ 3ã€‚</p>
<p>è­¦å‘Šæœƒã€Œæ•æ‰ã€åˆ°æˆ‘æŒ‰ä¸‹æŒ‰éˆ•æ™‚çš„ç‹€æ…‹ã€‚</p>
<p><em>ï¼ˆæœ‰å„ç¨®æ–¹æ³•ä¾†å¯¦ä½œå…¶ä»–çš„è¡Œç‚ºï¼Œä½†ç¾åœ¨æˆ‘æœƒé—œæ³¨åœ¨é è¨­çš„æƒ…å½¢ã€‚ç•¶å»ºæ§‹ä¸€å€‹å¿ƒç†æ¨¡å‹çš„æ™‚å€™ï¼Œæˆ‘å€‘å¾å¯é¸æ“‡çš„é€ƒç”Ÿè‰™å£è£¡ä¾†å€åˆ†ã€Œæœ€å°‘é˜»åŠ›è·¯å¾‘ã€æ˜¯é‡è¦çš„ã€‚ï¼‰</em></p>
<hr>
<p>ä½†å®ƒæ˜¯æ€éº¼é‹ä½œçš„ï¼Ÿ</p>
<p>æˆ‘å€‘è¨è«–äº† <code class="language-text">count</code> å€¼å°æˆ‘å€‘å‡½å¼çš„æ¯å€‹ç‰¹å®šçš„å‘¼å«æ˜¯å¸¸æ•¸ã€‚é€™å€‹æ˜¯å€¼å¾—å¼·èª¿çš„ â€” <strong>æˆ‘å€‘çš„å‡½å¼è¢«å‘¼å«äº†å¾ˆå¤šæ¬¡ï¼ˆæ¯æ¬¡æ¸²æŸ“ä¸€æ¬¡ï¼‰ï¼Œä½†æ¯æ¬¡è£¡é¢çš„ <code class="language-text">count</code> å€¼éƒ½æ˜¯å¸¸æ•¸ï¼Œä¸¦ä¸”è¢«è¨­å®šåˆ°æŸå€‹ç‰¹å®šçš„å€¼ï¼ˆæ¸²æŸ“çš„ stateï¼‰</strong></p>
<p>é€™ä¸¦ä¸æ˜¯é‡å° React â€” æ­£å¸¸çš„å‡½å¼ä¹Ÿæœ‰é¡ä¼¼çš„é‹ä½œæ–¹å¼ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> name <span class="token operator">=</span> person<span class="token punctuation">.</span>name<span class="token punctuation">;</span></span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> someone <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Dan'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span>

someone <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Yuzhi'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span>

someone <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Dominic'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>åœ¨<a href="https://codesandbox.io/s/mm6ww11lk8" target="_blank" rel="nofollow noopener noreferrer">é€™å€‹ç¯„ä¾‹</a>è£¡é¢ï¼Œå¤–é¢çš„ <code class="language-text">someone</code> è®Šæ•¸è¢«å¤šæ¬¡é‡æ–°è³¦å€¼ã€‚ï¼ˆå°±å¦‚åŒ React çš„æŸäº›åœ°æ–¹ï¼Œ<em>ç¾åœ¨</em>çš„ state å¯ä»¥æ”¹è®Šã€‚ï¼‰<strong>ç„¶è€Œï¼Œåœ¨ <code class="language-text">sayHi</code> è£¡é¢ï¼Œæœ‰å€‹åœ¨ç‰¹å®šå‘¼å«è£¡è·Ÿæœ¬åœ°çš„ <code class="language-text">name</code> å¸¸æ•¸é—œè¯çš„ <code class="language-text">person</code>ã€‚</strong>é€™å€‹å¸¸æ•¸æ˜¯æœ¬åœ°çš„ï¼Œæ‰€ä»¥å®ƒåœ¨æ¯æ¬¡çš„å‘¼å«ä¹‹é–“éƒ½æ˜¯å­¤ç«‹çš„ï¼å› æ­¤ï¼Œæ¯ç•¶ timeout è§¸ç™¼çš„æ™‚å€™ï¼Œæ¯å€‹è­¦å‘Šæœƒã€Œè¨˜å¾—ã€å®ƒè‡ªå·±çš„ <code class="language-text">name</code>ã€‚</p>
<p>é€™å€‹è§£é‡‹äº†æˆ‘å€‘çš„ event handler æ•æ‰äº†é»é¸æ™‚çš„ <code class="language-text">count</code>ã€‚å¦‚æœæˆ‘å€‘æ‡‰ç”¨ç›¸åŒçš„ä»£æ›åŸå‰‡ï¼Œæ¯æ¬¡çš„é¸æŸ“æœƒã€Œçœ‹åˆ°ã€å®ƒè‡ªå·±çš„ <code class="language-text">count</code>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ™‚</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// è¢« useState() å›å‚³</span></span>  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¶“éä¸€æ¬¡é»æ“Šï¼Œæˆ‘å€‘çš„å‡½å¼å†æ¬¡è¢«å‘¼å«</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// è¢« useState() å›å‚³</span></span>  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¶“éå¦ä¸€æ¬¡é»æ“Šï¼Œæˆ‘å€‘çš„å‡½å¼å†æ¬¡è¢«å‘¼å«</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// è¢« useState() å›å‚³</span></span>  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>äº‹å¯¦ä¸Šï¼Œæ¯æ¬¡æ¸²æŸ“æœƒå›å‚³å®ƒè‡ªå·±ã€Œç‰ˆæœ¬ã€çš„ <code class="language-text">handleAlertClick</code>ã€‚æ¯å€‹ç‰ˆæœ¬ã€Œè¨˜å¾—ã€å®ƒè‡ªå·±çš„ <code class="language-text">count</code>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ™‚</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// æœ‰ 0 åœ¨è£¡é¢çš„é‚£ä¸€å€‹</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¶“éä¸€æ¬¡é»æ“Šï¼Œæˆ‘å€‘çš„å‡½å¼å†æ¬¡è¢«å‘¼å«</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// æœ‰ 1 åœ¨è£¡é¢çš„é‚£ä¸€å€‹</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¶“éå¦ä¸€æ¬¡é»æ“Šï¼Œæˆ‘å€‘çš„å‡½å¼å†æ¬¡è¢«å‘¼å«</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleAlertClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'You clicked on: '</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleAlertClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token comment">// æœ‰ 2 åœ¨è£¡é¢çš„é‚£ä¸€å€‹</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>é€™å°±æ˜¯ç‚ºä»€éº¼åœ¨é€™å€‹<a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="nofollow noopener noreferrer">ç¤ºç¯„è£¡é¢</a>ï¼Œ event handlers ã€Œå±¬æ–¼ã€ä¸€å€‹ç‰¹å®šçš„æ¸²æŸ“ï¼Œç•¶ä½ é»æ“Šå¾Œï¼Œå®ƒæŒçºŒåœ°ç”¨é‚£å€‹æ¸²æŸ“<em>è£¡</em> <code class="language-text">counter</code> çš„ç‹€æ…‹ã€‚</p>
<p><strong>åœ¨ä»»ä½•ç‰¹å®šçš„æ¸²æŸ“è£¡é¢ï¼Œprops å’Œ state æœƒæ°¸é ä¿æŒä¸€æ¨£ã€‚</strong>ä½†å¦‚æœ props å’Œ state åœ¨æ¯æ¬¡æ¸²æŸ“ä¹‹é–“éƒ½æ˜¯å­¤ç«‹çš„ï¼Œé‚£ä»»ä½•ç”¨äº†å®ƒå€‘çš„å€¼éƒ½æ˜¯é€™æ¨£ï¼ˆåŒ…å« event handlersï¼‰ã€‚å®ƒå€‘ä¹Ÿã€Œå±¬æ–¼ã€ä¸€å€‹ç‰¹å®šçš„æ¸²æŸ“ã€‚æ‰€ä»¥ç”šè‡³åœ¨ event handler è£¡çš„ async å‡½å¼æœƒã€Œçœ‹åˆ°ã€ä¸€æ¨£çš„ <code class="language-text">count</code> å€¼ã€‚</p>
<p><em>ç­†è¨˜ï¼šæˆ‘å°‡å…·é«”çš„ <code class="language-text">count</code> å€¼å¯«åœ¨ä¸Šé¢çš„ <code class="language-text">handleAlertClick</code> å‡½å¼ã€‚é€™å€‹å¿ƒç†çš„ä»£æ›æ˜¯å®‰å…¨çš„ï¼Œå› ç‚º <code class="language-text">count</code> ä¸å¯èƒ½åœ¨ç‰¹å®šçš„æ¸²æŸ“è£¡é¢æ”¹è®Šã€‚å®ƒè¢«å®£å‘Šç‚º <code class="language-text">å¸¸æ•¸</code> è€Œä¸”æ˜¯å€‹æ•¸å­—ã€‚å®‰å…¨çš„æƒ³æ³•æ˜¯å°‡å…¶å®ƒçš„å€¼ï¼Œå¦‚ç‰©ä»¶ï¼Œä¹Ÿç”¨ç›¸åŒçš„æ–¹å¼ä¾†æ€è€ƒï¼Œä½†åªåœ¨æˆ‘å€‘åŒæ„é¿å…è®Šç•°ï¼ˆmutatingï¼‰ç‹€æ…‹ã€‚ç”¨æ–°å‰µé€ çš„ç‰©ä»¶å‘¼å« <code class="language-text">setSomething(newObj)</code> è€Œä¸å»è®Šç•°å®ƒæ˜¯å¯è¡Œçš„ï¼Œå› ç‚ºå±¬æ–¼å‰ä¸€å€‹æ¸²æŸ“çš„ state æ˜¯å®Œå¥½çš„ã€‚</em></p>
<h2 id="æ¯æ¬¡çš„æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„-effects"><a href="#%E6%AF%8F%E6%AC%A1%E7%9A%84%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E5%AE%83%E8%87%AA%E5%B7%B1%E7%9A%84-effects" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯æ¬¡çš„æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Effects</h2>
<p>æœ¬ç¯‡æ–‡ç« æ‡‰è©²è¦æ˜¯è¨è«–é—œæ–¼ effectsï¼Œä½†æˆ‘å€‘é‚„æ²’èŠåˆ° effectsï¼ç¾åœ¨æˆ‘å€‘æœƒæ‹‰å›ä¾†ã€‚é¡¯ç„¶åœ°ï¼Œeffects ä¸¦æ²’ä»€éº¼ä¸åŒã€‚</p>
<p>è®“æˆ‘å€‘å›åˆ°<a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="nofollow noopener noreferrer">æ–‡ä»¶</a>è£¡çš„ç¯„ä¾‹ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Click me</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>é€™è£¡æœ‰å€‹å•é¡Œè¦çµ¦ä½ ï¼šeffect å¦‚ä½•è®€å–æœ€æ–°çš„ <code class="language-text">count</code> ç‹€æ…‹å‘¢ï¼Ÿ</strong></p>
<p>æˆ–è¨±ï¼Œé€™è£¡æœ‰æŸç¨®ã€Œdata bindingã€æˆ–ã€Œè§€çœ‹ã€ï¼Œä½¿å¾— <code class="language-text">count</code> å³æ™‚åœ¨ effect å‡½å¼è£¡é¢æ›´æ–°ï¼Ÿæˆ–è¨± <code class="language-text">count</code> æ˜¯å€‹  React èƒ½å¤ è¨­å®šåœ¨æˆ‘å€‘çš„å…ƒä»¶è£¡é¢çš„ mutable çš„è®Šæ•¸ï¼Œæ‰€ä»¥æˆ‘å€‘çš„ effect æ°¸é éƒ½å¯ä»¥çœ‹å¾—åˆ°æœ€æ–°çš„å€¼ï¼Ÿ</p>
<p>ä¸ã€‚</p>
<p>æˆ‘å€‘å·²ç¶“çŸ¥é“ <code class="language-text">count</code> æ˜¯å€‹åœ¨ç‰¹å®šå…ƒä»¶æ¸²æŸ“è£¡é¢çš„å¸¸æ•¸ã€‚Event handlers ä¹‹æ‰€ä»¥èƒ½å¤ ã€Œçœ‹è¦‹ã€å®ƒå€‘ã€Œæ‰€å±¬çš„ã€æ¸²æŸ“è£¡çš„ <code class="language-text">count</code> çš„ç‹€æ…‹ï¼Œæ˜¯å› ç‚º <code class="language-text">count</code> æ˜¯å€‹åœ¨å®ƒç¯„åœè£¡çš„è®Šæ•¸ã€‚è€Œ Effects ä¹Ÿæ˜¯ç›¸åŒçš„é“ç†ï¼</p>
<p><strong>ä¸¦ä¸æ˜¯ <code class="language-text">count</code> è®Šæ•¸å› ç‚ºæŸç¨®åŸå› åœ¨ã€Œä¸è®Šçš„ã€ effect è£¡æ”¹è®Šäº†ã€‚æ˜¯å› ç‚º <em>effect å‡½å¼æœ¬èº«</em> åœ¨æ¯æ¬¡çš„æ¸²æŸ“éƒ½æ˜¯ä¸åŒçš„ã€‚</strong></p>
<p>æ¯å€‹ç‰ˆæœ¬ã€Œçœ‹è¦‹ã€å®ƒã€Œæ‰€å±¬çš„ã€æ¸²æŸ“çš„ <code class="language-text">count</code> å€¼ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ™‚</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ™‚çš„ Effect å‡½å¼</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">0</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¶“éä¸€æ¬¡é»æ“Šï¼Œæˆ‘å€‘çš„å‡½å¼å†æ¬¡è¢«å‘¼å«</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// åœ¨ç¬¬äºŒæ¬¡é¸æŸ“æ™‚çš„ Effect å‡½å¼</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¶“éå¦ä¸€æ¬¡é»æ“Šï¼Œæˆ‘å€‘çš„å‡½å¼å†æ¬¡è¢«å‘¼å«</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// åœ¨ç¬¬ä¸‰æ¬¡æ¸²æŸ“æ™‚çš„ Effect å‡½å¼</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span></code></pre></div>
<p>React è¨˜å¾—ä½ æä¾›çš„ effect å‡½å¼ï¼Œä¸”åœ¨ä¸€å † DOM çš„è®ŠåŒ–å¾ŒåŸ·è¡Œå®ƒï¼Œç„¶å¾Œè®“ç€è¦½å™¨å°‡ç•«é¢é¡¯ç¤ºåœ¨è¢å¹•ä¸Šã€‚</p>
<p>æ‰€ä»¥å³ä½¿åœ¨é€™è£¡æˆ‘å€‘è¨è«–äº†ä¸€å€‹å–®ä¸€çš„ <em>effect</em> æ¦‚å¿µï¼ˆæ›´æ–°æ–‡ä»¶çš„æ¨™é¡Œï¼‰ï¼Œå®ƒæ˜¯åœ¨æ¯æ¬¡æ¸²æŸ“è¢«<em>ä¸åŒçš„å‡½å¼</em>æ‰€å‘ˆç¾çš„ â€” æ¯å€‹ effect å‡½å¼ã€Œçœ‹åˆ°ã€å°ˆå±¬æ–¼å®ƒçš„ props å’Œ stateã€‚</p>
<p><strong>æ¦‚å¿µä¸Šä¾†èªªï¼Œä½ å¯ä»¥æƒ³åƒ effects æ˜¯<em>æ¸²æŸ“çµæœçš„ä¸€éƒ¨åˆ†</em>ã€‚</strong></p>
<p>åš´è¬¹çš„ä¾†èªªï¼Œå®ƒå€‘ä¸æ˜¯ï¼ˆç‚ºäº†<a href="https://overreacted.io/why-do-hooks-rely-on-call-order/" target="_blank" rel="nofollow noopener noreferrer">å…è¨± hooks çš„çµ„æˆ</a>ä¸ç”¨éº»ç…©çš„ syntax æˆ– runtime é–‹éŠ·ï¼‰ã€‚ä½†åœ¨æˆ‘å€‘æ‰€å»ºé€ çš„å¿ƒç†æ¨¡å‹ä¸‹ï¼Œ effect å‡½å¼ã€Œå±¬æ–¼ã€ä¸€å€‹ç‰¹å®šçš„æ¸²æŸ“ï¼Œå°±å¦‚åŒ event handlers æ‰€åšçš„äº‹æƒ…ä¸€æ¨£ã€‚</p>
<hr>
<p>ç‚ºäº†ç¢ºä¿æˆ‘å€‘æœ‰ç´®å¯¦çš„äº†è§£ï¼Œè®“æˆ‘å€‘ä¾†å›é¡§æˆ‘å€‘ç¬¬ä¸€æ¬¡çš„æ¸²æŸ“ï¼š</p>
<ul>
<li><strong>Reactï¼š</strong>çµ¦æˆ‘ä¸€å€‹ç•¶ç‹€æ…‹æ˜¯ <code class="language-text">0</code> çš„ä½¿ç”¨è€…ä»‹é¢ã€‚</li>
<li>
<p><strong>ä½ çš„å…ƒä»¶ï¼š</strong></p>
<ul>
<li>é€™è£¡æ˜¯ä¸€å€‹æ¸²æŸ“çš„çµæœï¼š
<code class="language-text">&lt;p&gt;You clicked 0 times&lt;/p&gt;</code>.</li>
<li>å¦å¤–è¨˜å¾—åœ¨ä½ å®Œæˆä¹‹å¾ŒåŸ·è¡Œé€™å€‹ effectï¼š<code class="language-text">() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>ã€‚</li>
</ul>
</li>
<li><strong>Reactï¼š</strong> å¥½çš„ã€‚æ›´æ–°ä½¿ç”¨è€…ä»‹é¢ã€‚å˜¿ç€è¦½å™¨ï¼Œæˆ‘è¦åœ¨ DOM ä¸Šé¢å¢åŠ ä¸€äº›æ±è¥¿ã€‚</li>
<li><strong>ç€è¦½å™¨ï¼š</strong> é…·ï¼Œæˆ‘æŠŠå®ƒç•«åœ¨è¢å¹•ä¸Šäº†ã€‚</li>
<li>
<p><strong>Reactï¼š</strong> å¥½çš„ï¼Œç¾åœ¨æˆ‘è¦é–‹å§‹åŸ·è¡Œä½ çµ¦æˆ‘çš„ effectã€‚</p>
<ul>
<li>åŸ·è¡Œ <code class="language-text">() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>ã€‚</li>
</ul>
</li>
</ul>
<hr>
<p>ç¾åœ¨è®“æˆ‘å€‘ä¾†å›é¡§åœ¨æˆ‘å€‘é»æ“Šä¹‹å¾Œç™¼ç”Ÿäº†ä»€éº¼äº‹ï¼š</p>
<ul>
<li><strong>ä½ çš„å…ƒä»¶ï¼š</strong> å˜¿ Reactï¼ŒæŠŠæˆ‘çš„ç‹€æ…‹è¨­æˆ <code class="language-text">1</code>ã€‚</li>
<li><strong>React:</strong> çµ¦æˆ‘ä¸€å€‹ç•¶ç‹€æ…‹æ˜¯ <code class="language-text">1</code> çš„ä»‹é¢ã€‚</li>
<li>
<p><strong>ä½ çš„å…ƒä»¶ï¼š</strong></p>
<ul>
<li>é€™è£¡æ˜¯æ¸²æŸ“çš„çµæœï¼š
<code class="language-text">&lt;p&gt;You clicked 1 times&lt;/p&gt;</code>.</li>
<li>å¦å¤–è¨˜å¾—åœ¨ä½ å®Œæˆä¹‹å¾ŒåŸ·è¡Œé€™å€‹ effectï¼š <code class="language-text">() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>.</li>
</ul>
</li>
<li><strong>React:</strong> å¥½çš„ã€‚æ›´æ–°ä½¿ç”¨è€…ä»‹é¢ã€‚å˜¿ç€è¦½å™¨ï¼Œæˆ‘æ”¹è®Šäº† DOMã€‚</li>
<li><strong>ç€è¦½å™¨ï¼š</strong> é…·ï¼Œæˆ‘æŠŠä½ çš„æ”¹è®Šç•«åœ¨è¢å¹•ä¸Šäº†ã€‚</li>
<li>
<p><strong>React:</strong> å¥½çš„ï¼Œç¾åœ¨æˆ‘è¦é–‹å§‹åŸ·è¡Œå±¬æ–¼æˆ‘å‰›å‰›æ¸²æŸ“çš„ effectã€‚</p>
<ul>
<li>åŸ·è¡Œ <code class="language-text">() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h2 id="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰ä»–è‡ªå·±çš„-æ‰€æœ‰æ±è¥¿"><a href="#%E6%AF%8F%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E4%BB%96%E8%87%AA%E5%B7%B1%E7%9A%84-%E6%89%80%E6%9C%89%E6%9D%B1%E8%A5%BF" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰ä»–è‡ªå·±çš„â€¦ æ‰€æœ‰æ±è¥¿</h2>
<p><strong>æˆ‘å€‘ç¾åœ¨çŸ¥é“äº† effects æœƒåœ¨æ¯æ¬¡æ¸²æŸ“éå¾ŒåŸ·è¡Œï¼Œæ˜¯æ¦‚å¿µä¸Šå…ƒä»¶è¼¸å‡ºçš„ä¸€éƒ¨åˆ†ï¼Œç„¶å¾Œã€Œçœ‹è¦‹ã€ é‚£å€‹ç‰¹å®šæ¸²æŸ“çš„ props å’Œ stateã€‚</strong></p>
<p>è®“æˆ‘å€‘ä¾†è©¦è©¦ä¸€å€‹æƒ³åƒå¯¦é©—ã€‚è©¦è‘—è€ƒæ…®ä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Click me</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘åœ¨å¾ˆå°çš„å»¶é²æ™‚é–“å…§é»æ“Šäº†å¥½å¹¾æ¬¡ï¼Œè«‹å• log æœƒçœ‹èµ·ä¾†åƒæ€æ¨£ï¼Ÿ</p>
<hr>
<p><em>ä»¥ä¸‹æœ‰åŠ‡é€</em></p>
<hr>
<p>ä½ å¯èƒ½æœƒæƒ³é€™å€‹æ˜¯å€‹ gotcha ä¸”æœ€å¾Œçš„çµæœä¸ç›´è¦ºã€‚å®ƒä¸æ˜¯ï¼æˆ‘å€‘å°‡æœƒçœ‹è¦‹ä¸€å€‹åºåˆ—çš„ logs â€” æ¯å€‹éƒ½å±¬æ–¼æŸå€‹ç‰¹å®šçš„æ¸²æŸ“ï¼Œä¸”å› æ­¤æœ‰å®ƒè‡ªå·±çš„ <code class="language-text">count</code> å€¼ã€‚ä½ å¯ä»¥<a href="https://codesandbox.io/s/lyx20m1ol" target="_blank" rel="nofollow noopener noreferrer">è‡ªå·±è©¦è©¦çœ‹</a>ï¼š</p>
<p><img src="/timeout_counter-a5727d333c270e05942f508707265378.gif" alt="è¢å¹•ç´€éŒ„äº† 1, 2, 3, 4, 5 ç…§è‘—é †åºçš„ logã€‚"></p>
<p>ä½ å¯èƒ½æœƒæƒ³ï¼šã€Œç•¶ç„¶é€™æ˜¯å®ƒæ‰€åŸ·è¡Œçš„æ–¹å¼ï¼å®ƒå¯èƒ½æœ‰ä»€éº¼åˆ¥çš„é‹ä½œæ–¹å¼å—ï¼Ÿã€</p>
<p>é€™å€‹ä¸¦ä¸æ˜¯ <code class="language-text">this.state</code> åœ¨ class è£¡æ‰€é‹ä½œçš„æ–¹å¼ã€‚å¾ˆå®¹æ˜“æœƒçŠ¯ä¸‹è¦ºå¾—å®ƒçš„<a href="https://codesandbox.io/s/kkymzwjqz3" target="_blank" rel="nofollow noopener noreferrer">class å¯¦ä½œ</a>ç­‰åŒæ–¼ä»¥ä¸‹ç¨‹å¼ç¢¼çš„éŒ¯èª¤ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>ç„¶è€Œï¼Œ<code class="language-text">this.state.count</code> æ°¸é æŒ‡å‘<em>æœ€å¾Œçš„</em>è¨ˆæ•¸ï¼Œè€Œä¸æ˜¯å±¬æ–¼æŸå€‹ç‰¹å®šæ¸²æŸ“çš„å€¼ã€‚æ‰€ä»¥ä½ æœƒçœ‹åˆ°æ¯æ¬¡çš„ log éƒ½æ˜¯ <code class="language-text">5</code>ï¼š</p>
<p><img src="/timeout_counter_class-264b329edc111a1973003bdf2bcacd65.gif" alt="è¢å¹•ç´€éŒ„äº† 5, 5, 5, 5, 5 ç…§è‘—é †åºçš„ logã€‚"></p>
<p>æˆ‘æƒ³é€™æ˜¯è«·åˆºçš„ï¼ŒHooks å±…ç„¶é€™éº¼ä¾è³´ JavaScript çš„ closuresï¼Œç„¶è€Œå®ƒå»æ˜¯ class çš„å¯¦ä½œï¼Œæ·±é™·æ–¼é€šå¸¸èˆ‡ closure é—œè¯çš„<a href="https://wsvincent.com/javascript-closure-settimeout-for-loop/" target="_blank" rel="nofollow noopener noreferrer">å…¸å‹çš„ wrong-value-in-a-timeout å›°æƒ‘</a>ã€‚é€™æ˜¯å› ç‚ºåœ¨é€™å€‹ä¾‹å­ä¸­å¯¦éš›é€ æˆå›°æƒ‘çš„æºé ­æ˜¯ mutationï¼ˆReact åœ¨ class è£¡è®Šç•° <code class="language-text">this.state</code> ä¾†æŒ‡å‡ºæœ€æ–°çš„ç‹€æ…‹ï¼‰è€Œä¸æ˜¯ closure æœ¬èº«ã€‚</p>
<p><strong>ä½ çš„å€¼ä¸æœƒè®ŠåŒ–çš„æ™‚å€™ï¼ŒClosure å¾ˆæ£’ã€‚å®ƒè®“å®ƒå€‘èƒ½å¤ æ›´ç°¡å–®çš„è¢«æ€è€ƒï¼Œå› ç‚ºä½ æœ€å¾Œæœƒåƒè€ƒå¸¸æ•¸ã€‚</strong>è€Œä¸”å¦‚åŒæˆ‘å€‘è¨è«–çš„ï¼Œprops å’Œ state æ°¸é ä¸æœƒåœ¨ç‰¹å®šçš„æ¸²æŸ“è£¡é¢æ”¹è®Šã€‚é †å¸¶ä¸€æï¼Œæˆ‘å€‘å¯ä»¥æŠŠ class çš„ç‰ˆæœ¬ä¿®æ­£â€¦ è—‰ç”±<a href="https://codesandbox.io/s/w7vjo07055" target="_blank" rel="nofollow noopener noreferrer">ä½¿ç”¨ closure</a>ã€‚</p>
<h2 id="é€†æµè€Œè¡Œ"><a href="#%E9%80%86%E6%B5%81%E8%80%8C%E8%A1%8C" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>é€†æµè€Œè¡Œ</h2>
<p>åœ¨é€™å€‹æ™‚é–“é»å°‡å®ƒç‰¹åˆ¥èªªå‡ºä¾†æ˜¯é‡è¦çš„ï¼š<strong>æ¯å€‹</strong>åœ¨å…ƒä»¶è£¡æ¸²æŸ“çš„å‡½å¼ï¼ˆåŒ…å«è£¡é¢çš„ event handlerã€effectsã€timeout æˆ– API å‘¼å«ï¼‰æ•æ‰äº†å®šç¾©ä»–å€‘çš„æ¸²æŸ“æ‰€å‘¼å«çš„ props å’Œ stateã€‚</p>
<p>æ‰€ä»¥é€™è£¡æ˜¯å…©å€‹ç›¸ç­‰çš„ä¾‹å­ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> counter <span class="token operator">=</span> props<span class="token punctuation">.</span>counter<span class="token punctuation">;</span></span>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>ç„¡è«–ä½ æ˜¯å¦ã€Œææ—©ã€è®€å–ä½ å…ƒä»¶è£¡çš„ props æˆ– stateã€‚</strong>å®ƒå€‘éƒ½ä¸æœƒæ”¹è®Šï¼åœ¨å–®ä¸€å€‹æ¸²æŸ“çš„ç¯„åœè£¡ï¼Œprops å’Œ state æœƒä¿æŒä¸€æ¨£ã€‚ï¼ˆè§£æ§‹ props è®“é€™å€‹æ›´ç‚ºæ˜é¡¯ã€‚ï¼‰</p>
<p>ç•¶ç„¶ï¼Œæœ‰æ™‚å€™ä½ <em>æƒ³è¦</em>è®€å–æœ€æ–°çš„å€¼è€Œä¸æ˜¯æŸå€‹åœ¨ effect çš„ callback è£¡æ‰€æ•æ‰åˆ°çš„å€¼ã€‚æœ€ç°¡å–®çš„æ–¹æ³•æ˜¯ä½¿ç”¨ refsï¼Œå¦‚åŒåœ¨<a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="nofollow noopener noreferrer">é€™ç¯‡æ–‡ç« </a>æœ€å¾Œä¸€å€‹å°ç¯€æ‰€æ•˜è¿°çš„ã€‚</p>
<p>è«‹æ³¨æ„ï¼Œç•¶ä½ æƒ³è¦å¾<em>éå»</em>çš„æ¸²æŸ“å‡½å¼è®€å–<em>æœªä¾†</em>çš„ props æˆ– state æ™‚ï¼Œä½ æ˜¯é€†æµè€Œè¡Œçš„ã€‚å®ƒä¸æ˜¯<em>éŒ¯èª¤</em>ï¼ˆè€Œä¸”åœ¨æŸäº›æ™‚å€™æ˜¯å¿…é ˆçš„ï¼‰ä½†ç ´å£ç¯„ä¾‹å¯èƒ½æœƒçœ‹èµ·ä¾†æ¯”è¼ƒä¸ã€Œä¹¾æ·¨ã€ã€‚é€™æ˜¯æ•…æ„çš„çµæœï¼Œå› ç‚ºå®ƒå¹«åŠ©å‡¸é¡¯å“ªå€‹ç¨‹å¼ç¢¼æ˜¯æ˜“ç¢çš„ä¸”ä¾è³´æ–¼æ™‚é–“é»ã€‚åœ¨ class è£¡é¢ï¼Œç•¶é€™ç™¼ç”Ÿçš„æ™‚å€™å®ƒæ¯”è¼ƒä¸æ˜é¡¯ã€‚</p>
<p>é€™è£¡æ˜¯ä¸€å€‹<a href="https://codesandbox.io/s/rm7z22qnlp" target="_blank" rel="nofollow noopener noreferrer">æˆ‘å€‘è¨ˆæ•¸å™¨ç¯„ä¾‹çš„ç‰ˆæœ¬</a>ï¼Œå®ƒè¤‡è£½äº† class çš„è¡Œç‚ºï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> latestCount <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// Set the mutable latest value</span></span><span class="gatsby-highlight-code-line">    latestCount<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span></span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token comment">// Read the mutable latest value</span></span><span class="gatsby-highlight-code-line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>latestCount<span class="token punctuation">.</span>current<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre></div>
<p><img src="/timeout_counter_refs-78f7948263dd13b023498b23cb99f4fc.gif" alt="è¢å¹•ç´€éŒ„äº† 5, 5, 5, 5, 5 ç…§è‘—é †åºçš„ logã€‚"></p>
<p>åœ¨ React è£¡è®Šç•°æŸäº›æ±è¥¿å¯èƒ½çœ‹èµ·ä¾†æœ‰é»è©­ç•°ã€‚ç„¶è€Œï¼Œé€™å€‹æ˜¯å¯¦éš›ä¸Š React æœ¬èº«å¦‚ä½•é‡æ–°è³¦å€¼çµ¦ class è£¡çš„ <code class="language-text">this.state</code> çš„æ–¹å¼ã€‚ä¸åƒè¢«æ•æ‰çš„ props å’Œ stateï¼Œä½ ä¸¦æ²’æœ‰ä»»ä½•åœ¨ç‰¹å®šçš„ callback è£¡è®€å– <code class="language-text">latestCount.current</code> æœƒçµ¦ä½ ç›¸åŒå€¼çš„ä¿è­‰ã€‚å®šç¾©ä¸Šï¼Œä½ å¯ä»¥åœ¨ä»»æ„æ™‚é–“è®Šç•°å®ƒã€‚é€™å°±æ˜¯ç‚ºä½•å®ƒä¸æ˜¯é è¨­å€¼çš„åŸå› ï¼Œè€Œä¸”ä½ å¿…é ˆæ¥å—å®ƒã€‚ </p>
<h2 id="æ‰€ä»¥-cleanup-å‘¢ï¼Ÿ"><a href="#%E6%89%80%E4%BB%A5-cleanup-%E5%91%A2%EF%BC%9F" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ‰€ä»¥ Cleanup å‘¢ï¼Ÿ</h2>
<p>å¦‚åŒ<a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup" target="_blank" rel="nofollow noopener noreferrer">æ–‡ä»¶è§£é‡‹</a>ï¼Œæœ‰äº› effects å¯èƒ½æœ‰ cleanup çš„é¢ç›¸ã€‚æœ€çµ‚ï¼Œå®ƒçš„ç›®çš„æ˜¯ç‚ºäº†æŸäº›æƒ…å½¢ï¼Œä¾‹å¦‚è¨‚é–±ï¼Œä¾†ã€Œå–æ¶ˆã€effectã€‚</p>
<p>è€ƒæ…®ä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>å‡è¨­ <code class="language-text">props</code> åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ˜¯ <code class="language-text">{id: 10}</code>ï¼Œç„¶å¾Œåœ¨ç¬¬äºŒæ¬¡æ¸²æŸ“æ˜¯ <code class="language-text">{id: 20}</code>ã€‚ä½ <em>å¯èƒ½</em>æœƒæƒ³é¡ä¼¼ä»¥ä¸‹çš„äº‹æƒ…æœƒç™¼ç”Ÿï¼š</p>
<ul>
<li>React ç‚ºäº† <code class="language-text">{id: 10}</code> æ¸…ç† effectã€‚</li>
<li>React ç‚ºäº† <code class="language-text">{id: 20}</code> æ¸²æŸ“ä½¿ç”¨è€…ä»‹é¢ã€‚</li>
<li>React ç‚ºäº† <code class="language-text">{id: 20}</code> åŸ·è¡Œ effectã€‚</li>
</ul>
<p>ï¼ˆé€™å…¶å¯¦ä¸¦ä¸å¤ªæ˜¯çœŸå¯¦çš„æƒ…å½¢ã€‚ï¼‰</p>
<p>ä»¥é€™æ¨£çš„å¿ƒç†æ¨¡å‹ä¾†çœ‹ï¼Œä½ å¯èƒ½æœƒæƒ³ï¼Œcleanup å› ç‚ºåœ¨æˆ‘å€‘é‡æ–°æ¸²æŸ“ä»¥å‰åŸ·è¡Œæ‰€ä»¥å¯ä»¥ã€Œçœ‹è¦‹ã€èˆŠçš„ propsï¼Œç„¶å¾Œæ–°çš„ effect  å› ç‚ºåœ¨é‡æ–°æ¸²æŸ“ä¹‹å¾ŒåŸ·è¡Œï¼Œæ‰€ä»¥ã€Œçœ‹è¦‹ã€æ–°çš„ propsã€‚é€™æ˜¯ç›´æ¥å¾ class çš„ç”Ÿå‘½é€±æœŸæ‰€æ¨æƒ³çš„å¿ƒç†æ¨¡å‹ï¼Œç„¶è€Œ<strong>å®ƒåœ¨é€™è£¡ä¸¦ä¸æ˜¯æº–ç¢ºçš„</strong>ã€‚æˆ‘å€‘ä¾†çœ‹çœ‹ç‚ºä»€éº¼ã€‚</p>
<p>React åªæœƒåœ¨<a href="https://medium.com/@dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f" target="_blank" rel="nofollow noopener noreferrer">è®“ç€è¦½å™¨ç¹ªåœ–</a>ä¹‹å¾ŒåŸ·è¡Œ effectsã€‚é€™ä½¿å¾—ä½ çš„æ‡‰ç”¨ç¨‹å¼æ›´å¿«ï¼Œå› ç‚ºå¤§éƒ¨åˆ†çš„ effect ä¸æœƒé˜»æ“‹ç•«é¢çš„æ›´æ–°ã€‚Effect çš„æ¸…ç†ä¹Ÿæœƒè¢«å»¶é²ã€‚<strong>å‰ä¸€å€‹ effect æœƒåœ¨ç”¨æ–°çš„ props æ¸²æŸ“ <em>ä¹‹å¾Œ</em> è¢«æ¸…æ‰ï¼š</strong></p>
<ul>
<li><strong>React ç‚ºäº† <code class="language-text">{id: 20}</code> æ¸²æŸ“ä½¿ç”¨è€…ä»‹é¢ã€‚</strong></li>
<li>ç€è¦½å™¨ç•«å‡ºç•«é¢ã€‚æˆ‘å€‘åœ¨ç•«é¢ä¸Šçœ‹è¦‹ <code class="language-text">{id: 20}</code> çš„ä½¿ç”¨è€…ä»‹é¢ã€‚</li>
<li><strong>React ç‚ºäº† <code class="language-text">{id: 10}</code> æ¸…æ‰ effectã€‚</strong></li>
<li>React ç‚ºäº† <code class="language-text">{id: 20}</code> åŸ·è¡Œ effectã€‚</li>
</ul>
<p>ä½ å¯èƒ½æœƒæƒ³ï¼šç„¶è€Œï¼Œå¦‚æœå®ƒåœ¨ props æ”¹è®Šæˆ <code class="language-text">{id: 20}</code> <em>ä¹‹å¾Œ</em>åŸ·è¡Œï¼Œå‰ä¸€æ¬¡çš„ effect çš„æ¸…ç†æ€éº¼ä»ç„¶èƒ½å¤ ã€Œçœ‹åˆ°ã€èˆŠçš„ <code class="language-text">{id: 10}</code> props å‘¢ï¼Ÿ</p>
<p>æˆ‘å€‘æ›¾ç¶“åœ¨é€™è£¡éâ€¦ ğŸ¤”</p>
<p><img src="/deja_vu-5fe238cf03a21dfa32af624124fcdcff.gif" alt="æ—¢è¦–æ„Ÿï¼ˆé§­å®¢ä»»å‹™è£¡çš„è²“å’ªå ´æ™¯ï¼‰"></p>
<p>å¼•è¿°å‰ä¸€å€‹ç« ç¯€ï¼š</p>
<blockquote>
<p>æ¯å€‹åœ¨å…ƒä»¶è£¡æ¸²æŸ“çš„å‡½å¼ï¼ˆåŒ…å« event handlersã€effectsã€timeouts æˆ–è£¡é¢å‘¼å«çš„ APIï¼‰æœƒæ•æ‰åˆ°å®šç¾©å®ƒçš„æ¸²æŸ“è£¡çš„ props å’Œ stateã€‚</p>
</blockquote>
<p>ç¾åœ¨ç­”æ¡ˆå¾ˆæ¸…æ¥šäº†ï¼Effect çš„æ¸…ç†ä¸¦ä¸æ˜¯è®€åˆ°äº†ã€Œæœ€æ–°çš„ã€propsï¼Œç„¡è«–å®ƒä»£è¡¨ä»€éº¼ã€‚å®ƒè®€å–äº†å®šç¾©å®ƒä¸”æ‰€å±¬çš„æ¸²æŸ“è£¡çš„ propsï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œprops æ˜¯ {id: 10}</span>
<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„ Effect</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">      <span class="token comment">// æ¸…ç†ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„ effect</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä¸‹ä¸€æ¬¡æ¸²æŸ“ï¼Œprops æ˜¯ {id: 20}</span>
<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// ç¬¬äºŒæ¬¡æ¸²æŸ“çš„ Effect</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      ChatAPI<span class="token punctuation">.</span><span class="token function">subscribeToFriendStatus</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// æ¸…ç†ç¬¬äºŒæ¬¡æ¸²æŸ“çš„ effect</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        ChatAPI<span class="token punctuation">.</span><span class="token function">unsubscribeFromFriendStatus</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> handleStatusChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç‹åœ‹æœƒèˆˆç››ç„¶å¾Œè½‰è®Šç‚ºå¡µåŸƒï¼Œå¤ªé™½æœƒæ®†ç›¡å¤–å±¤è®Šæˆç™½çŸ®æ˜Ÿï¼Œæœ€å¾Œçš„æ–‡æ˜æœƒçµæŸã€‚ä½†æ²’æœ‰ä»»ä½•ä¸€å€‹æ±è¥¿å¯ä»¥ä½¿å¾— props é™¤äº† <code class="language-text">{id: 10}</code> ä»¥å¤–çš„æ±è¥¿è¢«ç¬¬ä¸€å€‹æ¸²æŸ“çš„ effect çš„æ¸…ç†æ‰€ã€Œçœ‹è¦‹ã€ã€‚</p>
<p>é€™å°±æ˜¯ React åˆ©ç”¨ä¾†è™•ç†ç¹ªåœ–ä¹‹å¾Œçš„ effects â€” è€Œä¸”è®“ä½ çš„æ‡‰ç”¨ç¨‹å¼é è¨­å¾ˆå¿«ã€‚å¦‚æœæˆ‘å€‘éœ€è¦ï¼ŒèˆŠçš„ props ä»åœ¨é‚£ã€‚</p>
<h2 id="åŒæ­¥åŒ–ï¼Œè€Œéç”Ÿå‘½é€±æœŸ"><a href="#%E5%90%8C%E6%AD%A5%E5%8C%96%EF%BC%8C%E8%80%8C%E9%9D%9E%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>åŒæ­¥åŒ–ï¼Œè€Œéç”Ÿå‘½é€±æœŸ</h2>
<p>React è£¡å…¶ä¸­ä¸€å€‹è®“æˆ‘æœ€å–œæ­¡çš„äº‹æƒ…æ˜¯å®ƒçµ±ä¸€äº†æ•˜è¿°æœ€åˆçš„æ¸²æŸ“çµæœå’Œä¹‹å¾Œçš„æ›´æ–°ã€‚é€™å€‹è®“ä½ çš„ç¨‹å¼<a href="https://overreacted.io/the-bug-o-notation/" target="_blank" rel="nofollow noopener noreferrer">æ¸›å°‘äº†äº‚åº¦</a>ã€‚</p>
<p>å‡è¨­æˆ‘çš„å…ƒä»¶çœ‹èµ·ä¾†åƒé€™æ¨£ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¡è«–æˆ‘æ¸²æŸ“äº† <code class="language-text">&lt;Greeting name=&quot;Dan&quot; /&gt;</code> ç„¶å¾Œ <code class="language-text">&lt;Greeting name=&quot;Yuzhi&quot; /&gt;</code>ï¼Œé‚„æ˜¯æˆ‘åªæ˜¯å–®ç´”çš„æ¸²æŸ“äº†<code class="language-text">&lt;Greeting name=&quot;Yuzhi&quot; /&gt;</code>ã€‚æœ€çµ‚ï¼Œæˆ‘å€‘åœ¨å…©ç¨®æƒ…æ³éƒ½æœƒçœ‹è¦‹ã€ŒHello, Yuzhiã€ã€‚</p>
<p>äººå€‘èªªï¼šã€Œé‡è¦çš„æ˜¯éç¨‹ï¼Œä¸æ˜¯ç›®çš„åœ°ã€ã€‚å° React ä¾†èªªå‰‡æ˜¯ç›¸åçš„ã€‚<strong>é‡è¦çš„æ˜¯ç›®çš„åœ°ï¼Œä¸æ˜¯éç¨‹ã€‚</strong>é€™æ˜¯è·Ÿåœ¨ jQuery ç¨‹å¼ç¢¼è£¡å‘¼å« <code class="language-text">$.addClass</code> å’Œ <code class="language-text">$.removeClass</code>ï¼ˆæˆ‘å€‘çš„ã€Œéç¨‹ã€ï¼‰å’Œç‰¹åˆ¥æ¨™ç¤ºå‡ºå“ªå€‹ CSS class <em>æ‡‰è©²</em>åœ¨ React ç¨‹å¼ç¢¼è£¡ï¼ˆæˆ‘å€‘çš„ã€Œç›®çš„åœ°ã€ï¼‰çš„ä¸åŒä¹‹è™•ã€‚</p>
<p><strong>React æ ¹æ“šæˆ‘å€‘ç¾åœ¨çš„ props å’Œ state åŒæ­¥äº† DOMã€‚</strong>åœ¨æ¸²æŸ“æ™‚ã€Œmountã€æˆ–ã€Œæ›´æ–°ã€ä¹‹é–“ä¸¦æ²’æœ‰å·®ç•°ã€‚</p>
<p>ä½ æ‡‰è©²ç”¨ç›¸ä¼¼çš„æƒ³æ³•ä¾†æ€è€ƒ effectsã€‚<strong><code class="language-text">useEffect</code> è®“ä½ æ ¹æ“šæˆ‘å€‘çš„ props å’Œ state ä¾† <em>åŒæ­¥</em> åœ¨ React æ¨¹å¤–çš„æ±è¥¿ã€‚</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>é€™æ˜¯æœ‰é»ä¸åŒæ–¼ä½ æ‰€ç†Ÿæ‚‰çš„ <em>mount/update/unmount</em> å¿ƒç†æ¨¡å‹ã€‚çœŸçš„æŠŠé€™ä»¶äº‹å…§åŒ–æ˜¯å¾ˆé‡è¦çš„ã€‚<strong>å¦‚æœä½ è©¦è‘—æŠŠ effects å¯«æˆèˆ‡å…ƒä»¶æ˜¯å¦ç¬¬ä¸€æ¬¡æ¸²æŸ“æœ‰é—œè€Œä¸åŒï¼Œä½ æ˜¯åœ¨å˜—è©¦é€†æµè€Œè¡Œï¼</strong>å¦‚æœæˆ‘å€‘çš„çµæœä¾è³´æ–¼ã€Œéç¨‹ã€è€Œä¸æ˜¯ã€Œç›®çš„åœ°ã€ï¼Œæˆ‘å€‘æœƒåŒæ­¥åŒ–å¤±æ•—ã€‚</p>
<p>å®ƒä¸æ‡‰è©²èˆ‡æˆ‘å€‘ç”¨ props A, B, C æ¸²æŸ“ï¼Œæˆ–æ˜¯æˆ‘å€‘ç›´æ¥æ¸²æŸ“ C æœ‰é—œã€‚ç„¶è€Œå¯èƒ½æœ‰äº›æš«æ™‚çš„å·®ç•°ï¼ˆä¾‹å¦‚ï¼Œç•¶æˆ‘å€‘ç²å–è³‡æ–™æ™‚ï¼‰ï¼Œæœ€çµ‚çµæœæ‡‰è©²è¦ä¸€æ¨£ã€‚</p>
<p>ç›¸åŒçš„ï¼Œåœ¨<em>æ¯å€‹</em>æ¸²æŸ“åŸ·è¡Œæ‰€æœ‰ effects å¯èƒ½ä¸æ˜¯å¾ˆæœ‰æ•ˆã€‚ï¼ˆè€Œä¸”åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œå®ƒæœƒå°è‡´ç„¡çª®è¿´åœˆã€‚ï¼‰</p>
<p>æ‰€ä»¥æˆ‘å€‘è¦æ€éº¼ä¿®æ­£å®ƒï¼Ÿ</p>
<h2 id="æ•™å°-react-ä¾†å€åˆ¥ä½ çš„-effects"><a href="#%E6%95%99%E5%B0%8E-react-%E4%BE%86%E5%8D%80%E5%88%A5%E4%BD%A0%E7%9A%84-effects" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ•™å° React ä¾†å€åˆ¥ä½ çš„ Effects</h2>
<p>æˆ‘å€‘å·²ç¶“å­¸åˆ°äº†é—œæ–¼ DOM æœ¬èº«çš„ä¸€èª²ã€‚React åªæœƒæ›´æ–°éƒ¨åˆ†çœŸçš„æ”¹è®Šçš„ DOM è€Œä¸æ˜¯æ¯æ¬¡é‡æ–°æ¸²æŸ“æ™‚è§¸ç¢°å®ƒã€‚</p>
<p>ç•¶ä½ æ›´æ–°</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  Hello, Dan
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre></div>
<p>åˆ°</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  Hello, Yuzhi
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre></div>
<p>React çœ‹è¦‹å…©å€‹ç‰©ä»¶ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> oldProps <span class="token operator">=</span> <span class="token punctuation">{</span>className<span class="token punctuation">:</span> <span class="token string">'Greeting'</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newProps <span class="token operator">=</span> <span class="token punctuation">{</span>className<span class="token punctuation">:</span> <span class="token string">'Greeting'</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token string">'Hello, Yuzhi'</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>å®ƒè·‘éå®ƒçš„æ¯å€‹ props ç„¶å¾Œæ±ºå®šå“ªå€‹ <code class="language-text">children</code> æ”¹è®Šäº†ä¸”éœ€è¦æ›´æ–° DOMï¼Œä½† <code class="language-text">className</code> ä¸æ˜¯ã€‚æ‰€ä»¥å®ƒå¯ä»¥åªè¦é€™æ¨£åšï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">domNode<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'Hello, Yuzhi'</span><span class="token punctuation">;</span>
<span class="token comment">// æ²’æœ‰å¿…è¦è§¸ç¢° domNode.className</span></code></pre></div>
<p><strong>æˆ‘å€‘å¯ä»¥ç”¨ effects åšé¡ä¼¼çš„äº‹æƒ…å—ï¼Ÿå¦‚æœèƒ½å¤ é¿å…åœ¨éå¿…è¦åŸ·è¡Œ effect çš„æ™‚å€™é‡æ–°åŸ·è¡Œå®ƒï¼Œé€™æ¨£æœƒå¾ˆæ£’ã€‚</strong></p>
<p>ä¾‹å¦‚ï¼Œå¯èƒ½æˆ‘å€‘çš„å…ƒä»¶å› ç‚ºç‹€æ…‹æ”¹è®Šè€Œé‡æ–°æ¸²æŸ“ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Greeting<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      Hello, </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCounter</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">        Increment</span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½†æˆ‘å€‘çš„ effect ä¸¦æ²’æœ‰ä½¿ç”¨åˆ° <code class="language-text">counter</code> çš„ç‹€æ…‹ã€‚<strong>æˆ‘å€‘çš„ effect ç”¨ <code class="language-text">name</code> prop åŒæ­¥äº† <code class="language-text">document.title</code>ï¼Œä½† <code class="language-text">name</code> prop ä¿æŒä¸€æ¨£ã€‚</strong>åœ¨æ¯æ¬¡è¨ˆæ•¸å™¨æ”¹è®Šæ™‚é‡æ–°è³¦äºˆ <code class="language-text">document.title</code> æ–°çš„å€¼çœ‹èµ·ä¾†ä¸å¤ªç†æƒ³ã€‚</p>
<p>OKï¼Œæ‰€ä»¥ React å¯ä»¥å–®ç´”çš„â€¦ æ¯”è¼ƒ effects çš„å·®ç•°å—ï¼Ÿ</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> <span class="token function-variable function">oldEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">newEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// React å¯ä»¥çœ‹åˆ°é€™äº›å‡½å¼åšäº†ä¸€æ¨£çš„äº‹å—ï¼Ÿ</span></code></pre></div>
<p>ä¸å¤ªè¡Œã€‚React ä¸èƒ½åœ¨æ²’æœ‰å‘¼å«å‡½å¼ä»¥å‰çŒœå‡ºå®ƒåœ¨åšä»€éº¼ã€‚ï¼ˆæºé ­ä¸¦æ²’æœ‰åŒ…å«ç‰¹å®šçš„å€¼ï¼Œå®ƒåªæ˜¯é—œæ‰äº† <code class="language-text">name</code> propã€‚ï¼‰</p>
<p>é€™å°±æ˜¯ç‚ºä»€éº¼å¦‚æœä½ æƒ³è¦é¿å…éå¿…è¦çš„é‡æ–°åŸ·è¡Œ effectsï¼Œä½ å¯ä»¥æä¾›ä¸€å€‹ä¾å±¬ï¼ˆdependencyï¼‰çš„é™£åˆ—ï¼ˆä¹Ÿå«åšã€Œdepsã€ï¼‰çš„åƒæ•¸çµ¦ <code class="language-text">useEffect</code>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æˆ‘å€‘çš„ deps</span></span></code></pre></div>
<p><strong>é€™å°±åƒå¦‚æœæˆ‘å€‘å‘Šè¨´ Reactï¼šã€Œå˜¿ï¼Œæˆ‘çŸ¥é“ä½ ä¸èƒ½çœ‹è¦‹å‡½å¼ <em>è£¡é¢</em>ï¼Œä½†æˆ‘ä¿è­‰ä»–åªæœƒç”¨åˆ° <code class="language-text">name</code> è€Œä¸æœƒæœ‰å…¶ä»–æ¸²æŸ“å±¤é¢çš„æ±è¥¿ã€‚ã€</strong></p>
<p>å¦‚æœåœ¨é€™æ¬¡å’Œå‰ä¸€æ¬¡åŸ·è¡Œ effect æ™‚ï¼Œé€™äº›çš„æ¯å€‹å€¼éƒ½æ˜¯ä¸€æ¨£çš„ï¼Œå°±æ²’æœ‰ä»€éº¼éœ€è¦åŒæ­¥çš„æ±è¥¿ï¼Œæ‰€ä»¥ React å¯ä»¥è·³éé€™å€‹ effectï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">oldEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> oldDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Dan'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">newEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, Dan'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Dan'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// React ä¸èƒ½å·çœ‹å‡½å¼çš„è£¡é¢ï¼Œä½†å®ƒå¯ä»¥æ¯”è¼ƒ depsã€‚</span>
<span class="token comment">// å› ç‚ºæ‰€æœ‰ deps éƒ½æ˜¯ç›¸åŒçš„ï¼Œå®ƒä¸éœ€è¦åŸ·è¡Œæ–°çš„ effectã€‚</span></code></pre></div>
<p>å¦‚æœæœ‰ä»»ä½•ä¸€å€‹é€™æ¨£çš„å€¼åœ¨ä¾å±¬é™£åˆ—è£¡åœ¨æ¸²æŸ“ä¹‹é–“æœ‰æ‰€ä¸åŒï¼Œæˆ‘å€‘çŸ¥é“æˆ‘å€‘ä¸èƒ½è·³éåŸ·è¡Œ effectã€‚è¦åŒæ­¥æ‰€æœ‰çš„æ±è¥¿ï¼</p>
<h2 id="ä¸è¦å°-react-èªªé—œæ–¼ä¾å±¬çš„è¬Š"><a href="#%E4%B8%8D%E8%A6%81%E5%B0%8D-react-%E8%AA%AA%E9%97%9C%E6%96%BC%E4%BE%9D%E5%B1%AC%E7%9A%84%E8%AC%8A" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä¸è¦å° React èªªé—œæ–¼ä¾å±¬çš„è¬Š</h2>
<p>å° React èªªé—œæ–¼ä¾å±¬çš„è¬Šæœƒæœ‰ä¸å¥½çš„çµæœã€‚ç›´è¦ºä¸Šï¼Œé€™å¾ˆåˆç†ï¼Œä½†æˆ‘çœ‹éå¹¾ä¹æ¯å€‹æ“æœ‰ class å¿ƒç†æ¨¡å‹çš„äººåœ¨å˜—è©¦ä½¿ç”¨<code class="language-text">useEffect</code> æ™‚ï¼Œå˜—è©¦è‘—è¦æ¬ºé¨™è¦å‰‡ã€‚ï¼ˆæˆ‘ä¸€é–‹å§‹ä¹Ÿé€™æ¨£åšéï¼ï¼‰</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é€™æ¨£å¯ä»¥å—ï¼Ÿä¸¦ä¸æ˜¯æ°¸é éƒ½å¯ä»¥ -- è€Œä¸”æœ‰æ›´å¥½çš„æ–¹å¼ä¾†å¯«å®ƒã€‚</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>(<a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="nofollow noopener noreferrer">Hooks å¸¸è¦‹å•é¡Œ</a> è§£é‡‹äº†æ‡‰è©²æ€éº¼åšã€‚ æˆ‘å€‘æœƒå›åˆ°<a href="#moving-functions-inside-effects">ä¸‹é¢çš„</a>ä¾‹å­ã€‚)</em></p>
<p>ä½ æœƒèªªã€Œä½†æˆ‘åªæƒ³è¦åœ¨ mount çš„æ™‚å€™åŸ·è¡Œå®ƒï¼ã€ã€‚ç¾åœ¨ï¼Œè«‹è¨˜å¾—ï¼šå¦‚æœä½ ç‰¹åˆ¥åˆ—å‡ºäº† depsï¼Œ<strong><em>æ‰€æœ‰</em> åœ¨ä½ å…ƒä»¶è£¡è¢« effect ç”¨åˆ°çš„å€¼ <em>ä¸€å®š</em> è¦åœ¨é‚£è£¡ã€‚</strong>åŒ…å«äº† propsã€stateã€å‡½å¼ â€” ä»»ä½•åœ¨ä½ å…ƒä»¶è£¡çš„æ±è¥¿ã€‚</p>
<p>æœ‰æ™‚å€™ç•¶ä½ é€™æ¨£åšï¼Œå®ƒæœƒå°è‡´å•é¡Œã€‚ä¾‹å¦‚ï¼Œå¯èƒ½ä½ æœƒçœ‹è¦‹ç„¡çª®é‡æ–°ç²å–çš„è¿´åœˆï¼Œæˆ–ä¸€å€‹ socket å¤ªå¸¸è¢«é‡æ–°ç”¢ç”Ÿã€‚<strong>é€™å€‹å•é¡Œçš„è§£æ³•ä¸¦ <em>ä¸æ˜¯</em> æ‹¿æ‰ä¾å±¬ã€‚</strong>æˆ‘å€‘å¾ˆå¿«æœƒçœ‹è¦‹è§£æ³•ã€‚</p>
<p>ä½†åœ¨æˆ‘å€‘è·³åˆ°è§£æ³•ä¹‹å‰ï¼Œè®“æˆ‘å€‘å…ˆå†é‡æ¸…æˆ‘å€‘çš„å•é¡Œã€‚</p>
<h2 id="ç•¶æ¬ºé¨™ä¾å±¬çš„æ™‚å€™æœƒç™¼ç”Ÿä»€éº¼äº‹"><a href="#%E7%95%B6%E6%AC%BA%E9%A8%99%E4%BE%9D%E5%B1%AC%E7%9A%84%E6%99%82%E5%80%99%E6%9C%83%E7%99%BC%E7%94%9F%E4%BB%80%E9%BA%BC%E4%BA%8B" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç•¶æ¬ºé¨™ä¾å±¬çš„æ™‚å€™æœƒç™¼ç”Ÿä»€éº¼äº‹</h2>
<p>å¦‚æœ deps åŒ…å«äº†æ¯å€‹ effect æ‰€ç”¨åˆ°çš„å€¼ï¼ŒReact çŸ¥é“ä»€éº¼æ™‚å€™é‡æ–°åŸ·è¡Œå®ƒï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p><img src="/deps-compare-correct-fae247cd068eedbd4b62ba50592d2b3d.gif" alt="Effect ä»£æ›å…©å€‹æ±è¥¿çš„åœ–"></p>
<p><em>ï¼ˆä¾å±¬ä¸åŒäº†ï¼Œæ‰€ä»¥æˆ‘å€‘é‡æ–°åŸ·è¡Œ effectã€‚ï¼‰</em></p>
<p>ä½†ç•¶æˆ‘å€‘å°é€™å€‹ effect å®£å‘Šä½¿ç”¨ <code class="language-text">[]</code>ï¼Œæ–°çš„å‡½å¼ä¸æœƒåŸ·è¡Œï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éŒ¯èª¤ï¼šname ä¸åœ¨ deps è£¡</span></span></code></pre></div>
<p><img src="/deps-compare-wrong-25f75db3f9f57ffe1426912093577445.gif" alt="Effect ä»£æ›å…©å€‹æ±è¥¿çš„åœ–"></p>
<p><em>ï¼ˆä¾å±¬ç›¸åŒï¼Œæ‰€ä»¥æˆ‘å€‘è·³é effectã€‚ï¼‰</em></p>
<p>åœ¨é€™å€‹ä¾‹å­ä¸‹å•é¡Œå¯èƒ½ä¸å¤ªæ˜é¡¯ã€‚ä½†ç•¶ class è§£æ³•ã€Œè·³å‡ºã€ä½ çš„è¨˜æ†¶æ™‚ï¼Œç›´è¦ºæœƒåœ¨åˆ¥çš„æƒ…æ³ä¸‹æ¬ºé¨™ä½ ã€‚</p>
<p>èˆ‰ä¾‹ä¾†èªªï¼Œå‡è¨­æˆ‘å€‘å¯«äº†ä¸€å€‹æ¯ç§’å¢åŠ çš„è¨ˆæ•¸å™¨ã€‚ç”¨ classï¼Œæˆ‘å€‘çš„ç›´è¦ºæ˜¯ï¼šã€Œè¨­å®šä¸€æ¬¡å€é–“ï¼Œç„¶å¾Œæ‘§æ¯€ä¸€æ¬¡ã€ã€‚é€™è£¡æ˜¯æˆ‘å€‘å¯ä»¥æ€éº¼åšçš„ä¸€å€‹<a href="https://codesandbox.io/s/n5mjzjy9kl" target="_blank" rel="nofollow noopener noreferrer">ä¾‹å­</a>ã€‚ç•¶æˆ‘å€‘å¿ƒç†ä¸Šæƒ³è¦æŠŠé€™æ®µç¨‹å¼ç¢¼ç¿»è­¯åˆ° <code class="language-text">useEffect</code> æ™‚ï¼Œæˆ‘å€‘æœƒç›´è¦ºçš„æŠŠ <code class="language-text">[]</code> åŠ åˆ° depsã€‚ã€Œæˆ‘æƒ³è¦åŸ·è¡Œå®ƒä¸€æ¬¡ã€ï¼Œå°å§ï¼Ÿ</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¶è€Œï¼Œé€™å€‹ä¾‹å­<a href="https://codesandbox.io/s/91n5z8jo7r" target="_blank" rel="nofollow noopener noreferrer">åª<em>å¢åŠ </em>äº†ä¸€æ¬¡</a>ã€‚<em>Oops</em></p>
<p>å¦‚æœä½ çš„å¿ƒç†æ¨¡å‹æ˜¯ã€Œä¾å±¬å¯ä»¥è®“æˆ‘è¨­å®šæˆ‘æƒ³è¦é‡æ–°è§¸ç™¼ effect çš„æ™‚å€™ã€ï¼Œé€™å€‹ä¾‹å­å¯èƒ½æœƒçµ¦ä½ ç½é›£ã€‚å› ç‚ºå®ƒæ˜¯ä¸€å€‹å€é–“ï¼Œæ‰€ä»¥ä½ <em>æƒ³è¦</em>è§¸ç™¼å®ƒä¸€æ¬¡ â€” æ‰€ä»¥ç‚ºä»€éº¼é€™å€‹æœƒå°è‡´å•é¡Œï¼Ÿ</p>
<p>ç„¶è€Œï¼Œå¦‚æœä½ çŸ¥é“ä¾å±¬æ˜¯æˆ‘å€‘çµ¦ React æ‰€æä¾›é—œæ–¼<em>æ‰€æœ‰</em>é‚£å€‹ effect åœ¨æ¸²æŸ“ç¯„åœæ‰€ä½¿ç”¨çš„æç¤ºçš„è©±ï¼Œé€™æ¨£å¾ˆåˆç†ã€‚å®ƒç”¨äº†<code class="language-text">count</code>ï¼Œä½†æˆ‘å€‘åˆ©ç”¨ <code class="language-text">[]</code> æ¬ºé¨™å®ƒæ²’æœ‰ç”¨ã€‚åœ¨å®ƒåå’¬æˆ‘å€‘ä¸€å£å‰åªæ˜¯æ™‚é–“å•é¡Œï¼</p>
<p>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œ<code class="language-text">count</code> æ˜¯ <code class="language-text">0</code>ã€‚å› æ­¤ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„ effect è£¡çš„ <code class="language-text">setCount(count + 1)</code> ä»£è¡¨ <code class="language-text">setCount(0 + 1)</code>ã€‚<strong>å› ç‚º <code class="language-text">[]</code> deps æ‰€ä»¥æˆ‘å€‘æ²’æœ‰é‡æ–°åŸ·è¡Œ effectï¼Œå®ƒæœƒä¿æŒæ¯ç§’éƒ½å‘¼å« <code class="language-text">setCount(0 + 1)</code>ï¼š</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œstate æ˜¯ 0</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„ Effect</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ°¸é  setCount(1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// æ°¸é ä¸æœƒé‡æ–°åŸ·è¡Œ</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ¯å€‹ä¸‹ä¸€æ¬¡çš„æ¸²æŸ“ï¼Œstate æ˜¯ 1</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// é€™å€‹ effect æœƒæ°¸é è¢«å¿½ç•¥ï¼Œå› ç‚º</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// æˆ‘å€‘å° React èªªäº†ç©º deps çš„è¬Šã€‚</span></span>    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æˆ‘å€‘æ¬ºé¨™äº† React å‘Šè¨´å®ƒæˆ‘å€‘çš„ effect ä¸ä¾è³´ä»»ä½•å…ƒä»¶è£¡çš„å€¼ï¼Œä½†å¯¦éš›ä¸Šå®ƒæœ‰ï¼</p>
<p>æˆ‘å€‘çš„ effect ä½¿ç”¨äº† <code class="language-text">count</code> â€” ä¸€å€‹åœ¨å…ƒä»¶è£¡çš„å€¼ï¼ˆä½†åœ¨ effect ä¹‹å¤–ï¼‰ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token comment">// ...</span></span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>å› æ­¤ï¼Œå®£å‘Š <code class="language-text">[]</code> ç•¶ä½œä¾å±¬æœƒå°è‡´éŒ¯èª¤ã€‚React æœƒæ¯”è¼ƒä¾å±¬ï¼Œç„¶å¾Œè·³éæ›´æ–°é€™å€‹ effectï¼š</p>
<p><img src="/interval-wrong-29e53bd0c9b7d2ac70d3cd924886b030.gif" alt="é™³èˆŠçš„å€é–“ closure çš„åœ–"></p>
<p><em>ï¼ˆä¾å±¬ç›¸åŒï¼Œæ‰€ä»¥æˆ‘å€‘è·³é effectã€‚ï¼‰</em></p>
<p>é€™æ¨£çš„å•é¡Œæ˜¯å¾ˆé›£æƒ³åƒçš„ã€‚å› æ­¤ï¼Œæˆ‘é¼“å‹µä½ æŠŠå®ƒç•¶ä½œä¸€å€‹å¿…é ˆéµå®ˆçš„è¦å‰‡ä¾†æ°¸é èª å¯¦é¢å° effect çš„ä¾å±¬ï¼Œç„¶å¾Œå®£å‘Šå…¨éƒ¨ã€‚ï¼ˆå¦‚æœä½ æƒ³è¦åœ¨ä½ çš„çµ„è£¡å¼·åˆ¶é€™ä»¶äº‹ï¼Œæˆ‘å€‘æä¾›äº†ä¸€å€‹<a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="nofollow noopener noreferrer">lint rule</a>ã€‚ï¼‰</p>
<h2 id="å…©ç¨®å°ä¾å±¬èª å¯¦çš„æ–¹æ³•"><a href="#%E5%85%A9%E7%A8%AE%E5%B0%8D%E4%BE%9D%E5%B1%AC%E8%AA%A0%E5%AF%A6%E7%9A%84%E6%96%B9%E6%B3%95" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å…©ç¨®å°ä¾å±¬èª å¯¦çš„æ–¹æ³•</h2>
<p>æœ‰å…©å€‹èª å¯¦å°å¾…ä¾å±¬çš„ç­–ç•¥ã€‚ä½ æ‡‰è©²å¾ç¬¬ä¸€å€‹é–‹å§‹ï¼Œç„¶å¾Œå¿…è¦æ™‚å†åŸ·è¡Œç¬¬äºŒå€‹ã€‚</p>
<p><strong>ç¬¬ä¸€å€‹ç­–ç•¥æ˜¯ä¿®æ­£ä¾å±¬é™£åˆ—ä¾†åŒ…å« <em>æ‰€æœ‰</em> åœ¨å…ƒä»¶è£¡è¢« effect æ‰€ç”¨åˆ°çš„å€¼ã€‚</strong>è®“æˆ‘å€‘æŠŠ <code class="language-text">count</code> ç•¶ä½œ depï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>é€™ä½¿å¾—ä¾å±¬çš„é™£åˆ—æ­£ç¢ºã€‚å®ƒå¯èƒ½ä¸æ˜¯<em>ç†æƒ³çš„</em>ï¼Œä½†å®ƒæ˜¯ç¬¬ä¸€å€‹æˆ‘å€‘éœ€è¦ä¿®æ­£çš„å•é¡Œã€‚ç¾åœ¨ <code class="language-text">count</code> çš„æ”¹è®Šæœƒé‡æ–°åŸ·è¡Œ effectï¼Œæ¯å€‹ä¸‹æ¬¡çš„å€é–“åƒè€ƒäº† <code class="language-text">count</code> æ¸²æŸ“çš„ <code class="language-text">setCount(count + 1)</code>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œstate æ˜¯ 0</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„ Effect</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// setCount(count + 1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// [count]</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç¬¬äºŒæ¬¡æ¸²æŸ“ï¼Œstate æ˜¯ 1</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token comment">// ç¬¬äºŒæ¬¡æ¸²æŸ“çš„ Effect</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">        <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// setCount(count + 1)</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// [count]</span></span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>é€™æœƒ<a href="https://codesandbox.io/s/0x0mnlyq8l" target="_blank" rel="nofollow noopener noreferrer">ä¿®æ­£å•é¡Œ</a>ï¼Œä½†æ¯ç•¶ <code class="language-text">count</code> æ”¹è®Šæ™‚ï¼Œæˆ‘å€‘çš„å€é–“æœƒè¢«æ¸…æ‰å†é‡è¨­ã€‚é€™å¯èƒ½ä¸æ˜¯æˆ‘å€‘æƒ³è¦çš„ï¼š</p>
<p><img src="/interval-rightish-5734271ddfa94d2d65ac6160515e0069.gif" alt="å€é–“é‡æ–°è¨‚é–±çš„åœ–"></p>
<p><em>ï¼ˆä¾å±¬ä¸åŒäº†ï¼Œæ‰€ä»¥æˆ‘å€‘é‡æ–°åŸ·è¡Œ effectã€‚ï¼‰</em></p>
<hr>
<p><strong>ç¬¬äºŒå€‹ç­–ç•¥æ˜¯æ”¹è®Šæˆ‘å€‘çš„ effect ç¨‹å¼ç¢¼ï¼Œè®“å®ƒä¸æœƒ<em>éœ€è¦</em>ä¸€å€‹è¶…éæˆ‘å€‘é æƒ³çš„ç¶“å¸¸æ”¹è®Šçš„å€¼ã€‚</strong>æˆ‘å€‘ä¸æƒ³è¦å°ä¾å±¬èªªè¬Š â€” æˆ‘å€‘åªæƒ³è¦æ”¹è®Šæˆ‘å€‘çš„ effect ä½¿å®ƒæ“æœ‰<em>å°‘ä¸€é»</em>ä¾å±¬ã€‚</p>
<p>è®“æˆ‘å€‘ä¾†çœ‹çœ‹å¹¾å€‹å¸¸è¦‹çš„ç§»é™¤ä¾å±¬çš„æŠ€å·§ã€‚</p>
<hr>
<h2 id="è®“-effect-è‡ªçµ¦è‡ªè¶³"><a href="#%E8%AE%93-effect-%E8%87%AA%E7%B5%A6%E8%87%AA%E8%B6%B3" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>è®“ Effect è‡ªçµ¦è‡ªè¶³</h2>
<p>æˆ‘å€‘æƒ³è¦æŠŠ <code class="language-text">count</code> ä¾å±¬ç§»å‡ºæˆ‘å€‘çš„ effectã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>ç‚ºäº†åšåˆ°é€™æ¨£ï¼Œæˆ‘å€‘éœ€è¦å•å•æˆ‘å€‘è‡ªå·±ï¼š<strong>æˆ‘å€‘ç‚ºäº†ä»€éº¼ä½¿ç”¨ <code class="language-text">count</code> å‘¢ï¼Ÿ</strong>çœ‹èµ·ä¾†æˆ‘å€‘åªç‚ºäº†å‘¼å« <code class="language-text">setCount</code> è€Œç”¨å®ƒã€‚åœ¨é€™æ¨£çš„æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘ä¸¦ä¸çœŸçš„éœ€è¦ <code class="language-text">count</code>ã€‚ç•¶æˆ‘å€‘æƒ³è¦æ ¹æ“šå‰ä¸€æ¬¡çš„ state ä¾†æ›´æ–°ç¾åœ¨çš„ stateï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ <code class="language-text">setState</code> çš„ <a href="https://reactjs.org/docs/hooks-reference.html#functional-updates" target="_blank" rel="nofollow noopener noreferrer">å‡½å¼æ›´æ–°è¡¨å–®(functional updater form)</a>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>æˆ‘å–œæ­¡æŠŠé€™äº›æƒ…æ³æƒ³æˆæ˜¯ã€ŒéŒ¯èª¤çš„ä¾å±¬ã€ã€‚æ˜¯çš„ï¼Œ<code class="language-text">count</code> æ˜¯å¿…é ˆçš„ä¾å±¬ï¼Œå› ç‚ºæˆ‘å€‘åœ¨ effect è£¡å¯«äº† <code class="language-text">setCount(count + 1)</code>ã€‚ä½†æ˜¯ï¼Œæˆ‘å€‘åªçœŸçš„éœ€è¦ <code class="language-text">count</code> ä¾†æŠŠå®ƒè½‰æ›ç‚º <code class="language-text">count + 1</code>ï¼Œç„¶å¾Œã€ŒæŠŠå®ƒé€å›å»ã€çµ¦ Reactã€‚ä½† React <em>å·²ç¶“çŸ¥é“</em>ç›®å‰çš„ <code class="language-text">count</code> äº†ã€‚<strong>æˆ‘å€‘åªéœ€è¦å‘Šè¨´ React å¢åŠ é€™å€‹ state â€” ç„¡è«–å®ƒç¾åœ¨æ˜¯ä»€éº¼ã€‚</strong></p>
<p>é€™å°±æ˜¯ <code class="language-text">setCount(c =&gt; c + 1)</code> æ‰€åœ¨åšçš„äº‹æƒ…ã€‚ä½ å¯ä»¥æƒ³åƒå®ƒæ˜¯çµ¦ Reactã€Œé€å‡ºä¸€å€‹æ•™å­¸ã€ï¼Œé€™å€‹æ•™å­¸æ˜¯é—œæ–¼ç‹€æ…‹è©²å¦‚ä½•æ”¹è®Šã€‚é€™å€‹ã€Œæ›´æ–°è¡¨å–®ã€ä¹Ÿå°å…¶ä»–æƒ…æ³æœ‰å¹«åŠ©ï¼Œåƒæ˜¯ç•¶ä½  <a href="/react-as-a-ui-runtime/#batching">æ‰¹æ¬¡æ›´æ–°å¤šæ¨£æ±è¥¿</a>çš„æ™‚å€™ã€‚</p>
<p><strong>æ³¨æ„æˆ‘å€‘å¯¦éš›ä¸Š <em>åšäº†å·¥</em> ä¾†ç§»é™¤ä¾å±¬ã€‚æˆ‘å€‘ä¸¦ä¸æ˜¯åœ¨æ¬ºé¨™ã€‚æˆ‘å€‘çš„ effect å†ä¹Ÿä¸æœƒå¾æ¸²æŸ“çš„ç¯„åœè®€å– <code class="language-text">counter</code> çš„å€¼ï¼š</strong></p>
<p><img src="/interval-right-f128ad20c28317ed27a3cb68197fc906.gif" alt="å¯è¡Œçš„å€é–“çš„åœ–"></p>
<p><em>(ä¾å±¬ç›¸åŒï¼Œæˆ‘å€‘è·³é effectã€‚)</em></p>
<p>ä½ å¯ä»¥åœ¨<a href="https://codesandbox.io/s/q3181xz1pj" target="_blank" rel="nofollow noopener noreferrer">é€™è£¡</a>è©¦è©¦çœ‹ã€‚</p>
<p>å³ä½¿é€™å€‹ effect åªåŸ·è¡Œäº†ä¸€æ¬¡ï¼Œå±¬æ–¼ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„å€é–“çš„ callback æ˜¯æœ‰èƒ½åŠ›æ¯æ¬¡åœ¨å€é–“è§¸ç™¼çš„æ™‚å€™é€å‡º <code class="language-text">c =&gt; c + 1</code> é€™å€‹æ›´æ–°çš„æ•™å­¸ã€‚å®ƒå†ä¹Ÿä¸éœ€è¦çŸ¥é“ç¾åœ¨çš„ <code class="language-text">counter</code> ç‹€æ…‹ã€‚React å·²ç¶“çŸ¥é“å®ƒäº†ã€‚</p>
<h2 id="å‡½å¼æ›´æ–°å’Œ-google-æ–‡ä»¶"><a href="#%E5%87%BD%E5%BC%8F%E6%9B%B4%E6%96%B0%E5%92%8C-google-%E6%96%87%E4%BB%B6" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å‡½å¼æ›´æ–°å’Œ Google æ–‡ä»¶</h2>
<p>è¨˜å¾—æˆ‘å€‘è¨è«–åˆ°åŒæ­¥åŒ–æ˜¯ç‚ºäº† effect çš„å¿ƒç†æ¨¡å‹å—ï¼ŸåŒæ­¥åŒ–çš„æœ‰è¶£ä¹‹è™•æ˜¯ä½ å¸¸å¸¸æœƒæƒ³è¦ä¿æŒç³»çµ±ä¹‹é–“çš„ã€Œè¨Šæ¯ã€èˆ‡å®ƒå€‘çš„ç‹€æ…‹åˆ†é›¢ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œç·¨è¼¯ä¸€å€‹ Google æ–‡ä»¶ä¸¦ä¸æœƒçœŸçš„é€å‡º<em>å®Œæ•´</em>çš„é é¢åˆ°ä¼ºæœå™¨ã€‚é‚£æœƒéå¸¸æ²’æœ‰æ•ˆç‡ã€‚ç›¸åçš„ï¼Œå®ƒé€å‡ºä¸€å€‹ä½¿ç”¨è€…æƒ³è¦åšçš„äº‹æƒ…çš„è¡¨ç¤ºã€‚</p>
<p>ç•¶æˆ‘å€‘çš„ä½¿ç”¨æƒ…å¢ƒä¸åŒæ™‚ï¼Œç›¸ä¼¼çš„å“²å­¸ä»é©ç”¨æ–¼ effectã€‚<strong>å®ƒå¹«åŠ©äº†æˆ‘å€‘å¾ effect è£¡åªé€å‡ºæœ€å°éœ€è¦çš„è³‡è¨Šåˆ°å…ƒä»¶è£¡ã€‚</strong>æ›´æ–°çš„è¡¨å–®åƒæ˜¯ <code class="language-text">setCount(c =&gt; c + 1)</code> å‚³é”äº†æ¯”èµ· <code class="language-text">setCount(count + 1)</code> é‚„å°‘çš„è³‡è¨Šï¼Œå› ç‚ºå®ƒä¸¦æ²’æœ‰è¢«ç¾åœ¨çš„è¨ˆæ•¸çµ¦æ±¡æŸ“ã€‚å®ƒåªè¡¨é”äº†å‹•ä½œï¼ˆã€Œå¢åŠ ã€ï¼‰ã€‚æƒ³åƒ React åŒ…å«äº†<a href="https://reactjs.org/docs/thinking-in-react.html#step-3-identify-the-minimal-but-complete-representation-of-ui-state" target="_blank" rel="nofollow noopener noreferrer">æ‰¾åˆ°æœ€å°‘çš„ state</a>ã€‚é€™æ˜¯ç›¸åŒçš„åŸå‰‡ï¼Œä½†æ˜¯ç‚ºäº†æ›´æ–°ã€‚</p>
<p>å°‡<em>æ„åœ–</em>ç·¨ç¢¼ï¼ˆè€Œä¸æ˜¯çµæœï¼‰èˆ‡ Google æ–‡ä»¶å¦‚ä½•<a href="https://medium.com/@srijancse/how-real-time-collaborative-editing-work-operational-transformation-ac4902d75682" target="_blank" rel="nofollow noopener noreferrer">è§£æ±º</a>å”ä½œç·¨è¼¯æ˜¯ç›¸ä¼¼çš„ã€‚é›–ç„¶é€™æ˜¯å»¶ä¼¸çš„é¡æ¯”ï¼Œå‡½å¼æ›´æ–°åœ¨ React è£¡ä»£è¡¨äº†ç›¸ä¼¼çš„è§’è‰²ã€‚å®ƒå€‘ä¿è­‰äº†å¾å¤šå€‹ä¾†æºï¼ˆevent handlersã€events subscription ç­‰ï¼‰ä¾†çš„æ›´æ–°å¯ä»¥è¢«æ­£ç¢ºä¸”ä»¥å¯é æœŸçš„æ–¹å¼ä¾†æ‰¹æ¬¡æ‡‰ç”¨ã€‚</p>
<p><strong>ç„¶è€Œï¼Œå³ä½¿æ˜¯ <code class="language-text">setCount(c =&gt; c + 1)</code> ä¹Ÿä¸æ˜¯é‚£éº¼æ£’ã€‚</strong>å®ƒçœ‹èµ·ä¾†æœ‰é»å¥‡æ€ªï¼Œè€Œä¸”é™åˆ¶äº†å¾ˆå¤šæˆ‘å€‘èƒ½åšçš„æ±è¥¿ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘å€‘æœ‰å…©å€‹ç‹€æ…‹çš„è®Šæ•¸ï¼Œå®ƒå€‘çš„å€¼ä¾è³´æ–¼å½¼æ­¤ï¼Œæˆ–æ˜¯å¦‚æœæˆ‘å€‘æƒ³è¦æ ¹æ“š props ä¾†è¨ˆç®—ä¸‹ä¸€å€‹ stateï¼Œå®ƒä¸¦ä¸èƒ½å¹«åŠ©åˆ°æˆ‘å€‘ã€‚å¹¸é‹çš„ï¼Œ<code class="language-text">setCount(c =&gt; c + 1)</code> æœ‰æ›´å¼·å¤§çš„å§å¦¹æ¨¡å¼ã€‚å®ƒçš„åå­—å«åš <code class="language-text">useReducer</code>ã€‚</p>
<h2 id="å¾å‹•ä½œåˆ†é›¢æ›´æ–°"><a href="#%E5%BE%9E%E5%8B%95%E4%BD%9C%E5%88%86%E9%9B%A2%E6%9B%B4%E6%96%B0" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å¾å‹•ä½œåˆ†é›¢æ›´æ–°</h2>
<p>è®“æˆ‘å€‘ä¿®æ”¹ä¸€ä¸‹å‰é¢çš„ä¾‹å­ï¼Œä½¿å¾—æˆ‘å€‘æœ‰å…©å€‹ state è®Šæ•¸ï¼š<code class="language-text">count</code> å’Œ <code class="language-text">step</code>ã€‚æˆ‘å€‘çš„å€é–“æœƒæ ¹æ“š <code class="language-text">step</code> è¼¸å…¥çš„å€¼ä¾†å¢åŠ è¨ˆæ•¸ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>step<span class="token punctuation">,</span> setStep<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token function">setCount</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c <span class="token operator">+</span> step<span class="token punctuation">)</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>step<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>step<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>e <span class="token operator">=></span> <span class="token function">setStep</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(é€™è£¡æ˜¯<a href="https://codesandbox.io/s/zxn70rnkx" target="_blank" rel="nofollow noopener noreferrer">ç¤ºç¯„</a>.)</p>
<p>æ³¨æ„<strong>æˆ‘å€‘ä¸¦ä¸æ˜¯åœ¨æ¬ºé¨™ã€‚</strong>å› ç‚ºæˆ‘åœ¨ effect è£¡é–‹å§‹ä½¿ç”¨ <code class="language-text">step</code>ï¼Œæˆ‘æŠŠå®ƒåŠ é€²ä¾å±¬è£¡ã€‚é€™å°±æ˜¯ç‚ºä»€éº¼æˆ‘å€‘çš„ç¨‹å¼ç¢¼èƒ½å¤ æ­£ç¢ºåŸ·è¡Œã€‚</p>
<p>é€™å€‹ä¾‹å­è£¡ï¼Œç¾åœ¨çš„è¡Œç‚ºæ˜¯æ”¹è®Š <code class="language-text">step</code> æœƒé‡æ–°é–‹å§‹å€é–“ â€” å› ç‚ºå®ƒæ˜¯æˆ‘å€‘å…¶ä¸­ä¸€å€‹ä¾å±¬ã€‚åœ¨å¾ˆå¤šæƒ…æ³ä¸‹ï¼Œé€™å°±æ˜¯ä½ æ‰€æƒ³è¦çš„ï¼è§£é–‹ä¸€å€‹ effect ä¸¦é‡æ–°è¨­å®šå®ƒä¸¦æ²’æœ‰ä»»ä½•éŒ¯ï¼Œè€Œä¸”é™¤éæˆ‘å€‘æœ‰å¥½çš„ç†ç”±ï¼Œå¦å‰‡æˆ‘å€‘ä¸æ‡‰è©²é¿å…é€™æ¨£ã€‚</p>
<p>ç„¶è€Œï¼Œå‡è¨­æˆ‘å€‘ä¸æƒ³è¦å€é–“æ™‚é˜åœ¨ <code class="language-text">step</code> æ”¹è®Šæ™‚é‡è¨­ï¼Œæˆ‘å€‘æ‡‰è©²è¦æ€æ¨£åœ¨ effect è£¡ç§»é™¤æˆ‘å€‘çš„ <code class="language-text">step</code> ä¾å±¬å‘¢ï¼Ÿ</p>
<p><strong>ç•¶æˆ‘å€‘ä¾è³´å¦ä¸€å€‹ state è®Šæ•¸çš„ç¾æœ‰å€¼ä¾†æ›´æ–°ä¸€å€‹ state è®Šæ•¸æ™‚ï¼Œä½ å¯èƒ½æœƒæƒ³è¦å˜—è©¦ç”¨ <code class="language-text">useReducer</code> å–ä»£å…©è€…ã€‚</strong></p>
<p>ç•¶ä½ ç™¼ç¾ä½ é–‹å§‹å¯« <code class="language-text">setSomething(something =&gt; ...)</code>ï¼Œé€™å°±æ˜¯å€‹å¥½æ™‚æ©Ÿä¾†æ€è€ƒä½¿ç”¨ reducerã€‚Reducer è®“ä½ <strong>åˆ†é›¢è¡¨é”äº†ç™¼ç”Ÿåœ¨å…ƒä»¶è£¡çš„ã€Œå‹•ä½œ (action)ã€ï¼Œä»¥åŠ state å¦‚ä½•ä¾æ“šé€™äº›å‹•ä½œè€Œæœ‰çš„æ›´æ–°ã€‚</strong></p>
<p>è®“æˆ‘å€‘æŠŠ effect è£¡çš„ä¾å±¬å¾ <code class="language-text">step</code> æ”¹æˆ <code class="language-text">dispatch</code>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'tick'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è€Œä¸æ˜¯ setCount(c => c + step);</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>(çœ‹çœ‹<a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="nofollow noopener noreferrer">ç¤ºç¯„</a>ã€‚)</p>
<p>ä½ å¯èƒ½æœƒå•ï¼šã€Œé€™å€‹å“ªè£¡æ¯”è¼ƒå¥½ï¼Ÿã€ç­”æ¡ˆæ˜¯ <strong>React ä¿è­‰äº† <code class="language-text">dispatch</code> å‡½å¼åœ¨å…ƒä»¶çš„ç”Ÿå‘½é€±æœŸè£¡æ˜¯å¸¸æ•¸ã€‚æ‰€ä»¥ä¸Šé¢çš„ä¾‹å­ä¸éœ€è¦é‡æ–°è¨‚é–±å€é–“ã€‚</strong></p>
<p>æˆ‘å€‘è§£æ±ºäº†æˆ‘å€‘çš„å•é¡Œï¼</p>
<p><em>(ä½ å¯ä»¥å¾ deps è£¡çœç•¥ <code class="language-text">dispatch</code>ã€<code class="language-text">setState</code> å’Œ <code class="language-text">useRef</code> çš„å€¼ï¼Œå› ç‚º React ä¿è­‰å®ƒå€‘æœƒæ˜¯éœæ…‹çš„ã€‚ä½†åˆ—å‡ºå®ƒå€‘ä¹Ÿä¸æœƒæœ‰ä»€éº¼å£è™•ã€‚)</em></p>
<p>å–ä»£äº†åœ¨ effect <em>è£¡é¢</em>è®€å–ç‹€æ…‹ï¼Œå®ƒèª¿åº¦äº†å°æ–¼<em>ç™¼ç”Ÿäº†ä»€éº¼äº‹</em>çš„è³‡è¨Šçš„ç·¨ç¢¼çš„<em>å‹•ä½œ</em>ã€‚é€™ä½¿å¾—æˆ‘å€‘çš„ effect å¯ä»¥ä¿æŒèˆ‡ <code class="language-text">step</code> çš„ç‹€æ…‹åˆ†é›¢ã€‚æˆ‘å€‘çš„ effect ä¸¦ä¸åœ¨ä¹æˆ‘å€‘<em>å¦‚ä½•</em>æ›´æ–° stateï¼Œå®ƒåªå‘Šè¨´äº†æˆ‘å€‘<em>ç™¼ç”Ÿäº†ä»€éº¼äº‹</em>ã€‚ç„¶å¾Œ reducer å°‡æ›´æ–°çš„é‚è¼¯é›†ä¸­ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  step<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'tick'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> count <span class="token operator">+</span> step<span class="token punctuation">,</span> step <span class="token punctuation">}</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'step'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> step<span class="token punctuation">:</span> action<span class="token punctuation">.</span>step <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(å¦‚æœä½ ä¹‹å‰ä¸å°å¿ƒéŒ¯éï¼Œé€™è£¡æ˜¯ä¸€å€‹<a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="nofollow noopener noreferrer">ç¤ºç¯„</a>ã€‚)</p>
<h2 id="ç‚ºä»€éº¼-usereducer-æ˜¯-hooks-çš„æ¬ºé¨™æ¨¡å¼"><a href="#%E7%82%BA%E4%BB%80%E9%BA%BC-usereducer-%E6%98%AF-hooks-%E7%9A%84%E6%AC%BA%E9%A8%99%E6%A8%A1%E5%BC%8F" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ç‚ºä»€éº¼ useReducer æ˜¯ Hooks çš„æ¬ºé¨™æ¨¡å¼</h2>
<p>æˆ‘å€‘å·²ç¶“çœ‹è¦‹è©²å¦‚ä½•åœ¨ effect éœ€è¦æ ¹æ“šå‰ä¸€å€‹ state æˆ–å…¶ä»– state è®Šæ•¸ä¾†è¨­å®š state æ™‚ç§»é™¤ä¾å±¬ã€‚<strong>ä½†æ˜¯å¦‚æœæˆ‘å€‘éœ€è¦ <em>props</em> ä¾†è¨ˆç®—ä¸‹ä¸€å€‹ state çš„æ™‚å€™è©²æ€éº¼è¾¦å‘¢ï¼Ÿ</strong>ä¾‹å¦‚ï¼Œæˆ–è¨±æˆ‘å€‘çš„ API æ˜¯ <code class="language-text">&lt;Counter step={1} /&gt;</code>ã€‚ç•¶ç„¶ï¼Œåœ¨é€™å€‹ç‹€æ³ä¸‹æˆ‘å€‘ä¸èƒ½é¿å…å°‡ <code class="language-text">props.step</code> è¨­ç‚ºä¾å±¬ï¼Ÿ</p>
<p>äº‹å¯¦ä¸Šï¼Œæˆ‘å€‘å¯ä»¥ï¼æˆ‘å€‘å¯ä»¥æŠŠ <em>reducer æœ¬èº«</em>æ”¾é€²æˆ‘å€‘çš„å…ƒä»¶ä¾†è®€å– propsï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> step <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'tick'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> state <span class="token operator">+</span> step<span class="token punctuation">;</span></span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'tick'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>é€™å€‹æ¨¡å¼è®“ä¸€äº›å„ªåŒ–è®Šå¾—æ²’æœ‰ä½œç”¨ï¼Œæ‰€ä»¥è«‹è©¦è‘—ä¸è¦åœ¨æ¯å€‹åœ°æ–¹éƒ½ä½¿ç”¨å®ƒï¼Œä½†å¦‚æœä½ éœ€è¦çš„è©±ä½ å®Œå…¨å¯ä»¥å¾ reducer æ‹¿åˆ° propsã€‚ï¼ˆé€™è£¡æ˜¯ä¸€å€‹<a href="https://codesandbox.io/s/7ypm405o8q" target="_blank" rel="nofollow noopener noreferrer">ç¤ºç¯„</a>ã€‚ï¼‰</p>
<p><strong>å³ä½¿åœ¨é‚£å€‹ä¾‹å­è£¡ï¼Œ<code class="language-text">dispatch</code> ä»ç„¶ä¿è­‰æœƒåœ¨ä¸åŒé‡æ–°çš„æ¸²æŸ“ä¹‹é–“ä¿æŒç©©å®šã€‚</strong>æ‰€ä»¥å¦‚æœä½ æƒ³è¦çš„è©±ï¼Œä½ å¯ä»¥åœ¨ effect çš„ deps è£¡å¿½ç•¥å®ƒã€‚å®ƒä¸¦ä¸æœƒå°è‡´ effect é‡æ–°åŸ·è¡Œã€‚</p>
<p>ä½ å¯èƒ½æœƒæƒ³ï¼šé€™å€‹æ€éº¼å¯èƒ½æœƒå¯è¡Œï¼ŸReducer æ€éº¼åœ¨è¢«å¦ä¸€å€‹æ¸²æŸ“è£¡çš„ effect å‘¼å«çš„æ™‚å€™ã€ŒçŸ¥é“ã€props æ˜¯ä»€éº¼ï¼Ÿç­”æ¡ˆæ˜¯ç•¶ä½  <code class="language-text">dispatch</code> æ™‚ï¼ŒReact æœƒè¨˜ä½é€™å€‹å‹•ä½œ â€” ä½†å®ƒæœƒåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“<em>å‘¼å«</em>ä½ çš„ reducerã€‚åœ¨é‚£å€‹æ™‚é–“é»æ–°çš„ props æœƒåœ¨ç¯„åœè£¡ï¼Œä½ ä¸éœ€è¦åœ¨ effect ä¹‹å…§ã€‚</p>
<p><strong>é€™å°±æ˜¯ç‚ºä»€éº¼æˆ‘å–œæ­¡å°‡ <code class="language-text">useReducer</code> æƒ³æˆæ˜¯ Hooks çš„ã€Œæ¬ºé¨™æ¨¡å¼ã€ã€‚å®ƒè®“æˆ‘å¯ä»¥åˆ†é›¢æ›´æ–°çš„é‚è¼¯ä»¥åŠæè¿°ç™¼ç”Ÿäº†ä»€éº¼äº‹ã€‚é€™æ¨£ä¸€ä¾†ï¼Œå¹«åŠ©æˆ‘ç§»é™¤äº† effect è£¡ä¸å¿…è¦çš„ä¾å±¬ä»¥åŠé¿å…åœ¨éå¿…è¦çš„æ™‚å€™é‡æ–°åŸ·è¡Œå®ƒå€‘ã€‚</strong></p>
<h2 id="æŠŠå‡½å¼ç§»åˆ°-effect-è£¡"><a href="#%E6%8A%8A%E5%87%BD%E5%BC%8F%E7%A7%BB%E5%88%B0-effect-%E8%A3%A1" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æŠŠå‡½å¼ç§»åˆ° Effect è£¡</h2>
<p>ä¸€å€‹å¸¸è¦‹çš„éŒ¯èª¤æ˜¯èªç‚ºå‡½å¼ä¸æ‡‰è©²å‡ºç¾åœ¨ä¾å±¬è£¡ã€‚ä¾‹å¦‚ï¼Œé€™æ¨£çœ‹èµ·ä¾†æ˜¯å¯è¡Œçš„ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hits<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span>
      <span class="token string">'https://hn.algolia.com/api/v1/search?query=react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é€™æ¨£ ok å—ï¼Ÿ</span></span>
  <span class="token comment">// ...</span></code></pre></div>
<p><em>(<a href="https://codesandbox.io/s/8j4ykjyv0" target="_blank" rel="nofollow noopener noreferrer">é€™å€‹ä¾‹å­</a> æ˜¯ç”± Robin Wieruch çš„æ–‡ç« ä¿®æ”¹è€Œä¾†çš„ â€” <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">çœ‹çœ‹é€™å€‹</a>!)</em></p>
<p>å†æ›´æ¸…æ¥šä¸€é»ï¼Œé€™æ®µç¨‹å¼ç¢¼<em>çœŸçš„</em>æœƒæ­£ç¢ºåŸ·è¡Œã€‚<strong>ä½†æ˜¯å–®ç´”å¿½ç•¥æœ¬åœ°çš„å‡½å¼çš„å•é¡Œæ˜¯ï¼Œç•¶å…ƒä»¶è¦æ¨¡æˆé•·æ™‚ï¼Œæœƒè®Šå¾—å¾ˆé›£å€åˆ†æˆ‘å€‘æ˜¯å¦è™•ç†äº†æ‰€æœ‰çš„æƒ…æ³ï¼</strong></p>
<p>æƒ³åƒæˆ‘å€‘çš„ç¨‹å¼ç¢¼è¢«åˆ†æˆåƒä¸‹é¢çš„æ¨£å­ï¼Œç„¶å¾Œæ¯å€‹å‡½å¼éƒ½æ˜¯äº”å€å¤§ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æƒ³åƒé€™å€‹å‡½å¼å¾ˆé•·</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query=react'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// æƒ³åƒé€™å€‹å‡½å¼ä¹Ÿå¾ˆé•·</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç¾åœ¨å‡è¨­æˆ‘å€‘ä¹‹å¾Œåœ¨å…¶ä¸­ä¸€å€‹å‡½å¼è£¡ä½¿ç”¨äº†æŸäº› state æˆ– propï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æƒ³åƒé€™å€‹å‡½å¼ä¹Ÿå¾ˆé•·</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span>  <span class="token punctuation">}</span>

  <span class="token comment">// æƒ³åƒé€™å€‹å‡½å¼ä¹Ÿå¾ˆé•·</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘å€‘å¿˜è¨˜è¦æ›´æ–°ä»»ä½•ä¸€å€‹å‘¼å«äº†é€™äº›å‡½å¼çš„ effect çš„ depsï¼ˆè€Œä¸”å¯èƒ½é€éå…¶ä»–å‡½å¼ï¼ï¼‰ï¼Œæˆ‘å€‘çš„ effect æœƒåŒæ­¥å¤±æ•—æ”¹è®Š props å’Œ stateã€‚é€™è½èµ·ä¾†ä¸å¥½ã€‚</p>
<p>å¹¸é‹çš„ï¼Œé€™å€‹å•é¡Œæœ‰å€‹ç°¡å–®çš„è§£æ³•ã€‚<strong>å¦‚æœä½ åªåœ¨ä¸€å€‹ effect <em>è£¡</em>ä½¿ç”¨æŸäº›å‡½å¼ï¼ŒæŠŠå®ƒå€‘ç›´æ¥æ”¾é€²é‚£å€‹ effect <em>è£¡é¢</em>ï¼š</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token comment">// æˆ‘å€‘æŠŠé€™äº›å‡½å¼ç§»åˆ°è£¡é¢ï¼</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query=react'</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Deps æ˜¯ OK çš„</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(<a href="https://codesandbox.io/s/04kp3jwwql" target="_blank" rel="nofollow noopener noreferrer">é€™è£¡æ˜¯ä¸€å€‹ç¯„ä¾‹</a>ã€‚)</p>
<p>æ‰€ä»¥å¥½è™•æ˜¯ä»€éº¼å‘¢ï¼Ÿæˆ‘å€‘ä¸å†éœ€è¦å»æƒ³ã€Œå‚³ééçš„ä¾å±¬ã€ã€‚æˆ‘å€‘çš„ä¾å±¬é™£åˆ—ä¸æœƒå†èªªè¬Šäº†ï¼š<strong>æˆ‘å€‘çœŸçš„ <em>æ²’æœ‰</em> åœ¨ effect è£¡ä½¿ç”¨ä»»ä½•åœ¨å…ƒä»¶å¤–é¢ç¯„åœçš„æ±è¥¿ã€‚</strong></p>
<p>å¦‚æœæˆ‘å€‘ä¹‹å¾Œè¦ç·¨è¼¯ <code class="language-text">getFetchUrl</code> ä¾†ä½¿ç”¨ <code class="language-text">query</code> çš„ stateï¼Œæˆ‘å€‘æ›´å¯èƒ½æ³¨æ„åˆ°æˆ‘å€‘æ­£åœ¨ effect <em>è£¡é¢</em>ç·¨è¼¯å®ƒ â€” å› æ­¤ï¼Œæˆ‘å€‘éœ€è¦æŠŠ <code class="language-text">query</code> åŠ é€² effect çš„ä¾å±¬è£¡ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span>    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Deps æ˜¯ OK çš„</span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(é€™è£¡æ˜¯ä¸€å€‹<a href="https://codesandbox.io/s/pwm32zx7z7" target="_blank" rel="nofollow noopener noreferrer">ç¯„ä¾‹</a>ã€‚)</p>
<p>è—‰ç”±å¢åŠ é€™å€‹ä¾å±¬ï¼Œæˆ‘å€‘ä¸åªã€Œè¨å¥½äº† Reactã€ï¼Œåœ¨ query æ”¹è®Šæ™‚å»é‡æ–°ç²å–è³‡æ–™è®Šå¾—<em>åˆç†</em>äº†ã€‚<strong><code class="language-text">useEffect</code> çš„è¨­è¨ˆå¼·è¿«ä½ å»æ³¨æ„è³‡æ–™æµçš„è®ŠåŒ–ä»¥åŠé¸æ“‡è®“æˆ‘å€‘çš„ effect å¦‚ä½•å»åŒæ­¥å®ƒ â€” è€Œä¸æ˜¯å¿½ç•¥å®ƒç›´åˆ°æˆ‘å€‘çš„ä½¿ç”¨è€…é‡åˆ°äº†éŒ¯èª¤ã€‚</strong></p>
<p>å¹¸è™§ <code class="language-text">eslint-plugin-react-hooks</code> plugin æœ‰ <code class="language-text">exhaustive-deps</code> é€™å€‹ lint ruleï¼Œä½ å¯ä»¥<a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="nofollow noopener noreferrer">åˆ†æä½ åœ¨ç·¨è¼¯å™¨è£¡è¼¸å…¥çš„ effect</a>ä¸”ç²å¾—é—œæ–¼å“ªå€‹ä¾å±¬è¢«éºæ¼çš„å»ºè­°ã€‚æ›å¥è©±èªªï¼Œä¸€å€‹æ©Ÿå™¨å¯ä»¥å‘Šè¨´ä½ å“ªå€‹è³‡æ–™æµçš„æ”¹è®Šæ²’æœ‰æ­£ç¢ºè¢«å…ƒä»¶æ‰€è™•ç†ã€‚</p>
<p><img src="/exhaustive-deps-04a90dcbacb01105d634964880ebed19.gif" alt="Lint rule gif"></p>
<p>é‚„æ»¿è²¼å¿ƒçš„ã€‚</p>
<h2 id="ä½†æˆ‘ä¸æƒ³è¦æŠŠé€™å€‹å‡½å¼æ”¾é€²-effect-è£¡"><a href="#%E4%BD%86%E6%88%91%E4%B8%8D%E6%83%B3%E8%A6%81%E6%8A%8A%E9%80%99%E5%80%8B%E5%87%BD%E5%BC%8F%E6%94%BE%E9%80%B2-effect-%E8%A3%A1" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ä½†æˆ‘ä¸æƒ³è¦æŠŠé€™å€‹å‡½å¼æ”¾é€² Effect è£¡</h2>
<p>æœ‰æ™‚å€™ä½ å¯èƒ½ä¸æƒ³è¦æŠŠæŸå€‹å‡½å¼<em>æ”¾é€²</em>æŸå€‹ effect è£¡ã€‚ä¾‹å¦‚ï¼Œå¥½å¹¾å€‹åœ¨åŒå€‹å…ƒä»¶è£¡çš„ effect å¯èƒ½æœƒå‘¼å«ä¸€æ¨£çš„å‡½å¼ï¼Œä½ ä¸æƒ³è¦è¤‡è£½è²¼ä¸Šå®ƒçš„é‚è¼¯ã€‚æˆ–è‘—å®ƒå¯èƒ½æ˜¯ä¸€å€‹ propã€‚</p>
<p>ä½ æ‡‰è©²è·³éæŠŠé€™å€‹å‡½å¼æ”¾åˆ° effect çš„ä¾å±¬è£¡å—ï¼Ÿæˆ‘èªç‚ºä¸ã€‚å†ä¸€æ¬¡çš„ï¼Œ<strong>effect ä¸æ‡‰è©²å°å®ƒçš„ä¾å±¬èªªè¬Šã€‚</strong>é€šå¸¸æœƒæœ‰æ›´å¥½çš„è§£æ³•ã€‚ä¸€å€‹å¸¸è¦‹çš„èª¤è§£æ˜¯ã€Œå‡½å¼ä¸æœƒæ”¹è®Šã€ã€‚ä½†ç•¶æˆ‘å€‘é€éé€™ç¯‡æ–‡ç« å­¸ç¿’ä¹‹å¾Œï¼Œé€™å€‹å®Œå…¨ä¸æ˜¯äº‹å¯¦ã€‚äº‹å¯¦ä¸Šï¼Œä¸€å€‹åœ¨å…ƒä»¶è£¡å®šç¾©çš„å‡½å¼æœƒåœ¨æ¯æ¬¡æ¸²æŸ“æ”¹è®Šï¼</p>
<p><strong>å®ƒæœ¬èº«å‘ˆç¾äº†ä¸€å€‹å•é¡Œã€‚</strong>å‡è¨­å…©å€‹ effect å‘¼å«äº† <code class="language-text">getFetchUrl</code>ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... ç²å–è³‡æ–™å’Œåšä¸€äº›äº‹ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ éºæ¼çš„ dep: getFetchUrl</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... ç²å–è³‡æ–™å’Œåšä¸€äº›äº‹ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ éºæ¼çš„ dep: getFetchUrl</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åœ¨é€™å€‹æƒ…æ³ä¸‹ä½ å¯èƒ½ä¸æƒ³è¦æŠŠ <code class="language-text">getFetchUrl</code> ç§»é€²ä»»ä½•ä¸€å€‹ effectï¼Œå› ç‚ºä½ ä¸èƒ½å…±äº«é€™å€‹é‚è¼¯ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ ã€Œèª å¯¦ã€å°å¾… effect çš„ä¾å±¬ï¼Œä½ å¯èƒ½æœƒé‡åˆ°ä¸€å€‹å•é¡Œã€‚å› ç‚ºå…©å€‹ effect éƒ½ä¾è³´æ–¼ <code class="language-text">getFetchUrl</code> <strong>(å®ƒåœ¨æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ä¸åŒçš„)</strong>ï¼Œæˆ‘å€‘çš„ä¾å±¬é™£åˆ—æ˜¯æ¯«ç„¡ç”¨è™•çš„ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token comment">// ğŸ”´ åœ¨æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°è§¸ç™¼æ‰€æœ‰ effect</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... ç²å–è³‡æ–™å’Œåšä¸€äº›äº‹ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸš§ Deps æ˜¯æ­£ç¢ºçš„ä½†å®ƒå€‘å¤ªå¸¸æ”¹è®Šäº†</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... ç²å–è³‡æ–™å’Œåšä¸€äº›äº‹ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸš§ Deps æ˜¯æ­£ç¢ºçš„ä½†å®ƒå€‘å¤ªå¸¸æ”¹è®Šäº†</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä¸€å€‹è¿·äººçš„è§£æ³•æ˜¯ç›´æ¥å¿½ç•¥æŠŠ <code class="language-text">getFetchUrl</code> å‡½å¼æ”¾é€² deps çš„åˆ—è¡¨è£¡ã€‚ç„¶è€Œï¼Œæˆ‘ä¸èªç‚ºé€™æ˜¯å€‹å¥½çš„è§£æ³•ã€‚é€™ä½¿å¾—æˆ‘å€‘å¾ˆé›£å¯Ÿè¦ºåˆ°æˆ‘å€‘<em>æ­£åœ¨</em>ç‚ºè³‡æ–™æµæ–°å¢ä¸€å€‹æ”¹è®Šï¼Œè€Œé€™å€‹æ”¹è®Š<em>éœ€è¦</em>è¢« effect æ‰€è™•ç†ã€‚é€™å°è‡´äº†éŒ¯èª¤ï¼Œåƒæ˜¯æˆ‘å€‘ä¹‹å‰çœ‹åˆ°çš„ã€Œæ°¸é ä¸æœƒæ›´æ–°å€é–“ã€ã€‚</p>
<p>ç›¸åçš„ï¼Œæœ‰å…©å€‹æ›´ç°¡å–®çš„è§£æ³•ã€‚</p>
<p><strong>ç¬¬ä¸€å€‹ï¼Œå¦‚æœä¸€å€‹å‡½å¼ä¸ä½¿ç”¨ä»»ä½•åœ¨å…ƒä»¶ç¯„åœè£¡çš„æ±è¥¿ï¼Œä½ å¯ä»¥æŠŠå®ƒæŠ½åˆ°å…ƒä»¶å¤–å±¤ï¼Œç„¶å¾Œè‡ªç”±åœ°åœ¨ effect è£¡ä½¿ç”¨å®ƒï¼š</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token comment">// âœ… ä¸æœƒè¢«è³‡æ–™æµå½±éŸ¿</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">function</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span>
<span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... ç²å–è³‡æ–™å’Œåšä¸€äº›äº‹ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Deps are OK</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... ç²å–è³‡æ–™å’Œåšä¸€äº›äº‹ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Deps are OK</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æˆ‘å€‘ä¸¦ä¸éœ€è¦æŠŠå®ƒå®£å‘Šåœ¨ deps è£¡ï¼Œå› ç‚ºå®ƒåœ¨æ¸²æŸ“çš„ç¯„åœï¼Œè€Œä¸”å®ƒä¸æœƒè¢«è³‡æ–™æµæ‰€å½±éŸ¿ã€‚å®ƒä¸å¯èƒ½æ„å¤–çš„ä¾è³´æ–¼ props æˆ– stateã€‚</p>
<p>å¦å¤–ï¼Œä½ å¯ä»¥æŠŠå®ƒåŒ…åœ¨<a href="https://reactjs.org/docs/hooks-reference.html#usecallback" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">useCallback</code> Hook</a> è£¡é¢ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token comment">// âœ… ç•¶ä»–è‡ªå·±çš„ deps ä¸€æ¨£æ™‚ï¼Œä¿ç•™äº†ç‰¹æ€§</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âœ… Callback deps are OK</span></span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... ç²å–è³‡æ–™å’Œåšä¸€äº›äº‹ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Effect deps are OK</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token string">'redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... ç²å–è³‡æ–™å’Œåšä¸€äº›äº‹ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Effect deps are OK</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">useCallback</code> å°±åƒå¢åŠ å¦ä¸€å±¤ä¾å±¬çš„æª¢æŸ¥ã€‚å®ƒè§£æ±ºäº†å¦ä¸€ç«¯çš„å•é¡Œ â€” <strong>ä¸æ˜¯é¿å…ä¸€å€‹å‡½å¼çš„ä¾å±¬ï¼Œè€Œæ˜¯æˆ‘å€‘è®“å‡½å¼æœ¬èº«åªåœ¨éœ€è¦æ™‚æ”¹è®Šã€‚</strong></p>
<p>è®“æˆ‘å€‘çœ‹çœ‹ç‚ºä»€éº¼é€™å€‹é€”å¾‘æ˜¯æœ‰ç”¨çš„ã€‚ä¹‹å‰ï¼Œæˆ‘å€‘çš„ä¾‹å­é¡¯ç¤ºå…©å€‹æœå°‹çš„çµæœï¼ˆ <code class="language-text">&#39;react&#39;</code> å’Œ <code class="language-text">&#39;redux&#39;</code> çš„æœå°‹ queriesï¼‰ã€‚æ‰€ä»¥ <code class="language-text">getFetchUrl</code> æœƒå¾æœ¬åœ°çš„ state è®€å–å®ƒè€Œä¸æ˜¯æŠŠ <code class="language-text">query</code> ç•¶ä½œä¸€å€‹åƒæ•¸ã€‚</p>
<p>æˆ‘å€‘å°‡æœƒå¾ˆå¿«çœ‹åˆ°å®ƒæ²’æœ‰ <code class="language-text">query</code> é€™å€‹ä¾å±¬ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// æ²’æœ‰ query åƒæ•¸</span>
    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ éºæ¼çš„ dep: query</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘å°‡æˆ‘çš„ <code class="language-text">useCallback</code> çš„ deps ä¿®æ­£ç‚ºåŒ…å«äº† <code class="language-text">query</code>ï¼Œä»»ä½•ä¸€å€‹æ“æœ‰ <code class="language-text">getFetchUrl</code> deps çš„ effect æœƒåœ¨ <code class="language-text">query</code> æ”¹è®Šæ™‚é‡æ–°åŸ·è¡Œï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token comment">// âœ… ä¿ç•™ç‰¹æ€§ç›´åˆ° query æ”¹è®Š</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> getFetchUrl <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âœ… Callback deps are OK</span></span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getFetchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... ç²å–è³‡æ–™å’Œåšä¸€äº›äº‹ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getFetchUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Effect deps are OK</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç”±æ–¼æœ‰äº† <code class="language-text">useCallback</code>ï¼Œå¦‚æœ <code class="language-text">query</code> ä¸€æ¨£çš„è©±ï¼Œ<code class="language-text">getFetchUrl</code> ä¹Ÿæœƒä¿æŒä¸€æ¨£ï¼Œè€Œä¸”æˆ‘å€‘çš„ effect ä¸æœƒé‡æ–°åŸ·è¡Œã€‚ä½†å¦‚æœ <code class="language-text">query</code> æ”¹è®Šäº†ï¼Œ<code class="language-text">getFetchUrl</code> ä¹Ÿæœƒæ”¹è®Šï¼Œç„¶å¾Œæˆ‘å€‘æœƒé‡æ–°ç²å–è³‡æ–™ã€‚é€™å°±åƒæ˜¯ç•¶ä½ æ”¹è®ŠæŸäº› Excel è¡¨å–®çš„æ¬„ä½ï¼Œå…¶ä»–ç”¨åˆ°å®ƒçš„çš„æ¬„ä½ä¹Ÿæœƒè‡ªå‹•é‡æ–°è¨ˆç®—ã€‚</p>
<p>é€™åªæ˜¯æ“æŠ±è³‡æ–™æµå’ŒåŒæ­¥åŒ–å¿ƒæ…‹çš„çµæœã€‚<strong>ä¸€æ¨£çš„è§£æ³•ä¹Ÿé©ç”¨æ–¼ç”±ä¸Šä¸€å±¤å‚³é€²ä¾†çš„å‡½å¼ propsï¼š</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token comment">// âœ… ä¿ç•™ç‰¹æ€§ç›´åˆ° query æ”¹è®Š</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> fetchData <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// ... ç²å–è³‡æ–™å’Œå›å‚³å®ƒ ...</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âœ… Callback deps are OK</span></span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>fetchData<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fetchData <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>setData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>fetchData<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Effect deps are OK</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å› ç‚º <code class="language-text">fetchData</code> åªåœ¨å®ƒçš„ <code class="language-text">query</code> state æ”¹è®Šæ™‚åœ¨ <code class="language-text">Parent</code> è£¡é¢æ”¹è®Šï¼Œæˆ‘å€‘çš„ <code class="language-text">Child</code> ç›´åˆ°åœ¨æ‡‰ç”¨ç¨‹å¼è£¡çœŸçš„éœ€è¦æ™‚æ‰æœƒé‡æ–°ç²å–è³‡æ–™ã€‚</p>
<h2 id="å‡½å¼æ˜¯è³‡æ–™æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ"><a href="#%E5%87%BD%E5%BC%8F%E6%98%AF%E8%B3%87%E6%96%99%E6%B5%81%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%E5%97%8E%EF%BC%9F" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å‡½å¼æ˜¯è³‡æ–™æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ</h2>
<p>æœ‰è¶£çš„ï¼Œé€™å€‹æ¨¡å¼åœ¨ class çš„æƒ…å½¢ä¸‹æ˜¯å£æ‰çš„ï¼Œå®ƒé¡¯ç¤ºäº† effect å’Œç”Ÿå‘½é€±æœŸç¯„ä¾‹çš„ä¸åŒã€‚è©¦è‘—æ€è€ƒé€™å€‹ç¿»è­¯ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    query<span class="token punctuation">:</span> <span class="token string">'react'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// ... ç²å–è³‡æ–™å’Œåšä¸€äº›äº‹ ...</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä½ å¯èƒ½æœƒæƒ³ï¼šã€Œå˜¿ Danï¼Œæˆ‘å€‘éƒ½å·²ç¶“çŸ¥é“ <code class="language-text">useEffect</code> è·Ÿ <code class="language-text">componentDidMount</code> å’Œ <code class="language-text">componentDidUpdate</code> åˆåœ¨ä¸€èµ·å¾ˆåƒäº†ï¼Œä½ ä¸èƒ½ä¸€ç›´æåˆ°å®ƒï¼ã€<strong>ä½†å³ä½¿æœ‰äº† <code class="language-text">componentDidUpdate</code>ï¼Œé€™å€‹ä»ä¸èƒ½æ­£ç¢ºåŸ·è¡Œï¼š</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// ğŸ”´ é€™å€‹æ¢ä»¶å¼æ°¸é ä¸æœƒæ˜¯ true</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>fetchData <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>fetchData<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç•¶ç„¶ï¼Œ<code class="language-text">fetchData</code> æ˜¯ä¸€å€‹ class çš„æ–¹æ³• (method)ï¼ï¼ˆæˆ–ï¼Œæ˜¯ä¸€å€‹ class çš„å±¬æ€§ â€” ä½†å®ƒä¸æœƒæ”¹è®Šä»»ä½•æ±è¥¿ã€‚ï¼‰å®ƒä¸æœƒå› ç‚ºstate æ”¹è®Šè€Œæœ‰æ‰€ä¸åŒã€‚æ‰€ä»¥ <code class="language-text">this.props.fetchData</code> æœƒå’Œ <code class="language-text">prevProps.fetchData</code> ä¿æŒä¸€æ¨£ï¼Œä¸”æˆ‘å€‘ä¸æœƒé‡æ–°ç²å–è³‡æ–™ã€‚è®“æˆ‘å€‘ç§»é™¤é€™å€‹æ¢ä»¶è©¦è©¦ï¼Ÿ</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>å™¢ç­‰ä¸€ä¸‹ï¼Œé€™å€‹åœ¨<em>æ¯æ¬¡</em>é‡æ–°æ¸²æŸ“çš„æ™‚å€™éƒ½æœƒç²å–ã€‚ï¼ˆæ–°å¢ä¸€å€‹å‹•ç•«åˆ°æ¨¹ä¸Šæ˜¯å€‹ç™¼ç¾å®ƒçš„æœ‰è¶£æ–¹å¼ã€‚ï¼‰æˆ–è¨±æˆ‘å€‘å¯ä»¥æŠŠå®ƒç¶åˆ°æŸå€‹çš„ç‰¹å®šçš„ queryï¼Ÿ</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>ä½† <code class="language-text">this.props.fetchData !== prevProps.fetchData</code> æœƒ<em>æ°¸é </em>æ˜¯ <code class="language-text">true</code>ï¼Œå³ä½¿ <code class="language-text">query</code> æ²’æœ‰æ”¹è®Šï¼æ‰€ä»¥æˆ‘å€‘<em>æ°¸é æœƒ</em>é‡æ–°ç²å–ã€‚</p>
<p>é€™å€‹ class é›£é¡Œçš„å”¯ä¸€çœŸæ­£è§£æ³•æ˜¯ç¡¬è‘—é ­çš®ç„¶å¾ŒæŠŠ <code class="language-text">query</code> æœ¬èº«å‚³é€² <code class="language-text">Child</code> å…ƒä»¶è£¡ã€‚ <code class="language-text">Child</code> ä¸æœƒçœŸçš„<em>ä½¿ç”¨</em> <code class="language-text">query</code>ï¼Œä½†ç•¶å®ƒæ”¹è®Šæ™‚å®ƒæœƒè§¸ç™¼é‡æ–°ç²å–ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    query<span class="token punctuation">:</span> <span class="token string">'react'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://hn.algolia.com/api/v1/search?query='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
    <span class="token comment">// ... ç²å–è³‡æ–™å’Œåšä¸€äº›äº‹ ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">fetchData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">}</span></span> <span class="token attr-name">query</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>query<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>query <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åœ¨ä½¿ç”¨äº† React çš„ class é€™éº¼å¤šå¹´ä»¥ä¾†ï¼Œæˆ‘å·²ç¶“å¤ªç¿’æ…£æ–¼æŠŠä¸å¿…è¦çš„ props å‚³ä¸‹å»ç„¶å¾Œç ´å£ä¸Šå±¤å…ƒä»¶çš„å°è£ï¼Œæˆ‘åªåœ¨ä¸€é€±å‰ç™¼ç¾ç‚ºä»€éº¼æˆ‘å€‘å¿…é ˆé€™éº¼åšã€‚
Over the years of working with classes with React, Iâ€™ve gotten so used to passing unnecessary props down and breaking encapsulation of parent components that I only realized a week ago why we had to do it.</p>
<p><strong>æœ‰ classï¼Œå‡½å¼çš„ props æœ¬èº«ä¸æœƒçœŸçš„æ˜¯è³‡æ–™æµçš„ä¸€éƒ¨åˆ†ã€‚</strong>æ–¹æ³•ï¼ˆmethodsï¼‰æœƒé—œæ‰ mutable <code class="language-text">this</code> è®Šæ•¸ï¼Œæ‰€ä»¥æˆ‘å€‘ä¸èƒ½ä¾é ä»–å€‘çš„èº«ä»½ä¾†è¡¨ç¤ºä»»ä½•æ±è¥¿ã€‚å› æ­¤ï¼Œå³ä½¿ç•¶æˆ‘å€‘åªæƒ³è¦ä¸€å€‹å‡½å¼ï¼Œæˆ‘å€‘å¿…é ˆç…§é †åºå‚³éä¸€å †å…¶ä»–çš„è³‡æ–™æ‰èƒ½å¤ ä¾†ã€Œå€åˆ†ã€ä»–ã€‚æˆ‘å€‘ä¸èƒ½çŸ¥é“ <code class="language-text">this.props.fetchData</code> æ˜¯å¦æ ¹æ“šæŸäº›ç‹€æ…‹è¢«ä¸Šå±¤å‚³éä¸‹ä¾†ï¼Œä¹Ÿä¸çŸ¥é“ç‹€æ…‹æ˜¯å¦æ”¹è®Šäº†ã€‚
<strong>With classes, function props by themselves arenâ€™t truly a part of the data flow.</strong> Methods close over the mutable <code class="language-text">this</code> variable so we canâ€™t rely on their identity to mean anything. Therefore, even when we only want a function, we have to pass a bunch of other data around in order to be able to â€œdiffâ€ it. We canâ€™t know whether <code class="language-text">this.props.fetchData</code> passed from the parent depends on some state or not, and whether that state has just changed.</p>
<p><strong>æœ‰äº† <code class="language-text">useCallback</code>ï¼Œå‡½å¼å¯ä»¥å®Œå…¨åƒèˆ‡è³‡æ–™æµã€‚</strong>æˆ‘å€‘å¯ä»¥èªªå¦‚æœå‡½å¼çš„è¼¸å…¥æ”¹è®Šçš„è©±ï¼Œå‡½å¼æœ¬èº«ä¹Ÿæœƒæ”¹è®Šï¼Œä½†å¦‚æœæ²’æœ‰ï¼Œå®ƒæœƒä¿æŒä¸€æ¨£ã€‚å¹¸è™§æœ‰äº† <code class="language-text">useCallback</code> æ‰€æä¾›çš„é¡†ç²’åº¦ï¼Œåƒæ˜¯ <code class="language-text">props.fetchData</code> ä¹‹é¡çš„ props çš„æ”¹è®Šå¯ä»¥è‡ªå‹•å¾€ä¸‹å‚³æ’­ã€‚</p>
<p>ç›¸ä¼¼çš„ï¼Œ<a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">useMemo</code></a>è®“æˆ‘å€‘å¯ä»¥åœ¨è¤‡é›œçš„ç‰©ä»¶åšåˆ°ç›¸åŒçš„äº‹æƒ…ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ColorPicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¸æœƒç ´å£ Child çš„æ·ºå±¤æ¯”è¼ƒ prop çš„æª¢æŸ¥</span>
  <span class="token comment">// é™¤é color çœŸçš„æ”¹è®Šã€‚</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>color<span class="token punctuation">,</span> setColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'pink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> color <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>color<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>æˆ‘æƒ³è¦å¼·èª¿æŠŠ <code class="language-text">useCallback</code> åˆ°è™•æ”¾æ˜¯æ»¿ç¬¨é‡çš„ã€‚</strong>é€™æ˜¯å€‹å¥½çš„é€ƒç”Ÿè‰™å£ï¼Œè€Œä¸”åœ¨ä¸€å€‹å‡½å¼è¢«åŒæ™‚å‚³éä¸‹å»<em>ä¸”</em>åœ¨æŸäº›å°å­©è£¡çš„ effect è£¡é¢è¢«å‘¼å«æ˜¯æœ‰ç”¨çš„ã€‚æˆ–æ˜¯ä½ æƒ³è¦è©¦è‘—ç ´å£å°å­©å…ƒä»¶çš„è¨˜æ†¶åŒ–ã€‚ä½† Hooks æ¯”è¼ƒé©åˆ<a href="https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down" target="_blank" rel="nofollow noopener noreferrer">é¿å…æŠŠæ‰€æœ‰ callbacks å¾€ä¸‹å‚³</a>ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ç¯„ä¾‹è£¡é¢ï¼Œæˆ‘æœƒæ›´å‚¾å‘æ–¼ <code class="language-text">fetchData</code> æ˜¯åœ¨æˆ‘çš„ effect è£¡é¢ï¼ˆå®ƒå¯èƒ½æ˜¯å¾æŸå€‹å®¢è£½åŒ–çš„ Hook æŠ½å‡ºçš„ï¼‰æˆ–æ˜¯ä¸€å€‹æœ€ä¸Šå±¤çš„åŒ¯å…¥ã€‚æˆ‘æƒ³è¦è®“ effect ä¿æŒç°¡å–®ï¼Œä½†è£¡é¢çš„ callbacks ä¸æœƒå¹«åŠ©é€™å€‹ã€‚ï¼ˆã€Œå¦‚æœæŸäº› <code class="language-text">props.onComplete</code> callback åœ¨ request é€”ä¸­æ”¹è®Šäº†æ€éº¼è¾¦ï¼Ÿã€ä½ å¯ä»¥<a href="#swimming-against-the-tide">æ¨¡æ“¬ class çš„è¡Œç‚º</a> ä½†å®ƒä¸æœƒè§£æ±º ç«¶çˆ­æ¢ä»¶ï¼ˆrace conditionsï¼‰ã€‚ï¼‰</p>
<h2 id="è¬›åˆ°ç«¶çˆ­æ¢ä»¶ï¼ˆrace-conditionsï¼‰"><a href="#%E8%AC%9B%E5%88%B0%E7%AB%B6%E7%88%AD%E6%A2%9D%E4%BB%B6%EF%BC%88race-conditions%EF%BC%89" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>è¬›åˆ°ç«¶çˆ­æ¢ä»¶ï¼ˆRace Conditionsï¼‰</h2>
<p>ä¸€å€‹ç¶“å…¸çš„æœ‰ class çš„è³‡æ–™ç²å–ä¾‹å­å¦‚åŒä¸‹é¢é€™æ¨£ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    article<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">async</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> article <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚åŒä½ å¯èƒ½çŸ¥é“çš„ï¼Œé€™æ®µç¨‹å¼ç¢¼æ˜¯æœ‰å•é¡Œçš„ã€‚å®ƒä¸æœƒè™•ç†æ›´æ–°ã€‚æ‰€ä»¥ç¬¬äºŒç¨®ä½ åœ¨ç·šä¸Šæ‰¾å¾—åˆ°çš„ç¶“å…¸ç¯„ä¾‹æœƒåƒé€™æ¨£ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    article<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span>id <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token keyword">async</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> article <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>é€™å€‹ä¸€å®šæ›´å¥½ï¼ä½†å®ƒä»ç„¶æœ‰å•é¡Œã€‚å®ƒæœƒæœ‰å•é¡Œçš„åŸå› æ˜¯å› ç‚ºé€™å€‹ request å¯èƒ½æœƒä¸ç…§é †åºã€‚æ‰€ä»¥å¦‚æœæˆ‘ç²å– <code class="language-text">{id: 10}</code>ï¼Œè½‰æ›åˆ° <code class="language-text">{id: 20}</code>ï¼Œä½† <code class="language-text">{id: 20}</code> çš„ request æ¯”è¼ƒæ—©ç™¼ç”Ÿï¼Œé€™å€‹æ¯”è¼ƒæ—©ç™¼ç”Ÿä½†æ¯”è¼ƒæ™šçµæŸçš„ request æœƒéŒ¯èª¤çš„è¦†è“‹æ‰æˆ‘çš„ stateã€‚</p>
<p>é€™å«åšç«¶çˆ­æ¢ä»¶ï¼ˆrace conditionï¼‰ï¼Œå®ƒåœ¨æ“æœ‰ <code class="language-text">async</code> / <code class="language-text">await</code> çš„ç”±ä¸Šè€Œä¸‹çš„è³‡æ–™æµï¼ˆprops æˆ– state æœƒåœ¨æŸå€‹ async å‡½å¼çš„ä¸­é–“ç™¼ç”Ÿï¼‰çš„ç¨‹å¼ç¢¼è£¡å¾ˆå¸¸è¦‹ï¼ˆå‡è¨­äº†æŸäº›æœƒç­‰å¾…çµæœï¼‰ã€‚</p>
<p>Effect ä¸¦ä¸æœƒç¥å¥‡çš„è§£æ±ºé€™å€‹å•é¡Œï¼Œé›–ç„¶å¦‚æœä½ å˜—è©¦æƒ³è¦æŠŠ <code class="language-text">async</code> å‡½å¼ç›´æ¥å‚³é€² effect è£¡ï¼Œå®ƒå€‘æœƒè­¦å‘Šä½ ã€‚ï¼ˆæˆ‘å€‘éœ€è¦æ”¹é€²é€™å€‹è­¦å‘Šè®“å®ƒèƒ½å¤ æ›´æ¸…æ¥šçš„å‘Šè¨´ä½ å¯èƒ½æœƒé‡åˆ°ä»€éº¼å•é¡Œã€‚ï¼‰</p>
<p>å¦‚æœä½ æ‰€ä½¿ç”¨çš„ async æ–¹å¼æ”¯æ´å–æ¶ˆï¼Œé‚£å¾ˆæ£’ï¼ä½ å¯ä»¥åœ¨ä½ çš„ cleanup å‡½å¼è£¡é¢å–æ¶ˆ async requestã€‚</p>
<p>å¦å¤–ï¼Œæœ€ç°¡å–®çš„æ¬Šå®œä¹‹è¨ˆæ˜¯åˆ©ç”¨å¸ƒæ—å€¼ä¾†è¿½è¹¤å®ƒï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Article</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>article<span class="token punctuation">,</span> setArticle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">let</span> didCancel <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> article <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token function">fetchArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>didCancel<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>        <span class="token function">setArticle</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      didCancel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">é€™ç¯‡æ–‡ç« </a>æä¾›äº†æ›´å¤šé—œæ–¼ä½ å¯ä»¥æ€éº¼è™•è£¡éŒ¯èª¤å’Œè£è¼‰ç‹€æ…‹ï¼Œä»¥åŠå¾å®¢è£½åŒ–çš„ hook è£¡æŠ½å‡ºé‚è¼¯çš„ç´°ç¯€ã€‚å¦‚æœä½ å°å­¸ç¿’æ›´å¤šé—œæ–¼å¦‚ä½•ä½¿ç”¨ Hook ä¾†ç²å–è³‡æ–™æœ‰èˆˆè¶£ï¼Œæˆ‘æ¨è–¦ä½ çœ‹çœ‹é€™ç¯‡æ–‡ç« ã€‚</p>
<h2 id="æé«˜æ¨™æº–"><a href="#%E6%8F%90%E9%AB%98%E6%A8%99%E6%BA%96" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æé«˜æ¨™æº–</h2>
<p>æœ‰äº† class çš„ç”Ÿå‘½é€±æœŸçš„å¿ƒæ…‹ï¼Œå‰¯ä½œç”¨ï¼ˆside effectï¼‰æœƒèˆ‡æ¸²æŸ“çš„è¼¸å‡ºè¡Œç‚ºæœ‰æ‰€ä¸åŒã€‚æ¸²æŸ“ä½¿ç”¨è€…ä»‹é¢æ˜¯è¢« props å’Œ state æ‰€é©…ä½¿çš„ï¼Œè€Œä¸”æ˜¯ä¿è­‰æœƒèˆ‡å®ƒå€‘ä¸€è‡´ï¼Œä½†å‰¯ä½œç”¨ä¸æ˜¯ã€‚é€™æ˜¯å¸¸è¦‹çš„å•é¡Œä¾†æºã€‚</p>
<p>æœ‰äº† <code class="language-text">useEffect</code> çš„å¿ƒç†æ¨¡å‹ï¼Œäº‹æƒ…æœƒé è¨­ç‚ºåŒæ­¥ã€‚å‰¯ä½œç”¨æœƒè®Šæˆ React è³‡æ–™æµçš„ä¸€éƒ¨åˆ†ã€‚æ¯å€‹ <code class="language-text">useEffect</code> çš„å‘¼å«ï¼Œåªè¦ä½ ç”¨å°å®ƒï¼Œä½ çš„å…ƒä»¶å°±æœƒæŠŠé‚Šç·£æƒ…æ³è™•ç†å¾—å¾ˆå¥½ã€‚</p>
<p>ç„¶è€Œï¼Œè¦æ­£ç¢ºä½¿ç”¨å®ƒçš„é è¨­æˆæœ¬æ˜¯æ›´é«˜çš„ã€‚é€™å¯èƒ½æœƒæœ‰é»æƒ±äººã€‚å¯«èƒ½å¤ è™•ç†å¥½é‚Šç·£æƒ…æ³çš„åŒæ­¥åŒ–ç¨‹å¼ç¢¼ï¼Œæœ¬è³ªä¸Šæ˜¯æ¯”è§¸ç™¼ä¸€å€‹èˆ‡æ¸²æŸ“ä¸ä¸€è‡´çš„å‰¯ä½œç”¨é‚„é›£ã€‚</p>
<p>å¦‚æœ <code class="language-text">useEffect</code> æ˜¯ç”¨ä¾†ç•¶ä½œä½ æœ€å¸¸ä½¿ç”¨çš„<em>é‚£å€‹</em>å·¥å…·ï¼Œé€™å€‹å¯èƒ½æ˜¯ä»¤äººæ“”æ†‚çš„ã€‚ç„¶è€Œï¼Œå®ƒæ˜¯ä½ç´šåˆ¥çš„å»ºè¨­åŸºçŸ³ã€‚ç¾åœ¨æ˜¯ Hook çš„æ—©æœŸï¼Œæ‰€ä»¥æ¯å€‹äººéƒ½ä½¿ç”¨ä½ç´šåˆ¥çš„æ–¹æ³•ï¼Œå°¤å…¶æ˜¯åœ¨æ•™å­¸æ–‡ä»¶è£¡ã€‚ä½†å¯¦éš›ä¸Šï¼Œç¤¾ç¾¤å¾ˆæœ‰å¯èƒ½æœƒé–‹å§‹ç§»å¾€é«˜ç´šåˆ¥çš„ Hooks ï¼Œå› ç‚ºå¥½çš„ API æœƒç²å¾—é©…å‹•çš„åŠ›é‡ã€‚</p>
<p>æˆ‘çœ‹éä¸åŒçš„æ‡‰ç”¨ç¨‹å¼å‰µé€ å®ƒå€‘è‡ªå·±çš„ Hooksï¼Œåƒæ˜¯å°è£æŸäº›èªè­‰é‚è¼¯çš„ <code class="language-text">useFetch</code>ï¼Œæˆ–æ˜¯ä½¿ç”¨ä¸»é¡Œ context çš„ <code class="language-text">useTheme</code>ã€‚ä¸€æ—¦ä½ æœ‰äº†é‚£äº›æ±è¥¿çš„å·¥å…·ç®±ï¼Œä½ ä¸ç”¨é€™éº¼<em>å¸¸</em>ä½¿ç”¨ <code class="language-text">useEffect</code>ã€‚ä½†å®ƒå¸¶ä¾†çš„å½ˆæ€§ä½¿å¾—æ¯å€‹ç«‹åŸºæ–¼å®ƒä¸Šé¢çš„ hooks æœ‰æ›´å¤šå¥½è™•ã€‚</p>
<p>ç›®å‰ç‚ºæ­¢ï¼Œ<code class="language-text">useEffect</code> æœ€å¸¸ç”¨ä¾†ç²å–è³‡æ–™ã€‚ä½†ç²å–è³‡æ–™ä¸¦ä¸æ˜¯ä¸€å€‹åŒæ­¥åŒ–çš„å•é¡Œã€‚é€™å€‹å°¤å…¶æ˜é¡¯å› ç‚ºæˆ‘å€‘çš„ deps å¸¸å¸¸æ˜¯ <code class="language-text">[]</code>ã€‚é‚£æˆ‘å€‘åˆ°åº•åœ¨åŒæ­¥ä»€éº¼ï¼Ÿ</p>
<p>é•·æœŸä¾†çœ‹ï¼Œ<a href="https://reactjs.org/blog/2018/11/27/react-16-roadmap.html#react-16x-mid-2019-the-one-with-suspense-for-data-fetching" target="_blank" rel="nofollow noopener noreferrer">ç²å–è³‡æ–™çš„æš«åœï¼ˆSuspenseï¼‰</a>å°‡æœƒå…è¨±ç¬¬ä¸‰æ–¹çš„å¥—ä»¶æœ‰ç¬¬ä¸€æµçš„æ–¹æ³•ä¾†å‘Šè¨´ React ç›´åˆ°æŸäº› async ï¼ˆä»»ä½•æ±è¥¿ï¼šç¨‹å¼ç¢¼ï¼Œè³‡æ–™ï¼Œåœ–ç‰‡ï¼‰å¥½äº†ä¹‹å¾Œä¾†æš«åœæ¸²æŸ“ã€‚</p>
<p>Suspense é€æ¼¸åŒ…å«äº†æŸäº›è³‡æ–™ç²å–çš„ä½¿ç”¨æƒ…å½¢ï¼Œæˆ‘é æœŸ <code class="language-text">useEffect</code> æœƒåœ¨ä½ çœŸçš„æƒ³è¦åœ¨å‰¯ä½œç”¨è£¡åŒæ­¥æŸäº› props æˆ– state æ™‚ï¼Œç•¶ä½œä¸€å€‹æ¼¸å…¥èƒŒæ™¯çš„å¼·è€Œæœ‰åŠ›çš„å·¥å…·ã€‚ä¸åŒæ–¼ç²å–è³‡æ–™ï¼Œå®ƒè‡ªç„¶çš„è™•ç†äº†é€™æ¨£çš„æƒ…æ³ï¼Œå› ç‚ºå®ƒå°±æ˜¯è¨­è¨ˆä¾†å¦‚æ­¤çš„ã€‚ä½†ç›´åˆ°é‚£æ™‚ï¼Œå®¢è£½åŒ–çš„ Hooks åƒæ˜¯<a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="nofollow noopener noreferrer">é€™è£¡æ‰€é¡¯ç¤ºçš„</a>æ˜¯å€‹é‡è¤‡ä½¿ç”¨ç²å–è³‡æ–™é‚è¼¯çš„å¥½æ–¹æ³•ã€‚</p>
<h2 id="å¯«åœ¨æœ€å¾Œ"><a href="#%E5%AF%AB%E5%9C%A8%E6%9C%80%E5%BE%8C" aria-hidden class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>å¯«åœ¨æœ€å¾Œ</h2>
<p>ç¾åœ¨ä½ å·²ç¶“çŸ¥é“æˆ‘æ‰€çŸ¥é“é—œæ–¼ä½¿ç”¨ effect çš„æ‰€æœ‰äº‹æƒ…äº†ï¼Œå›å»çœ‹ä¸€é–‹å§‹çš„<a href="#tldr">æ‘˜è¦</a>ï¼Œå®ƒçœ‹èµ·ä¾†åˆç†å—ï¼Ÿæˆ‘æœ‰å¿½ç•¥æ‰ä»€éº¼å—ï¼Ÿï¼ˆæˆ‘é‚„æ²’ç”¨å…‰æˆ‘çš„ç´™ï¼ï¼‰</p>
<p>æˆ‘æœƒå¾ˆæƒ³åœ¨æ¨ç‰¹ä¸Šè½è½ä½ å€‘çš„æƒ³æ³•ï¼æ„Ÿè¬é–±è®€ã€‚</p></div><footer><p><a href="https://mobile.twitter.com/search?q=https%3A%2F%2Foverreacted.io%2Fa-complete-guide-to-useeffect%2F" target="_blank" rel="noopener noreferrer">Discuss on Twitter</a> â€¢ <a href="https://github.com/gaearon/overreacted.io/edit/master/src/pages/a-complete-guide-to-useeffect/index.zh-hant.md" target="_blank" rel="noopener noreferrer">Edit on GitHub</a></p></footer></article></main><aside><div style="margin:90px 0 40px 0;font-family:system-ui, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
    &quot;Roboto&quot;, &quot;Oxygen&quot;, &quot;Ubuntu&quot;, &quot;Cantarell&quot;, &quot;Fira Sans&quot;,
    &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif"><form action="https://app.convertkit.com/forms/812047/subscriptions" class="seva-form formkit-form" method="post" min-width="400 500 600 700 800" style="background-color:rgb(255, 255, 255);border-radius:6px"><div data-style="full"><div data-element="column" class="formkit-column" style="background-color:rgb(249, 250, 251)"><h1 class="formkit-header" data-element="header" style="color:rgb(77, 77, 77);font-size:20px;font-weight:700">Join the Newsletter</h1><div data-element="subheader" class="formkit-subheader" style="color:rgb(104, 104, 104)"><p>Subscribe to get my latest content by email.</p></div><div class="formkit-image"><svg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 46 46" style="max-width:100%"><g fill="none" fill-rule="evenodd"><path fill="#DD92AB" d="M23,36 C22.813,36 22.627,35.948 22.463,35.844 L0.463,21.844 C0.159,21.651 -0.017,21.308 0.001,20.948 C0.02,20.589 0.23,20.266 0.553,20.105 L23,6 L45.447,20.105 C45.769,20.266 45.98,20.588 45.999,20.948 C46.018,21.308 45.841,21.65 45.537,21.844 L23.537,35.844 C23.373,35.948 23.187,36 23,36 Z"></path><path fill="#FFF" d="M38,37 L8,37 L8,1 C8,0.448 8.448,0 9,0 L37,0 C37.552,0 38,0.448 38,1 L38,37 Z"></path><path fill="#FFA7C4" d="M45,46 C44.916,46 44.831,45.989 44.748,45.968 L21.748,39.968 L22,33 L46,21 L46,45 C46,45.31 45.856,45.602 45.611,45.792 C45.435,45.928 45.219,46 45,46 Z"></path><path fill="#FFC3D7" d="M45,46 L1,46 C0.447,46 0,45.552 0,45 L0,21 L45.479,44.122 C45.88,44.341 46.083,44.804 45.969,45.247 C45.856,45.69 45.457,46 45,46 Z"></path><path fill="#FFA7C4" d="M19 20.414L14.293 15.707C13.902 15.316 13.902 14.684 14.293 14.293L19 9.586 20.414 11 16.414 15 20.414 19 19 20.414zM27 20.414L25.586 19 29.586 15 25.586 11 27 9.586 31.707 14.293C32.098 14.684 32.098 15.316 31.707 15.707L27 20.414z"></path></g></svg></div></div><div data-element="column" class="formkit-column"><ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul><div data-element="fields" class="seva-fields formkit-fields"><div class="formkit-field"><input type="text" class="formkit-input" aria-label="Your first name" name="fields[first_name]" placeholder="Your first name" style="border-color:rgb(227, 227, 227);border-radius:4px;color:rgb(0, 0, 0);font-weight:400"/></div><div class="formkit-field"><input type="email" class="formkit-input" name="email_address" aria-label="Your email address" placeholder="Your email address" style="border-color:rgb(227, 227, 227);border-radius:4px;color:rgb(0, 0, 0);font-weight:400"/></div><button data-element="submit" class="formkit-submit formkit-submit" style="background-color:hsl(340, 63%, 55%);border-radius:24px;color:white;font-weight:700"><div class="formkit-spinner"></div><span>Subscribe</span></button></div><div data-element="guarantee" class="formkit-guarantee" style="color:rgb(77, 77, 77);font-size:13px;font-weight:400"><p>I wonâ€™t send you spam.</p><p>Unsubscribe at <em>any</em> time.</p></div></div></div></form></div><h3 style="font-family:Montserrat, sans-serif;margin-top:0.4375rem"><a style="box-shadow:none;text-decoration:none;color:var(--pink)" href="/">Overreacted</a></h3><div style="display:flex;margin-bottom:3.5rem"><img src="/static/profile-pic-69c77131fd248a7aaaf26fab021f469f.png" alt="Yusuf Unlu" style="margin-right:0.875rem;margin-bottom:0;height:3.5rem;border-radius:50%"/><p style="max-width:310px">Personal blog by <a href="https://mobile.twitter.com/yufusunlu">Yusuf Unlu</a>.<!-- --> <!-- -->IÂ explain with words and code.</p></div><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li></li><li></li></ul></nav></aside></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-130227707-1', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"zh-hant-a-complete-guide-to-useeffect-24c","path":"/zh-hant/a-complete-guide-to-useeffect/"};window.dataPath="288/path---zh-hant-a-complete-guide-to-useeffect-24-c-998-BcBa62OQojfelSLHwYmmdz6dcKs";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-83825dcbe188439d174e.js"],"component---src-templates-blog-index-js":["/component---src-templates-blog-index-js-1d061c91bf8b4d1ed13d.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.f3aea2f29a9b96501823.css","/component---src-templates-blog-post-js-5ff9d93420b5b2cefece.js"],"component---src-pages-404-js":["/component---src-pages-404-js.e9c5c3b80c5e9b8c6fa0.css","/component---src-pages-404-js-6115a896c1bd484b3973.js"],"component---src-pages-confirm-js":["/component---src-pages-confirm-js.e9c5c3b80c5e9b8c6fa0.css","/component---src-pages-confirm-js-e5c8bcda280c240e1d6e.js"],"component---src-pages-thanks-js":["/component---src-pages-thanks-js.e9c5c3b80c5e9b8c6fa0.css","/component---src-pages-thanks-js-bd098f6660863fbb8af2.js"],"pages-manifest":["/pages-manifest-f3e11a74ebf6959e04be.js"]};/*]]>*/</script><script src="/webpack-runtime-dea655677e505366ecd7.js" async=""></script><script src="/1-1b550cd61a5e170131aa.js" async=""></script><script src="/2-31a6021f1637c5720eda.js" async=""></script><script src="/0-b197e8c6c7ff26484233.js" async=""></script><script src="/app-83825dcbe188439d174e.js" async=""></script><script src="/component---src-templates-blog-post-js-5ff9d93420b5b2cefece.js" async=""></script></body></html>